<!doctype html>
<meta charset="utf-8">
<title>Software Carpentry: (Draft Version )</title>
<body>
<br>

<h2>Welcome</h2> 
<ul> 
<li>These notes are part of a course on software development skills for 
scientists and engineers being prepared by Greg Wilson for the Python Software 
Foundation</li> 
<li>Please use the links included with the slides to provide comments and 
feedback</li> 
<li>Comment on this slide</li> </ul> 
<h2>Course Outline</h2> 
<ul> 
<li>Introduction</li> 
<li>Version Control</li> 
<li>Shell Basics</li> 
<li>More Shell</li> 
<li>Basic Scripting</li> 
<li>Strings, Lists, and Files</li> 
<li>Functions, Libraries, and the File System</li> 
<li>Testing Basics</li> 
<li>Dictionaries and Error Handling</li> 
<li>Debugging</li> 
<li>Object-Oriented Programming</li> 
<li>Structured Unit Testing</li> 
<li>Automated Builds</li> 
<li>Coding Style and Reading Code</li> 
<li>Watching Programs Run</li> 
<li>Regular Expressions</li> 
<li>Basic XML and XHTML</li> 
<li>A Mini-Project</li> 
<li>Binary Data</li> 
<li>Relational Databases</li> 
<li>Client-Side Web Programming</li> 
<li>CGI</li> 
<li>Security</li> 
<li>Teamware</li> 
<li>Extreme Programming</li> 
<li>The ICONIX Process</li> 
<li>The Nevex Process</li> 
<li>Backward, Forward, and Sideways</li> 
<li>Bibliography</li> 
<li>Glossary</li> 
<li>Online Resources</li> 
<li>List of Figures</li> 
<li>List of Tables</li> 
<li>Syllabus</li> 
<li>Comment on this slide</li> </ul> 
<h2>Acknowledgments</h2> 
<ul> 
<li>The <code>Python Software Foundation</code>, for the grant that made this 
work possible</li> 
<li>The <code>University of Toronto</code>, for letting me test this version 
of this course on its students</li> 
<li>Its <code>Department of Computer Science</code>, for giving me a home, and 
making me feel welcome</li> 
<li>Brent Gorda, who helped create the first version of this course</li> 
<li>Heather Mayer, for the artwork</li> 
<li><code>YesLogic</code>, for generously donating licenses for Prince (their 
XML-to-PDF converter)</li> 
<li>The many people who commented on this material, and suggested ways to 
improve it:
<ul> 
<li> Hossein Bidhendi Stephane Bortzmeyer Michelle Craig Simon Duane Paul 
Dubois Hans Fangohr Brent Gorda <br>
Adam Goucher Perry Greenfield Paul Gries 
Brandon King Catherine Letondal Michelle Levesque Andy Lumsdaine <br>
Laurie 
MacDougall Keir Mierle Kit-Sun Ng Dirkjan Ochtman Victor Putz Irving Reid Karen 
Reid <br>
Paul Salvini Diomidis Spinellis Bill Spotz Tom Van Vleck Jim Vickroy 
<br> <br>
</li> </ul></li> 
<li>Frank Willison&mdash;I'm sorry this one was finished too late for you to 
tune up
<ul> 
<li> <br>
<br>
</li> </ul></li> 
<li>John Scopes, and everyone else with the courage to fight for the idea that 
the truth is more important than doctrine</li> 
<li>Comment on this slide</li> </ul> top next <br>
<br>

<h1>Introduction</h1> prev  Draft Version 556 next <br>
<br>

<h2>Motivation</h2> 
<ul> 
<li>Computers are as important to scientists as telescopes and test tubes 
<ul> 
<li>Analyze problems that are too complex for traditional means</li> 
<li>Simulate things that can't be studied in laboratories</li> </ul></li> 
<li>Many scientists now spend much of their professional lives writing and 
maintaining software
<ul> 
<li>A quarter of graduate students in science and engineering spend 25-50% of 
their time programming</li> </ul></li> 
<li>But most scientists have never been taught how to do this efficiently 
<ul> 
<li>It's a long way from the loops and arrays of first year to simulating bone 
development in foetal marsupials&hellip;</li> 
<li>Like being shown how to differentiate polynomials, then expected to invent 
the rest of calculus</li> </ul></li> 
<li>This course will teach you how to design, build, maintain, and share 
programs more efficiently
<ul> 
<li>Focus: tools and techniques appropriate for half a dozen people working 
together for a year
<ul> 
<li>Everything you do at that scale will also make you more productive when 
you're working on your own for a week</li> </ul></li> 
<li>Will <em>not</em> turn you into a computer scientist 
<ul> 
<li>Far too many of them around anyway</li> </ul></li> 
<li>Instead, goal is to teach you the equivalent of good laboratory technique 
for computational science
<ul> 
<li>The 20% of ideas that account for 80% of real world use</li> 
<li>Software carpentry, rather than software engineering</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Meeting Standards</h2> 
<ul> 
<li>Experimental results are only publishable if they are believed to be <em>
correct</em> and <em>reproducible</em> 
<ul> 
<li>Equipment calibrated, samples uncontaminated, relevant steps recorded</li> 
<li>In practice, almost always rely on the professionalism of the people doing 
the work</li> </ul></li> 
<li>How well do computational scientists meet these standards? 
<ul> 
<li>Correctness of code rarely questioned 
<ul> 
<li>We all know programs are buggy, but when was the last time you saw a paper 
rejected because of concerns over the quality of the software used to produce 
the results?</li> </ul></li> 
<li>Reproducibility often nonexistent 
<ul> 
<li>How many people can reproduce, much less trace, each computational result 
in their thesis?</li> </ul></li> </ul></li> 
<li>The times they are a-changing 
<ul> 
<li>Standards for computational work can only go up</li> 
<li>Change can happen almost overnight 
<ul> 
<li>Like the American car market when German and Japanese imports appeared in 
the 1970s</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Most Important Idea in This Course</h2> 
<ul> 
<li><em>Improving quality improves productivity</em></li> 
<li>I.e., the tools and techniques you must adopt to produce better code also 
help you write more code, faster</li> 
<li>Comment on this slide</li> </ul> 
<h2>Who You Are</h2> 
<ul> 
<li>User stories 
<ul> 
<li>Important part of designing user interfaces for mass-distribution software
</li> 
<li>Helps make discussion of features and usability more concrete</li> </ul>
</li> 
<li>Harry 
<ul> 
<li>27; B.Sc. in zoology</li> 
<li>Did an introductory Fortran course nine years ago, and attended a workshop 
on web-based bioinformatics tools when he started his job</li> 
<li>Now developing fuzzy pattern-matching algorithms for Genes'R'Us, a biotech 
firm with labs in four countries</li> </ul></li> 
<li>Ron 
<ul> 
<li>24; B.Eng in mechanical engineering, now doing an M.Sc. part time</li> 
<li>Did C in first year; has been using MATLAB ever since</li> 
<li>Modeling thermal degradation (a.k.a. &ldquo;melting&rdquo;) of 
firefighters' helmets</li> </ul></li> 
<li>Hermione 
<ul> 
<li>34; Ph.D. in physics</li> 
<li>Took two courses on C and two on numerical analysis as an undergrad, and a 
computer graphics course as a graduate student</li> 
<li>Now in charge of the 5-person flywheel braking group at Yoyodyne Inc.</li> 
</ul></li> 
<li>Ginny 
<ul> 
<li>22; finished a B.Eng. in chemical engineering last year, now doing an 
M.Sc. in biochemistry</li> 
<li>Did C in first year, and has built a personal web site (static HTML only)
</li> 
<li>Thesis topic is improving the yield of organic fullerene production</li> 
</ul></li> 
<li>Albus 
<ul> 
<li>47; Ph.D. in mathematics; studies large random graphs using both analytic 
and computational techniques</li> 
<li>Undergraduate degree in Mathematics and Computer Science in the 1970s; 
programs mainly in C++</li> 
<li>Professor at Euphoric State University; former chair of graduate studies
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Quick Self-Test</h2> 
<ul> 
<li>Adapted from [Spolsky 2004] and [McConnell 1997] 
<ul> 
<li>1 for &ldquo;yes&rdquo;, 0 for &ldquo;no&rdquo;, and -1 if you don't 
understand the question</li> </ul></li> 
<li>So: 
<ul> 
<li>Do you use version control?</li> 
<li>Can you rebuild everything in one step?</li> 
<li>Do you have an automated test suite?</li> 
<li>Do you build the software, and run the test suite, daily?</li> 
<li>Do you have a bug database?</li> 
<li>Do you use a symbolic debugger?</li> 
<li>Do you use a style checker to ensure that your software is written in a 
uniform, readable way?</li> 
<li>Can you trace everything you release back to the software that produced it?
</li> 
<li>Do you document as you program, and keep your documentation in your source 
files?</li> 
<li>Can you set up a development environment (including any libraries you 
need) on a fresh machine without heroic effort?</li> 
<li>Do you have a schedule with small binary milestones?</li> 
<li>Do you estimate how long tasks will take before you start, and compare 
that with how long they actually took?</li> 
<li>If you're working with others, or developing software that other people 
may use:
<ul> 
<li>Do you test your interfaces using paper prototypes before implementing 
them?</li> 
<li>Is there a searchable archive of discussions about the project?</li> 
<li>Do team members write and share small tools for automating common tasks?
</li> 
<li>Does your schedule allow for infrastructure development, training, sick 
time, etc.?</li> </ul></li> </ul></li> 
<li>And your score is?</li> 
<li>Comment on this slide</li> </ul> 
<h2>Learn by Building</h2> 
<ul> 
<li>So why are we where we are? 
<ul> 
<li>It's difficult to learn these things from academic computer scientists 
<ul> 
<li>CS research is more concerned with rapid prototyping than with reliability
</li> </ul></li> 
<li>People are naturally sceptical of innovation 
<ul> 
<li>Particularly after they've seen a few bandwagons roll through</li> 
<li>Glass's Law [Glass 2002] : any new way of doing things initially slows you 
down</li> </ul></li> 
<li>You only have to be as good as the competition 
<ul> 
<li>American auto makers in the 1970s</li> </ul></li> </ul></li> 
<li>This course's approach: 
<ul> 
<li>Introduce some basic tools 
<ul> 
<li>Students immediately see benefit of taking the course</li> 
<li>Tools can be used to manage the course itself</li> </ul></li> 
<li>Show students how to build tools like these 
<ul> 
<li>Where &ldquo;how&rdquo; includes both what goes into the software, and how 
to create it</li> 
<li>Solidifies understanding of tools' capabilities and limitations</li> 
<li>Makes discussion of technique more concrete</li> </ul></li> 
<li>Show students what else they can do with their new skills 
<ul> 
<li>The right way to tackle issues that come up over and over again</li> </ul>
</li> </ul></li> 
<li>Key point: avoid overload 
<ul> 
<li>People who already know these things tend to underestimate how hard they 
are to learn</li> 
<li>No point preaching to the converted</li> 
<li>Try instead to move the middle of the bell curve to the right</li> </ul>
</li> 
<li>Why is the course called software &ldquo;carpentry&rdquo;? 
<ul> 
<li>Because it focuses on the details of the craft</li> 
<li>If software engineering is about building an electronic version of the 
Channel Tunnel, this stuff is the equivalent of putting an extension on the 
house</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Topics</h2> 
<ul> 
<li>Shell programming</li> 
<li>Version control</li> 
<li>Automating builds</li> 
<li>Python (4 lectures)</li> 
<li>Systematic debugging</li> 
<li>Higher-level programming (2 lectures)</li> 
<li>Testing (2 lectures)</li> 
<li>Coding style and reading code</li> 
<li>Data crunching (4 lectures)</li> 
<li>Web programming and security (3 lectures)</li> 
<li>Software development project tools and processes (4 lectures)</li> 
<li>Comment on this slide</li> </ul> 
<h2>Setting Up</h2> 
<ul> 
<li>Some previous programming experience 
<ul> 
<li><code>for</code> loops, <code>if</code>/<code>then</code>/<code>else</code>
</li> 
<li>Function calls</li> 
<li>Arrays</li> 
<li>File I/O</li> 
<li>Compilation</li> </ul></li> 
<li>Individual setup 
<ul> 
<li>Python (version 2.4 or higher)</li> 
<li>Cygwin (on Windows)</li> 
<li>An editor 
<ul> 
<li>We'll look at smart ones later in the course</li> </ul></li> 
<li>Subversion 
<ul> 
<li>We'll spend a lecture on this next week</li> </ul></li> </ul></li> 
<li>Time 
<ul> 
<li>Expect to spend 2-3 hours outside class for each lecture</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Recommended Reading</h2> 
<ul> 
<li>&ldquo;If you only have time to read one book, make time to read two&rdquo;
<ul> 
<li> [Glass 2002] summarizes what we actually know about programmers' 
productivity</li> 
<li> [Hunt &amp; Thomas 1999] and [Gunderloy 2004] are about the things that 
distinguish good programmers from bad ones</li> 
<li> [Lutz &amp; Ascher 2003] is the standard introduction to Python 
<ul> 
<li> [Pilgrim 2004] is also good, and is available on-line</li> </ul></li> 
<li> [Langtangen 2004] is a comprehensive introducton to Python aimed squarely 
at scientists and engineers
<ul> 
<li>Goes into much more detail than this course will</li> 
<li>But doesn't address broader issues, such as programming practices</li> 
</ul></li> 
<li>See the Bibliography for others</li> </ul></li> 
<li>Check out some of the Online Resources as well</li> 
<li>Comment on this slide</li> </ul> 
<h2>Typographic Conventions</h2> 
<ul> 
<li><code>Code fragments</code></li> 
<li><code>Commands</code></li> 
<li><em>Definitions</em></li> 
<li><code>&lt;elements/&gt;</code></li> 
<li><em>Mathematics</em></li> 
<li><code>&lceil;Regular expressions&rfloor;</code></li> 
<li><code>&quot;Strings&quot;</code></li> 
<li><code>Tags</code></li> 
<li><code>Attributes</code></li> 
<li><code>URLs</code></li> 
<pre>Source code. </pre> 
<pre>Interactive commands. </pre> 
<pre>Program output. </pre> 
<pre>Program errors. </pre> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Version Control</h1> prev  Draft Version 534 next <br>
<br>

<h2>Problem #1: Synchronizing Files</h2> 
<ul> 
<li>Want to work on one set of files on three different machines 
<ul> 
<li>Home, office, a friend's</li> </ul></li> 
<li>Option 1: use a shared file system 
<ul> 
<li>Difficult to set up 
<ul> 
<li>And even more difficult to make secure</li> </ul></li> 
<li>Inflexible: what if you're on the road?</li> </ul></li> 
<li>Option 2: Carry around a floppy or USB dongle 
<ul> 
<li>Have to remember to copy files onto it and then off again</li> 
<li>What if your project is too big?</li> </ul></li> 
<li>Option 3: mail, FTP, SCP, etc. 
<ul> 
<li>Still have to remember to push and pull exactly the right files at exactly 
the right time</li> </ul></li> 
<li>Option 4: get the computer to do the work 
<ul> 
<li>Keep a master copy in one place</li> 
<li>Use a program to synchronize working copies when and as needed</li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Problem #2: Undoing Changes</h2> 
<ul> 
<li>Often want to undo changes to a file 
<ul> 
<li>Start work, realize it's the wrong approach, want to get back to starting 
point</li> 
<li>Like &ldquo;undo&rdquo; in an editor&hellip;</li> 
<li>&hellip;but longer-lived&mdash;keep the whole history of every file, 
forever</li> </ul></li> 
<li>Similarly, often want to see who changed what, and when 
<ul> 
<li>When working in teams, want to see what your partners did</li> 
<li>Bugs are more likely to be in fresh code than in code that's been running 
for a long time</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Solution: Version Control</h2> 
<ul> 
<li>Solve both problems at once by using a <em>version control system</em> 
(VCS)</li> 
<li>Mechanics: 
<ul> 
<li>Keep the master copy of every file in a central <em>repository</em> 
<ul> 
<li>Actually, keep <em>all</em> old versions of every file</li> </ul></li> 
<li>Everyone on the development team does their work in a <em>working copy</em>
</li> 
<li>When you're ready to share your changes, you <em>commit</em> them to the 
repository</li> 
<li>The VCS saves the old version of the file, then writes your changes on top 
<ul> 
<li>Also records the time of the change, who made it, and a comment</li> </ul>
</li> 
<li>Take a look in a moment at what happens if two or more people try to make 
changes at the same time</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>CVS and Subversion</h2> 
<ul> 
<li>Two open source version control systems in widespread use 
<ul> 
<li>Many others available commercially</li> 
<li>If you can afford it, use <em>Perforce</em></li> </ul></li> 
<li><em>CVS</em> (Concurrent Version System) 
<ul> 
<li>Invented in the 1980s</li> 
<li>Very popular, but showing its age</li> 
<li>Flaw #1: it keeps track of each file separately 
<ul> 
<li>But authors often change several files in tandem</li> 
<li>Since CVS has no notion of a &ldquo;batch submit&rdquo;, there's no 
reliable way to say, &ldquo;What other changes were made in conjunction with 
this one?&rdquo;</li> </ul></li> 
<li>Flaw #2: you can create new directories, but can't ever delete old ones
</li> </ul></li> 
<li><em>Subversion</em> 
<ul> 
<li>Designed as a backward-compatible replacement for CVS starting in 2000</li>
<li>Fixes both of the major flaws in CVS</li> 
<li>Many open source projects have switched, or are switching&hellip;</li> 
<li>&hellip;so we'll use it in this course</li> 
<li>See the <code>Subversion</code> site for details</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Basic Use</h2> 
<ul> 
<li>Assume for a moment that a repository has been created, and that Ron and 
Hermione already have working copies
<ul> 
<li>See below how to do this</li> </ul></li> 
<li>Ron wants to make changes to the rotor spin simulation 
<ul> 
<li>Runs <code>svn update</code> to bring his copy up to date with the 
repository</li> 
<li>Edits <code>spin.c</code> and <code>spin.h</code></li> 
<li>Runs <code>svn commit</code> to save those changes in the repository 
<ul> 
<li>Note: the whole repository gets a new version number</li> </ul></li> </ul>
</li> 
<li>Ron realizes that he forgot to make one change 
<ul> 
<li>Runs <code>svn update</code> again, just in case Hermione has also been 
making changes (she hasn't)</li> 
<li>Edits <code>spin.c</code> again</li> 
<li>Runs <code>svn commit</code> a second time</li> </ul></li> 
<li>Several hours later, Hermione runs <code>svn update</code> on her working 
copy
<ul> 
<li>Subversion copies Ron's changes into her directory</li> </ul></li> 
<p> Figure 3.1: Basic Use</p> <br>
<br>

<li>Comment on this slide</li> </ul> 
<h2>How To Do It</h2> 
<ul> 
<li>One way to use Subversion is to type commands in a shell 
<ul> 
<li>Guaranteed to work everywhere without anything else being installed</li> 
<li>But there are several good graphical interfaces for Subversion too</li> 
</ul></li> 
<li><code>RapidSVN</code> runs on Windows, Linux, and Mac 
<ul> 
<li>Well, maybe &ldquo;walks&rdquo; is a better description&mdash;as of 
Version 0.9, it's not the fastest thing in the world</li> 
<li> 
<p> Figure 3.2: RapidSVN</p> <br>
<br>
</li> </ul></li> 
<li><code>TortoiseSVN</code> is a Windows shell extension 
<ul> 
<li>Which means that it integrates with the Windows file browser, rather than 
running separately</li> 
<li>But that also means that it doesn't work on Linux or Mac</li> 
<li> 
<p> Figure 3.3: TortoiseSVN</p> <br>
<br>
</li> </ul></li> 
<li>And if you're on a Macintosh, there's <code>SmartSVN</code></li> 
<li>Comment on this slide</li> </ul> 
<h2>Working Together</h2> 
<ul> 
<li>What if two (or more) people want to edit the same file at the same time? 
<ul> 
<li>Option 1: prevent it 
<ul> 
<li>Only allow one person to have a writeable copy of the file at once</li> 
<li><em>Pessimistic concurrency</em></li> 
<li>Microsoft Visual SourceSafe</li> </ul></li> 
<li>Option 2: patch up afterwards 
<ul> 
<li><em>Optimistic concurrency</em></li> 
<li>&ldquo;It's easier to get forgiveness than permission&rdquo;</li> 
<li>CVS, Perforce, Subversion</li> </ul></li> </ul></li> 
<p> Figure 3.4: Merging Conflicts</p> <br>
<br>

<li>Ron and Hermione both have copies of <code>spin.c</code> version 15 
<ul> 
<li> 
<pre>int maxRotateSetting(int * available, int length) { int i, maxFound; if 
(length == 0) { return 0; } for (i=0; i&lt;length; i+=1) { if (available[i] 
&gt; maxFound) { maxFound = available[i]; } } return maxFound; }</pre> </li> 
</ul></li> 
<li>Ron commits his changes 
<ul> 
<li>Creates <code>spin.c</code> version 16</li> 
<li> 
<pre>// Find maximum rotation setting from those available, // or 0 if none 
are available. int maxRotateSetting(int * available, int length) { int i, 
maxFound; if (length == 0) { return 0; } for (i=0; i&lt;length; i+=1) { if 
(available[i] &gt; maxFound) { maxFound = available[i]; } } return maxFound; }
</pre> </li> </ul></li> 
<li>Meanwhile, Hermione is editing her copy, and produces this: 
<ul> 
<li> 
<pre>// Find maximum rotation setting, or 0. int maxRotateSetting(int * 
available, int length) { int i, maxFound = 0; for (i=0; i&lt;length; i+=1) { if 
(available[i] &gt; maxFound) { maxFound = available[i]; } } return maxFound; }
</pre> </li> </ul></li> 
<li>Tries to submit her changes: conflict! 
<ul> 
<li>Subversion puts both Ron's and Hermione's changes in Hermione's working 
copy, with markers
<ul> 
<li> 
<pre>&lt;&lt;&lt;&lt;&lt;&lt;&lt; .mine // Find maximum rotation setting, or 
0. ======= // Find maximum rotation setting from those available, // or 0 if 
none are available. &gt;&gt;&gt;&gt;&gt;&gt;&gt; .r471 int maxRotateSetting(int 
* available, int length) { int i, maxFound = 0; for (i=0; i&lt;length; i+=1) { 
if (available[i] &gt; maxFound) { maxFound = available[i]; } } return maxFound; 
}</pre> </li> </ul></li> 
<li>Also creates <code>spin.c.mine</code>, <code>spin.c.15</code>, and <code>
spin.c.16</code> for reference</li> 
<li>Hermione must decide what to keep, and what to throw away 
<ul> 
<li>Subversion won't let her commit his changes until all the conflict markers 
are eliminated</li> </ul></li> 
<li>Once Hermione is done editing, she: 
<ul> 
<li>Runs <code>svn resolved spin.c</code> to tell Subversion the conflict has 
been fixed</li> 
<li>Runs <code>svn commit spin.c</code> to create <code>spin.c</code> version 
17</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What Versions Actually Mean</h2> 
<ul> 
<li>The discussion above referred to &ldquo;version 16 of <code>spin.c</code>
&rdquo;, but in fact there is no such thing</li> 
<li>Instead, there's version 16 (or 17, or 18&hellip;) of the <em>repository
</em> 
<ul> 
<li>Users are supposed to try to keep the files in the repository in a 
consistent state
<ul> 
<li>I.e., don't submit things that are half-done</li> 
<li>Since the next person to do an update would then be in the same half-done 
state you are</li> </ul></li> 
<li>Subversion therefore updates the version number on the whole repository 
every time a set of changes is submitted
<ul> 
<li>Each change set can affect any number of files (including adding or 
deleting files)</li> </ul></li> 
<li>The phrase &ldquo;version 229&rdquo; therefore uniquely identifies an 
entire set of files
<ul> 
<li>Unlike CVS and other systems, where version 319 of one file might 
correspond to version 107 of another, and version 794 of a third</li> </ul></li>
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Warning: Binary Files</h2> 
<ul> 
<li>Subversion can only mark conflicts this way in text files 
<ul> 
<li>I.e., files that store lines of human-readable characters</li> 
<li>Source code, HTML&mdash;basically, anything you can edit with Notepad, Vi, 
or Emacs</li> </ul></li> 
<li>Images, video clips, Microsoft Word, and many other formats aren't 
<ul> 
<li>When there's a conflict, Subversion saves your copy and the master copy 
side by side in your working directory</li> 
<li>Up to you to resolve the differences</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rolling Back Changes</h2> 
<ul> 
<li>Suppose Ron decides that he doesn't like his recent changes 
<ul> 
<li><code>svn diff</code> will show him which files he has changed, and what 
those changes are</li> 
<li>He hasn't committed anything yet, so he can use <code>svn revert</code> to 
re-synchronize with the master copy</li> 
<li>If you find yourself doing this repeatedly, you should probably go and do 
something else for a while&hellip;</li> </ul></li> 
<li>Now suppose that Ron decides he doesn't like the changes Hermione just 
made to<code>spin.c</code> 
<ul> 
<li>Wants to do the equivalent of &ldquo;undo&rdquo; on several files</li> 
<li><code>svn log</code> shows recent history</li> 
<li>He decides he wants to revert to version 16 of the repository</li> 
<li><code>svn merge -r 17:16 spin.c</code> means &ldquo;merge changes, going 
from version 17 to version 16&rdquo; (i.e., backwards)
<ul> 
<li>Can obviously go back to even earlier versions to undo more changes</li> 
</ul></li> </ul></li> 
<p> Figure 3.5: Undoing Changes</p> <br>
<br>

<li>Comment on this slide</li> </ul> 
<h2>And Finally, Getting Started</h2> 
<ul> 
<li>To create a repository: 
<ul> 
<li>Decide where to put it (e.g., <code>/rotor/repo</code>)</li> 
<li>Go into the containing directory: <code>cd /rotor</code></li> 
<li><code>svnadmin create repo</code></li> </ul></li> 
<li>Can then interact with repository in two ways 
<ul> 
<li>Directly through the file system: <code>file:///rotor/repo</code> 
<ul> 
<li>Use this if you're working on the same machine the repository is on</li> 
</ul></li> 
<li>Through a web server: <code>https://your.host.name/rotor/repo</code> 
<ul> 
<li>Use this if the repository is on a remote machine</li> 
<li>Note: requires your system administrator to configure the web server 
properly</li> 
<li><code>https</code> (instead of <code>http</code>) means &ldquo;use a 
secure connection&rdquo;</li> </ul></li> </ul></li> 
<li>To get a working copy (assuming you're using a web server): 
<ul> 
<li><code>svn checkout https://your.host.name/rotor/repo</code></li> 
<li>Creates a new directory <code>repo</code> 
<ul> 
<li>Common to give it a more informative name using <code>svn checkout 
https://your.host.name/rotor/repo rotorproject</code></li> </ul></li> 
<li>Important: only use <code>svn checkout</code> once, to initialize your 
working copy</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Subversion Command Reference</h2> 
<ul> Name Purpose Example <br>
<code>svn add</code> Add files and/or 
directories to version control. <code>svn add newfile.c newdir</code> <br>

<code>svn checkout</code> Get a fresh working copy of a repository. <code>svn 
checkout https://your.host.name/rotor/repo rotorproject</code> <br>
<code>svn 
commit</code> Send changes from working copy to repository (inverse of <code>
update</code>). <code>svn commit -m &quot;Comment on the changes&quot;</code> 
<br> <code>svn delete</code> Delete files and/or directories from version 
control. <code>svn delete oldfile.c</code> <br>
<code>svn help</code> Get help 
(in general, or for a particular command). <code>svn help update</code> <br>

<code>svn log</code> Show history of recent changes. <code>svn log --verbose *.c
</code> <br>
<code>svn merge</code> Merge two different versions of a file into 
one. <code>svn merge -r 18:16 spin.c</code> <br>
<code>svn mkdir</code> Create 
a new directory and put it under version control. <code>svn mkdir newmodule
</code> <br>
<code>svn rename</code> Rename a file or directory, keeping track 
of history. <code>svn rename temp.txt release_notes.txt</code> <br>
<code>svn 
revert</code> Undo changes to working copy (i.e., resynchronize with 
repository). <code>svn revert spin.h</code> <br>
<code>svn status</code> Show 
the status of files and directories in the working copy. <code>svn status</code>
<br> <code>svn update</code> Bring changes from repository into working copy 
(inverse of<code>commit</code>). <code>svn update</code> <br>
<br>

<p> Table 3.1: Common Subversion Commands</p> 
<li>Comment on this slide</li> </ul> 
<h2>How to Read Subversion Output</h2> 
<ul> 
<li><code>svn status</code> compares your working copy with the repository, 
printing one line for each file that's worth talking about
<ul> 
<li> 
<pre>$ svn status </pre> 
<pre>M spin.c MC readme.txt </pre> </li> 
<li><code>spin.c</code> has been modified</li> 
<li><code>readme.txt</code> has been modified, and has conflicts</li> </ul>
</li> 
<li><code>svn update</code> prints one line for each file or directory it does 
something to
<ul> 
<li> 
<pre>$ svn update </pre> 
<pre>A newspin.c U spin.c C spin.h </pre> </li> 
<li><code>newspin.c</code> has been added</li> 
<li><code>spin.c</code> has been updated (i.e., someone else modified it)</li> 
<li>There's a conflict in <code>spin.h</code> 
<ul> 
<li>Which you'll have to resolve before you can commit your changes</li> </ul>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Branching and Merging</h2> 
<ul> 
<li>Sometimes want to work on several different versions of software at once 
<ul> 
<li>Example: need to do bug fixes on Version 3 while making incompatible 
changes toward Version 4</li> 
<li>Or want two sets of developers to be able to write and test large changes 
independently, then put things back together</li> </ul></li> 
<li>All modern version control systems allow you to <em>branch</em> a 
repository
<ul> 
<li>Create a &ldquo;parallel universe&rdquo; which is initially the same as 
the original, but which evolves independently</li> 
<li> 
<p> Figure 3.6: Branching and Merging</p> <br>
<br>
</li> 
<li>Much better than just copying all the source files: the version control 
system remembers where the branch came from, and can trace its history back</li>
</ul></li> 
<li>Can later <em>merge</em> changes from one branch to another 
<ul> 
<li>Example: fix a bug on one branch, merge the changes into other branches 
that have the same bug</li> 
<li>Again, much better than copying by hand, since the version control system 
can keep track of where things came from, and where they went</li> </ul></li> 
<li>Warning: many people become over-excited about branching when they first 
start to use it
<ul> 
<li>Keeping track of what's going on where can be a considerable management 
overhead</li> 
<li>On a small project, very rare to need more than two active branches</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 3.1:</p> 
<p>Follow the instructions given to you by your instructor to check out a copy 
of the Subversion repository you'll be using in this course. Unless otherwise 
noted, the exercises below assume that you have done this, and that your 
working copy is in a directory called<code>course</code>. You will submit all 
of your exercises in this course by checking files into your repository.</p> 
<p>Exercise 3.2:</p> 
<p>Create a file <code>course/ex01/bio.txt</code> (where <code>course</code> 
is the root of your working copy of your Subversion repository), and write a 
short biography of yourself (100 words or so) of the kind used in academic 
journals, conference proceedings, etc. Commit this file to your repository. 
Remember to provide a meaningful comment when committing the file!</p> 
<p>Exercise 3.3:</p> 
<p>What's the difference between <code>mv</code> and <code>svn mv</code>? Put 
the answer in a file called<code>course/ex01/mv.txt</code> and commit your 
changes.</p> 
<p>Once you have committed your changes, type <code>svn log</code> in your 
<code>course</code> directory. If you didn't know what you'd just done, would 
you be able to figure it out from the log messages? If not, why not?</p> 
<p>Exercise 3.4:</p> 
<p>In this exercise, you'll simulate the actions of two people editing a 
single file. To do that, you'll need to check out a second copy of your 
repository. One way to do this is to use a separate computer (e.g., your 
laptop, your home computer, or a machine in the lab). Another is to make a 
temporary directory, and check out a second copy of your repository there. 
Please make sure that the second copy isn't inside the first, or vice 
versa&mdash;Subversion will become very confused.</p> 
<p>Let's call the two working copies Blue and Green. Do the following:</p> 
<p>a) Create <code>Blue/ex01/planets.txt</code>, and add the following lines:
</p> 
<pre>Mercury Venus Earth Mars Jupiter Saturn </pre> 
<p>Commit the file.</p> 
<p>b) Update the Green repository. (You should get a copy of <code>planets.txt
</code>.)</p> 
<p>c) Change <code>Blue/ex01/planets.txt</code> so that it reads:</p> 
<pre>1. Mercury 2. Venus 3. Earth 4. Mars 5. Jupiter 6. Saturn </pre> 
<p>Commit the changes.</p> 
<p>d) Edit <code>Green/ex01/planets.txt</code> so that its contents are as 
shown below. Do<em>not</em> do <code>svn update</code> before editing this 
file, as that will spoil the exercise.</p> 
<pre>Mercury 0 Venus 0 Earth 1 Mars 2 Jupiter 16 (and counting) Saturn 14 (and 
counting)</pre> 
<p>e) Now, in Green, do <code>svn update</code>. Subversion should tell you 
that there are conflicts in<code>planets.txt</code>. Resolve the conflicts so 
that the file contains:</p> 
<pre>1. Mercury 0 2. Venus 0 3. Earth 1 4. Mars 2 5. Jupiter 16 6. Saturn 14 
</pre> 
<p>Commit the changes.</p> 
<p>f) Update the Blue repository, and check that <code>planets.txt</code> now 
has the same content as it has in the Green repository.</p> 
<p>Exercise 3.5:</p> 
<p>Add another line or two to <code>course/ex01/bio.txt</code> and commit 
those changes. Then, use<code>svn merge</code> to restore the original contents 
of your biography (<code>course/ex01/bio.txt</code>), and commit the result. 
When you are done,<code>bio.txt</code> should look the way it did at the end of 
the first part of the previous exercise.) Note: the purpose of this exercise is 
to teach you how to go back in time to get old versions of files&mdash;while it 
would be simpler in this case just to edit<code>bio.txt</code>, you can't 
(reliably) do that when you've made larger changes, to multiple files, over a 
longer period of time.</p> prev top next <br>
<br>

<h1>Shell Basics</h1> prev  Draft Version 588 next <br>
<br>

<h2>Introduction</h2> 
<ul> 
<li>Most modern tools have a graphical user interface (GUI) 
<ul> 
<li>Because they're easier to use</li> </ul></li> 
<li>But command-line user interfaces (CLUIs) still have their place 
<ul> 
<li>Easier (faster) to build new CLUI tools 
<ul> 
<li>Building a GUI takes time</li> 
<li>Building a <em>good</em> GUI takes a lot of time</li> </ul></li> 
<li>Higher action-to-keystroke ratio 
<ul> 
<li>Once you're over the (steeper) learning curve</li> </ul></li> 
<li>Easier to see and understand what the computer is doing on your behalf 
<ul> 
<li>Which is part of what this course is about</li> </ul></li> 
<li>Most important: it's easier to combine CLUI tools than GUI tools 
<ul> 
<li>Small tools, combined in many ways, can be very powerful</li> </ul></li> 
</ul></li> 
<li> [Ray &amp; Ray 2003] is a good introduction for newcomers 
<ul> 
<li>And despite its age, [Kernighan &amp; Pike 1984] is still useful</li> </ul>
</li> 
<li>How to tell if you can skip this lecture 
<ul> 
<li>Do you know what a shell is?</li> 
<li>Do you know the difference between an absolute path and a relative path?
</li> 
<li>Do you know what a process is?</li> 
<li>Do you know what a pipe is?</li> 
<li>Do you know what <code>$PATH</code> is?</li> 
<li>Do you know what <code>rwxr-xr-x</code> means?</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Shell vs. the Operating System</h2> 
<ul> 
<li>The most important command-line tool is the <em>command shell</em> (often 
just called &ldquo;the shell&rdquo;)
<ul> 
<li>Manages a user's interactions with the operating system by: 
<ul> 
<li>Reading commands from the keyboard</li> 
<li>Figuring out what programs the user wants to run</li> 
<li>Running those programs</li> 
<li>Displaying their output on the screen</li> </ul></li> 
<li>Looks (and works) like an interactive terminal circa 1980 
<ul> 
<li> 
<p> Figure 4.1: A Shell in Action</p> <br>
<br>
</li> </ul></li> </ul></li> 
<li>The shell is just one program among many 
<ul> 
<li>Many different ones have been written</li> 
<li><code>sh</code> was the first for Unix 
<ul> 
<li>Most others extend its capabilities in various ways</li> 
<li>Which means that it's the lowest common denominator you can always rely on
</li> </ul></li> 
<li>We'll use <code>bash</code> (the Bourne again shell) in this course 
<ul> 
<li>Available just about everywhere</li> 
<li>Even on Windows (thanks to <code>Cygwin</code>)</li> </ul></li> </ul></li> 
<li>In contrast, the <em>operating system</em> is <em>not</em> just another 
program
<ul> 
<li>Automatically loaded when the computer boots up</li> 
<li>The only program that can talk directly to the computer's hardware 
<ul> 
<li>I.e., read characters from the keyboard, or send drawing commands to the 
screen</li> </ul></li> 
<li>Manages files and directories on the disk</li> 
<li>Keeps track of who you are, and what you're allowed to do</li> 
<li>You can run many instances of the shell on a computer at once, but it can 
only run one operating system at a time</li> 
<li> 
<p> Figure 4.2: Operating System and Shell</p> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The File System</h2> 
<ul> 
<li>The <em>file system</em> is the set of files and directories the computer 
can access
<ul> 
<li>&ldquo;Everything that stays put when you turn the computer off and 
restart it&rdquo;</li> </ul></li> 
<li>Data is stored in files 
<ul> 
<li>By convention, files have two part names, like <code>notes.txt</code> or 
<code>home.html</code></li> 
<li>Most operating systems allow you to associate a <em>filename extension</em>
 with an application
<ul> 
<li>E.g., <code>.txt</code> is associated with an editor, and <code>.html
</code> with a web browser</li> </ul></li> 
<li>But this is all just convention: you can call files (almost) anything you 
want</li> </ul></li> 
<li>Files are stored in directories (often called folders) 
<ul> 
<li>Directories can contain other directories, too</li> 
<li>Results in the familiar <em>directory tree</em></li> 
<li> 
<p> Figure 4.3: A Directory Tree</p> <br>
<br>
</li> 
<li>Everything in a particular directory must have a unique name 
<ul> 
<li>Otherwise, how would you identify it?</li> </ul></li> 
<li>But items in different directories can have the same name</li> </ul></li> 
<li>On Unix, the file system has a unique <em>root directory</em> called <code>
/</code> 
<ul> 
<li>Every other directory is a child of it, or a child of a child, etc.</li> 
</ul></li> 
<li>On Windows, every <em>drive</em> has its own root directory 
<ul> 
<li>So <code>C:\home\gvwilson\notes.txt</code> is different from <code>
J:\home\gvwilson\notes.txt</code></li> 
<li>When you're using Cygwin, you can also write <code>C:\home\gvwilson</code> 
as<code>c:/home/gvwilson</code></li> 
<li>Or as <code>/cygdrive/c/home/gvwilson</code> 
<ul> 
<li>Some Unix programs give <code>&quot;:&quot;</code> a special meaning, so 
Cygwin needed a way to write paths without it&hellip;</li> </ul></li> </ul></li>
<li>A <em>path</em> is a description of how to find something in a file system 
<ul> 
<li>An <em>absolute path</em> describes a location from the root directory down
<ul> 
<li>Equivalent to a street address</li> 
<li>Always starts with <code>&quot;/&quot;</code></li> 
<li>E.g., <code>/home/gvwilson</code> is my home directory, and <code>
/courses/swc/lec/shell.swc</code> is this file</li> </ul></li> 
<li>A <em>relative path</em> describes how to find something from some other 
location
<ul> 
<li>Equivalent to saying, &ldquo;Four blocks north, and seven east&rdquo;</li> 
<li>E.g., from <code>/courses/swc</code>, the relative path to this file is 
<code>lec/shell.swc</code></li> </ul></li> </ul></li> 
<li>Every program (including the shell) has a <em>current working directory
</em> 
<ul> 
<li>&ldquo;Where am I?&rdquo;</li> 
<li>Relative paths are deciphered relative to this location</li> 
<li>It can change while a program is running</li> </ul></li> 
<li>Finally, two special names: 
<ul> 
<li><code>&quot;.&quot;</code> means &ldquo;the current directory&rdquo;</li> 
<li><code>&quot;..&quot;</code> means &ldquo;the directory immediately above 
this one
<ul> 
<li>Also called the <em>parent directory</em></li> 
<li>In <code>/courses/swc/data</code>, <code>..</code> is <code>/courses/swc
</code></li> 
<li>In <code>/courses/swc/data/elements</code>, <code>..</code> is <code>
/courses/swc/data</code></li> 
<li> 
<p> Figure 4.4: Parent Directories</p> <br>
<br>
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Few Simple Commands</h2> 
<ul> 
<li>Easiest way to learn basic Unix commands is to see them in action</li> 
<li>First, I type <code>pwd</code> (short for &quot;print working 
directory&rdquo;) to find out where I am
<ul> 
<li>Unfortunately, most Unix commands have equally cryptic names</li> 
<li> 
<pre>pwd </pre> 
<pre>/home/gvwilson/swc </pre> </li> </ul></li> 
<li>I then type <code>ls</code> (for &ldquo;listing&rdquo;) to see what's in 
the current directory
<ul> 
<li> 
<pre>ls </pre> 
<pre>LICENSE.txt admin data graphics lec pdf scraps util Makefile cgi-bin etc 
img mp3 publ src web</pre> </li> </ul></li> 
<li>What actually happens when I type <code>ls</code> is: 
<ul> 
<li>The operating system reads characters from the keyboard</li> 
<li>Passes them to the shell (because it's the currently active window on my 
desktop)</li> 
<li>The shell breaks the line of text it receives into words</li> 
<li>Looks for a program with the same name as the first word (i.e., the 
command to run)
<ul> 
<li>Describe in a moment how the shell knows where to look</li> </ul></li> 
<li>Runs that program</li> 
<li>Reads the program's output and sends it back to the operating system for 
display</li> 
<li> 
<p> Figure 4.5: Running a Program</p> <br>
<br>
</li> </ul></li> 
<li>I can tell <code>ls</code> to produce more informative output by giving it 
some<em>flags</em> 
<ul> 
<li>By convention, flags start with <code>&quot;-&quot;</code>, as in <code>
&quot;-c&quot;</code> or <code>&quot;-l&quot;</code></li> 
<li>Show directories with trailing slash 
<ul> 
<li> 
<pre>ls -F </pre> 
<pre>LICENSE.txt admin/ data/ exer/ lec/ publ/ soln/ util/ Makefile cgi-bin/ 
etc/ img/ pdf/ scraps/ src/ web/</pre> </li> </ul></li> 
<li>Show all files and directories, including those whose names begin with 
<code>.</code> 
<ul> 
<li> 
<pre>ls -a </pre> 
<pre>. .. .svn admin data exer img lec publ soln src util tmpl README.txt 
license.txt todo.txt</pre> </li> 
<li>By default, <code>ls</code> doesn't show anything whose name begins with 
<code>.</code></li> 
<li>Note the <code>.svn</code> directory: this is where Subversion keeps 
administrative information</li> 
<li>Do <em>not</em> edit anything in this directory yourself, or Subversion 
will become very confused</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Creating Files and Directories</h2> 
<ul> 
<li>Rather than messing with the course files, let's create a temporary 
directory and play around in there
<ul> 
<li> 
<pre>mkdir temp </pre> </li> 
<li>Note: no output</li> 
<li>The <code>-v</code> (&ldquo;verbose&rdquo;) flag tells <code>mkdir</code> 
to print a confirmation message</li> </ul></li> 
<li>Now go into that directory 
<ul> 
<li> 
<pre>cd temp </pre> </li> 
<li>Changes the shell's notion of our current working directory</li> 
<li> 
<pre>pwd </pre> 
<pre>/home/gvwilson/swc/temp </pre> </li> 
<li>No files there yet:</li> 
<li> 
<pre>ls -a </pre> 
<pre>. .. </pre> </li> </ul></li> 
<li>Use the editor of your choice to create a file called <code>earth.txt
</code> with the following contents: 
<ul> 
<li> 
<pre>Name: Earth Period: 365.26 days Inclination: 0.00 Eccentricity: 0.02 
</pre> </li> 
<li>Notepad (on Windows) runs in a window of its own</li> 
<li>Pico (on Unix) takes over the shell window temporarily</li> 
<li>We'll look at more advanced editing tools for programming in a few lectures
</li> </ul></li> 
<li>Easiest way to create a similar file <code>venus.txt</code> is to copy the 
one we have
<ul> 
<li> 
<pre>cp earth.txt venus.txt </pre> </li> 
<li> 
<pre>ls -t </pre> 
<pre>venus.txt earth.txt </pre> </li> 
<li>Note: the <code>-t</code> option tells <code>ls</code> to list newest first
</li> </ul></li> 
<li>Check the contents of the file using <code>cat</code> (short for 
&ldquo;concatenate&rdquo;)
<ul> 
<li>Just prints the contents of a file to the screen</li> 
<li> 
<pre>cat venus.txt </pre> 
<pre>Name: Earth Period: 365.26 days Inclination: 0.00 Eccentricity: 0.02 
</pre> </li> </ul></li> 
<li>Edit the file so that it looks like this: 
<ul> 
<li> 
<pre>Name: Venus Period: 224.70 days Inclination: 3.39 Eccentricity: 0.01 
</pre> </li> </ul></li> 
<li>Compare the sizes of the two files using <code>wc</code> (for &ldquo;word 
count&rdquo;)
<ul> 
<li> 
<pre>wc earth.txt venus.txt </pre> 
<pre> 4 9 69 earth.txt 4 9 69 venus.txt 8 18 138 total </pre> </li> 
<li>Columns show lines, words, and characters</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Wildcards</h2> 
<ul> 
<li>Some characters (called <em>wildcards</em>) mean special things to the 
shell
<ul> 
<li><code>*</code> matches zero or more characters 
<ul> 
<li>So <code>ls *.f77</code> lists all the Fortran-77 files in a directory</li>
</ul></li> 
<li> 
<pre>wc *.txt </pre> 
<pre> 4 9 69 earth.txt 4 9 69 venus.txt 8 18 138 total </pre> </li> 
<li><code>?</code> matches any single character 
<ul> 
<li>So <code>ls ??.txt</code> lists all the text files with two-letter prefixes
</li> 
<li>And <code>ls ??.*</code> lists all the files with two-letter prefixes, and 
any extension</li> </ul></li> 
<li><code>~</code> on its own means &ldquo;my home directory&rdquo; 
<ul> 
<li>I.e., the one I'm in when I first log in</li> </ul></li> 
<li><code>~harry</code> means &ldquo;Harry's home directory&rdquo;</li> </ul>
</li> 
<li>Note: the shell expands wildcards <em>before</em> running commands 
<ul> 
<li>There's no way for <code>ls</code> to know whether it was invoked as <code>
ls *.txt</code> or <code>rm earth.txt venus.txt</code></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 4.1:</p> 
<p>Suppose you are in your home directory, and <code>ls</code> shows you this:
</p> 
<pre>Makefile biography.txt data enrolment.txt programs thesis </pre> 
<p>What argument(s) do you have to give to <code>ls</code> to get it to put a 
trailing slash after the names of subdirectories, like this:</p> 
<pre>Makefile biography.txt data/ enrolment.txt programs/ thesis/ </pre> 
<p>If you run <code>ls data</code>, it shows:</p> 
<pre>earth.txt jupiter.txt mars.txt mercury.txt saturn.txt venus.txt </pre> 
<p>What command should you run to get the following output:</p> 
<pre>data/earth.txt data/jupiter.txt data/mars.txt data/mercury.txt 
data/saturn.txt data/venus.txt</pre> 
<p>What if you want this (note that an extra entry is being displayed):</p> 
<pre>total 7 drwxr-xr-x 7 someone 0 May 6 08:27 .svn -rw-r--r-- 1 someone 2396 
May 6 08:38 earth.txt -rw-r--r-- 1 someone 1263 May 6 08:38 jupiter.txt 
-rw-r--r-- 1 someone 1015 May 6 08:43 mars.txt -rw-r--r-- 1 someone 946 May 6 
08:41 mercury.txt -rw-r--r-- 1 someone 1714 May 6 08:40 saturn.txt -rw-r--r-- 1 
someone 881 May 6 08:40 venus.txt</pre> 
<p>Note: the command will display your user ID, rather than <code>someone
</code>. On some machines, the command will also display a group ID. Ignore 
these differences for the purpose of this question.</p> 
<p>Exercise 4.2:</p> 
<p>According to the listing of the <code>data</code> directory above, who can 
read the file<code>mercury.txt</code>? Who can write it (i.e., change its 
contents or delete it)? When was<code>mercury.txt</code> last changed? What 
command would you run to allow everyone to edit or delete the file?</p> 
<p>Exercise 4.3:</p> 
<p>Suppose you want to remove all files whose names (not including their 
extensions) are of length 3, start with the letter<code>a</code>, and have 
<code>.txt</code> as extension. What command would you use? For example, if the 
directory contains three files<code>a.txt</code>, <code>abc.txt</code>, and 
<code>abcd.txt</code>, the command should remove <code>abc.txt</code> , but not 
the other two files.</p> 
<p>Exercise 4.4:</p> 
<p>What does the command <code>cd ~</code> do? What about <code>cd ~gvwilson
</code>?</p> 
<p>Exercise 4.5:</p> 
<p>What's the difference between the commands <code>cd HOME</code> and <code>
cd $HOME</code>?</p> 
<p>Exercise 4.6:</p> 
<p>Suppose you want to list the names of all the text files in the <code>data
</code> directory that contain the word <code>&quot;carpentry&quot;</code>. 
What command or commands could you use?</p> 
<p>Exercise 4.7:</p> 
<p>Suppose you have written a program called <code>analyze</code>. What 
command or commands could you use to display the first ten lines of its output? 
What would you use to display lines 50-100? To send lines 50-100 to a file 
called<code>tmp.txt</code>?</p> 
<p>Exercise 4.8:</p> 
<p>The command <code>ls data &gt; tmp.txt</code> writes a listing of the <code>
data</code> directory's contents into <code>tmp.txt</code>. Anything that was 
in the file before the command was run is overwritten. What command could you 
use to append the listing to<code>tmp.txt</code> instead?</p> 
<p>Exercise 4.9:</p> 
<p>What command(s) would you use to find out how many subdirectories there are 
in the<code>lectures</code> directory?</p> 
<p>Exercise 4.10:</p> 
<p>What does <code>rm *.ch</code>? What about <code>rm *.[ch]</code>?</p> 
<p>Exercise 4.11:</p> 
<p>What command(s) could you use to find out how many instances of a program 
are running on your computer at once? For example, if you are on Windows, what 
would you do to find out how many instances of<code>svchost.exe</code> are 
running? On Unix, what would you do to find out how many instances of<code>bash
</code> are running?</p> 
<p>Exercise 4.12:</p> 
<p>What do the commands <code>pushd</code>, <code>popd</code>, and <code>dirs
</code> do? Where do their names come from?</p> 
<p>Exercise 4.13:</p> 
<p>How would you send the file <code>earth.txt</code> to the default printer? 
How would you check it made it (other than wandering over to the printer and 
standing there)?</p> 
<p>Exercise 4.14:</p> 
<p>A colleague asks for your data files. How would you archive them to send as 
one file? How could you compress them?</p> 
<p>Exercise 4.15:</p> 
<p>The instructor wants you to use a hitherto unknown command for manipulating 
files. How would you get help on this command?</p> 
<p>Exercise 4.16:</p> 
<p>You have changed a text file on your home PC, and mailed it to the 
university terminal. What steps can you take to see what changes you may have 
made, compared with a master copy in your home directory?</p> 
<p>Exercise 4.17:</p> 
<p>How would you change your password?</p> 
<p>Exercise 4.18:</p> 
<p><code>grep</code> is one of the more useful tools in the toolbox. It finds 
lines in files that match a pattern and prints them out. For example, assume I 
have files<code>earth.txt</code> and <code>venus.txt</code> containing lines 
like this:</p> 
<pre>Name: Earth Period: 365.26 days Inclination: 0.00 Eccentricity: 0.02 
</pre> 
<p>If I type <code>grep Period *.txt</code> in that directory, I get:</p> 
<pre>earth.txt:Period: 365.26 days venus.txt:Period: 224.70 days </pre> 
<p>Search strings can use regular expressions, which will be discussed in a 
later lecture. <code>grep</code> takes many options as well; for example, <code>
grep -c /bin/bash /etc/passwd</code> reports how many lines in <code>/etc/passwd
</code> (the Unix password file) that contain the string <code>/bin/bash</code>
, which in turn tells me how many users are using<code>bash</code> as their 
shell.</p> 
<p>Suppose all you wanted was a list of the files that contained lines 
matching a pattern, rather than the matches themselves&mdash;what flag or flags 
would you give to<code>grep</code>? What if you wanted the line numbers of 
matching lines?</p> 
<p>Exercise 4.19:</p> 
<p><code>diff</code> finds and displays the differences between two files. It 
works best if both files are plain text (i.e., not images or Excel 
spreadsheets). By default, it shows the differences in groups, like this:</p> 
<pre>3c3,4 &lt; Inclination: 0.00 --- &gt; Inclination: 0.00 degrees &gt; 
Satellites: 1</pre> 
<p>(The rather cryptic header <code>&quot;3c3,4&quot;</code> means that line 3 
of the first file must be changed to get lines 3-4 of the second.)</p> 
<p>What flag(s) should you give <code>diff</code> to tell it to ignore changes 
that just insert or delete blank lines? What if you want to ignore changes in 
case (i.e., treat lowercase and uppercase letters as the same)?</p> 
<p>Exercise 4.20:</p> 
<p>Suppose you wanted <code>ls</code> to sort its output by filename 
extension, i.e., to list all<code>.cmd</code> files before all <code>.exe</code>
 files, and all<code>.exe</code>'s before all <code>.txt</code> files. What 
command or commands would you use?</p> prev top next <br>
<br>

<h1>More Shell</h1> prev  Draft Version 584 next <br>
<br>

<h2>Redirecting Input and Output</h2> 
<ul> 
<li>A running program is called a <em>process</em></li> 
<li>By default, every process has three connections to the outside world: 
<ul> 
<li><em>Standard input</em> (stdin): connected to the keyboard</li> 
<li><em>Standard output</em> (stdout): connected to the screen</li> 
<li><em>Standard error</em> (stderr): also connected to the screen 
<ul> 
<li>Used for error messages</li> </ul></li> 
<li> 
<p> Figure 5.1: The Shell Running a Program</p> <br>
<br>
</li> </ul></li> 
<li>You can tell the shell to connect standard input and standard output to 
files instead
<ul> 
<li><code>command &lt; inputFile</code> reads from <code>inputFile</code> 
instead of from the keyboard
<ul> 
<li>Don't need to use this very often, because most Unix commands let you 
specify the input file (or files) as command-line arguments</li> </ul></li> 
<li><code>command &gt; outputFile</code> writes to <code>outputFile</code> 
instead of to the screen
<ul> 
<li>Only &ldquo;normal&rdquo; output goes to the file, not error messages</li> 
</ul></li> 
<li><code>command &lt; inputFile &gt; outputFile</code> does both</li> 
<li> 
<p> Figure 5.2: Redirecting Standard Input and Output</p> <br>
<br>
</li> </ul>
</li> 
<li>Example: save number of lines in all text files to <code>words.len</code> 
<ul> 
<li> 
<pre>$ wc -w *.txt &gt; words.len </pre> </li> 
<li>Nothing appears, because output is being sent to the file <code>words.len
</code></li> 
<li> 
<pre>$ ls -t </pre> 
<pre>words.len venus.txt earth.txt </pre> </li> 
<li> 
<pre>$ cat words.len </pre> 
<pre> 4 9 69 earth.txt 4 9 69 venus.txt 3 12 62 words.len 11 30 200 total 
</pre> </li> </ul></li> 
<li>Try typing <code>cat &gt; junk.txt</code> 
<ul> 
<li>No input file specified, so <code>cat</code> reads from the keyboard</li> 
<li>Output sent to a file</li> 
<li>Voila: the world's dumbest text editor</li> </ul></li> 
<li>When you're done, use <code>rm junk.txt</code> to get rid of the file 
<ul> 
<li>Don't type <code>rm *</code> unless you're really, really sure that's what 
you want to do&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Pipes</h2> 
<ul> 
<li>Suppose you want to use the output of one program as the input of another 
<ul> 
<li>E.g., use <code>wc -w *.*</code> to count the words in some files, then 
<code>sort -n</code> to sort numerically</li> </ul></li> 
<li>Option 1: send output of first command to a temporary file, then read from 
that file
<ul> 
<li> 
<pre>wc *.txt &gt; temp sort -n &lt; temp </pre> </li> </ul></li> 
<li>Option 2: use a <em>pipe</em> to connect the two programs 
<ul> 
<li>Written as <code>&quot;|&quot;</code></li> 
<li>Tells the operating system to send what the first program writes to its 
stdout to the second program's stdin</li> 
<li> 
<pre>wc -w *.* | sort -n </pre> 
<pre> 9 earth.txt 9 venus.txt 12 words.len 30 total </pre> </li> 
<li> 
<p> Figure 5.3: Pipes</p> <br>
<br>
</li> 
<li>More convenient (and much less error prone) than temporary files</li> </ul>
</li> 
<li>Can chain any number of commands together 
<ul> 
<li>And combine with input and output redirection</li> 
<li> 
<pre>wc *.txt | sort -n | head -5 &gt; shortest.files </pre> </li> </ul></li> 
<li>Any program that reads from standard input and writes to standard output 
can use redirection and pipes
<ul> 
<li>Programs that do this are often called <em>filters</em></li> 
<li>If you make your programs work like filters, you can easily combine them 
with others</li> 
<li>A combinatorial explosion of goodness</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Environment Variables</h2> 
<ul> 
<li>Like any other program, the shell has variables</li> 
<li>Since they define a user's environment, they are usually called <em>
environment variables</em> 
<ul> 
<li>Usually all upper case</li> </ul></li> 
<li>Type <code>set</code> at the command prompt to get a listing: 
<ul> 
<li> 
<pre>$ set </pre> 
<pre>ANT_HOME=C:/apache-ant-1.6.2 BASH=/usr/bin/bash COLUMNS=80 
COMPUTERNAME=ISHAD HISTFILESIZE=500</pre> </li> </ul></li> 
<li>Get a particular variable's value by putting a <code>&quot;$&quot;</code> 
in front of its name
<ul> 
<li>E.g., the shell replaces <code>&quot;$HOME&quot;</code> with the current 
user's home directory</li> 
<li>Often use the <code>echo</code> command to print this out 
<ul> 
<li> 
<pre>$ echo $HOME </pre> 
<pre>/home/gvwilson </pre> </li> 
<li>Question: why must you type <code>echo $HOME</code>, and not just <code>
$HOME</code>?</li> </ul></li> </ul></li> 
<li>To set or reset a variable's value temporarily, use this: 
<ul> 
<li> 
<pre>$ export VARNAME=value </pre> </li> 
<li>Only affects the current shell (and programs run from it)</li> </ul></li> 
<li>To set a variable's value automatically when you log in, set it in <code>
~/.bashrc</code> 
<ul> 
<li>Remember, <code>&quot;~&quot;</code> is a shortcut meaning &ldquo;your 
home directory&rdquo;
<ul> 
<li>For me, right now, <code>~/.bashrc</code> is <code>/home/gvwilson/.bashrc
</code></li> </ul></li> </ul></li> 
<li>Important environment variables 
<ul> 
<li> Name Typical Value Notes <br>
<code>HOME</code> <code>/home/gvwilson
</code> The current user's home directory <br>
<code>HOMEDRIVE</code> <code>C:
</code> The current user's home drive (Windows only) <br>
<code>HOSTNAME</code> 
<code>&quot;ishad&quot;</code> This computer's name <br>
<code>HOSTTYPE</code> 
<code>&quot;i686&quot;</code> What kind of computer this is <br>
<code>OS</code>
<code>&quot;Windows_NT&quot;</code> What operating system is running <br>
<code>
PATH</code> <code>
&quot;/home/gvwilson/bin:/usr/local/bin:/usr/bin:/bin:/Python24/&quot;</code> 
Where to look for programs <br>
<code>PWD</code> <code>/home/gvwilson/swc/lec
</code> Present working directory (sometimes <code>CWD</code>, for current 
working directory) <br>
<code>SHELL</code> <code>/bin/bash</code> What shell is 
being run <br>
<code>TEMP</code> <code>/tmp</code> Where to store temporary 
files <br>
<code>USER</code> <code>&quot;gvwilson&quot;</code> The current 
user's ID <br>
<br>

<p> Table 5.1: Important Environment Variables</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How the Shell Finds Programs</h2> 
<ul> 
<li>The most important of these variables is <code>PATH</code> 
<ul> 
<li>The <em>search path</em> that tells the shell where to look for programs
</li> 
<li>When you type a command like <code>tabulate</code>, the shell: 
<ul> 
<li>Splits <code>$PATH</code> on colons to get a list of directories</li> 
<li>Looks for the program in each directory, in left-to-right order</li> 
<li>Runs the first one that it finds</li> </ul></li> </ul></li> 
<li>Example 
<ul> 
<li><code>PATH</code> is <code>
/home/gvwilson/bin:/usr/local/bin:/usr/bin:/bin:/Python24</code></li> 
<li>Both <code>/usr/local/bin/tabulate</code> and <code>
/home/gvwilson/bin/tabulate</code> exist</li> 
<li><code>/home/gvwilson/bin/tabulate</code> will be run when you type <code>
tabulate</code> at the command prompt</li> 
<li>Can run the other one by specifying the path, instead of just the command 
name</li> </ul></li> 
<li>Warning: it is common to include <code>.</code> in your path 
<ul> 
<li>This allows you to run a program in the current directory just by typing 
<code>whatever</code>, instead of <code>./whatever</code></li> 
<li>But it also means you can never be quite sure what program a command will 
invoke
<ul> 
<li>Though you can use the command <code>which program_name</code>, which will 
tell you</li> </ul></li> </ul></li> 
<li>Common entries in <code>PATH</code> include: 
<ul> 
<li><code>/bin</code>, <code>/usr/bin</code>: core tools like <code>ls</code> 
<ul> 
<li>Note: the word &ldquo;bin&rdquo; comes from &ldquo;binary&rdquo;, which is 
geekspeak for &ldquo;a compiled program&rdquo;</li> </ul></li> 
<li><code>/usr/local/bin</code>: optional (but common) tools, like the <code>
gcc</code></li> 
<li><code>$HOME/bin</code>: tools you have built for yourself 
<ul> 
<li>Remember, <code>$HOME</code> means &ldquo;the user's home directory&rdquo;
</li> 
<li>So this is equivalent to <code>~/bin</code></li> </ul></li> </ul></li> 
<li>Cygwin does things a little differently 
<ul> 
<li>Uses the notation <code>/cygdrive/c/somewhere</code> instead of Windows' 
<code>c:/somewhere</code> 
<ul> 
<li>The colon in <code>c:/somewhere</code> would clash with the colons in the 
<code>PATH</code> variable</li> </ul></li> 
<li>By default, Cygwin treats <code>c:/cygwin</code> as the root of its file 
system
<ul> 
<li>So <code>/home/aturing</code> is a synonym for <code>c:/cygwin/home/aturing
</code></li> 
<li>Yes, it can be confusing, but remember: we're trying to run one operating 
system's tools on top of another</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Basic Tools</h2> 
<ul> <code>man</code> Documentation for commands. <br>
<code>cat</code> 
Concatenate and display text files. <br>
<code>cd</code> Change working 
directory. <br>
<code>chmod</code> Change file and directory permissions. <br>

<code>clear</code> Clear the screen. <br>
<code>cp</code> Copy files and 
directories. <br>
<code>date</code> Display the current date and time. <br>

<code>diff</code> Show differences between two text files. <br>
<code>echo
</code> Print arguments. <br>
<code>env</code> Show environment variables. <br>

<code>head</code> Display the first few lines of a file. <br>
<code>ls</code> 
List files and directories. <br>
<code>mkdir</code> Make directories. <br>

<code>more</code> Page through a text file. <br>
<code>mv</code> Move (rename) 
files and directories. <br>
<code>od</code> Display the bytes in a file. <br>

<code>passwd</code> Change your password. <br>
<code>pwd</code> Print current 
working directory. <br>
<code>rm</code> Remove files. <br>
<code>rmdir</code> 
Remove directories. <br>
<code>sort</code> Sort lines. <br>
<code>tail</code> 
Display the last few lines of a file. <br>
<code>uniq</code> Remove duplicate 
lines. <br>
<code>wc</code> Count lines, words, and characters in a file. <br>

<code>which</code> locate a command <br>
<br>

<p> Table 5.2: Basic Command-Line Tools</p> 
<li>Comment on this slide</li> </ul> 
<h2>Ownership and Permission: Unix</h2> 
<ul> 
<li>On Unix, every user belongs to one or more groups 
<ul> 
<li>The <code>groups</code> command will show you which ones you are in</li> 
</ul></li> 
<li>Every file is owned by a particular user <em>and</em> a particular group 
<ul> 
<li>Owner can assign different read, write, and execute permissions to user, 
group, and others</li> 
<li>Read: can look at contents, but not modify them</li> 
<li>Write: can modify contents</li> 
<li>Execute: can run the file (e.g., it's a program)</li> </ul></li> 
<li><code>ls -l</code> will show all of this information 
<ul> 
<li>(Along with the file's size and a few other things)</li> 
<li>Permissions displayed as three <code>rwx</code> triples</li> 
<li>&ldquo;Missing&rdquo; permissions shown by <code>&quot;-&quot;</code></li> 
<li>Example: <code>rw-rw-r--</code> means &ldquo;user and group can read and 
write; everyone else can read; no one can execute&rdquo;</li> </ul></li> 
<li>Change permissions using <code>chmod</code> 
<ul> 
<li>Example: <code>chmod u+x something.exe</code> gives the user execute 
permission to<code>something.exe</code></li> 
<li>Example: <code>chmod o-r notes.txt</code> takes away the world's read 
permission for<code>notes.txt</code></li> </ul></li> 
<li>Permissions mean something a little different for directories 
<ul> 
<li>Execute permission means you can &ldquo;go into&rdquo; a directory, but 
does<em>not</em> mean you can read its contents</li> 
<li>So if a directory called <code>tools</code> has permission <code>rwx--x--x
</code> (i.e., owner can do anything, but everyone else only has execute 
permission), then:
<ul> 
<li>If someone other than the owner does <code>ls tools</code>, permission is 
denied</li> 
<li>But if there's a useful program called <code>tools/findanswers</code>, 
other users can still run it</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Ownership and Permission: Windows</h2> 
<ul> 
<li>Of course, it all works differently on Windows 
<ul> 
<li>Not better or worse, just differently</li> </ul></li> 
<li>Windows XP uses <em>access control lists</em> (ACLs) 
<ul> 
<li>Instead of describing users as &ldquo;file owner, group member, or 
something else&rdquo;, ACLs let you specify exactly what any particular user, 
or set of users, can do to a file, directory, device, etc.</li> 
<li>Older versions of Windows (such as Windows 95 and Windows 2000) are 
fundamentally insecure, and shouldn't be used</li> </ul></li> 
<li>Cygwin does its best to make the Windows model look like Unix's</li> 
<li>If you trip over the differences, please consult a system administrator
</li> 
<li>Comment on this slide</li> </ul> 
<h2>More Advanced Tools</h2> 
<ul> <code>du</code> Print the disk space used by files and directories. <br>

<code>find</code> Find files that match a pattern. <br>
<code>grep</code> Print 
lines matching a pattern. <br>
<code>gunzip</code> Uncompress a file. <br>

<code>gzip</code> Compress a file. <br>
<code>lpr</code> Send a file to a 
printer. <br>
<code>lprm</code> Remove a print job from a printer's queue. <br>

<code>lpq</code> Check the status of a printer's queue. <br>
<code>ps</code> 
Display running processes. <br>
<code>tar</code> Archive files. <br>
<code>which
</code> Find the path to a program. <br>
<code>who</code> See who is logged in. 
<br> <code>xargs</code> Execute a command for each line of input. <br>
<br>

<p> Table 5.3: Advanced Command-Line Tools</p> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 5.1:</p> 
<p>You're worried your data files can be read by your nemesis, Dr. Evil. How 
would you check whether or not he can, and if necessary change permissions so 
only you can read or write the files?</p> prev top next <br>
<br>

<h1>Basic Scripting</h1> prev  Draft Version 590 next <br>
<br>

<h2>Why Python?</h2> 
<ul> 
<li>Two factors determine time to solution: 
<ul> 
<li>How long it takes to write a program (human time)</li> 
<li>How long it takes that program to run (machine time)</li> </ul></li> 
<li>Different languages make different tradeoffs between programming speed and 
execution speed
<ul> 
<li>Programmers write the same number of lines of code per day no matter what 
language they're using, so high-level languages are good</li> 
<li>But the more abstract the language, the more work it is for the computer 
to figure out what you want it to do</li> 
<li> 
<p> Figure 6.1: Nimble vs. Sturdy Languages</p> <br>
<br>
</li> </ul></li> 
<li><code>Python</code> is: 
<ul> 
<li>Like the shell, only better</li> 
<li>Freely available for many platforms</li> 
<li>Widely used</li> 
<li>Well documented</li> 
<li>(Much) easier to read than Perl 
<ul> 
<li>Material that took three days to teach in Perl took only two to teach in 
Python</li> 
<li>Follow-up surveys showed significantly higher retention rates</li> </ul>
</li> 
<li>(Much) slower than C/C++ or Fortran 
<ul> 
<li>10-100 times slower than compiled, optimized code</li> 
<li>But it's relatively easy to call C/C++ and Fortran libraries from Python
</li> </ul></li> 
<li>Doesn't have all of MATLAB's numerical tools 
<ul> 
<li>But its <code>Numeric</code> package isn't bad</li> 
<li>And it has a lot of things MATLAB doesn't</li> </ul></li> </ul></li> 
<li>This course isn't really about Python 
<ul> 
<li>It's about solving simple problems with the least effort</li> </ul></li> 
<li>But we have to write the examples in something 
<ul> 
<li>So we might as well choose something simple and useful</li> </ul></li> 
<li>For more information: 
<ul> 
<li> [Lutz &amp; Ascher 2003] is the standard introduction</li> 
<li> [Martelli 2005] is a collection of useful tips and tricks 
<ul> 
<li>See <code>Python Cookbook</code> for the on-line version</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Running Python Interactively</h2> 
<ul> 
<li>Running a program in a sturdy language is a two-step process: 
<ul> 
<li>Compiler translates source code into something that can run</li> 
<li>That &ldquo;something&rdquo; then runs 
<ul> 
<li>Directly on the hardware (C, C++, Fortran)</li> 
<li>On a <em>virtual machine</em> (Java)</li> 
<li>Some combination of the two (C#)</li> </ul></li> </ul></li> 
<li>Nimble languages typically combine the compiler and the virtual machine 
<ul> 
<li>A single program reads the user's code, translates it into something 
executable, and executes it right away</li> 
<li> 
<p> Figure 6.2: Sturdy vs. Nimble Execution</p> <br>
<br>
</li> </ul></li> 
<li>This means that most nimble languages can run interactively, like a shell 
<ul> 
<li> 
<pre>$ python </pre> 
<pre>&gt;&gt;&gt; 3 + 5 8 &gt;&gt;&gt; x = 5 * 3 ** 2 # assign 5 times 3 
squared to x &gt;&gt;&gt; print x 45 &gt;&gt;&gt; print 'some' + 'thing' # 
concatenate strings something</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Running Saved Programs</h2> 
<ul> 
<li>Obviously don't have to retype program every time you want to run it</li> 
<li>Option 1: save program in a file with a <code>.py</code> extension, and 
type<code>python filename.py</code> 
<ul> 
<li>Python reads and executes the commands in the file exactly as if they'd 
been typed in interactively</li> </ul></li> 
<li>Option 2 (Unix only): make the following the first line of the <code>.py
</code> file 
<ul> 
<li> 
<pre>#!/usr/bin/env python </pre> </li> 
<li>This tells Unix to look up a program called <code>python</code>, and run 
it with the rest of the file as its input</li> </ul></li> 
<li>Option 3 (Windows only): associate <code>.py</code> files with Python 
<ul> 
<li>Double-clicking on anything ending in <code>.py</code> will then run it
</li> 
<li>Happens automatically when you run the Python Windows installer</li> </ul>
</li> 
<li>Example 
<ul> 
<li>Using an editor, put the following in <code>powers.py</code></li> 
<li> 
<pre>print 2, 2**2, 2**3, 2**4 print 3, 3**2, 3**3, 3**4 print 4, 4**2, 4**3, 
4**5</pre> </li> 
<li>Run using <code>python powers.py</code></li> 
<li>Should see the following</li> 
<li> 
<pre>2 4 8 16 3 9 27 81 4 16 64 1024 </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Variables</h2> 
<ul> 
<li>Variables are names for values 
<ul> 
<li>No declarations: variables are created when something is assigned to them
</li> 
<li> 
<p> Figure 6.3: Variables Refer to Values</p> <br>
<br>
</li> </ul></li> 
<li>No types: a variable is just a name, and can refer to different types of 
values at different times
<ul> 
<li>Although your code will be easier to understand if you don't abuse this
</li> </ul></li> 
<li>Must give a variable a value before using it 
<ul> 
<li>Unlike some languages, Python doesn't try to guess a 
&ldquo;sensible&rdquo; value</li> 
<li> 
<pre>print something </pre> 
<pre>Traceback (most recent call last): File &quot;undefined.py&quot;, line 1, 
in ? print something NameError: name 'something' is not defined</pre> </li> 
</ul></li> 
<li>While variables don't have types, values do 
<ul> 
<li>If you try to operate on incompatible values, Python will complain</li> 
<li> 
<pre>x = 'two' # 'two' is a string y = 2 # 2 is an integer print x * y # 
multiplying a string concatenates it repeatedly print x + y # but you can't add 
an integer and a string</pre> 
<pre>twotwo </pre> 
<pre>Traceback (most recent call last): File &quot;add_int_str.py&quot;, line 
4, in ? print x + y # but you can't add an integer and a string TypeError: 
cannot concatenate 'str' and 'int' objects</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Printing and Quoting</h2> 
<ul> 
<li>The <code>print</code> statement prints zero or more values 
<ul> 
<li>Separated by spaces</li> 
<li>Automatically puts a newline at the end</li> 
<li>So <code>print</code> on its own just prints a blank line</li> </ul></li> 
<li>Use either single or double quotes to create strings 
<ul> 
<li>Must be consistent: if a string starts with one kind of quote, it must end 
with that kind of quote
<ul> 
<li>But different strings in the same program can use different kinds of quotes
</li> 
<li>This was not necessarily a good design decision&hellip;</li> </ul></li> 
<li> 
<pre>print 'a', &quot;b&quot;, '&quot;c&quot;', &quot;'d'&quot; </pre> 
<pre>a b &quot;c&quot; 'd' </pre> </li> </ul></li> 
<li>The built-in function <code>str</code> converts things to strings 
<ul> 
<li> 
<pre>print 'carbon-' + str(14) </pre> 
<pre>carbon-14 </pre> </li> 
<li>Use similar functions called <code>int</code>, <code>float</code>, etc. to 
convert values to other types</li> </ul></li> 
<li>Use <em>escape sequences</em> to put special characters in strings 
<ul> 
<li>Single quotes in a single-quoted string: <code>'This isn\'t unusual.'
</code></li> 
<li>Double quotes in a double-quoted string: <code>&quot;She said, \&quot;You 
can quote me on that!\&quot;&quot;</code></li> 
<li>Tab and newline characters: <code>'\tIndented line\n'</code></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Numbers and Arithmetic</h2> 
<ul> 
<li>The usual numeric types 
<ul> 
<li><code>14</code> is an integer (32 bits long on most machines)</li> 
<li><code>14.0</code> is floating point (double precision, i.e., 64 bits long)
</li> </ul></li> 
<li>Two unusual numeric types 
<ul> 
<li><code>1+4j</code> is a complex number (two 64-bit values)</li> 
<li><code>123456789L</code> is a long integer 
<ul> 
<li>Arbitrary length: uses as much memory as it needs to</li> 
<li>Operations are several times slower</li> 
<li>Python automatically switches to long-integer mode when it needs to</li> 
</ul></li> </ul></li> 
<li>Python borrows C's numeric operators 
<ul> 
<li> Name Operator Use Value Notes <br>
Addition <code>+</code> <code>35 + 22
</code> <code>57</code> <br>
<code>'Py' + 'thon'</code> <code>'Python'</code> 
<br> Subtraction <code>-</code> <code>35 - 22</code> <code>13</code> <br>

Multiplication <code>*</code> <code>3 * 2</code> <code>6</code> <br>
<code>'Py' 
* 2</code> <code>'PyPy'</code> <code>2 * 'Py'</code> is illegal <br>
Division 
<code>/</code> <code>3.0 / 2</code> <code>1.5</code> <br>
<code>3 / 2</code> 
<code>1</code> Integer division rounds down: <code>-3 / 2</code> is <code>-2
</code>, not <code>-1</code> <br>
Exponentiation <code>**</code> <code>2 ** 0.5
</code> <code>1.4142135623730951</code> <br>
Remainder <code>%</code> <code>13 
% 5</code> <code>3</code> <br>
<br>

<p> Table 6.1: Numeric Operators in Python</p> </li> </ul></li> 
<li>Python also supports C's <em>in-place operators</em> 
<ul> 
<li><code>x += 3</code> does the same thing as <code>x = x + 3</code></li> 
<li><code>5 += 3</code> is an error, since you can't assign a new value to 
5&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Booleans</h2> 
<ul> 
<li><code>True</code> and <code>False</code> are true and false (d'oh)</li> 
<li>Empty string, 0, and <code>None</code> are equivalent to false 
<ul> 
<li>Just as 3 is equivalent to 3.0</li> </ul></li> 
<li>(Almost) everything else is true</li> 
<li>Combine Booleans using <code>and</code>, <code>or</code>, <code>not</code> 
<ul> 
<li><code>and</code> and <code>or</code> are <em>short-circuit</em> operators
</li> 
<li>Evaluate expressions left to right, and stop as soon as they know the 
answer</li> 
<li>Result is the last thing evaluated, rather than <code>True</code> or <code>
False</code></li> 
<li> Expression Result Notes <br>
<code>True or False</code> <code>True</code> 
<br> <code>True and False</code> <code>False</code> <br>
<code>'a' or 'b'</code>
<code>'a'</code> <code>or</code> is true if either side is true, so it stops 
after evaluating<code>'a'</code> <br>
<code>'a' and 'b'</code> <code>'b'</code> 
<code>and</code> is only true if both sides are true, so it doesn't stop until 
it has evaluated<code>'b'</code> <br>
<code>0 or 'b'</code> <code>'b'</code> 0 
is false, but<code>'b'</code> is true <br>
<code>0 and 'b'</code> <code>0</code>
Since 0 is false, Python can stop evaluating there <br>
<code>0 and (1/0)</code>
<code>0</code> <code>1/0</code> would be an error, but Python never gets that 
far <br>
<code>(x and 'set') or 'not set'</code> It depends If <code>x</code> 
is true, this expression's value is<code>'set'</code>; if <code>x</code> is 
false, it is<code>'not set'</code> <br>
<br>

<p> Table 6.2: Boolean Operators in Python</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Comparisons</h2> 
<ul> 
<li>Python borrows C's comparison operators, too 
<ul> 
<li>But allows you to chain comparisons together, just as in mathematics</li> 
</ul></li> Expression Value <br>
<code>3 &lt; 5</code> <code>True</code> <br>

<code>3.0 &lt; 5</code> <code>True</code> <br>
<code>3 != 5</code> <code>True
</code> <br>
<code>3 == 5</code> <code>False</code> <br>
<code>3 &lt; 5 &lt;= 7
</code> <code>True</code> <br>
<code>3 &lt; 5 &gt;= 2</code> <code>True</code> 
(but please don't write this&mdash;it's hard to read) <br>
<code>3+2j &lt; 5
</code> Error: can only use <code>==</code> and <code>!=</code> on complex 
numbers <br>
<br>

<p> Table 6.3: Comparison Operators in Python</p> 
<li>Note the difference between assignment and testing for equality 
<ul> 
<li>Use a single equals sign <code>=</code> for assignment</li> 
<li>Use a double equals sign <code>==</code> to test if two things have equal 
values</li> </ul></li> 
<li>String comparison may not do what you expect 
<ul> 
<li>Characters are encoded as numbers: digits come before uppercase letters, 
all of which come before lowercase letters
<ul> 
<li>Punctuation is mixed in between, just to make matters difficult</li> </ul>
</li> 
<li>Strings are compared character by character from first to last until: 
<ul> 
<li>One character is less than another</li> 
<li>One string runs out of characters</li> </ul></li> 
<li> Expression Value <br>
<code>'abc' &lt; 'def'</code> <code>True</code> <br>
<code>'abc' &lt; 'Abc'</code> <code>False</code> <br>
<code>'ab' &lt; 'abc'
</code> <code>True</code> <br>
<code>'0' &lt; '9'</code> <code>True</code> <br>

<code>'100' &lt; '2'</code> <code>True</code> <br>
<br>

<p> Table 6.4: Python String Comparisons</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Conditionals</h2> 
<ul> 
<li>Python uses <code>if</code>, <code>elif</code> (<em>not</em> <code>else if
</code>), and <code>else</code></li> 
<li>Use a colon and indentation to show nesting 
<ul> 
<li> 
<pre>a = 3 if a &lt; 0: print 'less' elif a == 0: print 'equal' else: print 
'greater'</pre> </li> </ul></li> 
<li>Why indentation? 
<ul> 
<li>Based on studies from the 1980s, it's what everyone looks at anyway</li> 
<li>Just count the number of warnings in C/Java books about misleading 
indentation</li> </ul></li> 
<li>Doesn't matter how much you use, but: 
<ul> 
<li>Everything in the block must be indented the same amount</li> 
<li>Tabs are expanded so that they're equivalent to (up to) eight characters 
<ul> 
<li>So don't ever indent with tabs, since your editor may interpret them 
differently</li> </ul></li> 
<li>Many editors understand Python indentation, and will help you get it right 
<ul> 
<li>If you're fond of legacy character-oriented editors, <code>Emacs</code> and
<code>Vim</code> both work well</li> 
<li>If you want a free integrated development environment (IDE), try <code>SPE
</code> or <code>PyDev</code></li> 
<li>If you'd prefer something with commercial support, <code>Komodo</code> and 
<code>WingIDE</code> are my favorites</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>While Loops, Break, and Continue</h2> 
<ul> 
<li>Do something repeatedly as long as some condition is true 
<ul> 
<li>Again, use colon and indentation to show nesting</li> 
<li> 
<pre>a = 3 while a &gt; 0: print a a -= 1 </pre> 
<pre>3 2 1 </pre> </li> </ul></li> 
<li>Do the &ldquo;something&rdquo; zero times if the condition is false the 
first time it is tested
<ul> 
<li> 
<pre>print 'before' a = -1 while a &gt; 0: print a a -=1 print 'after' </pre> 
<pre>before after </pre> </li> </ul></li> 
<li>If the condition is always true, the loop never ends 
<ul> 
<li> 
<pre>a = 3 while a &gt; 0: print a # oops --- forgot to subtract one from a 
</pre> 
<pre>3 3 3 </pre> </li> </ul></li> 
<li>Can break out of the middle of a loop using <code>break</code> 
<ul> 
<li> 
<pre>a = 30 while True: print a a -= 1 if (a % 5) == 0: # if a is divisible by 
5 break</pre> 
<pre>30 29 28 27 26 </pre> </li> 
<li>Don't abuse this: put the test at the top of the loop unless there's a 
really good reason not to</li> </ul></li> 
<li>Can skip to the next iteration using <code>continue</code> 
<ul> 
<li> 
<pre>a = 5 while a &gt; 0: print 'top of loop', a a -= 1 if (a % 2) == 0: 
continue print '...bottom of loop', a</pre> 
<pre>top of loop 5 top of loop 4 ...bottom of loop 3 top of loop 3 top of loop 
2 ...bottom of loop 1 top of loop 1</pre> </li> 
<li>Again, don't abuse this by writing loops that are hard for other people to 
figure out
<ul> 
<li>If only because &ldquo;other people&rdquo; includes you three months from 
now</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Strings, Lists, and Files</h1> prev  Draft Version 546 next <br>
<br>

<h2>Where We Just Were</h2> 
<ul> 
<li>Python is a nimble language with: 
<ul> 
<li>Numbers, strings, and Booleans</li> 
<li>Conditionals (<code>if</code>, <code>elif</code>, and <code>else</code>)
</li> 
<li><code>while</code> loops (with <code>break</code> and <code>continue</code>
)</li> </ul></li> 
<li>This lecture describes: 
<ul> 
<li>Lists, for storing collections of values</li> 
<li>Functions, which reduce redundancy, and make programs easier to read</li> 
<li>Reading and writing files</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>But First, Strings</h2> 
<ul> 
<li>A string is an <em>immutable sequence of characters</em></li> 
<li><em>Immutable</em> means that it cannot be modified once it has been 
created
<ul> 
<li>I.e., you cannot change individual characters in place</li> 
<li> 
<pre>str = 'abc' print 'str is', str str[0] = 'x' print 'str is now', str 
</pre> 
<pre>str is abc </pre> 
<pre>Traceback (most recent call last): File &quot;immutable_err.py&quot;, 
line 3, in ? str[0] = 'x' TypeError: object does not support item assignment
</pre> </li> 
<li>Though you can of course assign a new string value to a variable</li> 
<li> 
<pre>str = 'abc' print 'str is', str str = 'xyz' print 'str is now', str </pre>
<pre>str is abc str is now xyz </pre> </li> </ul></li> 
<li><em>Sequence</em> means that it can be indexed 
<ul> 
<li>Indices start at 0 (as they do in C)&hellip;</li> 
<li>&hellip;so <code>text[0]</code> is the first character of the string <code>
text</code></li> 
<li>The built-in function <code>len</code> returns the length of a 
string&hellip;</li> 
<li>&hellip;so the index of the last character of <code>text</code> is <code>
len(text)-1</code></li> </ul></li> 
<li>Note: there is no separate data type for characters 
<ul> 
<li>A character is simply a string of length 1</li> </ul></li> 
<pre>element = &quot;boron&quot; i = 0 while i &lt; len(element): print 
element[i] i += 1</pre> 
<pre>b o r o n </pre> 
<li>Comment on this slide</li> </ul> 
<h2>Slicing, Bounds, and Negative Indices</h2> 
<ul> 
<li><code>text[start:end]</code> takes a <em>slice</em> out of <code>text
</code> 
<ul> 
<li>Creates a new string containing the characters of <code>text</code> from 
<code>start</code> up to (but not including) <code>end</code></li> 
<li> 
<pre>val = &quot;helium&quot; print val[1:3], val[:2], val[4:] </pre> 
<pre>el he um </pre> </li> 
<li>Sometimes helps to think of indices as being <em>between</em> elements</li>
<li> 
<p> Figure 7.1: Visualizing Indices</p> <br>
<br>
</li> </ul></li> 
<li>A few logical consequences: 
<ul> 
<li><code>text[1:2]</code> is either the second character in <code>text</code>
, or the empty string (if<code>text</code> doesn't have a second character)</li>
<li>So <code>text[1:1]</code> is always the empty string 
<ul> 
<li>From index 1, up to but not including index 1</li> </ul></li> 
<li>And <code>text[2:1]</code> is always the empty string</li> </ul></li> 
<li>Negative indices count backward from the end of the string 
<ul> 
<li><code>x[-1]</code> is the last character 
<ul> 
<li>A lot easier to read than <code>x[len(x)-1]</code></li> </ul></li> 
<li><code>x[-2]</code> is the second-to-last character</li> 
<li> 
<p> Figure 7.2: Visualizing Negative Indices</p> <br>
<br>
</li> 
<li> 
<pre>val = &quot;carbon&quot; print val[-2], val[-4], val[-6] </pre> 
<pre>o r c </pre> </li> </ul></li> 
<li>Bounds checking rules: 
<ul> 
<li>Python always does an out-of-bounds check when you index a single item</li>
<li>But it truncates out-of-range indices when you take a slice</li> 
<li> 
<pre>val = &quot;helium&quot; print val[1:22] x = val[22] </pre> 
<pre>elium </pre> 
<pre>Traceback (most recent call last): File &quot;bounds.py&quot;, line 3, in 
? x = val[22] IndexError: string index out of range</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>String Methods</h2> 
<ul> 
<li>A <em>method</em> is a function that's tied to a particular <em>object</em>
<ul> 
<li>Invented to help programmers organize their code</li> 
<li>To call method <code>M</code> of object <code>X</code>, type <code>X.M()
</code></li> 
<li>We'll see how to create objects and methods of our own later</li> </ul>
</li> 
<li>Almost everything in Python has methods 
<ul> 
<li>Numbers are the only important exception</li> </ul></li> 
<li>String methods 
<ul> 
<li> Method Purpose Example Result <br>
<code>capitalize</code> Capitalize 
first letter of string <code>&quot;text&quot;.capitalize()</code> <code>
&quot;Text&quot;</code> <br>
<code>lower</code> Convert all letters to 
lowercase. <code>&quot;aBcD&quot;.lower()</code> <code>&quot;abcd&quot;</code> 
<br> <code>upper</code> Convert all letters to uppercase. <code>
&quot;aBcD&quot;.upper()</code> <code>&quot;ABCD&quot;</code> <br>
<code>strip
</code> Remove leading and trailing whitespace (blanks, tabs, newlines, etc.) 
<code>&quot; a b &quot;.strip()</code> <code>&quot;a b&quot;</code> <br>
<code>
lstrip</code> Remove whitespace at left (leading) edge of string. <code>&quot; 
a b &quot;.lstrip()</code> <code>&quot;a b &quot;</code> <br>
<code>rstrip
</code> Remove whitespace at right (trailing) edge of string. <code>&quot; a b 
&quot;.rstrip()</code> <code>&quot; a b&quot;</code> <br>
<code>count</code> 
Count how many times one string appears in another. <code>
&quot;abracadabra&quot;.count(&quot;ra&quot;)</code> <code>2</code> <br>
<code>
find</code> Return the index of the first occurrence of one string in another, 
or -1. <code>&quot;abracadabra&quot;.find(&quot;ra&quot;)</code> <code>2</code> 
<br> <code>&quot;abracadabra&quot;.find(&quot;xyz&quot;)</code> <code>-1</code> 
<br> <code>replace</code> Replace occurrences of one string with another. <code>
&quot;abracadabra&quot;.replace(&quot;ra&quot;, &quot;-&quot;)</code> <code>
&quot;ab-cadab-&quot;</code> <br>
<br>

<p> Table 7.1: String Methods</p> </li> </ul></li> 
<li>Notes 
<ul> 
<li>These methods don't have to be called on constant strings 
<ul> 
<li> 
<pre>text = &quot;Hogwarts&quot; print text.upper() print 
text.replace(&quot;rts&quot;, &quot;sh&quot;)</pre> 
<pre>HOGWARTS Hogwash </pre> </li> </ul></li> 
<li>These methods create new strings: they do <em>not</em> change the strings 
they're called on
<ul> 
<li> 
<pre>text = &quot;Hogwarts&quot; print &quot;method result is&quot;, 
text.replace(&quot;rts&quot;, &quot;sh&quot;) print &quot;variable text 
is&quot;, text</pre> 
<pre>method result is Hogwash variable text is Hogwarts </pre> </li> </ul></li>
<li>You can <em>chain</em> method calls together, and mix with indexing, 
concatenation, etc.
<ul> 
<li>If the result of one method call is a string, you can immediately call a 
method on that result</li> 
<li> 
<pre>text = &quot;Hermione&quot; print ':' + text.upper()[4:7].center(10) + ':'
</pre> 
<pre>: ION : </pre> </li> 
<li>Use this in moderation: long chains of method calls are hard to read and 
debug</li> </ul></li> 
<li>You can use <code>is</code> to check whether one string appears in another 
<ul> 
<li> 
<pre>print &quot;atta&quot; in &quot;gatcattcgat&quot; print &quot;tcga&quot; 
in &quot;gatcattcgat&quot;</pre> 
<pre>False True </pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Lists</h2> 
<ul> 
<li>A list is a <em>mutable sequence of objects</em> 
<ul> 
<li><em>Mutable</em> means that, unlike a string, it can be changed in place
</li> 
<li><em>Of objects</em> means that lists can hold anything and everything</li> 
<li>Think of it as a one-dimensional array, or vector, that automatically 
resizes itself as needed</li> </ul></li> 
<li>Write lists using square brackets: <code>[]</code>, <code>[3]</code>, 
<code>[5, &quot;b&quot;]</code> 
<ul> 
<li>The empty list is considered false</li> </ul></li> 
<li>Indexing and slicing work almost the same way for strings and lists: 
<ul> 
<li>Indexing or slicing a string always returns a string</li> 
<li>Indexing a list returns a single item</li> 
<li>Slicing a list returns a new list</li> 
<li> 
<pre>x = [&quot;a&quot;, 2, &quot;bcd&quot;, 4] print x[0] print x[-1] print 
x[1:-1]</pre> 
<pre>a 4 [2, 'bcd'] </pre> </li> 
<li>As before, Python always checks bounds on element access, but truncates 
bounds on slices</li> </ul></li> 
<li>Assign a new value to a list element using <code>x[i] = v</code> 
<ul> 
<li> 
<pre>gases = [&quot;helium&quot;, &quot;argon&quot;, &quot;neon&quot;] print 
gases i = 0 while i &lt; len(gases): gases[i] = &quot;changed&quot; print gases 
i += 1</pre> 
<pre>['helium', 'argon', 'neon'] ['changed', 'argon', 'neon'] ['changed', 
'changed', 'neon'] ['changed', 'changed', 'changed']</pre> </li> </ul></li> 
<li>Adding two (or more) lists concatenates their elements 
<ul> 
<li>Creates a new list</li> 
<li> 
<pre>left = ['L', 'E', 'F', 'T'] right = ['W', 'R', 'I', 'T', 'E'] both = left 
+ right print both</pre> 
<pre>['L', 'E', 'F', 'T', 'W', 'R', 'I', 'T', 'E'] </pre> </li> </ul></li> 
<li>Can't concatenate a string and a list 
<ul> 
<li>But <code>list(text)</code> creates a list whose elements are the 
characters of the string<code>text</code> 
<ul> 
<li> 
<pre>print list(&quot;Dumbledore&quot;) </pre> 
<pre>['D', 'u', 'm', 'b', 'l', 'e', 'd', 'o', 'r', 'e'] </pre> </li> </ul></li>
</ul></li> 
<li><code>del</code> deletes something from the list, and shortens the list 
<ul> 
<li>The &ldquo;something&rdquo; can be a slice, in which case several items 
are deleted</li> 
<li> 
<pre>values = ['a', 'b', 'c', 'd', 'e'] print 'original', values del values[2] 
print 'after deleting item 2', values del values[-2:] print 'after deleting 
last two remaining items', values</pre> 
<pre>original ['a', 'b', 'c', 'd', 'e'] after deleting item 2 ['a', 'b', 'd', 
'e'] after deleting last two remaining items ['a', 'b']</pre> </li> 
<li>Note: <code>del</code> modifies the list, and doesn't return anything</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>List Methods</h2> 
<ul> 
<li>Like strings, lists are objects, and have methods 
<ul> 
<li>In the examples below, assume <code>x</code> is initially <code>['c', 'a', 
'b', 'c']</code></li> 
<li> Method Purpose Example Result <br>
<code>append</code> Add to the end of 
the list. <code>x.append(99)</code> <code>['c', 'a', 'b', 'c', 99]</code> <br>

<code>count</code> Count how many times something appears in the list. <code>
x.count('c')</code> <code>2</code> <br>
<code>index</code> Find the first 
occurrence of something in the list. <code>x.index('a')</code> <code>1</code> 
<br> <code>insert</code> Insert something into the list. <code>x.insert(2, 
'diamond')</code> <code>['c', 'a', 'diamond', 'b', 'c']</code> <br>
<code>remove
</code> Remove the first occurrence of something from the list. <code>
x.remove('c')</code> <code>['a', 'b', 'c']</code> <br>
<code>reverse</code> 
Reverse the list in place. <code>x.reverse()</code> <code>['c', 'b', 'a', 'c']
</code> <br>
<code>sort</code> Sort the list in place. <code>x.sort()</code> 
<code>['a', 'b', 'c', 'c']</code> <br>
<br>

<p> Table 7.2: List Methods</p> </li> </ul></li> 
<li>Notes 
<ul> 
<li>It's an error if <code>list.index</code> can't find the item it's 
searching for
<ul> 
<li>The next lecture describes how to handle errors</li> </ul></li> 
<li><code>list.reverse</code> and <code>list.sort</code> change the list, and 
return<code>None</code> 
<ul> 
<li><code>x = x.reverse()</code> is a common error</li> 
<li>It reverses <code>x</code>, but then sets <code>x</code> to <code>None
</code>, so all data is lost</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>For Loops and Ranges</h2> 
<ul> 
<li>Python's <code>for</code> statement automatically loops over the <em>
content</em> of a collection 
<ul> 
<li><code>for x in text</code> sets <code>x</code> to each character of <code>
text</code> in turn</li> 
<li><code>for x in someList</code> sets <code>x</code> to each element of 
<code>someList</code> in turn</li> 
<li> 
<pre>for c in 'lead': print '+' + c + '+', print for x in ['helium', 'argon', 
'neon']: print x.capitalize()</pre> 
<pre>+l+ +e+ +a+ +d+ Helium Argon Neon </pre> </li> 
<li>The trailing comma in the <code>print</code> statement suppresses the 
automatic newline</li> </ul></li> 
<li>The built-in function <code>range</code> creates the list <code>[start, 
start+1, ..., end-1]</code> 
<ul> 
<li>Note: <code>end-1</code>, just as <code>x[start:end]</code> is the 
elements of<code>x</code> up to, but not including, <code>end</code></li> 
<li><code>range(end)</code> is the same as <code>range(0, end)</code></li> 
<li><code>range(start, end, step)</code> goes in increments of <code>step
</code></li> 
<li>May generate an empty list</li> 
<li> 
<pre>print range(2, 5) print range(3) print range(2, 10, 3) print range(3, 1) 
</pre> 
<pre>[2, 3, 4] [0, 1, 2] [2, 5, 8] [] </pre> </li> </ul></li> 
<li>So: 
<ul> 
<li>To loop from 0 to N-1, use <code>for i in range(N)</code></li> 
<li>To loop over the indices of a list or string, use <code>for i in 
range(len(sequence))</code></li> 
<li> 
<pre>chars = &quot;abc&quot; for i in range(len(chars)): print i, chars[i] 
</pre> 
<pre>0 a 1 b 2 c </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Membership</h2> 
<ul> 
<li><code>x in c</code> is <code>True</code> if the value <code>x</code> is in 
the collection<code>c</code> 
<ul> 
<li>Equivalent to a substring test on strings 
<ul> 
<li><code>'x' in 'Harry'</code> is <code>False</code></li> 
<li><code>'ar' in 'Harry'</code> is <code>True</code></li> </ul></li> 
<li>Works element-by-element on lists 
<ul> 
<li><code>3 in [1, 2, 3, 4]</code> is <code>True</code></li> 
<li><code>[2, 3] in [1, 2, 3, 4]</code> is <code>False</code></li> </ul></li> 
<li> 
<pre>vowels = 'aeiou' for v in vowels: if v in 'uranium': print v </pre> 
<pre>a i u </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Nesting Lists</h2> 
<ul> 
<li>Since lists can contain anything, you can build lists of lists of lists 
of&hellip;
<ul> 
<li>Example: use a list of two values to represent a point, and a list of 
points to represent a line segment
<ul> 
<li> 
<p> Figure 7.3: Line Segment</p> <br>
<br>
</li> </ul></li> </ul></li> 
<li>Write indices left to right to select elements from the outside in 
<ul> 
<li> 
<pre>x = [[13, 17, 19], [23, 29]] print x[1] print x[0][1:3] </pre> 
<pre>[23, 29] [17, 19] </pre> </li> </ul></li> 
<li>The nested lists are objects in their own right 
<ul> 
<li>The outer list stores a reference to the inner list 
<ul> 
<li>But the inner list does <em>not</em> know that it's being referred to</li> 
<li>Object in Python (almost) never know who's pointing at them</li> </ul></li>
<li>When you index the outer list, you get an <em>alias</em> for the inner list
<ul> 
<li>Another name for the same data</li> </ul></li> 
<li>Changes made through either reference update the same data 
<ul> 
<li> 
<pre>x = [['a', 'b'], ['c', 'd', 'e']] y = x[0] print 'before: nested list 
is', x print '...and sublist is', y y[0] = 123 print 'after: nested list is', x 
print '...and sublist is', y</pre> 
<pre>before: nested list is [['a', 'b'], ['c', 'd', 'e']] ...and sublist is 
['a', 'b'] after: nested list is [[123, 'b'], ['c', 'd', 'e']] ...and sublist 
is [123, 'b']</pre> </li> 
<li> 
<p> Figure 7.4: Aliasing In Action</p> <br>
<br>
</li> </ul></li> </ul></li> 
<li>I lied to you earlier when I said that indexing and slicing does the same 
thing on lists that it does on strings
<ul> 
<li>The technical term is &ldquo;pedagogically motivated misdirection&rdquo;
</li> 
<li>Indexing returns whatever the list itself contains 
<ul> 
<li>In the case of a nested list, this is a reference to the sublist</li> </ul>
</li> 
<li>Slicing returns a new list containing the selected elements of the 
original list
<ul> 
<li>So changes to a slice do <em>not</em> affect the original list</li> 
<li>Can't tell the difference with strings, since there's no way to update one 
in place anyway</li> 
<li> 
<pre>x = [['a', 'b'], ['c', 'd', 'e'], ['f', 'g']] y = x[0:2] print 'before: 
nested list is', x print '...and slice is', y y[0] = 123 print 'after: nested 
list is', x print '...and modified slice is', y</pre> 
<pre>before: nested list is [['a', 'b'], ['c', 'd', 'e'], ['f', 'g']] ...and 
slice is [['a', 'b'], ['c', 'd', 'e']] after: nested list is [['a', 'b'], ['c', 
'd', 'e'], ['f', 'g']] ...and modified slice is [123, ['c', 'd', 'e']]</pre> 
</li> 
<li> 
<p> Figure 7.5: Slicing Copies Data</p> <br>
<br>
</li> </ul></li> 
<li>Yes, it can be confusing&hellip; 
<ul> 
<li>&hellip;but anything else would be unacceptably slow&hellip;</li> 
<li>&hellip;so draw diagrams when you need to&hellip;</li> 
<li>&hellip;and don't write overly-complicated code in the first place</li> 
</ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Tuples</h2> 
<ul> 
<li>Python actually has a second type of list, called a <em>tuple</em> 
<ul> 
<li>Just like a normal list, but immutable (i.e., can't be changed after 
creation)</li> 
<li>Written using parentheses instead of square brackets: <code>(1, 2, 3)
</code> instead of <code>[1, 2, 3]</code></li> 
<li>Empty tuple is <code>()</code></li> 
<li>Tuple with one element must be written with a comma, as in <code>(55,)
</code> 
<ul> 
<li>Because <code>(55)</code> has to be just the integer 55, or the 
mathematicians will get upset</li> </ul></li> </ul></li> 
<li>Why bother? 
<ul> 
<li>Performance: if you know the length of the sequence isn't going to change, 
you can do some things more quickly</li> 
<li>There are places where Python needs immutable objects that contain other 
values
<ul> 
<li>We'll meet them in the next lecture</li> </ul></li> 
<li>I still think it's a wart&hellip;</li> </ul></li> 
<li>Tuples allow Python to provide <em>multi-valued assignment</em> 
<ul> 
<li><code>a, b = 2, 3</code> assigns 2 to <code>a</code>, and 3 to <code>b
</code> 
<ul> 
<li>Equivalent to <code>a, b = (2, 3)</code></li> </ul></li> 
<li><code>a, b, c = [1, 2, 3]</code> does what you'd expect</li> 
<li><code>a, b = [1, 2, 3, 4]</code> is an error 
<ul> 
<li>Number of targets on the left must match the number of values on the right
</li> </ul></li> 
<li><code>a, b = b, a</code> swaps the values in <code>a</code> and <code>b
</code></li> </ul></li> 
<li>Use multi-valued assignment in <code>for</code> loops to unpack structures 
on the fly
<ul> 
<li> 
<pre>corners = [[1, 3], [2, 7], [4, 0], [4, 9]] sumX, sumY = 0, 0 for cX, cY 
in corners: sumX += cX sumY += cY sumX = float(sumX) / len(corners) sumY = 
float(sumY) / len(corners) print &quot;center is&quot;, sumX, sumY</pre> 
<pre>center is 2.75 4.75 </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Files</h2> 
<ul> 
<li>Use the built-in function <code>open()</code> to open a file 
<ul> 
<li>First argument is path</li> 
<li>Second is <code>'r'</code> (for read) or <code>'w'</code> for write</li> 
<li>Result is a file object with methods for input and output</li> </ul></li> 
<pre>infile = open('file.txt', 'r') outfile = open('copy.txt', 'w') line = 
infile.readline() while line: outfile.write(line) line = infile.readline() 
infile.close() outfile.close()</pre> 
<li>Here's what just happened: 
<ul> 
<li>First statement opens <code>file.txt</code> for reading, and assigns the 
file object to<code>input</code></li> 
<li>Second statement opens <code>copy.txt</code> for writing, and assigns the 
file object to<code>output</code></li> 
<li>Program then tries to read a line from <code>input</code> 
<ul> 
<li>If the file is empty, <code>line</code> is assigned the value <code>None
</code></li> 
<li>Like <code>Null</code> in C, or <code>null</code> in Java, it means 
&ldquo;nothing here&rdquo;, and is considered false</li> </ul></li> 
<li>As long as there are lines in the input file, the program: 
<ul> 
<li>Writes the most recent line to <code>output</code></li> 
<li>Reads the next line</li> </ul></li> 
<li>When the input file is exhausted, the program closes <code>input</code> and
<code>output</code> 
<ul> 
<li>Python will close the files automatically when the program exits&hellip;
</li> 
<li>&hellip;but it's good practice to tidy up your toys when your done playing 
with them</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Other Ways to Do It</h2> 
<ul> 
<li>Could also copy files like this: 
<ul> 
<li> 
<pre>infile = open('file.txt', 'r') outfile = open('copy.txt', 'w') for line 
in infile: outfile.write(line) infile.close() outfile.close()</pre> </li> </ul>
</li> 
<li>Or this: 
<ul> 
<li> 
<pre>infile = open('file.txt', 'r') contents = infile.readlines() 
infile.close() outfile = open('copy.txt', 'w') outfile.writelines(contents) 
outfile.close()</pre> </li> </ul></li> 
<li>Moral of the story: get to know the standard library of whatever language 
you're using
<ul> 
<li>A week of hard work can sometimes save you an hour of reading, too&hellip;
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 7.1:</p> 
<p>What does <code>&quot;aaaaa&quot;.count(&quot;aaa&quot;)</code> return? Why?
</p> 
<p>Exercise 7.2:</p> 
<p>What does the built-in function <code>enumerate</code> do? Use it to write 
a function called<code>findOver</code> that takes a list of numbers called 
<code>values</code>, and a number called <code>threshold</code>, as arguments, 
and returns a list of the locations where items in<code>values</code> are 
greater than<code>threshold</code>. For example, <code>findOver([1.1, 3.8, 
-1.6, 7.4], 2.0)</code> should return <code>[1, 3]</code>, since the values in 
the input list at locations 1 and 3 are greater than the threshold 2.0.</p> 
<p>Exercise 7.3:</p> 
<p>What do each of the following five code fragments do? Why?</p> 
<pre>x = ['a', 'b', 'c', 'd'] x[0:2] = [] </pre> <br>

<pre>x = ['a', 'b', 'c', 'd'] x[0:2] = ['q'] </pre> <br>

<pre>x = ['a', 'b', 'c', 'd'] x[0:2] = 'q' </pre> <br>

<pre>x = ['a', 'b', 'c', 'd'] x[0:2] = 99 </pre> <br>

<pre>x = ['a', 'b', 'c', 'd'] x[0:2] = [99] </pre> <br>
<br>

<p>Exercise 7.4:</p> 
<p>What does <code>'a'.join(['b', 'c', 'd'])</code> return? If you have a list 
of strings, how can you concatenate them in a single statement? Why do you think
<code>join</code> is written this way, rather than as <code>['b', 'c', 
'd'].join('a')</code>?</p> prev top next <br>
<br>

<h1>Functions, Libraries, and the File System</h1> prev  Draft Version 584 next
<br> <br>

<h2>Where We Just Were</h2> 
<ul> 
<li>Python has: 
<ul> 
<li>The usual primitive data types (numbers, strings, Booleans)</li> 
<li>The usual ways to combine statements (loops and conditionals)</li> 
<li>Lists for storing collections of data</li> </ul></li> 
<li>This lecture describes: 
<ul> 
<li>Functions, for reusing code, and making it easier to understand</li> 
<li>Modules, for building libraries</li> 
<li>Four commonly-used libraries</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Defining Functions</h2> 
<ul> 
<li>Define a new function using <code>def</code> 
<ul> 
<li>Argument names follow in parentheses 
<ul> 
<li>No types</li> </ul></li> 
<li> 
<pre># Define function. def ave(x, y): return (x + y) / 2.0 # Use function. 
print ave(20, 30)</pre> 
<pre>25.0 </pre> </li> </ul></li> 
<li>Exit at any time with <code>return</code> 
<ul> 
<li> 
<pre>def sign(x): if x &lt; 0: return -1 if x == 0: return 0 return 1 for i in 
[-17.0, 33.3, 0.0]: print i, sign(i)</pre> 
<pre>-17.0 -1 33.3 1 0.0 0 </pre> </li> 
<li>Functions with lots of <code>return</code> statements tend to be hard to 
understand</li> </ul></li> 
<li>Every function returns something 
<ul> 
<li><code>return</code> on its own is the same as <code>return None</code></li>
<li>Functions without <code>return</code> statements also return <code>None
</code> 
<ul> 
<li><code>list.sort</code> and <code>list.reverse</code> are examples</li> 
</ul></li> 
<li> 
<pre>def double_elt(x): for i in range(len(x)): x[i] = x[i] * 2 values = [3, 
'xyz', [9]] print &quot;values before call:&quot;, values result = 
double_elt(values) print &quot;result of call:&quot;, result print &quot;values 
after call:&quot;, values</pre> 
<pre>values before call: [3, 'xyz', [9]] result of call: None values after 
call: [6, 'xyzxyz', [9, 9]]</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Scope</h2> 
<ul> 
<li>Variables created in function are local to it 
<ul> 
<li>Fresh copies created for each call</li> 
<li>Values discarded when the function returns</li> 
<li>As always, variables must be defined before they can be used</li> </ul>
</li> 
<li>Python manages variables using a <em>call stack</em> 
<ul> 
<li> 
<pre># Global variable called 'x'. x = 123 # Function that defines a local 
variable called 'x'. def f(arg): x = arg print &quot;in call, x is&quot;, x # 
Call the function to prove that it uses its local 'x'. print &quot;before call, 
global x is&quot;, x f(999) print &quot;after call, global x is&quot;, x</pre> 
<pre>before call, global x is 123 in call, x is 999 after call, global x is 123
</pre> </li> 
<li> 
<p> Figure 8.1: Call Stack (a)</p> <br>
<br>
</li> 
<li> 
<p> Figure 8.2: Call Stack (b)</p> <br>
<br>
</li> 
<li> 
<p> Figure 8.3: Call Stack (c)</p> <br>
<br>
</li> 
<li>Each time a function is called, Python creates new variables, and puts 
them on top of the stack</li> 
<li>When a variable is referenced, Python looks at the top <em>stack frame</em>
, then at global variables
<ul> 
<li>Unlike some languages, does <em>not</em> search every frame in the stack
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Parameter Passing Rules</h2> 
<ul> 
<li>Python copies variables' values when passing them to functions 
<ul> 
<li>Since Booleans, numbers, and strings can't be updated, a function can't 
affect its caller's values</li> 
<li>But if you pass a list to a function, the function will operate on the 
original list,<em>not</em> a copy</li> 
<li> 
<pre>def mutate(x, y): x = 0 y[0] = &quot;modified&quot; single = 1 triple = 
[1, 2, 3] print &quot;before call, single is&quot;, single, &quot;and triple 
is&quot;, triple mutate(single, triple) print &quot;after call, single 
is&quot;, single, &quot;and triple is&quot;, triple</pre> 
<pre>before call, single is 1 and triple is [1, 2, 3] after call, single is 1 
and triple is ['modified', 2, 3]</pre> </li> 
<li> 
<p> Figure 8.4: Argument Passing (a)</p> <br>
<br>
</li> 
<li> 
<p> Figure 8.5: Argument Passing (b)</p> <br>
<br>
</li> 
<li> 
<p> Figure 8.6: Argument Passing (c)</p> <br>
<br>
</li> 
<li> 
<p> Figure 8.7: Argument Passing (d)</p> <br>
<br>
</li> </ul></li> 
<li>If you want to pass a copy of a list into <code>mutate</code>, use <code>
mutate(single, triple[:])</code> 
<ul> 
<li><code>triple[:]</code> is the same as <code>triple[0:len(triple)]</code>
&hellip;</li> 
<li>&hellip;which is a slice of <code>triple</code> that includes the entire 
list&hellip;</li> 
<li>&hellip;and slicing creates a new list</li> 
<li> 
<p> Figure 8.8: Passing a Slice</p> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Default Parameter Values</h2> 
<ul> 
<li>You can specify default values for parameters when defining a function 
<ul> 
<li>Just &ldquo;assign&rdquo; some constant to the parameter in the definition
</li> 
<li>The parameters actually passed when the function is called are matched up 
left to right
<ul> 
<li>So put the parameters the user is least likely to want to change at the 
end of the parameter list</li> </ul></li> 
<li> 
<pre>def total(values, start=0, end=None): # If no values given, total is 
zero. if not values: return 0 # If no end specified, use the entire sequence. 
if end is None: end = len(values) # Calculate. result = 0 for i in range(start, 
end): result += values[i] return result</pre> 
<pre>numbers being added [10, 20, 30, 40, 50, 60] total(numbers, 0, 3) 60 
total(numbers, 4) 110 total(numbers) 210</pre> </li> </ul></li> 
<li>All arguments with defaults must come <em>after</em> all arguments without 
them
<ul> 
<li>Otherwise, matching values to parameters would be ambiguous</li> 
<li> 
<pre>def total(values, start=0, end): # If no values given, total is zero. if 
not values: return 0 # Calculate. result = 0 for i in range(start, end): result 
+= values[i] return result</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Extra Arguments</h2> 
<ul> 
<li>If a function has been defined the right way, you can call it with extra 
arguments
<ul> 
<li>Last parameter in definition must have <code>*</code> in front of its name 
<ul> 
<li>Doesn't matter what it's called, but most people use <code>*extra</code>
</li> </ul></li> 
<li>Any &ldquo;leftover&rdquo; parameters are put in a tuple and passed via 
this argument
<ul> 
<li>Remember, a tuple is an immutable (unmodifiable) list</li> </ul></li> 
<li>Can only be one <code>*</code> argument per function 
<ul> 
<li>If there were two or more, how would Python know which extra values to put 
in which?</li> </ul></li> 
<li> 
<pre>def show(first, *extra): print first, extra show(10) show(10, 20, 30) 
show(10, 'text', ['a', 'list'])</pre> 
<pre>10 () 10 (20, 30) 10 ('text', ['a', 'list']) </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Functions Are Objects</h2> 
<ul> 
<li>Once it has been translated into instructions, a function is just another 
object
<ul> 
<li>Happens to be an object you can call, just as strings and lists happens to 
be objects you can index</li> 
<li><code>def</code> is just a shorthand for &ldquo;create a function, and 
assign it to a variable&rdquo;</li> 
<li> 
<pre>Pi = 3.14 def circum(r): return 2 * Pi * r for x in [1.0, 2.0, 3.0]: 
print x, circum(x)</pre> </li> 
<li> 
<p> Figure 8.9: Functions As Objects</p> <br>
<br>
</li> </ul></li> 
<li>This means you can: 
<ul> 
<li>Redefine functions (just as you can reassign values to variables)</li> 
<li>Create aliases for functions</li> 
<li>Pass functions as parameters</li> 
<li>Store functions in lists</li> </ul></li> 
<li>Example: apply a function to each value in a list 
<ul> 
<li> 
<pre># Apply a function to each value in a list. def applyToList(func, 
values): result = [] for x in values: y = func(x) result.append(y) return 
result # A sample function (calculates 1/3 of value). def oneThird(a): return 
a/3.0 # Test. values = [0.0, 0.5, 0.75, 0.875, 0.9375] output = 
applyToList(oneThird, values) for i in range(len(values)): print values[i], 
&quot;=&gt;&quot;, output[i]</pre> 
<pre>0.0 =&gt; 0.0 0.5 =&gt; 0.166666666667 0.75 =&gt; 0.25 0.875 =&gt; 
0.291666666667 0.9375 =&gt; 0.3125</pre> </li> </ul></li> 
<li>Example: apply several functions to a single value 
<ul> 
<li> 
<pre># Apply each function in a list to a value. def applyEach(functions, 
value): result = [] for f in functions: y = f(value) result.append(y) return 
result # One half. def oneHalf(a): return a/2.0 # One third. def oneThird(a): 
return a/3.0 # One quarter. def oneQuarter(a): return a/4.0 # Test. functions = 
[oneHalf, oneThird, oneQuarter] output = applyEach(functions, 0.25) for i in 
range(len(functions)): print functions[i].__name__, output[i]</pre> 
<pre>oneHalf 0.125 oneThird 0.0833333333333 oneQuarter 0.0625 </pre> </li> 
<li>Note: every function has an attribute called <code>__name__</code>, which 
is the name it was originally defined under
<ul> 
<li>Handy when debugging</li> </ul></li> 
<li> 
<pre># An example function. def original(left, right): return (left + right) / 
2.0 # Create an alias for it. alias = original # Call them directly. print 
&quot;calling original:&quot;, original.__name__, original(3, 4) print 
&quot;calling alias:&quot;, alias.__name__, alias(3, 4) # Get a little fancy. 
print &quot;Calling in loop...&quot; for f in [original, alias]: print 
f.__name__, f(5, 8)</pre> 
<pre>calling original: original 3.5 calling alias: original 3.5 Calling in 
loop... original 6.5 original 6.5</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Creating Modules</h2> 
<ul> 
<li>Every Python file is automatically also a <em>module</em> (or library) 
<ul> 
<li>If the file is called <code>xyz.py</code>, load it using <code>import xyz
</code></li> </ul></li> 
<li>The statements in the module are executed as it is loaded 
<ul> 
<li>Assignment and <code>def</code> are statements</li> 
<li>You can use conditionals, loops, and anything else, too</li> </ul></li> 
<li>Refer to things in a module using <code>module.thing</code> 
<ul> 
<li>Put this in <code>mylib.py</code></li> 
<li> 
<pre># A constant. value = 123 # Remember, modules are executed as they're 
loaded... if value &lt; 200: size = 'small' else: size = 'large' # A function. 
def printVersion(): print 'Stuff Version 2.2'</pre> </li> 
<li>Use it by putting this in <code>program.py</code></li> 
<li> 
<pre># Load the contents of mylib.py. import mylib # Define our own version of 
value. value = &quot;something else entirely&quot; # Show mylib's values. print 
'mylib.value', mylib.value print 'mylib.size', mylib.size # Show out own 
values. print 'own value:', value # Call function. mylib.printVersion()</pre> 
</li> 
<li>When <code>program.py</code> runs, it prints this</li> 
<li> 
<pre># Load the contents of mylib.py. import mylib # Define our own version of 
value. value = &quot;something else entirely&quot; # Show mylib's values. print 
'mylib.value', mylib.value print 'mylib.size', mylib.size # Show out own 
values. print 'own value:', value # Call function. mylib.printVersion()</pre> 
<pre>mylib.value 123 mylib.size small own value: something else entirely Stuff 
Version 2.2</pre> </li> </ul></li> 
<li>Notice that both <code>mylib.py</code> and <code>program.py</code> define 
<code>value</code> 
<ul> 
<li>Each module is its own global scope</li> 
<li>When something in <code>mylib.py</code> references <code>value</code>, it 
always gets its own<code>value</code></li> </ul></li> 
<li>You can also use: 
<ul> 
<li><code>import mylib as m</code>, then call <code>m.printVersion()</code>
</li> 
<li><code>from mylib import printVersion</code>, then call <code>printVersion()
</code> 
<ul> 
<li>Question: what would happen if you did <code>from mylib import value</code>
?</li> </ul></li> 
<li><code>from mylib import *</code> imports everything from <code>mylib</code>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Math Library</h2> 
<ul> 
<li>Python is a small language with a large library 
<ul> 
<li>Much of the standard library is just Python interfaces to standard C 
libraries</li> </ul></li> 
<li>Example: the <code>math</code> library 
<ul> 
<li> Type Name Purpose Example Result <br>
Constant <code>e</code> Constant 
<code>e</code> <code>2.71828&hellip;</code> <br>
<code>pi</code> Constant <code>
pi</code> <code>3.14159&hellip;</code> <br>
Function <code>ceil</code> Ceiling 
<code>ceil(2.5)</code> <code>3.0</code> <br>
<code>floor</code> Floor <code>
floor(-2.5)</code> <code>-3.0</code> <br>
<code>exp</code> Exponential <code>
exp(1.0)</code> <code>2.71828&hellip;</code> <br>
<code>log</code> Logarithm 
<code>log(4.0)</code> <code>1.38629&hellip;</code> <br>
<code>log(4.0, 2.0)
</code> <code>2.0</code> <br>
<code>log10</code> Base-10 logarithm <code>
log10(4.0)</code> <code>0.60205&hellip;</code> <br>
<code>pow</code> Power 
<code>pow(2.5, 2.0)</code> <code>6.25</code> <br>
<code>sqrt</code> Square root 
<code>sqrt(9.0)</code> <code>3.0</code> <br>
<code>cos</code> Cosine <code>
cos(pi)</code> <code>-1.0</code> <br>
<code>asin</code> Arc sine <code>
asin(-1.0)</code> <code>-1.5707&hellip;</code> <br>
<code>hypot</code> 
Euclidean norm<em>x2 + y2</em> <code>hypot(2, 3)</code> <code>3.60555&hellip;
</code> <br>
<code>degrees</code> Convert from radians to degrees <code>
degrees(pi)</code> <code>180</code> <br>
<code>radians</code> Convert from 
degrees to radians <code>radians(45)</code> <code>0.78539&hellip;</code> <br>

<br> 
<p> Table 8.1: The Python Standard Math Library</p> </li> 
<li>All the other trigonometric functions (<code>tan</code>, <code>arctan
</code>, etc.) are also there</li> 
<li><code>abs</code> is built in to the language: don't have to import 
anything to use it</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The System Library</h2> 
<ul> 
<li>Most commonly used library in Python is the system library <code>sys</code>
<ul> 
<li>Information about Python (e.g., version number and copyright notice)</li> 
<li>Information about the environment (e.g., what operating system the program 
is running on)</li> 
<li>Advanced features that mere mortals should never meddle with</li> </ul>
</li> 
<li>By convention, always imported with <code>import sys</code> 
<ul> 
<li>Members referred to as <code>sys.x</code>, rather than just <code>x</code>
</li> </ul></li> 
<li>Contents 
<ul> 
<li> Type Name Purpose Example Result <br>
Data <code>argv</code> The 
program's command line arguments <code>argv[0]</code> <code>
&quot;myscript.py&quot;</code> (or whatever your program is called) <br>
<code>
maxint</code> Largest positive value that can be represented by Python's basic 
integer type <code>sys.maxint</code> <code>2147483647</code> <br>
<code>path
</code> List of directories that Python searches when importing modules <code>
sys.path</code> <code>['/home/greg/pylib', '/Python24/lib', 
'/Python24/lib/site-packages']</code> <br>
<code>platform</code> What type of 
operating system Python is running on <code>sys.platform</code> <code>
&quot;win32&quot;</code> <br>
<code>stdin</code> Standard input <code>
sys.stdin.readline()</code> (Typically) the next line of input from the keyboard
<br> <code>stdout</code> Standard output <code>sys.stdout.write('****')</code> 
(Typically) print four stars to the screen <br>
<code>stderr</code> Standard 
error <code>sys.stderr.write('Program crashing!\n')</code> Print an error 
message to the screen <br>
<code>version</code> What version of Python this is 
<code>sys.version</code> <code>&quot;2.4 (#60, Feb 9 2005, 19:03:27) [MSC 
v.1310 32 bit (Intel)]&quot;</code> <br>
Function <code>exit</code> Exit from 
Python, returning a status code to the operating system <code>sys.exit(0)</code>
Terminates program with status 0 <br>
<br>

<p> Table 8.2: The Python System Library</p> </li> </ul></li> 
<li><code>sys.argv</code> is automatically initialized to the program's 
command-line arguments
<ul> 
<li>Program's name is always <code>sys.argv[0]</code></li> 
<li>Example: <code>python program.py -d noisy</code> gets <code>['program.py', 
'-d', 'noisy']</code></li> </ul></li> 
<li><code>sys.path</code> is the list of places Python is allowed to look to 
find modules for import
<ul> 
<li>Initialized from the <code>PYTHONPATH</code> environment variable 
<ul> 
<li>Directory containing the program being run is automatically put at the 
start of this list</li> </ul></li> 
<li>If <code>sys.path</code> is <code>['/home/swc/exmpl/py03', 
'/home/swc/lib', '/Python24/lib']</code>, then <code>import quark</code> will 
look for:
<ul> 
<li><code>/home/swc/exmpl/py03/quark.py</code></li> 
<li><code>/home/swc/lib/quark.py</code></li> 
<li><code>/Python24/lib/quark.py</code></li> 
<li>then fail</li> </ul></li> </ul></li> 
<li><code>sys.stdin</code> and <code>sys.stdout</code> are normally connected 
to the keyboard and screen
<ul> 
<li>If you redirect input, or are using a pipe, <code>sys.stdin</code> reads 
from a file or another program
<ul> 
<li>In <code>python reader.py &lt; somefile.txt</code>, <code>reader.py</code>
's<code>sys.stdin</code> reads from <code>somefile.txt</code></li> </ul></li> 
<li>If you redirect output, or are using a pipe, <code>sys.stdout</code> 
writes to a file or another program
<ul> 
<li><code>python writer.py | sort | uniq</code> sorts the output of <code>
writer.py</code> and removes duplicate lines</li> </ul></li> </ul></li> 
<li><code>sys.exit</code> terminates the program, and returns an integer <em>
status code</em> to the operating system 
<ul> 
<li>0 indicates successful execution (&ldquo;zero errors&rdquo;)</li> 
<li>Non-zero is an error code 
<ul> 
<li>Please be polite and return 1 or -1 if you detect an error in your program
</li> </ul></li> 
<li>Yes, it's the opposite of what you'd expect&hellip;</li> 
<li>If you don't exit explicitly, Python returns 0</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Times</h2> 
<ul> 
<li>Can't delete old files, or check how long your program has been running, 
without some notion of time</li> 
<li>Terminology: 
<ul> 
<li>The <em>epoch</em> is the moment from which time is measured. On Unix, the 
epoch is midnight, January 1, 1970; time is measured in seconds since then.</li>
<li><em>Coordinated Universal Time</em>, or UTC, is the official time planet 
Earth. It used to be called Greenwich Mean Time (GMT).</li> 
<li><em>Local time</em> is what the clock on your wall shows. It is defined to 
be UTC, plus or minus a constant offset determined by your<em>time zone</em>, 
possibly modified by<em>daylight savings time</em>.</li> 
<li>A <em>leap year</em> is a year that has an extra day (to keep the calendar 
in synch with Earth's orbit around the sun)</li> 
<li>A <em>leap second</em> is an extra second added to a day to keep UTC in 
synch with Earth's rotation
<ul> 
<li>Sometimes, two leap seconds have to be added.</li> </ul></li> 
<li>A <em>time structure</em> is an object with nine fields, representing a 
time in a more comprehensible format.
<ul> 
<li><code>tm_year</code>: year (e.g., 2005)</li> 
<li><code>tm_mon</code>: month (integer in the range [1, 12])</li> 
<li><code>tm_mday</code>: day of the month (integer in the range [1, 31])</li> 
<li><code>tm_hour</code>: hour of the day (integer in the range [0, 23])</li> 
<li><code>tm_min</code>: minute of the hour (integer in the range [0, 59])</li>
<li><code>tm_sec</code>: second of the minute (integer in the range [0, 61])
</li> 
<li><code>tm_wday</code>: week day (integer in the range [0, 6], with Monday 
being 0)</li> 
<li><code>tm_yday</code>: day of the year (integer in the range [1, 366])</li> 
<li><code>tm_isdst</code>: daylight savings time flag</li> </ul></li> </ul>
</li> 
<li>Contents of <code>time</code> module (presented out of order so that 
they'll make more sense):
<ul> 
<li> Type Name Purpose Example Result <br>
Function <code>time</code> The 
current time, in seconds since the epoch. <code>time.time()</code> 
1111941637.0929999 (on March 27, 2005, at 11:40:39 EST) <br>
<code>gmtime</code>
Convert a time (in seconds since the epoch) to a time structure representing 
the time in UTC. <code>time.gmtime(1111941637)</code> A structure with <code>
s.tm_year</code> equal to 2005, <code>s.tm_hour</code> equal to 16, etc. <br>

<code>localtime</code> Like <code>gmtime</code>, but returns the local time. 
<code>time.localtime(1111941637)</code> A structure with <code>s.tm_hou</code> 
equal to 11 instead of 16. <br>
<code>ctime</code> Convert a time (in seconds 
since the epoch) to a readable string in local time. time.ctime(1111941637)
<code></code> <code>&quot;Sun Mar 27 11:40:37 2005&quot;</code> <br>
<code>
asctime</code> Convert a time structure to a readable string in UTC. 
time.asctime(time.gmtime(1111941637))<code></code> <code>&quot;Sun Mar 27 
16:40:37 2005&quot;</code> <br>
<code>mktime</code> Convert a time structure 
(or a 9-element tuple) to seconds since the epoch in the local time zone. <code>
time.mktime((1970, 1, 1, 0, 0, 0, 0, 0, 0))</code> 18000.0 (in Eastern Standard 
Time) <br>
<code>sleep</code> Pause the program for the specified number of 
seconds. <code>time.sleep(5)</code> Nothing, for five seconds. <br>
<br>

<p> Table 8.3: The Python Time Library</p> </li> 
<li>The names and behavior of these functions are taken from the standard C 
library
<ul> 
<li>Less consistent than one might want</li> 
<li>For example, no equivalent of <code>time.mktime</code> for converting to 
UTC</li> </ul></li> 
<li>Always store and manipulate times in UTC 
<ul> 
<li>Especially important in a world in which the telescope could be in Hawaii, 
and the database in Paris.</li> </ul></li> 
<li>Do <em>not</em> try to write calendar calculations yourself 
<ul> 
<li>It's a lot harder than you think</li> 
<li>Use the <code>datetime</code> and <code>calendar</code> modules</li> </ul>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Working with the File System</h2> 
<ul> 
<li>The <code>os</code> module contains a lot of functions for interacting 
with the operating system
<ul> 
<li>The table below is only a fraction of them</li> 
<li> Type Name Purpose Example Result <br>
Constant <code>curdir</code> The 
symbolic name for the current directory. <code>os.curdir</code> <code>.</code> 
on Linux. <br>
<code>pardir</code> The symbolic name for the parent directory. 
<code>os.pardir</code> <code>..</code> on Linux. <br>
<code>sep</code> The 
separator character used in paths. <code>os.sep</code> <code>/</code> on Linux, 
<code>\</code> on Windows. <br>
<code>linesep</code> The end-of-line marker 
used in text files. <code>os.linesep</code> <code>\n</code> on Linux, <code>\r\n
</code> on Windows. <br>
Function <code>listdir</code> List the contents of a 
directory. <code>os.listdir('/tmp')</code> The names of all the files and 
directories in<code>/tmp</code> (except <code>.</code> and <code>..</code>). 
<br> <code>mkdir</code> Create a new directory. <code>os.mkdir('/tmp/scratch')
</code> Make the directory <code>/tmp/scratch</code>. Use <code>os.makedirs
</code> to make several directories at once. <br>
<code>remove</code> Delete a 
file. <code>os.remove('/tmp/workingfile.txt')</code> Delete the file <code>
/tmp/workingfile.txt</code>. <br>
<code>rename</code> Rename (or move) a file 
or directory. <code>os.rename('/tmp/scratch.txt', 
'/home/swc/data/important.txt')</code> Move the file <code>/tmp/scratch.txt
</code> to <code>/home/swc/data/important.txt</code>. <br>
<code>rmdir</code> 
Remove a directory. <code>os.rmdir('/home/swc')</code> Probably not something 
you want to do&hellip; Use<code>os.removedirs</code> to remove several 
directories at once. <br>
<code>stat</code> Get information about a file or 
directory. <code>os.stat('/home/swc/data/important.txt')</code> Find out when 
<code>important.txt</code> was created, how large it is, etc. <br>
<br>

<p> Table 8.4: The Python File System Library</p> </li> 
<li>Note: <code>os.stat</code> returns an object with at least ten members, 
the most important of which are:
<ul> 
<li><code>st_size</code>: size in bytes</li> 
<li><code>st_atime</code>: time of most recent access</li> 
<li><code>st_mtime</code>: time of most recent modification</li> 
<li>These times are in seconds since the epoch</li> 
<li> 
<pre>import time, os info = os.stat('stat_file.py') print 'size:', 
info.st_size print 'access time:', time.ctime(info.st_atime) print 
'modification time:', time.ctime(info.st_mtime)</pre> 
<pre>size: 177 access time: Sat Jul 2 07:16:46 2005 modification time: Mon Jun 
13 09:31:10 2005</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Manipulating Pathnames</h2> 
<ul> 
<li>The <code>os</code> module has a <em>submodule</em> called <code>os.path
</code> 
<ul> 
<li>Manipulate pathnames (filenames and directory names) correctly and 
efficiently
<ul> 
<li>Do <em>not</em> write your own functions for this&mdash;the rules are 
trickier than you think</li> </ul></li> 
<li>Used at least as often as <code>os</code> itself</li> </ul></li> 
<li>Contents: 
<ul> 
<li> Type Name Purpose Example Result <br>
Function <code>abspath</code> 
Create normalized absolute pathnames. <code>
os.path.abspath('../jeevan/bin/script.py')</code> <code>
/home/jeevan/bin/script.py</code> (if executed in <code>/home/gvwilson</code>) 
<br> <code>basename</code> Return the last portion of a path (i.e., the 
filename, or the last directory name). <code>
os.path.basename('/tmp/scratch/junk.data')</code> <code>junk.data</code> <br>

<code>dirname</code> Return all but the last portion of a path. <code>
os.path.basename('/tmp/scratch/junk.data')</code> <code>/tmp/scratch</code> <br>
<code>exists</code> Return <code>True</code> if a pathname refers to an 
existing file or directory. <code>os.path.exists('./scribble.txt')</code> <code>
True</code> if there is a file called <code>scribble.txt</code> in the current 
working directory,<code>False</code> otherwise. <br>
<code>getatime</code> Get 
the last access time of a file or directory (like<code>os.stat</code>). <code>
os.path.getatime('.')</code> <code>1112109573</code> (which means that the 
current directory was last read or written at 10:19:33 EST on March 29, 2005). 
<br> <code>getmtime</code> Get the last modification time of a file or 
directory (like<code>os.stat</code>). <code>os.path.getmtime('.')</code> <code>
1112109502</code> (which means that the current directory was last modified 71 
seconds before the time shown above). <br>
<code>getsize</code> Get the size of 
something in bytes (like<code>os.stat</code>). <code>os.path.getsize('py03.swc')
</code> <code>29662</code>. <br>
<code>isabs</code> <code>True</code> if its 
argument is an absolute pathname. <code>os.path.isabs('tmp/data.txt')</code> 
<code>False</code> <br>
<code>isfile</code> <code>True</code> if its argument 
identifies an existing file. <code>os.path.isfile('tmp/data.txt')</code> <code>
True</code> if a file called <code>./tmp/data.txt</code> exists, and <code>False
</code> otherwise. <br>
<code>isdir</code> <code>True</code> if its argument 
identifies an existing directory.. <code>os.path.isdir('tmp')</code> <code>True
</code> if the current directory has a subdirectory called <code>tmp</code>. 
<br> <code>join</code> Join pathname fragments to create a full pathname. <code>
os.path.join('/tmp', 'scratch', 'data.txt')</code> <code>
&quot;/tmp/scratch/data.txt&quot;</code> <br>
<code>normpath</code> Normalize a 
pathname (i.e., remove redundant slashes, uses of<code>.</code> and <code>..
</code>, etc.). <code>os.path.normpath('tmp/scratch/../other/file.txt')</code> 
<code>&quot;tmp/other/file.txt&quot;</code> <br>
<code>split</code> Return both 
of the values returned by<code>os.path.dirname</code> and <code>os.path.basename
</code>. <code>os.path.split('/tmp/scratch.dat')</code> <code>('/tmp', 
'scratch.dat')</code> <br>
<code>splitext</code> Split a path into two pieces 
<code>root</code> and <code>ext</code>, such that <code>ext</code> is the last 
piece beginning with a<code>&quot;.&quot;</code>. <code>
os.path.splitext('/tmp/scratch.dat')</code> <code>('/tmp/scratch', '.dat')
</code> <br>
<br>

<p> Table 8.5: Python's Pathname Library</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Knowing Where You Are</h2> 
<ul> 
<li>Python assigns the module's name to the special variable <code>__name__
</code> 
<ul> 
<li><code>&quot;__main__&quot;</code> when the file is run from the command 
line</li> 
<li>The module's name when it is loaded by something else</li> </ul></li> 
<li>Often used to draw attention to the main body of a large program</li> 
<li>Or to include self-tests in module 
<ul> 
<li>If the module is loaded by something else, its name isn't <code>
&quot;__main__&quot;</code>, so the tests aren't run</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Where to Learn More</h2> 
<ul> 
<li><code>Daily Python URL</code> and <code>Doctor Dobb's Journal Python-URL
</code> collect Python-related news in one place</li> 
<li><code>Python Cookbook</code> (and the print version, [Martelli 2005] ) are 
recipes ranging in complexity from nearly trivial to fiendishly subtle</li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 8.1:</p> 
<p>Write a function that takes two strings called <code>text</code> and <code>
fragment</code> as arguments, and returns the number of times <code>fragment
</code> appears in the second half of <code>text</code>. Your function must <em>
not</em> create a copy of the second half of <code>text</code>. (Hint: read the 
documentation for<code>string.count</code>.)</p> 
<p>Exercise 8.2:</p> 
<p>What does the Python keyword <code>global</code> do? What are some reasons 
<em>not</em> to write code that uses it?</p> 
<p>Exercise 8.3:</p> 
<p>Consider the following sample of code and its output:</p> 
<pre>def settings(first, **rest): print 'first is', first print 'rest is' for 
(name, value) in rest.items(): print '...', name, value print settings(1) 
settings(1, two=2, three=&quot;THREE&quot;)</pre> 
<pre>first is 1 rest is first is 1 rest is ... two 2 ... three THREE </pre> 
<p>What does the variable <code>rest</code> do? What does the double asterisk 
<code>**</code> in front of its name mean? How does it compare to the example 
with<code>*extra</code> (with a single asterisk) in the lecture?</p> 
<p>Exercise 8.4:</p> 
<p>Python allows you to import all the functions and variables in a module at 
once, making them local name. For example, if the module is called<code>values
</code>, and contains a variable called <code>Threshold</code> and a function 
called<code>limit</code>, then after the statement <code>from values import *
</code>, you can then refer directly to <code>Threshold</code> and <code>limit
</code>, rather than having to use <code>values.Threshold</code> or <code>
values.limit</code>. Explain why this is generally considered a bad thing to 
do, even though it reduces the amount programmers have to type.</p> 
<p>Exercise 8.5:</p> 
<p><code>sys.stdin</code>, <code>sys.stdout</code>, and <code>sys.stderr</code>
 are variables, which means that you can assign to them. For example, if you 
want to change where<code>print</code> sends its output, you can do this:</p> 
<pre>import sys print 'this goes to stdout' temp = sys.stdout sys.stdout = 
open('temporary.txt', 'w') print 'this goes to temporary.txt' sys.stdout = temp
</pre> 
<p>Do you think this is a good programming practice? When and why do you think 
its use might be justified?</p> 
<p>Exercise 8.6:</p> 
<p><code>os.stat(path)</code> returns an object whose members describe various 
properties of the file or directory identified by<code>path</code>. Using this, 
write a function that will determine whether or not a file is more than one 
year old.</p> 
<p>Exercise 8.7:</p> 
<p>Write a Python program that takes as its arguments two years (such as 1997 
and 2007), prints out the number of days between the 15th of each month from 
January of the first year until December of the last year.</p> 
<p>Exercise 8.8:</p> 
<p>Write a simple version of <code>which</code> in Python. Your program should 
check each directory on the caller's path (in order) to find an executable 
program that has the name given to it on the command line.</p> prev top next 
<br> <br>

<h1>Testing Basics</h1> prev  Draft Version 504 next <br>
<br>

<h2>Motivation</h2> 
<ul> 
<li>Testing software is just as important as calibrating experimental 
equipment, or checking the purity of reagants
<ul> 
<li>But it's done far less often</li> 
<li>Reason #1: people don't know how</li> 
<li>Reason #2: low standards can perpetuate themselves until someone decides 
to make quality an issue
<ul> 
<li>American cars in the 1970s</li> </ul></li> </ul></li> 
<li>Study after study has proved that the more time you spend testing, the 
less total time it takes to develop working software
<ul> 
<li>So long as you know how to test systematically&hellip;</li> 
<li>&hellip;and use the right tools to help you&hellip;</li> 
<li>&hellip;and design your software to be testable 
<ul> 
<li>Just like chip designers</li> </ul></li> </ul></li> 
<li>Studies also show that how well a team tests is a good predictor of how 
good they are at meeting schedule and quality targets
<ul> 
<li>Because discipline matters more than genius</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Terminology</h2> 
<ul> 
<li><em>Unit testing</em> (or <em>component testing</em>): testing one 
component in isolation
<ul> 
<li>E.g., test that all of a class's methods do what they're supposed to</li> 
</ul></li> 
<li><em>System testing</em> (or <em>integration testing</em>): testing that 
components work properly in combination
<ul> 
<li>E.g., make sure that when X calls Y, it passes parameters in the right 
order</li> </ul></li> 
<li>These are two ends of a spectrum 
<ul> 
<li>Most classes rely on several others, and so cannot be tested in isolation 
<ul> 
<li>Often pursue a <em>bottom-up testing</em> strategy</li> 
<li>Test the simple classes first, then the ones that use them, then the ones 
that use those</li> </ul></li> 
<li>Often makes sense to test subsystems (made up of several classes), rather 
than the entire program
<ul> 
<li>E.g., test the voice recognition module</li> </ul></li> 
<li>Sometimes have to build <em>scaffolding</em> to support testing 
<ul> 
<li>Like the scaffolding on a building site, it's extra code that is used 
during the construction process, but not delivered to customers</li> </ul></li> 
</ul></li> 
<li><em>Regression testing</em>: rerunning tests periodically to see whether 
the code has<em>regressed</em> 
<ul> 
<li>I.e., whether things that used to work are now broken</li> 
<li>Every time a change is made to the system, the programmer making the 
change should rerun the regression tests<em>before</em> checking her changes 
into version control
<ul> 
<li>Never slow other people down by breaking things that they're relying on
</li> </ul></li> 
<li>A large program that doesn't have regression tests is difficult (sometimes 
impossible) to maintain
<ul> 
<li>The only way to know whether a change to one part will break something 
somewhere else is to run the whole program</li> </ul></li> </ul></li> 
<li>A <em>fixture</em> is a thing to be tested 
<ul> 
<li>E.g., an object, a data structure, a complete database</li> </ul></li> 
<li>A <em>test</em> is something you do to a fixture 
<ul> 
<li>In order for a test to be useful, you must be able to compare its <em>
actual outcome</em> with its <em>expected outcome</em></li> </ul></li> 
<li>A <em>test result</em> can be one of: 
<ul> 
<li><em>Pass</em>: the actual outcome is what was expected</li> 
<li><em>Fail</em>: the actual outcome is different from what was expected</li> 
<li><em>Error</em>: something went wrong with the test itself (i.e., the test 
contains a bug)
<ul> 
<li>Don't know anything about the system being tested</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Example: Rectangle Overlap</h2> 
<ul> 
<li>Want to test a function <code>overlap</code> that calculates the overlap 
between two rectangles
<ul> 
<li>Each rectangle is represented by an instance of the class <code>Rect</code>
<ul> 
<li>Constructor takes four non-negative integer arguments (low and high XY 
coordinates)</li> 
<li>Class has methods <code>getLoX</code>, <code>getLoY</code>, <code>getHiX
</code>, and <code>getHiY</code></li> 
<li>Rectangle is guaranteed to have non-zero area</li> </ul></li> 
<li>Function returns: 
<ul> 
<li>A new rectangle representing the overlap of its inputs if they overlap</li>
<li><code>None</code> if there's no overlap</li> 
<li>Note: since rectangles have to have non-zero area, touching on an edge or 
corner does<em>not</em> count as overlap</li> </ul></li> </ul></li> 
<li>Analysis 
<ul> 
<li>This is unit testing (one thing in isolation) 
<ul> 
<li>Assume for the moment that <code>Rect</code> is correct</li> 
<li>I.e., that it has been tested elsewhere</li> </ul></li> 
<li>Each fixture will be a pair of rectangles 
<ul> 
<li>The test will be to pass them to <code>overlap</code>, and see if the 
output is correct</li> </ul></li> </ul></li> 
<li>First version of <code>overlap</code>: 
<ul> 
<li> 
<pre> def overlap(left, right): '''Calculate overlap between two 
rectangles.''' loX = max(left.getLoX(), right.getLoX()) hiX = 
min(left.getHiX(), right.getHiX()) loY = max(left.getLoY(), right.getLoY()) hiY 
= min(left.getHiY(), right.getHiY()) if (loX &gt;= hiX) or (loY &gt; hiY): 
return None return Rect(loX, loY, loX, hiY)</pre> </li> 
<li>How many errors can you spot?</li> </ul></li> 
<li>First test passes: 
<ul> 
<li> 
<pre> r1 = Rect(0, 0, 1, 1) r2 = Rect(2, 2, 3, 3) result = overlap(r1, r2) if 
result == None: print 'pass' else: print 'fail'</pre> 
<pre>pass </pre> </li> </ul></li> 
<li>But not the second one: 
<ul> 
<li> 
<pre> r1 = Rect(0, 0, 1, 1) r2 = Rect(0, 1, 3, 3) result = overlap(r1, r2) if 
result == None: print 'pass' else: print 'fail'</pre> 
<pre>Traceback (most recent call last): File &quot;overlap.py&quot;, line 97, 
in ? result = overlap(r1, r2) File &quot;overlap.py&quot;, line 64, in overlap 
return Rect(loX, loY, hiX, hiY) File &quot;overlap.py&quot;, line 9, in 
__init__ assert 0 &lt;= loY &lt; hiY, 'illegal Y coordinates' AssertionError: 
illegal Y coordinates</pre> </li> 
<li>This is an error in the test 
<ul> 
<li>A good test will <em>always</em> run, no matter what state the code is in
</li> </ul></li> </ul></li> 
<li>Revise the test and rerun: 
<ul> 
<li> 
<pre> try: r1 = Rect(0, 0, 1, 1) r2 = Rect(0, 1, 3, 3) result = overlap(r1, 
r2) if result == None: print 'pass' else: print 'fail' except Exception, e: 
print 'error', e</pre> 
<pre>pass </pre> </li> 
<li>Why is this change important? 
<ul> 
<li>Need to be able to run all tests, all the time</li> 
<li>If the first test raises an exception that isn't handled, the other 
ninety-nine tests won't run at all</li> </ul></li> </ul></li> 
<li>So, what's the problem? 
<ul> 
<li>Passing <code>loX</code> to <code>Rect</code>'s constructor twice, rather 
than<code>loX</code> and <code>hiX</code></li> 
<li>Fix and rerun tests 
<ul> 
<li>Still fails</li> </ul></li> 
<li>Testing <code>loY &gt; hiY</code> instead of <code>loY &gt;= hiY</code>
</li> 
<li>Fix and rerun tests 
<ul> 
<li>They pass!</li> </ul></li> </ul></li> 
<li>We ought to test that <code>overlap</code> works when rectangles <em>do
</em> overlap 
<ul> 
<li> 
<pre> try: r1 = Rect(0, 0, 3, 3) r2 = Rect(1, 1, 2, 2) result = overlap(r1, 
r2) if result == Rect(1, 1, 2, 2): print 'pass' else: print 'fail' except 
Exception, e: print 'error', e</pre> 
<pre>error name 'overlap' is not defined </pre> </li> 
<li>This is only one case out of many 
<ul> 
<li> 
<p> Figure 9.1: Possible Overlap Tests</p> <br>
<br>
</li> </ul></li> 
<li>How many tests should we write? When should we stop?</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>General Rules for Unit Tests</h2> 
<ul> 
<li>Make tests independent of each other 
<ul> 
<li>No interaction between tests 
<ul> 
<li>Nothing one test does can affect any other test</li> 
<li>In particular, the order in which tests are run shouldn't matter</li> </ul>
</li> 
<li>If two tests depend on one another, then when the first fails, the second 
either:
<ul> 
<li>Isn't run (so you have less information), or</li> 
<li>Runs, but gives you the wrong answer (which is even worse than no 
information)</li> </ul></li> </ul></li> 
<li>Keep tests small 
<ul> 
<li>Each tests exactly one thing</li> 
<li>When a test fails, you'll know the cause right away</li> </ul></li> 
<li>Don't hard-code absolute path names, magic numbers, etc. 
<ul> 
<li>Want to be able to move tests from machine to machine</li> 
<li>Have to b able to maintain tests as code evolves 
<ul> 
<li>Test code should be at least as well written as production code</li> </ul>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Simple Testing Framework</h2> 
<ul> 
<li>Step back a moment and think about how we're writing our tests 
<ul> 
<li>Each has two rectangles as input, and expects either a rectangle or <code>
None</code></li> 
<li>Each reports passes, fails, or errors</li> </ul></li> 
<li>Design principle: every time you see a pattern, try to capture it in code 
<ul> 
<li>Write the shared code once</li> 
<li>Encourage people to do things the right way by making that way easiest</li>
</ul></li> 
<li>Step 1: write a function that runs a test and reports its result 
<ul> 
<li> 
<pre>def runTest(left, right, expected): try: assert left is not None assert 
right is not None actual = overlap(left, right) if actual == expected: return 
'pass' else: return 'fail' except Exception, e: return 'error'</pre> </li> 
<li>Just as easy to return strings as to define constants for pass, fail, and 
error</li> 
<li>Note: assertions on input arguments are inside the <code>try</code>/<code>
except</code> 
<ul> 
<li>Passing <code>None</code> as the left or right rectangle is an error in 
the test</li> </ul></li> </ul></li> 
<li>Step 2: write some tests 
<ul> 
<li>Whenever possible, create a table of inputs and results 
<ul> 
<li>Easier for people to read, understand, and add to than code</li> 
<li>Especially if those people aren't programmers</li> </ul></li> 
<li> 
<pre>def runTest(left, right, expected): try: assert left is not None assert 
right is not None actual = overlap(left, right) if actual == expected: return 
'pass' else: return 'fail' except Exception, e: return 'error'</pre> </li> </ul>
</li> 
<li>We can make this even more flexible by writing a function that tests an 
arbitrary function
<ul> 
<li>Remember that <code>def f(*args)</code> creates a function that takes any 
number of arguments</li> 
<li>If you have a tuple of values called <code>vals</code>, then <code>f(*vals)
</code> matches the values with <code>f</code>'s arguments 
<ul> 
<li>E.g., if <code>vals</code> is <code>(11, 12, 13)</code>, then <code>
f(*vals)</code> is the same as <code>f(11, 12, 13)</code></li> 
<li>Gives you a way to call an arbitrary function with an arbitrary set of 
arguments in a uniform way</li> </ul></li> 
<li>Use this to write a function <code>runAllTests</code> that takes two 
arguments:
<ul> 
<li>The function you actually want to test</li> 
<li>A list of lists, each of which consists of zero or more arguments, and the 
expected result</li> </ul></li> 
<li> 
<pre>def runAllTests(func, tests): pass = fail = error = 0 for testCase in 
tests: try: args, expected = testCase[:-1], testCase[-1] actual = func(*args) 
if actual == expected: pass += 1 else: fail += 1 except Exception, e: error += 
1 for (label, count) in (('pass', pass), ('fail', fail), ('error', error)): 
print '%s: %4d' % (label, count) runAllTests(overlap, tests)</pre> </li> 
<li>Advantage: reusability 
<ul> 
<li>Can use this to test <em>any</em> function</li> </ul></li> 
<li>Disadvantage: obscurity 
<ul> 
<li>The extra level of abstraction makes it harder to understand what's going 
on</li> 
<li>But you only have to understand one hard thing once, instead of many 
slightly less hard things over and over</li> </ul></li> </ul></li> 
<li>Take a look in the next lecture at a full-fledged unit testing framework
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Choosing Test Cases</h2> 
<ul> 
<li>You can't test everything 
<ul> 
<li>There are roughly 10 million 7-digit phone numbers</li> 
<li>A function that puts two phone numbers in order has <em>1014</em> possible 
inputs</li> 
<li>At a million tests a second, it will take <em>108</em> seconds (or roughly 
three years) to check them all
<ul> 
<li>And then we move on to the second function&hellip;</li> </ul></li> 
<li>Faster computers won't get us out of this hole 
<ul> 
<li>How many possible inputs are there to a function that sorts a list of 
strings?</li> </ul></li> </ul></li> 
<li>Human beings are creatures of habit 
<ul> 
<li>Tend to make the same kinds of errors over and over again</li> 
<li>So test for those first</li> 
<li>Has an interesting side effect: once you start testing for habitual 
errors, programmers become more conscious of them, and make them less often</li>
</ul></li> 
<li>The first tests you should write: 
<ul> 
<li>Tests you expect to succeed 
<ul> 
<li>Boundary cases (e.g., sort the empty list, or a list of one value)</li> 
<li>Simplest interesting case (e.g., sort a list of two values)</li> 
<li>General case (e.g., sort a list of nine values)</li> 
<li>If duplicate values are allowed, make sure you test with them</li> </ul>
</li> 
<li>Tests you expect to fail 
<ul> 
<li>Invalid input (e.g., passed a dictionary instead of a list)</li> 
<li>Remember, error handling is part of the interface too</li> </ul></li> 
<li>Sanity tests 
<ul> 
<li>Make sure data structures remain consistent</li> 
<li>If there is redundant information, check it against itself</li> </ul></li> 
</ul></li> 
<li>A catalog of errors 
<ul> 
<li>Numbers: zero, largest, smallest magnitude, most negative</li> 
<li>Structures: empty, exactly one element, maximum number of elements 
<ul> 
<li>Duplicate elements (e.g., the letter <code>&quot;J&quot;</code> appears 
three times in a string)</li> 
<li>Aliased elements (e.g., a list contains two references to another list)
</li> 
<li>Circular structures (e.g., a list that contains a reference to itself)</li>
</ul></li> 
<li>Searching: no match found, one match found, multiple matches found, 
everything matches
<ul> 
<li>Code like <code>x = findAll(structure)[0]</code> is almost always wrong
</li> 
<li>Should also check aliased matches (same thing found multiple times)</li> 
</ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Dictionaries and Error Handling</h1> prev  Draft Version 590 next <br>
<br>
<h2>Motivation</h2> 
<ul> 
<li>Problem: you want to count how often different people send messages to a 
mailing list
<ul> 
<li>Input: a file with one email address per line 
<ul> 
<li>Each address may appear many times</li> </ul></li> 
<li>Output: a table of addresses, sorted by frequency of appearance</li> </ul>
</li> 
<li>Solution: keep track of counts in a list of pairs 
<ul> 
<li>Each entry in the list is <code>[address, countSoFar]</code></li> 
<li>Each time an address is read in, search the list, and either: 
<ul> 
<li>Increment the count of an existing entry, or</li> 
<li>Create a new entry with a count of 1</li> </ul></li> 
<li>Once everything has been read, sort the entries 
<ul> 
<li>Note: you can pass your own comparison function to <code>list.sort</code>
</li> </ul></li> 
<li> 
<pre>import sys def countFind(counts, address): for x in counts: if x[0] == 
address: return x return None def countFreq(lines): counts = [] for line in 
lines: line = line.strip() existing = countFind(counts, line) if existing: 
existing[1] += 1 else: counts.append([line, 1]) return counts def 
compareByFrequency(a, b): if a[1] &lt; b[1]: return 1 if a[1] == b[1]: return 0 
return -1 if __name__ == '__main__': instream = open(sys.argv[1], 'r') lines = 
instream.readlines() instream.close() result = countFreq(lines) 
result.sort(compareByFrequency) for address, frequency in result: print 
frequency, &quot;:&quot;, address</pre> </li> </ul></li> 
<li>This is clumsy and inefficient 
<ul> 
<li>Clumsy: writing a lot of code to do something that ought to be simple</li> 
<li>Inefficient: repeatedly searching the entire list</li> </ul></li> 
<li>There's an easier way&hellip;</li> 
<li>Comment on this slide</li> </ul> 
<h2>String Formatting</h2> 
<ul> 
<li>But before we start, let's tidy up a few loose ends</li> 
<li>Python's <code>%</code> operator is used to format strings 
<ul> 
<li>Left side is a string specifying how things are to be formatted</li> 
<li>Right side is the values to be formatted 
<ul> 
<li>One value on its own&hellip;</li> 
<li>&hellip;or a tuple if there are many values</li> </ul></li> </ul></li> 
<li><code>'here %s go' % 'we'</code> creates a new string <code>&quot;here we 
go&quot;</code> 
<ul> 
<li>The <code>&quot;%s&quot;</code> in the left string means &ldquo;insert a 
string here&rdquo;</li> 
<li>So the string on the right is inserted</li> 
<li>Since strings are immutable, this creates a new string (does <em>not</em> 
modify the format string in place)</li> </ul></li> 
<li><code>'left %d right %d' % (-1, 1)</code> creates <code>&quot;left -1 
right 1&quot;</code> 
<ul> 
<li><code>&quot;%d&quot;</code> stands for &ldquo;decimal integer&rdquo;</li> 
<li>Format specifiers are matched with values left to right</li> 
<li><code>'do %s %d times' % ('this', 99)</code> creates <code>&quot;do this 
99 times&quot;</code></li> </ul></li> 
<li><code>'[%4d]' % 13</code> creates <code>&quot;[&nbsp;&nbsp;13]&quot;</code>
<ul> 
<li>The integer between the <code>&quot;%&quot;</code> and <code>&quot;d&quot;
</code> specifies a width</li> 
<li><code>'[%-4d]' % 13</code> creates <code>&quot;[13&nbsp;&nbsp;]&quot;
</code>, because negative widths mean &ldquo;left justify&rdquo;</li> </ul></li>
<li><code>'[%6.2f %%]' % 37.2</code> creates <code>&quot;[&nbsp;37.20 %]&quot;
</code> 
<ul> 
<li><code>&quot;%6.2f&quot;</code> means &ldquo;a floating point number, six 
characters wide, with two after the decimal point&rdquo;</li> 
<li><code>&quot;%%&quot;</code> is translated into a single <code>&quot;%&quot;
</code> character 
<ul> 
<li>Just as <code>&quot;\\&quot;</code> is how you represent a single <code>
&quot;\&quot;</code> in a string</li> </ul></li> </ul></li> 
<li><code>'[%6.2e %%]' % 37.2</code> creates <code>&quot;[3.72e+001 %]&quot;
</code> 
<ul> 
<li><code>&quot;%e&quot;</code> is scientific (exponential) notation</li> 
<li>Python will use more characters than it's been told to if it has to</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Dictionaries</h2> 
<ul> 
<li>A sequence (such as a string or list) associates one value with each 
integer from 0 to N-1</li> 
<li>A <em>dictionary</em> associates one value with each of its <em>keys</em> 
<ul> 
<li>Also called maps, hashes, and associative arrays</li> 
<li>Keys don't have to be integers 
<ul> 
<li>In fact, they are usually strings</li> </ul></li> </ul></li> 
<li>Often visualized as a two-column table 
<ul> 
<li>Each key in the left column must be unique</li> 
<li>Values can occur several times</li> 
<li>Example planet names as keys, and the lengths of their years as values 
<ul> 
<li> Mercury 87.97 <br>
Venus 224.70 <br>
&#8942; &#8942; <br>
Pluto 90550.0 
<br> <br>
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Mechanics</h2> 
<ul> 
<li>Create a dictionary by putting key/value pairs inside <code>{}</code> 
<ul> 
<li><code>{'Newton':1642, 'Darwin':1809}</code></li> 
<li>Empty dictionary written <code>{}</code></li> 
<li>Get a value from an existing dictionary using <code>[]</code> (just like 
everything else in Python)</li> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809 } print &quot;Darwin's 
birthday:&quot;, birthday['Darwin'] print &quot;Newton's birthday:&quot;, 
birthday['Newton']</pre> 
<pre>Darwin's birthday: 1809 Newton's birthday: 1642 </pre> </li> </ul></li> 
<li>Assigning to a dictionary key: 
<ul> 
<li>Creates a new entry if the key is not already in dictionary</li> 
<li>Overwrites the previous value if the key is already present</li> 
<li> 
<pre>birthday = {} birthday['Darwin'] = 1809 birthday['Newton'] = 1942 # oops 
birthday['Newton'] = 1642 print birthday</pre> 
<pre>{'Darwin': 1809, 'Newton': 1642} </pre> </li> </ul></li> 
<li>Can only access keys that are present 
<ul> 
<li>Just as you can't index elements of a list that aren't there</li> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809 } print birthday['Turing'] 
</pre> 
<pre>Traceback (most recent call last): File &quot;key_error.py&quot;, line 5, 
in ? print birthday['Turing'] KeyError: 'Turing'</pre> </li> </ul></li> 
<li>Remove an entry using <code>del d[k]</code> 
<ul> 
<li>Can only remove entries that are actually present</li> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809, 'Turing' : 1912 } print 
'Before deleting Turing:', birthday del birthday['Turing'] print 'After 
deleting Turing:', birthday</pre> 
<pre>Before deleting Turing: {'Turing': 1912, 'Newton': 1642, 'Darwin': 1809} 
After deleting Turing: {'Newton': 1642, 'Darwin': 1809}</pre> </li> </ul></li> 
<li><code>for k in d</code> loops over the dictionary's keys (rather than its 
values)
<ul> 
<li>Note: this is different from lists, where <code>for</code> loops over the 
values, rather than the &ldquo;keys&rdquo; (indices)</li> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809, 'Turing' : 1912 } for name 
in birthday: print name, birthday[name]</pre> 
<pre>Turing 1912 Newton 1642 Darwin 1809 </pre> </li> </ul></li> 
<li>Test whether a key <code>k</code> is in a dictionary <code>d</code> using 
<code>k in d</code> 
<ul> 
<li>Once again, inconsistent with behavior of lists, but useful</li> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809 } for name in ['Newton', 
'Turing']: if name in birthday: print name, birthday[name] else: print 'Who 
is', name, '?'</pre> 
<pre>Newton 1642 Who is Turing ? </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Dictionary Methods</h2> 
<ul> 
<li>Yes, dictionaries are objects too&hellip; 
<ul> 
<li> Method Purpose Example Result <br>
<code>clear</code> Empty the 
dictionary. <code>d.clear()</code> Returns <code>None</code>, but <code>d</code>
 is now empty. <br>
<code>get</code> Return the value associated with a key, or 
a default value if the key is not present. <code>d.get('x', 99)</code> Returns 
<code>d['x']</code> if <code>&quot;x&quot;</code> is in <code>d</code>, or 99 
if it is not. <br>
<code>keys</code> Return the dictionary's keys as a list. 
Entries are guaranteed to be unique. <code>birthday.keys()</code> <code>
['Turing', 'Newton', 'Darwin']</code> <br>
<code>items</code> Return a list of 
(key, value) pairs. <code>birthday.items()</code> <code>[('Turing', 1912), 
('Newton', 1642), ('Darwin', 1809)]</code> <br>
<code>values</code> Return the 
dictionary's values as a list. Entries may or may not be unique. <code>
birthday.values()</code> <code>[1912, 1642, 1809]</code> <br>
<code>update
</code> Copy keys and values from one dictionary into another. See the example 
below. <br>
<br>

<p> Table 10.1: Dictionary Methods</p> </li> </ul></li> 
<li>Example: 
<ul> 
<li> 
<pre>birthday = { 'Newton' : 1642, 'Darwin' : 1809, 'Turing' : 1912 } print 
'keys:', birthday.keys() print 'values:', birthday.values() print 'items:', 
birthday.items() print 'get:', birthday.get('Curie', 1867) temp = { 'Curie' : 
1867, 'Hopper' : 1906, 'Franklin' : 1920 } birthday.update(temp) print 'after 
update:', birthday birthday.clear() print 'after clear:', birthday</pre> 
<pre>keys: ['Turing', 'Newton', 'Darwin'] values: [1912, 1642, 1809] items: 
[('Turing', 1912), ('Newton', 1642), ('Darwin', 1809)] get: 1867 after update: 
{'Curie': 1867, 'Darwin': 1809, 'Franklin': 1920, 'Turing': 1912, 'Newton': 
1642, 'Hopper': 1906} after clear: {}</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Counting Frequency</h2> 
<ul> 
<li>Revisit the problem of counting how often things appear in a file 
<ul> 
<li>Use the things (email addresses) as keys in a dictionary</li> 
<li>The value associated with each key is the number of times it has been seen 
so far</li> 
<li> 
<pre># Data to count. names = ['Be','Mg','Mg','Ca','Be','Mg', 'Be'] # Build a 
dictionary of frequencies. freq = {} for name in names: # Already seen, so 
increment count by one. if name in freq: freq[name] = freq[name] + 1 # Never 
seen before, so add to dictionary. else: freq[name] = 1 # Display. print freq
</pre> 
<pre>{'Be': 3, 'Mg': 3, 'Ca': 1} </pre> </li> 
<li> 
<p> Figure 10.1: Counting Frequency</p> <br>
<br>
</li> </ul></li> 
<li>Note: dictionaries do <em>not</em> store keys in order 
<ul> 
<li>No way to predict where a dictionary will insert a new value</li> 
<li>Paradoxically, this is part of what makes dictionaries so fast</li> </ul>
</li> 
<li>So, to print frequency in alphabetic order by address: 
<ul> 
<li>Get the list of keys</li> 
<li>Sort that list</li> 
<li>Loop over it</li> 
<li> 
<pre># Build the frequency dictionary as before. names = 
['Be','Mg','Mg','Ca','Be','Mg', 'Be'] freq = {} for name in names: if name in 
freq: freq[name] = freq[name] + 1 else: freq[name] = 1 # Print in alphabetical 
order by key. keys = freq.keys() keys.sort() for k in keys: print k, freq[k]
</pre> 
<pre>Be 3 Ca 1 Mg 3 </pre> </li> </ul></li> 
<li>Can simplify this code using <code>dict.get</code> 
<ul> 
<li>Get either the count associated with the key, or 0, then add one to it</li>
<li> 
<pre># Use 'get' to simplify the counting loop. names = 
['Be','Mg','Mg','Ca','Be','Mg', 'Be'] freq = {} for name in names: freq[name] = 
freq.get(name, 0) + 1 # Print. keys = freq.keys() keys.sort() for k in keys: 
print k, freq[k]</pre> 
<pre>Be 3 Ca 1 Mg 3 </pre> </li> </ul></li> 
<li>But how to print in order of frequency? 
<ul> 
<li>Need to <em>invert</em> the dictionary (i.e., swap keys and values)</li> 
<li>Problem: there might be <em>collisions</em>, since values aren't 
guaranteed to be unique
<ul> 
<li>What is the inverse of <code>{'a':1, 'b':1, 'c':1}</code>?</li> </ul></li> 
<li>Solution: store a list of values instead of just a single value</li> 
<li> 
<pre># Count values as before. names = ['Be','Mg','Mg','Ca','Be','Mg', 'Be'] 
freq = {} for name in names: freq[name] = freq.get(name, 0) + 1 # Invert. 
inverse = {} for (key, value) in freq.items(): seen = inverse.get(value, []) 
seen.append(key) inverse[value] = seen # Print. keys = inverse.keys() 
keys.sort() for k in keys: print k, inverse[k]</pre> 
<pre>1 ['Ca'] 3 ['Be', 'Mg'] </pre> </li> 
<li> 
<p> Figure 10.2: Tracing Execution of Dictionary Inversion</p> <br>
<br>
</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Formatting Strings with Dictionaries</h2> 
<ul> 
<li>Complex string formatting can be hard to understand 
<ul> 
<li>Especially if one value needs to be used several times</li> 
<li>E.g., producing an email form letter, and need to put the person's name in 
three places</li> </ul></li> 
<li>Instead of a tuple, <code>&quot;%&quot;</code> can take a dictionary as 
its right argument
<ul> 
<li>Use <code>&quot;%(varname)s&quot;</code> or <code>&quot;%(varname)4d&quot;
</code> inside format string to identify what's to be substituted</li> 
<li><code>'%(word)s, t%(word)s, and everyw%(word)s' % {'word' : 'here'}</code> 
creates<code>&quot;here, there, and everywhere&quot;</code></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Catching Errors</h2> 
<ul> 
<li>Like other modern languages, Python uses <em>exceptions</em> to handle 
errors
<ul> 
<li>Separating normal (expected) operation from exceptional cases makes code 
easier to read</li> </ul></li> 
<li>Structured like <code>if</code>/<code>else</code> 
<ul> 
<li>Introduce a block of statements with <code>try</code></li> 
<li>Then introduce error handling code with <code>except</code></li> 
<li>When something goes wrong in the <code>try</code> block, Python <em>raises
</em> an exception</li> 
<li>Python finds the matching <code>except</code> block, and executes whatever 
instructions it contains</li> 
<li> 
<pre>print 'before try/except' try: print '..first line of try block' print 
1/0 print '..last line of try block' except: print '..handling error!' print 
'after try/except'</pre> 
<pre>before try/except ..first line of try block ..handling error! after 
try/except</pre> </li> 
<li> 
<p> Figure 10.3: Flow of Control in Try/Except</p> <br>
<br>
</li> </ul></li> 
<li>You can include code to execute when there <em>isn't</em> an error using 
<code>else</code> 
<ul> 
<li> 
<pre>for val in (0.0, 1.0): print &quot;val is&quot;, val try: x = 1.0/val 
except: print '..handling error!' else: print '...in the else block'</pre> 
<pre>val is 0.0 ..handling error! val is 1.0 ...in the else block </pre> </li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exception Objects</h2> 
<ul> 
<li>When an error occurs, Python actually creates an object to store 
information about it
<ul> 
<li>Typically an error message</li> </ul></li> 
<li>Can choose to handle specific errors by specifying an exception type in the
<code>except</code> statement 
<ul> 
<li>E.g., handle division by zero, but not out-of-bounds list index</li> 
<li>Syntax is <code>except ExceptionType, variable</code> 
<ul> 
<li><code>ExceptionType</code> is what you want to catch</li> 
<li>If something of that type is raised, the exception object is assigned to 
<code>variable</code></li> </ul></li> 
<li> 
<pre>values = [-1.0, 0.0, 1.0] for i in range(4): # note: top index will be 
out of bounds try: x = 1.0 / values[i] except ZeroDivisionError, e: print 
'divide by zero:', e</pre> 
<pre>divide by zero: float division </pre> 
<pre>Traceback (most recent call last): File &quot;except_with_type.py&quot;, 
line 4, in ? x = 1.0 / values[i] IndexError: list index out of range</pre> </li>
</ul></li> 
<li>You can associate any number of <code>except</code> blocks with a single 
<code>try</code> 
<ul> 
<li>They're tested in order&mdash;whichever matches first, wins</li> 
<li>If a &ldquo;naked&rdquo; <code>except</code> appears, it must be the last 
one (since it catches everything)
<ul> 
<li>Better to use <code>except Exception, e</code> so that you have the 
exception object</li> </ul></li> </ul></li> 
<li>Exceptions are organized in a hierarchy 
<ul> 
<li>E.g., <code>ZeroDivisionError</code>, <code>OverflowError</code>, and 
<code>FloatingPointError</code> are all specialized versions of <code>
ArithmeticError</code></li> 
<li>And <code>IndexError</code> (list/string index out of bounds) and <code>
KeyError</code> (non-existent dictionary key) are specializations of <code>
LookupError</code></li> 
<li> 
<pre>for i in range(2): try: if i == 0: vals = ['a', 'b'] x = vals[99] else: 
vals = {20 : 'a', 30 : 'b'} x = vals[40] except KeyError, e: print 'loop %d, 
handling key errors:' % i, e except LookupError, e: print 'loop %d, handling 
generic lookup errors:' % i, e</pre> 
<pre>loop 0, handling generic lookup errors: list index out of range loop 1, 
handling key errors: 40</pre> </li> 
<li>We'll see in a later lecture how this hierarchy is implemented 
<ul> 
<li>Hint: it has something to do with objects&hellip;</li> </ul></li> </ul>
</li> 
<li>Common exception types 
<ul> 
<li> Name Purpose <br>
<code>Exception</code> Root of exception hierarchy. <br>
<code>ArithmeticError</code> Illegal arithmetic operation <br>
<code>IndexError
</code> Bad index to sequence (out of bounds or illegal type) <br>
<code>
KeyError</code> Nonexistent index to dictionary <br>
<code>TypeError</code> 
Illegal type (e.g., trying to add integer and string) <br>
<code>ValueError
</code> Illegal value (e.g., <code>math.sqrt(-1)</code>) <br>
<code>IOError
</code> Unable to create or open file, read data, etc. <br>
<br>

<p> Table 10.2: Common Exception Types</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Functions and Exceptions</h2> 
<ul> 
<li>So if a function raises an exception, who gets to handle it? 
<ul> 
<li>Each time Python enters a <code>try</code>/<code>except</code> block, it 
pushes the<code>except</code> handlers on a stack 
<ul> 
<li>Just like the function call stack</li> </ul></li> 
<li>When an exception is raised, Python look in this stack, and jumps to the 
first matching handler</li> 
<li> 
<pre>def invert(vals, index): try: vals[index] = 1/vals[index] except 
ArithmeticError, e: print 'inner exception handler:', e def each(func, vals, 
indices): try: for i in indices: func(vals, i) except IndexError, e: print 
'outer exception handler:', e # Note: top index will be out of bounds allValues 
= [-1, 0, 1] allIndices = [0, 1, 2, 3] each(invert, allValues, allIndices)</pre>
<pre>calling func for index 0 calling func for index 1 inner exception 
handler: integer division or modulo by zero calling func for index 2 calling 
func for index 3 outer exception handler: list index out of range</pre> </li> 
<li> 
<p> Figure 10.4: Stacking Exception Handlers</p> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Raising Exceptions</h2> 
<ul> 
<li>Use <code>raise</code> to trigger exception processing 
<ul> 
<li>Obviously, have to specify the type of exception you're raising</li> 
<li>E.g., <code>raise Exception('this is an error message')</code> 
<ul> 
<li>Please make your error messages more informative&hellip;</li> </ul></li> 
<li> 
<pre>for i in range(4): try: # Raise exception if value is odd. if (i % 2) == 
1: raise ValueError('index is odd') else: print 'not raising exception for %d' 
% i except ValueError, e: print 'caught exception for %d' % i, e</pre> 
<pre>not raising exception for 0 caught exception for 1 index is odd not 
raising exception for 2 caught exception for 3 index is odd</pre> </li> </ul>
</li> 
<li>Raise exceptions to report errors in functions 
<ul> 
<li>Rather than returning <code>None</code> or -1 or something like that</li> 
<li><code>list.find</code> (which returns -1 if something can't be found) is 
unusual in this respect
<ul> 
<li>But it's more convenient than <code>list.index</code>, which throws an 
exception</li> </ul></li> </ul></li> 
<li>General rule: throw low, catch high 
<ul> 
<li>I.e., throw lots of very specific exceptions, but only catch them in a few 
places, high in your code, where you can take corrective action</li> 
<li>Reason #1: every application handles errors differently 
<ul> 
<li>If someone is using your library in a GUI, you don't want to be printing to
<code>stderr</code></li> </ul></li> 
<li>Reason #2: error handling code gets in the way of understanding the 
algorithm, so disentangle the two</li> 
<li> 
<pre>import sys # Look for the first matching line in a file. def 
findFirstMatchingLine(filename, word): infile = open(filename, 'r') lines = 
infile.readlines() infile.close() for line in lines: if line.find(word) &gt;= 
0: return line.rstrip() errMsg = '%s does not contain %s' % (filename, word) 
raise ValueError(errMsg) if __name__ == '__main__': try: word = sys.argv[1] for 
filename in sys.argv[2:]: line = findFirstMatchingLine(filename, word) print 
'%s / %s =&gt; %s' % (filename, word, line) except ValueError, e: print 
&gt;&gt; sys.stderr, e except IOError, e: print &gt;&gt; sys.stderr, e except 
Exception, e: print &gt;&gt; sys.stderr, e</pre> 
<pre>import sys # Look for the first matching line in a file. def 
findFirstMatchingLine(filename, word): infile = open(filename, 'r') lines = 
infile.readlines() infile.close() for line in lines: if line.find(word) &gt;= 
0: return line.rstrip() errMsg = '%s does not contain %s' % (filename, word) 
raise ValueError(errMsg) if __name__ == '__main__': try: word = sys.argv[1] for 
filename in sys.argv[2:]: line = findFirstMatchingLine(filename, word) print 
'%s / %s =&gt; %s' % (filename, word, line) except ValueError, e: print 
&gt;&gt; sys.stderr, e except IOError, e: print &gt;&gt; sys.stderr, e except 
Exception, e: print &gt;&gt; sys.stderr, e</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Assertions</h2> 
<ul> 
<li>An <em>assertion</em> is a claim about the state of a program that must be 
true if the program is correct
<ul> 
<li>E.g., &ldquo;this list is not empty&rdquo;, or &ldquo;this value is 
greater than that one&rdquo;</li> </ul></li> 
<li>Three kinds of assertions: 
<ul> 
<li>A <em>pre-condition</em> is something that must be true in order for 
something else to work
<ul> 
<li>E.g., &ldquo;argument is non-negative&rdquo; is a pre-condition for <code>
math.sqrt</code></li> </ul></li> 
<li>A <em>post-condition</em> is something that is guaranteed to be true after 
something else happens
<ul> 
<li>E.g., &ldquo;result is either -1 or a legal index to the string&rdquo; is 
a post-condition of<code>string.find</code></li> </ul></li> 
<li>Anything else is simply called a <em>state assertion</em> 
<ul> 
<li>E.g., &ldquo;this loop always executes at least once&rdquo;</li> </ul></li>
</ul></li> 
<li>Embed assertions in programs using the <code>assert</code> statement 
<ul> 
<li>First argument is a Boolean condition</li> 
<li>Second (optional) is an error message</li> 
<li>If the condition isn't satisfied, Python raises an <code>AssertionError
</code> exception</li> 
<li> 
<pre>def findRange(values): assert (values != None) and (len(values) &gt; 0), 
'Illegal input' left = min(values) right = max(values) assert left &lt; right, 
'Empty range' return (left, right)</pre> </li> </ul></li> 
<li>Good programmers practice <em>defensive programming</em> by putting lots 
of assertions in their code
<ul> 
<li>&ldquo;Executable documentation&rdquo; 
<ul> 
<li>Describes how the program is supposed to behave, in a way that the 
computer can check</li> 
<li>Can't ever be out of step with the actual code, since it <em>is</em> code
</li> </ul></li> 
<li>Fail early, fail often 
<ul> 
<li>The less time that elapses between when an error occurs, and when its 
effects show up, the easier it is to fix</li> </ul></li> 
<li>Bugs grow up to be assertions 
<ul> 
<li>If you made an error once, there's a good chance you'll make it again</li> 
<li>Adding an assertion helps you find and fix it faster the second time</li> 
</ul></li> </ul></li> 
<li>Assertions should only be used to check the program's correctness, not the 
correctness of its inputs
<ul> 
<li>I.e., don't use <code>assert</code> to check that your program managed to 
open a file</li> 
<li>It isn't the program's fault if it doesn't have read permission&hellip;
</li> </ul></li> 
<li>Complex assertions are more likely to contain bugs than to catch them 
<ul> 
<li>If it won't fit comfortably on one line, it probably shouldn't be an 
assertion</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Running Other Programs</h2> 
<ul> 
<li>One program can run another by <em>spawning</em> a new process 
<ul> 
<li>Make and the shell both do this</li> 
<li>So can your programs</li> </ul></li> 
<li><code>os.popen</code> runs a command, and lets you <em>either</em>: 
<ul> 
<li>Write to its standard input, or</li> 
<li>Read from its standard output</li> 
<li> 
<p> Figure 10.5: Running Another Program</p> <br>
<br>
</li> </ul></li> 
<li>Example: read the output of the <code>ls</code> command into your program 
<ul> 
<li> 
<pre>import os instream = os.popen('ls', 'r') lines = instream.readlines() 
instream.close() for line in lines[:4]: line = line.rstrip() print '%4d: %s' % 
(len(line), line)</pre> 
<pre> 13: addresses.txt 13: assertions.py 14: create_dict.py 18: 
create_dict.py.out</pre> </li> </ul></li> 
<li>Example: send the output of your program to <code>gzip</code> for 
compression:
<ul> 
<li> 
<pre>import os # Create compressed output and report its size. outstream = 
os.popen('gzip -c &gt; temp.txt.gz', 'w') for i in range(1000): for word in 
'this is a test'.split(): print &gt;&gt; outstream, word outstream.close() 
print 'output is %d bytes' % os.stat('temp.txt.gz').st_size # See how big it 
would have been. instream = os.popen('gunzip -c temp.txt.gz', 'r') total = 0 
for line in instream.readlines(): total += len(line) instream.close() print 
'output would have been %d bytes' % total</pre> 
<pre>output is 79 bytes output would have been 15000 bytes </pre> </li> </ul>
</li> 
<li>You can use <code>os.popen2</code> to connect to the other program's input 
and output simultaneously
<ul> 
<li> 
<pre>import os childIn, childOut = os.popen2('sort') for word in 'this is a 
test'.split(): print &gt;&gt; childIn, word childIn.close() for line in 
childOut.readlines(): print line.rstrip() childOut.close()</pre> 
<pre>a is test this </pre> </li> </ul></li> 
<li>But you must be very careful about <em>deadlock</em> 
<ul> 
<li>If the child is trying to write to the parent while the parent is trying 
to write to the child, both are blocked
<ul> 
<li>The operating system can only hold on to a limited amount of input or 
output data at a time, so increasing the buffer size only delays the problem
</li> 
<li> 
<p> Figure 10.6: Deadlock</p> <br>
<br>
</li> </ul></li> 
<li>Things are even trickier if you use <code>os.popen3</code>, which gives 
you the child process's<code>stdin</code>, <code>stdout</code>, and <code>stderr
</code> 
<ul> 
<li>If the parent is trying to read from the child's <code>stdout</code> while 
it's trying to write an error message to<code>stderr</code>, both programs will 
be blocked</li> </ul></li> </ul></li> 
<li>Solutions are outside the scope of this course 
<ul> 
<li>Use <code>os.popen</code> (with temporary files if necessary) until you're 
comfortable enough to move on</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 10.1:</p> 
<p>Suppose you wanted to sort entries with the same frequency alphabetically. 
What changes would you have to make to<code>compareByFrequency</code>?</p> prev 
top next <br>
<br>

<h1>Debugging</h1> prev  Draft Version 588 next <br>
<br>

<h2>What It Is</h2> 
<ul> 
<li>Finding and fixing flaws in software 
<ul> 
<li>Assume for now that you built the right thing the wrong way</li> 
<li>Requirements errors are actually a major cause of software project failure
</li> </ul></li> 
<li>You're going to spend half your professional life debugging 
<ul> 
<li>After all, once it's fixed, you move on to something else</li> 
<li>So learn how to do it well</li> </ul></li> 
<li>Talk about tools first (because they'll make everything else less painful)
</li> 
<li>Then some simple rules 
<ul> 
<li>Most taken from [Agans 2002] </li> </ul></li> 
<li>Remember: never debug standing up 
<ul> 
<li>The faster you try to work, the slower you'll go</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What's Wrong with Print Statements</h2> 
<ul> 
<li>Many people still debug by adding print statements to their programs 
<ul> 
<li>&ldquo;Gee, I wonder what the value of <code>maxTemp</code> is when I call 
<code>resolve</code>?&rdquo;</li> </ul></li> 
<li>Debugging with print statements is: 
<ul> 
<li>Error-prone: adding print statements is a good way to add typos 
<ul> 
<li>Particularly when you have to modify the block structure of your program 
to fit it in</li> </ul></li> 
<li>Time-consuming 
<ul> 
<li>All that typing&hellip;</li> 
<li>And (if you're using Java, C++, or Fortran) all that recompiling&hellip;
</li> </ul></li> 
<li>Misleading 
<ul> 
<li>Adding print statements moves things around in memory, changes execution 
timing, etc.</li> 
<li>Common to have bugs that hide when print statements are added, and 
reappear when they're removed</li> </ul></li> </ul></li> 
<li>There's a much better way</li> 
<li>Comment on this slide</li> </ul> 
<h2>Symbolic Debuggers</h2> 
<ul> 
<li>A <em>symbolic debugger</em> is a program that runs another program on 
your behalf
<ul> 
<li>Called &ldquo;symbolic&rdquo; because it can show you the source code you 
wrote, rather than the raw machine code that's executing</li> </ul></li> 
<li>Using a debugger is one of the two things that separates professionals 
from amateurs
<ul> 
<li>Using version control is the other</li> </ul></li> 
<li>While the <em>target program</em> (or <em>debuggee</em>) is running, the 
debugger can:
<ul> 
<li>Pause, resume, or restart the target</li> 
<li>Inspect and display the values of variables</li> 
<li>Change those values</li> 
<li>Watch for certain events</li> </ul></li> 
<li>Do <em>not</em> need to modify the source of the target program! 
<ul> 
<li>Depending on your language, you may need to compile it with different flags
</li> 
<li>And yes, the debugger modifies the target's layout in memory, and 
execution speed&hellip;</li> 
<li>&hellip;but a lot less than print statements&hellip;</li> 
<li>&hellip;with a lot less effort from you</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Running in a Debugger</h2> 
<ul> 
<li>Depending on language and tools, there may be several ways to get into the 
debugger
<ul> 
<li>Launch the debugger, load the target program, and start work</li> 
<li>Run the debugger with the target program as a command-line argument</li> 
<li>In interpreted languages like Python, you can also switch into debugging 
mode in the middle of an interactive session</li> </ul></li> 
<li>Sometimes also do <em>post mortem debugging</em> 
<ul> 
<li>When a program fails badly (e.g., illegal memory access in C++), it 
creates a<em>core dump</em> 
<ul> 
<li>Copies all of its internal state to a file on disk</li> </ul></li> 
<li>Can then load that dump into the debugger, and see where the program was 
when it died
<ul> 
<li>Not as good as watching it run&hellip;</li> 
<li>&hellip;but sometimes the best you can do</li> </ul></li> </ul></li> 
<li>Modern graphical debuggers typically show: 
<ul> 
<li>The source code</li> 
<li>The call stack</li> 
<li>The values of variables that are currently in scope 
<ul> 
<li>I.e., global variables, parameters to the current function call, and local 
variables in that function</li> </ul></li> 
<li>A panel displaying what your program has printed to standard output and/or 
standard error</li> 
<li> 
<p> Figure 11.1: A Debugger in Action</p> <br>
<br>
</li> </ul></li> 
<li>If the debugger is part of a larger <em>integrated development environment
</em> (IDE), it may show other things as well 
<ul> 
<li>A source browser that presents an outline of the project's modules, 
classes, functions, variables, etc.</li> 
<li> 
<p> Figure 11.2: Source Browser</p> <br>
<br>
</li> 
<li>A code assistant that presents context-sensitive help and documentation
</li> 
<li> 
<p> Figure 11.3: Code Assistant</p> <br>
<br>
</li> </ul></li> 
<li>Note: tools like this are available for every modern language 
<ul> 
<li> 
<p> Figure 11.4: Microsoft Visual Studio in Action</p> <br>
<br>
</li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Basic Operations</h2> 
<ul> 
<li>The debugger can set <em>breakpoints</em> in the target program 
<ul> 
<li>Tells the target to pause when it reaches particular lines of code</li> 
</ul></li> 
<li>Once the program is paused, the debugger can <em>single-step</em> it 
<ul> 
<li>Execute one statement at a time</li> 
<li>Most can: 
<ul> 
<li><em>Step into</em> function calls</li> 
<li><em>Step over</em> them, or</li> 
<li>Run to the end of the current function</li> </ul></li> </ul></li> 
<li>When the target is paused, the debugger can display the contents of its 
memory
<ul> 
<li>The compiler (or interpreter) keeps track of the types of values in 
memory&hellip;</li> 
<li>&hellip;so the debugger can show integers as integers, rather than as 
sequences of bytes</li> 
<li> 
<p> Figure 11.5: Inspecting Values</p> <br>
<br>
</li> </ul></li> 
<li>Most debuggers can also evaluate expressions using the current values of 
variables
<ul> 
<li>E.g., type in <code>2*x&lt;0</code>, debugger displays <code>False</code>
</li> 
<li>Yes, this means that every debugger contains a mini-interpreter for the 
language in question&hellip;</li> </ul></li> 
<li>This is a lot easier than adding print statements&hellip;</li> 
<li>Comment on this slide</li> </ul> 
<h2>How Debuggers Work</h2> 
<ul> 
<li>A running program is: 
<ul> 
<li>A bunch of bytes in memory whose values are instructions 
<ul> 
<li>Each statement in the source program typically corresponds to several 
instructions</li> 
<li>The compiler (or interpreter) can produce a table that records this mapping
</li> </ul></li> 
<li>Another bunch of bytes whose values are the program's variables 
<ul> 
<li>The <em>static space</em> contains constant strings, magic numbers, etc.
</li> 
<li>The call stack is the parameters to all currently-active function calls
</li> 
<li>The <em>heap</em> is all dynamically-created objects</li> </ul></li> 
<li>Some <em>registers</em> 
<ul> 
<li>An <em>instruction pointer</em> that keeps track of what to execute next
</li> 
<li>A <em>stack pointer</em> to keep track of the call stack</li> 
<li>Miscellaneous other registers for doing arithmetic, etc.</li> </ul></li> 
</ul></li> 
<li>In order to set a breakpoint on a particular line, a debugger: 
<ul> 
<li>Figures out which instructions were produced for the statement on that line
</li> 
<li>Records the first of those instructions in a safe place</li> 
<li>Replaces that instruction with a <code>HALT</code> instruction 
<ul> 
<li>Every processor and virtual machine has one of these</li> </ul></li> 
<li> 
<p> Figure 11.6: Creating a Breakpoint</p> <br>
<br>
</li> </ul></li> 
<li>When the target program reaches the <code>HALT</code> instruction: 
<ul> 
<li>It stops, and sends a signal to the operating system&hellip;</li> 
<li>&hellip;which passes the signal on to the debugger&hellip;</li> 
<li>&hellip;which waits for instructions from the user 
<ul> 
<li>Such as &ldquo;Show me the value of <code>maxTemp</code>&rdquo;</li> </ul>
</li> </ul></li> 
<li>When the user wants the program to resume, the debugger: 
<ul> 
<li>Puts the instruction at the breakpoint location back in place</li> 
<li>Tells the program to execute just that instruction 
<ul> 
<li>Every processor and virtual machine has a &ldquo;single step&rdquo; 
mechanism</li> </ul></li> 
<li>Replaces the instruction with a <code>HALT</code> once again 
<ul> 
<li>Otherwise, the breakpoint will disappear</li> </ul></li> 
<li>Tells the program to run normally</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Advanced Operations</h2> 
<ul> 
<li>Debugger lets you move up and down the call stack 
<ul> 
<li>Remember, the set of outstanding function calls is just a bunch of 
variables in memory</li> 
<li>Debugger can ask how large each one is, so it knows where to go to get to 
the previous stack frame</li> 
<li>Lets you figure out how execution got to a particular place 
<ul> 
<li>Otherwise known as, &ldquo;What?? We shouldn't be here!!&rdquo;</li> </ul>
</li> </ul></li> 
<li>Can modify variables in a running program, too 
<ul> 
<li>If you have a theory about why an intermittent bug is occurring: 
<ul> 
<li>Run to that point</li> 
<li>Set variables' values (e.g., set <code>maxTemp</code> to -1)</li> 
<li>Resume execution</li> </ul></li> 
<li>Sometimes used to test error handling code 
<ul> 
<li>Easier to change <code>timeSpentWaiting</code> to 600 seconds in debugger 
than to pull out the network cable and wait&hellip;</li> </ul></li> </ul></li> 
<li>Can set <em>conditional breakpoints</em> 
<ul> 
<li>Only pauses program if some condition is met 
<ul> 
<li>Loop index greater than 100</li> 
<li>Filename argument to function is <code>None</code></li> </ul></li> </ul>
</li> 
<li>Some debuggers also support <em>watchpoints</em> 
<ul> 
<li>Have the debugger watch every write to memory</li> 
<li>Halt when anything, anywhere, modifies a particular variable</li> 
<li>Slow the program down a lot 
<ul> 
<li>Typically a factor of 100 or more</li> </ul></li> 
<li>But sometimes the only practical way to find out why a string in C is 
being overwritten</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 0: Get It Right the First Time</h2> 
<ul> 
<li>The simplest bugs to fix are the ones that don't exist</li> 
<li>Design, reflect, discuss, <em>then</em> code 
<ul> 
<li>A week of hard work can sometimes save you an hour of thought</li> </ul>
</li> 
<li>Make good style a habit 
<ul> 
<li>Train yourself to do things right, so that you'll code well even when 
you're tired, stressed, and facing a deadline</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 1: What Is It Supposed to Do?</h2> 
<ul> 
<li>First step is knowing what the problem is 
<ul> 
<li>&ldquo;It doesn't work&rdquo; isn't good enough</li> 
<li>What exactly is going wrong?</li> 
<li>How do you know?</li> </ul></li> 
<li>Requires you to know how the software is supposed to behave 
<ul> 
<li>Is this case explicit in the specification?</li> 
<li>If not: 
<ul> 
<li>Do you have enough knowledge to extrapolate?</li> 
<li>Do you have the right to do so?</li> </ul></li> </ul></li> 
<li>Write it down! 
<ul> 
<li>Preferably away from the keyboard and screen</li> </ul></li> 
<li>Try not to let what you're seeing influence what you expect to see 
<ul> 
<li><em>Cognitive dissonance</em> leads us to adjust what we think we're 
observing in order to fit preconceptions</li> </ul></li> 
<li>Question: What do testers do while waiting for code? 
<ul> 
<li>Answer: read the specification and start writing down test cases</li> 
<li>If there's no specification, you're wasting valuable time 
<ul> 
<li>And if QA isn't involved in drawing up the specification, to guarantee 
testability, you're wasting even more</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 2: Is It Plugged In?</h2> 
<ul> 
<li>Are you actually exercising the problem that you think you are? 
<ul> 
<li>Are you giving it the right test data?</li> 
<li>Is it configured the way you think it is?</li> 
<li>Is it the version you think it is?</li> 
<li>Has the feature actually been implemented yet?</li> </ul></li> 
<li>Why are you sure? 
<ul> 
<li>Maybe the reason you can't isolate the problem is that it's not there</li> 
</ul></li> 
<li>Another argument in favor of automatic regression tests 
<ul> 
<li>Guaranteed to rerun the test the same way each time</li> </ul></li> 
<li>Also a good argument against automatic regression tests 
<ul> 
<li>If the test is wrong, it will generate the same false negative each time
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 3: Make It Fail</h2> 
<ul> 
<li>You can only debug things when you can see them going wrong</li> 
<li>Find a test case that makes the code fail 
<ul> 
<li>Then try to simplify it</li> 
<li>Then try to find another one</li> 
<li>Use data to weed out false hypotheses</li> 
<li>Remember, it's computer science, not computer flip-a-coin</li> </ul></li> 
<li>If you can't make it fail repeatedly, you're going to have to rely on: 
<ul> 
<li>Post-mortem inspection (autopsies) 
<ul> 
<li>But then you have to reason backwards to figure out <em>why</em> the 
program crashed</li> </ul></li> 
<li>Logging with print statements 
<ul> 
<li>But this can distort the program's behavior</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 4: Divide and Conquer</h2> 
<ul> 
<li>Once you have a test that makes the system fail, isolate the faulty 
subsystem
<ul> 
<li>Faults can only occur upstream from where the system fails</li> 
<li>Look at input to the module that's failing</li> 
<li>If that's wrong, look at preceding module's input, and so on</li> </ul>
</li> 
<li>Fail early, fail often 
<ul> 
<li>Use <code>assert</code> to trap consistency errors early</li> 
<li>Every time you fix a bug, see whether you can add an assertion 
<ul> 
<li>If you made the mistake once, odds are that you, or someone, will make it 
again</li> 
<li>Another strong argument against duplicated code</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 5: Change One Thing at a Time, For a Reason</h2> 
<ul> 
<li>Replacing random chunks of code unlikely to do much good 
<ul> 
<li>If you got it wrong the first time, what makes you think you'll get it 
right the second? Or the ninth?</li> 
<li>So always have a hypothesis before making a change</li> </ul></li> 
<li>Change one thing, then re-run your tests 
<ul> 
<li>Changes can often uncover (or introduce) new bugs</li> 
<li>The more things you change at once, the harder it is to know what's 
responsible for what</li> 
<li>And the harder it is to keep track of what you've done, and what effect it 
had</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 6: Write It Down</h2> 
<ul> 
<li>Science works because scientists keep records</li> 
<li>If you try to keep the state of play in your head, you will lose track 
(and time)
<ul> 
<li>&ldquo;Wait, didn't A followed by B with an odd number of lines cause 
those symptoms? Or was it B followed by A? Or was it A and B with an even 
number of lines?&rdquo;</li> </ul></li> 
<li>Records particularly useful when getting help 
<ul> 
<li>People are more likely to listen when you can explain clearly what you did
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 7: Be Humble</h2> 
<ul> 
<li>If you can't find it in 15 minutes, ask for help 
<ul> 
<li>Just explaining the problem aloud is often enough</li> </ul></li> 
<li>Don't keep telling yourself why it <em>should</em> work: if it doesn't, it 
doesn't
<ul> 
<li>Never debug while grinding your teeth, either&hellip;</li> </ul></li> 
<li>Keep track of your mistakes 
<ul> 
<li>Just as runners keep track of their time for the 100 meter sprint</li> 
<li>You're most likely to fix what you're paying attention to</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>How productive you are depends on: 
<ul> 
<li>What tools you use</li> 
<li>How well you use them</li> </ul></li> 
<li>A symbolic debugger will make you more productive 
<ul> 
<li>Like any other tool, there's a learning curve</li> 
<li>But after a few sessions, you will have more <em>working</em> code in less 
time</li> </ul></li> 
<li>The best debugger in the world is no substitute for working methodically 
<ul> 
<li>The scientific method is the best tool we've ever invented for finding out 
&ldquo;why&rdquo;</li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Object-Oriented Programming</h1> prev  Draft Version 555 next <br>
<br>

<h2>Motivation</h2> 
<ul> 
<li>How should a programmer represent XY points? 
<ul> 
<li>Using a list of two numbers is convenient, but: 
<ul> 
<li>People reading the code have to remember (or guess) that <code>p[1]</code> 
means &ldquo;the Y coordinate&rdquo;</li> 
<li>There's nothing to stop someone accidentally appending a third 
&ldquo;coordinate&rdquo;, or setting the X coordinate to<code>&quot;orange&quot;
</code></li> </ul></li> </ul></li> 
<li>(Almost) all modern languages encourage programmers to define <em>abstract 
data types</em> 
<ul> 
<li>Called <em>abstract</em> because they hide the details of their 
implementation</li> 
<li>Programmers interact with them through a limited set of operations, rather 
than by manipulating data directly
<ul> 
<li>Fewer things can go wrong</li> 
<li>Easier to read resulting code</li> 
<li>Makes code easier to maintain, since internals can be changed without 
changing calling code</li> </ul></li> </ul></li> 
<li>An ADT is usually created by defining a <em>class</em>, then creating one 
or more objects that are<em>instances</em> of that class 
<ul> 
<li>All objects have the same methods (abilities), but their own state</li> 
<li>Changes to one object do not affect the state of others</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Naked Class</h2> 
<ul> 
<li>Define a class in Python using the <code>class</code> keyword 
<ul> 
<li>Like other keywords, <code>class</code> is followed by <code>&quot;:&quot;
</code>, and introduces block</li> 
<li>Name of the new class is usually followed by <code>object</code> in 
parentheses
<ul> 
<li>We'll see other options later</li> </ul></li> </ul></li> 
<li>Create a new instance of the class by &ldquo;calling&rdquo; the class name 
as if it were a function
<ul> 
<li>If the class's body is <code>pass</code>, this creates a blank object</li> 
<li>See in a moment how to make objects more interesting</li> </ul></li> 
<li>Most objects have <em>data members</em> that store their internal state 
<ul> 
<li>A &ldquo;personal&rdquo; variable, like &ldquo;my nose&rdquo; or &ldquo;my 
watch&rdquo;</li> 
<li>Use the expression <code>obj.data</code> to access the <code>data</code> 
member of<code>obj</code> 
<ul> 
<li>Unlike C++ and Java, Python has no notion of &ldquo;hiding&rdquo; data 
members</li> </ul></li> </ul></li> 
<li>Create data members simply by referring to them 
<ul> 
<li>The expression <code>obj.x = 3</code> either: 
<ul> 
<li>Gives <code>obj</code> a new member <code>x</code>, and assigns it the 
value 3, or</li> 
<li>Overwrites the existing member <code>x</code> with the value 3</li> </ul>
</li> 
<li>Just like creating variables in a function</li> </ul></li> 
<li>Example: an XY point 
<ul> 
<li> 
<pre>class point2d(object): pass if __name__ == '__main__': p = point2d() p.x 
= 0.0 p.y = 3.0 print &quot;point is&quot;, p print &quot;coordiantes 
are&quot;, p.x, p.y</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Methods</h2> 
<ul> 
<li>Naked classes are just glorified dictionaries 
<ul> 
<li>Instead of <code>obj['x']</code>, have <code>obj.x</code></li> </ul></li> 
<li>Really become interesting when we start to define methods 
<ul> 
<li>Any function defined inside a class belongs to that class</li> 
<li>When a method is called, Python passes the object itself as the method's 
first argument
<ul> 
<li>Which means that every method must take at least one argument</li> 
<li>By convention, it is called <code>self</code></li> </ul></li> </ul></li> 
<li>Why use methods? 
<ul> 
<li>Make code easier to understand by grouping operations</li> 
<li>Give programmers a place to check the integrity of their ADTs</li> </ul>
</li> 
<li>The expression <code>obj.meth(arg)</code> is equivalent to: 
<ul> 
<li>Find the class that <code>obj</code> is an instance of</li> 
<li>Call that class's <code>meth</code> method with <code>obj</code> and <code>
arg</code> as arguments</li> </ul></li> 
<li>When a new object is created, Python checks whether the class has defined 
a method called<code>__init__</code> 
<ul> 
<li>If it has, Python calls it before doing anything else</li> 
<li>This <em>constructor</em> can give the object its initial data members 
simply by assigning them values</li> </ul></li> 
<li>Inside a method, refer to the object's <code>data</code> member as <code>
self.data</code> 
<ul> 
<li>Since the object was passed to the method as the parameter <code>self
</code></li> 
<li>The expression <code>data</code> is <em>not</em> the same as <code>
self.data</code> 
<ul> 
<li><code>data</code> on its own means &ldquo;a local variable called <code>
data</code>&rdquo;</li> </ul></li> </ul></li> 
<li>Example: a 2D point in the upper right quadrant 
<ul> 
<li> 
<pre>class point2d(object): # Constructor defines how to create new objects. 
def __init__(self): self.x = 0 self.y = 0 # Get X coordinate. def getX(self): 
return self.x # Set X coordinate. def setX(self, newX): assert newX &gt;= 0 
self.x = newX # Get and set Y coordinate. def getY(self): return self.y def 
setY(self, newY): assert newY &gt;= 0 self.y = newY # Calculate norm. def 
norm(self): return math.sqrt(self.x ** 2 + self.y ** 2)</pre> </li> 
<li>The <code>__init__</code> constructor sets the point's initial coordinates
</li> 
<li>The <em>getter</em> methods replace raw read access</li> 
<li>The <em>setter</em> methods check the constraints on the state of the class
<ul> 
<li>If someone tries to assign a negative coordinate, the class will raise an 
exception</li> 
<li>Fail early, fail often</li> 
<li>Note: when testing the class, test the error handling too</li> 
<li> 
<pre># Tests. if __name__ == '__main__': p = point2d() assert p.getX() == 0.0 
assert p.getY() == 0.0 p.setX(3.0) p.setY(4.0) assert p.getX() == 3.0 assert 
p.getY() == 4.0 assert p.norm() == 5.0 try: p.setX(-1.0) assert False except 
AssertionError: pass</pre> </li> </ul></li> </ul></li> 
<li>Keep the <em>memory model</em> in mind when thinking about objects 
<ul> 
<li> 
<p> Figure 12.1: Memory Model</p> <br>
<br>
</li> 
<li>A method is just a function that Python can call in a particular way</li> 
<li>You can call it directly if you want to 
<ul> 
<li> 
<pre> p = point2d() p.setX(9.0) p.setY(2.0) print &quot;calling getX directly 
gives&quot;, point2d.getX(p)</pre> 
<pre>calling getX directly gives 9.0 </pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Defining a Queue</h2> 
<ul> 
<li>A queue can do three things: 
<ul> 
<li>Enqueue an item</li> 
<li>Dequeue the front item 
<ul> 
<li>Which raises an exception if the queue is empty</li> 
<li>Remember, error behavior is part of a class's interface too</li> </ul></li>
<li>Report whether it is empty or not 
<ul> 
<li>Which is less powerful than reporting its size</li> </ul></li> </ul></li> 
<li>A queue may store items in many different ways 
<ul> 
<li>The simplest in Python is probably to use a list&hellip;</li> 
<li>&hellip;but it isn't the only one&hellip;</li> 
<li>&hellip;and whoever is using the class shouldn't care 
<ul> 
<li>At least, not unless speed and/or memory requirements become an issue</li> 
</ul></li> </ul></li> 
<li>Implementation: 
<ul> 
<li> 
<pre>class Queue(object): '''Implement a queue.''' def __init__(self): 
'''Construct an empty queue.''' self.data = [] def enq(self, val): '''Add a new 
value to the end of the queue.''' self.data.append(val) def deq(self): 
'''Return the front value of the queue, or raise ValueError if the queue is 
empty.''' if len(self.data) == 0: raise ValueError, &quot;Can't dequeue from 
empty queue&quot; val = self.data[0] self.data = self.data[1:] return val def 
empty(self): '''Report whether the queue is empty or not.''' return 
len(self.data) == 0</pre> </li> 
<li>Use <em>docstrings</em> instead of comments to document classes and 
methods (and functions)
<ul> 
<li>Unlike comments, they are kept at runtime to provide interactive help</li> 
<li> 
<pre> print Queue.__doc__ print Queue.enq.__doc__ print q.deq.__doc__ </pre> 
<pre>Implement a queue. Add a new value to the end of the queue. Return the 
front value of the queue, or raise ValueError if the queue is empty.</pre> </li>
</ul></li> 
<li><code>raise ValueError</code> instead of using <code>assert</code> when 
someone tries to dequeue from an empty queue
<ul> 
<li>The operation isn't a flaw in this code (which is what assertions are for)
</li> 
<li>Question: should <code>point2d.setX</code> and <code>point2d.setY</code> 
have raised<code>ValueError</code> as well?</li> </ul></li> 
<li>Always include tests 
<ul> 
<li> 
<pre>if __name__ == '__main__': q = Queue() assert q.empty() try: x = q.deq() 
assert False except ValueError: pass q.enq('first') assert not q.empty() 
q.enq('second') assert q.deq() == 'first' assert q.deq() == 'second' assert 
q.empty()</pre> </li> 
<li>We'll see in the next two lectures how to do this systematically</li> </ul>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Special Methods</h2> 
<ul> 
<li><code>__init__</code> is just one example of a <em>special method</em> 
<ul> 
<li>All have names beginning and ending with double underscore</li> 
<li>Give programmers a way to make their data types look like those built into 
Python</li> </ul></li> 
<li>Most widely used is probably <code>__str__</code> 
<ul> 
<li>When Python needs a string representation of an object, it sees if the 
object's class defines<code>__str__</code></li> 
<li>If it does, Python calls it, and uses the string it returns</li> 
<li>If it doesn't, Python creates a default string representation</li> 
<li> 
<pre>class first(object): def __init__(self, name): self.name = name class 
second(object): def __init__(self, name): self.name = name def __str__(self): 
return 'second/&quot;%s&quot;' % self.name f = first(&quot;orange&quot;) print 
&quot;first object is&quot;, f s = second(&quot;apple&quot;) print &quot;second 
object is&quot;, s</pre> 
<pre>first object is &lt;__main__.first object at 0x401d982c&gt; second object 
is second/&quot;apple&quot;</pre> </li> </ul></li> 
<li>Other examples: 
<ul> 
<li>If <code>obj</code> is an object, <code>len(obj)</code> calls <code>
obj.__len__()</code> 
<ul> 
<li>Easy to add to <code>Queue</code> to report how long the queue is</li> 
</ul></li> 
<li><code>x in obj</code> is equivalent to <code>obj.__contains__(x)</code> 
<ul> 
<li>Would also be easy to add to <code>Queue</code>, but should we?</li> 
<li>Don't want to create &ldquo;kitchen sink&rdquo; classes</li> </ul></li> 
<li> 
<pre>class Queue(object): def __init__(self): self.data = [] def enq(self, 
val): self.data.append(val) def deq(self): if len(self.data) == 0: raise 
ValueError, &quot;Can't dequeue from empty queue&quot; val = self.data[0] 
self.data = self.data[1:] return val def __len__(self): return len(self.data) 
def empty(self): return self.__len__() == 0 if __name__ == '__main__': q = 
Queue() q.enq('first') q.enq('second') assert len(q) == 2 q.deq() q.deq() 
assert q.empty()</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Inheritance</h2> 
<ul> 
<li>What if we want two types of queue, one with <code>__len__</code> and one 
without?</li> 
<li>More realistically, suppose we have two types of people: professors and 
students
<ul> 
<li>They have a lot in common: names, email addresses, etc.</li> 
<li>But each has things the other doesn't (e.g., an office, or courses taught 
vs. courses taken)</li> 
<li>Really don't want to write each method twice 
<ul> 
<li>Anything repeated in two or more places will eventually be wrong in at 
least one.</li> </ul></li> </ul></li> 
<li>The object-oriented solution is <em>inheritance</em> 
<ul> 
<li>One class <em>extends</em> its <em>parent class</em> by adding new state 
and methods
<ul> 
<li>Anything instances of the parent class can do, instances of the child 
class can do as well</li> 
<li>But not vice versa</li> </ul></li> 
<li>Extend any class with any number of <em>child classes</em> 
<ul> 
<li>All children share the behavior of their parent</li> 
<li>But are completely independent of one another</li> </ul></li> </ul></li> 
<li>For example, define a <code>Person</code> as: 
<ul> 
<li> 
<pre>class Person(object): '''Represent generic traits of any person.''' def 
__init__(self, name, email): '''Create a new person with a name and an email 
address.''' self.name = name self.email = email def getName(self): return 
self.name def getEmail(self): return self.email</pre> </li> 
<li>Then <em>derive</em> <code>Professor</code>: 
<ul> 
<li> 
<pre>class Professor(Person): '''Professors are more than people...''' def 
__init__(self, name, email, office): Person.__init__(self, name, email) 
self.office = office def getOffice(self): return self.office</pre> </li> </ul>
</li> 
<li>Note that it's <code>Professor(Person)</code> instead of <code>
Professor(object)</code> 
<ul> 
<li>Signals that <code>Professor</code> extends <code>Person</code> instead of 
the generic built-in<code>object</code> class</li> </ul></li> 
<li>Note also that <code>Professor</code>'s constructor calls <code>Person
</code>'s 
<ul> 
<li>Ensures that all of <code>Person</code>'s initialization is done without 
duplicating code</li> 
<li>Ensures that changes to <code>Person</code> will automatically be 
reflected in<code>Person</code></li> </ul></li> 
<li>Now define <code>Student</code>: 
<ul> 
<li> 
<pre>class Student(Person): '''Students are more than people too...''' def 
__init__(self, name, email, program): Person.__init__(self, name, email) 
self.program = program def getProgram(self): return self.program</pre> </li> 
</ul></li> 
<li>And run a few tests: 
<ul> 
<li> 
<pre>if __name__ == '__main__': tb = Professor('Tycho Brahe', 
't.brahe@copenhagen.dk', 'Room 241') print tb.getName(), tb.getEmail(), 
tb.getOffice() jk = Student('Johannes Kepler', 'j.kepler@uraniborg.org', 
'B.A.') print jk.getName(), jk.getEmail(), jk.getProgram()</pre> 
<pre>Tycho Brahe t.brahe@copenhagen.dk Room 241 Johannes Kepler 
j.kepler@uraniborg.org B.A.</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Polymorphism</h2> 
<ul> 
<li>Suppose we define <code>Person.__str__</code>, then <em>override</em> it 
with more specific definitions in<code>Professor</code> and <code>Student</code>
<ul> 
<li>When Python looks for a method, it checks the object's class, then its 
parent class, and so on</li> 
<li> 
<p> Figure 12.2: Method Lookup</p> <br>
<br>
</li> 
<li>Result is that Python calls the most appropriate method for an object</li> 
<li> 
<pre>class Person(object): def __init__(self, name, email): self.name = name 
self.email = email ... def __str__(self): return '%s (%s)' % (self.name, 
self.email) class Professor(Person): def __init__(self, name, email, office): 
Person.__init__(self, name, email) self.office = office ... def __str__(self): 
result = Person.__str__(self) result += ' Room %s' % self.office return result 
class Student(Person): def __init__(self, name, email, program): 
Person.__init__(self, name, email) self.program = program ... def 
__str__(self): result = Person.__str__(self) result += ' Program %s' % 
self.program return result if __name__ == '__main__': crowd = [ 
Professor('Tycho Brahe', 't.brahe@copenhagen.dk', 'Room 241'), 
Student('Johannes Kepler', 'j.kepler@uraniborg.org', 'B.A.') ] for person in 
crowd: print person</pre> 
<pre>Tycho Brahe (t.brahe@copenhagen.dk) Room Room 241 Johannes Kepler 
(j.kepler@uraniborg.org) Program B.A.</pre> </li> </ul></li> 
<li><em>Polymorphism</em> means &ldquo;having more than one form&rdquo; 
<ul> 
<li>In object-oriented programming, it means being able to treat different 
types of things as interchangeable</li> 
<li>E.g., if every class derived from <code>Shape</code> defines a method 
<code>area</code>, then <code>obj.area()</code> will return the area of <code>
obj</code> <em>without</em> the caller having to know if <code>obj</code> is 
actually a square or a circle</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Substitution Principle</h2> 
<ul> 
<li>Python looks up each method when it's called 
<ul> 
<li>So any two classes that define the same set of methods can be used 
interchangeably</li> </ul></li> 
<li>However, the usual way to implement polymorphism is via inheritance 
<ul> 
<li>Only override things that need to change</li> </ul></li> 
<li>The <em>Liskov Substitution Principle</em> states that it should always be 
possible to replace an instance of a parent class with an instance of the child 
class
<ul> 
<li>Means that if <code>Parent.meth</code> returns a string, <code>Child.meth
</code> must also return a string</li> 
<li>If <code>Parent.meth</code> returns a non-empty string with at least three 
vowels,<code>Child.meth</code> must as well</li> </ul></li> 
<li>Often expressed in terms of pre-conditions and post-conditions 
<ul> 
<li><code>Child.meth</code> must satisfy all the post-conditions of <code>
Parent.meth</code>, and may impose more 
<ul> 
<li>In other words, <code>Child.meth</code>'s possible output is a subset of 
<code>Parent.meth</code>'s</li> 
<li>So any code that works correctly using the output of <code>Parent.meth
</code> will continue to work if given an instance of <code>Child</code> instead
</li> </ul></li> 
<li><code>Child.meth</code> may ignore some of <code>Parent.meth</code>'s 
pre-conditions, but may<em>not</em> impose more 
<ul> 
<li>Equivalently, <code>Child.meth</code> accepts everything that<code>
Parent.meth</code> did, and possibly more</li> 
<li>So any code that could call <code>Parent.meth</code> correctly is 
guaranteed to call<code>Child.meth</code> correctly too</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Class Members</h2> 
<ul> 
<li>Sometimes want to share data between all instances of a class 
<ul> 
<li>Constants, a count of the number of class instances created, etc.</li> 
</ul></li> 
<li>Any data members defined inside the <code>class</code> block belong to the 
class as a whole
<ul> 
<li> 
<pre>class Counter(object): num = 0 # Number of Counter objects created. def 
__init__(self, name): Counter.num += 1 self.name = name if __name__ == 
'__main__': print 'initial count', Counter.num first = Counter('first') print 
'after creating first object', Counter.num second = Counter('second') print 
'after creating second object', Counter.num</pre> 
<pre>initial count 0 after creating first object 1 after creating second 
object 2</pre> </li> </ul></li> 
<li>Can also define methods that belong to the class, rather than to 
particular objects
<ul> 
<li>Out of scope for this course, but often useful</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Overloading Operators</h2> 
<ul> 
<li>(Almost) every feature of Python objects can be overridden by defining the 
right special method
<ul> 
<li>If done carefully, makes code much easier to read</li> 
<li>If done haphazardly, makes it almost impossible to understand</li> </ul>
</li> 
<li>One common use is <em>operator overloading</em> 
<ul> 
<li>The symbol <code>&quot;+&quot;</code> is just a shorthand for a function 
that takes two arguments</li> 
<li>If a class defines a method <code>__add__</code>, it takes precedence over 
the built-in &ldquo;function&rdquo;
<ul> 
<li>So <code>x + y</code> calls <code>x.__add__(y)</code></li> </ul></li> </ul>
</li> 
<li>Of course, it's not quite that simple 
<ul> 
<li><code>2 + x</code> and <code>x + 2</code> don't always do the same thing 
<ul> 
<li>String concatenation</li> 
<li>Matrix multiplication</li> </ul></li> 
<li>Classes can define right-hand versions of operators, e.g., <code>__radd__
</code> instead of <code>__add__</code> 
<ul> 
<li>If <code>x</code> has an <code>__add__</code> method, call that</li> 
<li>Otherwise, if <code>y</code> has an <code>__radd__</code> method, call that
</li> 
<li>Otherwise, try Python's built-ins</li> </ul></li> </ul></li> 
<li>Example: a vector is <em>sparse</em> if most of its entries are zero 
<ul> 
<li>No point padding eleven actual values with nine million zeroes</li> 
<li>So use a dictionary to record non-zero values and their indices</li> 
<li>Addition: create a new vector with a non-zero value wherever either 
operand had a non-zero value</li> 
<li>Dot product: add up products of matching non-zero values</li> 
<li>Length: return one more than the index of the largest non-zero value 
<ul> 
<li>&ldquo;One more&rdquo; to be consistent with Python's lists</li> 
<li>Hm&hellip;what is the length of <code>v</code> after: 
<pre>v = SparseVector() # all values initialized to 0.0 v[27] = 1.0 # length 
is now 28 v[43] = 1.0 # length is now 44 v[43] = 0.0 # is the length still 44, 
or 28?</pre> </li> </ul></li> 
<li>This isn't a programming question; it's a <em>data modeling</em> question 
<ul> 
<li>What does the data in the program have to do to model the real world 
accurately?</li> </ul></li> </ul></li> 
<li>The easy stuff 
<ul> 
<li>Construction creates an empty sparse vector</li> 
<li>Its length is the largest index ever seen 
<ul> 
<li>May or may not be sensible, but it's easy to implement</li> </ul></li> 
<li> 
<pre>class SparseVector(object): '''Implement a sparse vector. If a value has 
not been set explicitly, its value is zero.''' def __init__(self): '''Construct 
a sparse vector with all zero entries.''' self.values = {} def __len__(self): 
'''The length of a vector length is the largest index ever seen.''' if 
len(self.values): return max(self.values.keys()) return 0</pre> </li> </ul></li>
<li>Making it look like a vector 
<ul> 
<li>Subscripting with <code>[]</code> is just a binary operator too 
<ul> 
<li><code>obj[index]</code> is implemented as <code>obj.__getitem__(index)
</code></li> 
<li><code>obj[index] = value</code> is <code>obj.__setitem(index, value)</code>
</li> 
<li>Note: <em>all</em> programming languages do this&mdash;the only question 
is whether they let you see it</li> </ul></li> 
<li> 
<pre> def __getitem__(self, key): '''Return an explicit value, or 0.0 if none 
has been set.''' if key in self.values: return self.values[key] return 0.0 def 
__setitem__(self, key, value): '''Assign a new value to a vector entry.''' 
self.values[key] = value</pre> </li> </ul></li> 
<li>Dot product 
<ul> 
<li>The other object (on the right side of <code>&quot;*&quot;</code>) is 
usually called<code>other</code></li> 
<li>No reason to insist that it be a sparse vector 
<ul> 
<li>Could equally well be a list of values</li> </ul></li> 
<li>So loop over the indices of our own values, multiply by corresponding 
values in other object
<ul> 
<li>Any index not encountered in this loop doesn't matter, since it 
corresponds to something that's zero</li> </ul></li> 
<li> 
<pre> def __mul__(self, other): '''Calculate cross product of a sparse vector 
with something else.''' result = 0.0 for k in self.values.keys(): result += 
self.values[k] * other[k] return result def __rmul__(self, other): return 
self.__mul__(other)</pre> </li> 
<li>Note: <code>__rmul__ = __mul__</code> makes <code>__rmul__</code> point to 
the same code as<code>__mul__</code> 
<ul> 
<li>There's no magic here: methods are functions, are objects, are things you 
can assign to names</li> </ul></li> </ul></li> 
<li>Addition 
<ul> 
<li>Trickier than multiplication: result is non-zero wherever <em>either</em> 
argument is non-zero</li> 
<li>Don't want to loop over all the zeroes of either argument</li> 
<li>Solution: if the other object is a sparse vector, cheat 
<ul> 
<li>I.e., reach inside it, and rely on details of its implementation</li> </ul>
</li> 
<li> 
<pre> def __add__(self, other): '''Add something to a sparse vector.''' # 
Initialize result with all non-zero values from this vector. result = 
SparseVector() result.values.update(self.values) # If the other object is also 
a sparse vector, add non-zero values. if isinstance(other, SparseVector): for k 
in other.values.keys(): result[k] = result[k] + other[k] # Otherwise, use brute 
force. else: for i in range(len(other)): result[i] = result[i] + other[i] 
return result # Right-hand add does the same thing as left-hand add. __radd__ = 
__add__</pre> </li> </ul></li> 
<li>And finally, some tests 
<ul> 
<li> 
<pre>if __name__ == '__main__': x = SparseVector() x[1] = 1.0 x[3] = 3.0 x[5] 
= 5.0 print 'len(x)', len(x) for i in range(len(x)): print '...', i, x[i] y = 
SparseVector() y[1] = 10.0 y[2] = 20.0 y[3] = 30.0 print 'x + y', x + y print 
'y + x', y + x print 'x * y', x * y print 'y * x', y * x z = [0.0, 0.1, 0.2, 
0.3, 0.4, 0.5] print 'x + z', x + z print 'x * z', x * z print 'z + x', z + x
</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Structured Unit Testing</h1> prev  Draft Version 525 next <br>
<br>

<h2>A Unit Testing Framework</h2> 
<ul> 
<li>Unit testing follows a pattern 
<ul> 
<li>Setup and teardown</li> 
<li>Lots of small, independent tests</li> 
<li>Reporting</li> 
<li>Aggregation (combine tests into a <em>test suite</em>, and test suites 
into larger suites)</li> </ul></li> 
<li>See a pattern, build a framework 
<ul> 
<li>Write shared code once</li> 
<li>Encourage people to work a certain way 
<ul> 
<li>I.e., make it easy for them to do things right</li> </ul></li> </ul></li> 
<li>JUnit is a testing framework originally written by Kent Beck and Erich 
Gamma in 1997
<ul> 
<li>Widely adopted 
<ul> 
<li>Now integrated into almost all Java IDEs</li> 
<li>Made testing easy enough that programmers actually started doing it</li> 
</ul></li> 
<li>Widely imitated: 
<ul> 
<li>Workalikes are available C++, Perl, .NET, etc.</li> 
<li>Once you know one, you can easily learn and use the others</li> </ul></li> 
<li>Widely extended 
<ul> 
<li>Add-ons for measuring test execution times, recording tests, testing web 
applications, etc.</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Mechanics</h2> 
<ul> 
<li>Python's standard unit testing framework is the <code>unittest</code> 
module</li> 
<li>What you do: 
<ul> 
<li><code>import unittest</code></li> 
<li>Derive a class (or several classes) from <code>unittest.TestCase</code>
</li> 
<li>Define one method for each test 
<ul> 
<li>Name must begin with <code>&quot;test&quot;</code></li> 
<li>Takes no argument (other than <code>self</code>)</li> 
<li>Returns nothing</li> </ul></li> 
<li>Call <code>unittest.main()</code></li> </ul></li> 
<li>What the framework does: 
<ul> 
<li>Search the program to find classes derived from <code>TestCase</code> 
<ul> 
<li>See how this works in a later lecture</li> </ul></li> 
<li>Search each class to find methods whose names begin with the word <code>
&quot;test&quot;</code></li> 
<li>For each method: 
<ul> 
<li>Create a new instance of the class</li> 
<li>Call the method</li> 
<li>Record pass, fail, or error</li> </ul></li> </ul></li> 
<li>Actually check things inside test methods using methods provided by <code>
TestCase</code> 
<ul> 
<li>Allows the framework to distinguish between test assertions, and normal 
<code>assert</code> statements 
<ul> 
<li>Since the code being tested might use the latter</li> </ul></li> 
<li>Checking methods include: 
<ul> 
<li><code>assert_(condition)</code>: check that something is true (note the 
underscore)</li> 
<li><code>assertEqual(a, b)</code>: check that two things are equal</li> 
<li><code>assertNotEqual(a, b)</code>: the reverse of the above</li> 
<li><code>assertRaises(exception, func, &hellip;args&hellip;)</code>: call 
<code>func</code> with arguments (if provided), and check that it raises the 
right exception</li> 
<li><code>fail()</code>: signal an unconditional failure</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Testing a Function</h2> 
<ul> 
<li>You want to test a function that calculates a running sum of the values in 
the list
<ul> 
<li>Replaces <code>[a, b, c, &hellip;]</code> with <code>[a, a+b, a+b+c, 
&hellip;]</code></li> 
<li>Test cases: 
<ul> 
<li>Empty list</li> 
<li>Single value</li> 
<li>Long list with mix of positive and negative values</li> </ul></li> 
<li>Hm&hellip; Is it supposed to: 
<ul> 
<li>Return a new list?</li> 
<li>Modify its argument in place and return that?</li> 
<li>Modify its argument and return <code>None</code>?</li> </ul></li> 
<li>Your tests can only ever be as good as (your understanding of) the spec 
<ul> 
<li>We'll assume it's supposed to return a new list</li> </ul></li> </ul></li> 
<li>First implementation of <code>runningSum</code>: 
<ul> 
<li> 
<pre>import sys, unittest def runningSum(seq): result = seq[0:1] for i in 
range(2, len(seq)): result.append(result[i-1] + seq[i]) return result class 
SumTests(unittest.TestCase): def testEmpty(self): 
self.assertEqual(runningSum([]), []) def testSingle(self): 
self.assertEqual(runningSum([3]), [3]) def testDouble(self): 
self.assertEqual(runningSum([2, 9]), [2, 11]) def testLong(self): 
self.assertEqual(runningSum([-3, 0, 3, -2, 5]), [-3, -3, 0, -2, 3]) if __name__ 
== '__main__': unittest.main()</pre> 
<pre>F.E. 
====================================================================== ERROR: 
testLong (__main__.SumTests) 
---------------------------------------------------------------------- 
Traceback (most recent call last): File &quot;running_sum_wrong.py&quot;, line 
21, in testLong self.assertEqual(runningSum([-3, 0, 3, -2, 5]), [-3, -3, 0, -2, 
3]) File &quot;running_sum_wrong.py&quot;, line 6, in runningSum 
result.append(result[i-1] + seq[i]) IndexError: list index out of range 
====================================================================== FAIL: 
testDouble (__main__.SumTests) 
---------------------------------------------------------------------- 
Traceback (most recent call last): File &quot;running_sum_wrong.py&quot;, line 
18, in testDouble self.assertEqual(runningSum([2, 9]), [2, 11]) File 
&quot;c:\Python23\lib\unittest.py&quot;, line 302, in failUnlessEqual raise 
self.failureException, \ AssertionError: [2] != [2, 11] 
---------------------------------------------------------------------- Ran 4 
tests in 0.000s FAILED (failures=1, errors=1)</pre> </li> 
<li>Notice that test methods deserve to have meaningful names too</li> </ul>
</li> 
<li>Can you spot the error? 
<ul> 
<li>Default output gives the stack trace, to help you find the problem 
<ul> 
<li>You can also provide messages to the <code>TestCase.assert</code> family 
of methods</li> </ul></li> 
<li>Tests are run in an arbitrary order 
<ul> 
<li>Classes store methods in a dictionary for fast lookup</li> 
<li>Means that there's no guarantee they'll be run in the order in which you 
defined them</li> 
<li>Yet another good reason to make each test independent</li> </ul></li> </ul>
</li> 
<li>Fix the method and re-run the tests 
<ul> 
<li> 
<pre>def runningSum(seq): result = seq[0:1] for i in range(1, len(seq)): 
result.append(result[i-1] + seq[i]) return result</pre> 
<pre>.... 
---------------------------------------------------------------------- Ran 4 
tests in 0.000s OK</pre> </li> 
<li>Everything works</li> </ul></li> 
<li>Should you really go to this much effort to test a simple function? 
<ul> 
<li>Took less than a minute to write the four tests</li> 
<li>Uncovered one gap in the requirements, and one error in the first 
implementation</li> 
<li>Able to verify the fix almost instantly</li> 
<li>Sounds pretty good to me&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Eliminating Redundancy</h2> 
<ul> 
<li>Setting up a fixture can often be more work than writing the test 
<ul> 
<li>Complex data structures, external files, etc.</li> </ul></li> 
<li>If the test class defines a method called <code>setUp</code>, the 
framework will call it before running each test
<ul> 
<li>And if there's a method called <code>tearDown</code>, it will be run after 
each test</li> </ul></li> 
<li>Example: test whether a function can trace Make-like dependencies correctly
<ul> 
<li>Several kinds of tests to run, and several fixtures to run them on</li> 
<li>So create all the fixtures in <code>setUp</code>, and use them in the test 
methods
<ul> 
<li>Alternatively, create a separate test class for each fixture</li> 
<li>Worth doing if creating a fixture takes so long that you don't want any 
redundant setup</li> </ul></li> 
<li> 
<pre>class TestDepends(unittest.TestCase): def setUp(self): self.f0 = {} 
self.f1 = {'a' : []} self.f2 = {'a' : ['a']} self.f3 = {'a' : ['b'], 'b' : []} 
self.f4 = {'a' : ['b', 'c'], 'b' : ['a'], 'c' : ['d'], 'd' : []} def 
testCanReachSelf(self): self.assert_(dependsOn(self.f1, 'a', 'a')) 
self.assert_(dependsOn(self.f2, 'a', 'a')) self.assert_(dependsOn(self.f3, 'b', 
'b')) self.assert_(dependsOn(self.f4, 'c', 'c')) def testSingleStep(self): 
self.assert_(dependsOn(self.f3, 'a', 'b')) self.assert_(dependsOn(self.f4, 'a', 
'b')) self.assert_(dependsOn(self.f4, 'c', 'd')) def testBackward(self): 
self.assert_(dependsOn(self.f4, 'b', 'a')) def testMultiStep(self): 
self.assert_(dependsOn(self.f4, 'a', 'd')) self.assert_(dependsOn(self.f4, 'b', 
'd')) def testNegative(self): self.assert_(not dependsOn(self.f1, 'a', 'c')) 
self.assert_(not dependsOn(self.f3, 'b', 'a'))</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Testing for Failure</h2> 
<ul> 
<li>Testing that code fails in the right way is just as important as testing 
that it does the right thing
<ul> 
<li>Otherwise, someone will do something wrong some day, and the code <em>won't
</em> report it</li> </ul></li> 
<li>Two ways to do it: 
<ul> 
<li>Use <code>TestCase.assertRaises</code> to check that a specific function 
raises a specific exception</li> 
<li>Use <code>try</code>/<code>except</code> yourself 
<ul> 
<li>Have to do it this way in C++, Java, and most other sturdy languages</li> 
</ul></li> </ul></li> 
<li>Example: testing a function that finds all values inside a double-ended 
range
<ul> 
<li>Raises <code>ValueError</code> if the range is empty, or if the set of 
values is empty</li> 
<li> 
<pre>class TestInRange(unittest.TestCase): def testNoValues(self): try: 
inRange([], 0.0, 1.0) except ValueError: pass else: self.fail() def 
testBadRange(self): try: inRange([0.0], 3.0, 3.0) inRange([0.0], 4.0, -2.0) 
except ValueError: pass else: self.fail()</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Testing I/O</h2> 
<ul> 
<li>Input and output often seem hard to test 
<ul> 
<li>Put a bunch of fixture files and expected results in a testing directory?
</li> 
<li>Create temporary files when and as tests execute?</li> </ul></li> 
<li>The best answer is to use fake I/O using strings 
<ul> 
<li>Python's <code>StringIO</code> and <code>cStringIO</code> modules can read 
and write strings instead of files</li> 
<li>Similar packages exist for C++, Java, and other languages</li> </ul></li> 
<li>This only works if the function being tested takes streams as arguments, 
rather than filenames
<ul> 
<li>If the function opens and closes the file, no way for you to substitute a 
fake file</li> 
<li>An example of designing code to make it testable</li> </ul></li> 
<li>Example: find lines where two files differ 
<ul> 
<li>Nothing as fancy as <code>diff</code>, just a line-by-line comparison</li> 
<li>Input: two streams (which might be open files or <code>StringIO</code> 
wrappers around strings)</li> 
<li>Output: another stream (i.e., a file, or a <code>StringIO</code>)</li> 
<li>As a side effect, we've made the function itself more useful 
<ul> 
<li>People can now use it to compare strings, or strings and files</li> </ul>
</li> 
<li> 
<pre>class TestDiff(unittest.TestCase): def wrapAndRun(self, left, right, 
expected): left = StringIO(left) right = StringIO(right) actual = StringIO() 
diff(left, right, actual) self.assertEqual(actual.getvalue(), expected) def 
testEmpty(self): self.wrapAndRun('', '', '') def testLengthyMatch(self): str = 
'a\nb\nc\n' self.wrapAndRun(str, str, '') def testSingleLineMismatch(self): 
self.wrapAndRun('a\n', 'b\n', '1\n') def testMiddleMismatch(self): 
self.wrapAndRun('a\nb\nc\n', 'a\nx\nc\n', '2\n')</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Testing With Classes</h2> 
<ul> 
<li>Testing classes isn't much different from what we've already seen 
<ul> 
<li>Create objects, call their methods, check the results</li> </ul></li> 
<li>But how can we keep tests independent? 
<ul> 
<li>Can't test methods unless we can construct objects&hellip;</li> 
<li>&hellip;but the only way to see if objects have been constructed properly 
is to invoke their methods</li> </ul></li> 
<li>The answer is to keep tests <em>as independent as possible</em> 
<ul> 
<li>The first tests you write use simple constructors, and simple inspector 
methods</li> 
<li>Once those pass, start writing more complex tests</li> 
<li>They probably won't be executed in this order once they're all 
written&hellip;</li> 
<li>&hellip;but they still give you somewhere to set a breakpoint when simple 
things start to go wrong</li> </ul></li> 
<li>Much more interesting to think about how to use object-oriented ideas in 
constructing tests
<ul> 
<li>Create one class that has a lot of tests</li> 
<li>Derive other test classes that: 
<ul> 
<li>Create specific fixtures</li> 
<li>Run specific tests</li> </ul></li> 
<li>By default, the framework will run all the generic tests for the specific 
classes as well
<ul> 
<li> 
<p> Figure 13.1: Object-Oriented Testing</p> <br>
<br>
</li> </ul></li> 
<li>This only works if the tests in the base class are generalized 
<ul> 
<li>A little more setup work for a big payoff</li> </ul></li> </ul></li> 
<li>Example: billing application for a software consulting firm 
<ul> 
<li>Each consultant may be assigned to zero or more projects</li> 
<li>Each project may have zero or more consultant currently assigned to it</li>
<li>The <code>Assignment</code> class keep track of who is currently assigned 
to what
<ul> 
<li>Use strings for consultant and project IDs for now</li> </ul></li> 
<li>Create a base class <code>CommonTests</code> to hold shared tests 
<ul> 
<li>Do <em>not</em> derive this from <code>unittest.TestCase</code></li> 
<li>If we did, the framework would automatically try to run it&hellip;</li> 
<li>&hellip;and it's not designed to be run on its own</li> </ul></li> 
<li>This class does <em>not</em> create a fixture 
<ul> 
<li>That's the job of the derived class</li> </ul></li> 
<li>Add a test 
<ul> 
<li>Each test records the state of the fixture&hellip;</li> 
<li>&hellip;does something&hellip;</li> 
<li>&hellip;and then checks that the fixture is in the right final state</li> 
<li>Remember, the fixture is recreated from scratch for each test</li> </ul>
</li> 
<li> 
<pre>class CommonTests(object): '''Tests that can be applied to all 
fixtures.''' def testAddNew(self): '''Check that adding a single new assignment 
works.''' priorConsultants = self.fixture.getConsultants() priorProjects = 
self.fixture.getProjects() self.fixture.addAssignment('Alan', 'tables') 
self.assertEqual(self.fixture.getByConsultant('Alan'), Set(['tables'])) 
self.assertEqual(self.fixture.getByProject('tables'), Set(['Alan'])) 
self.assertEqual(self.fixture.getConsultants(), Set(['Alan']) | 
priorConsultants) self.assertEqual(self.fixture.getProjects(), Set(['tables']) 
| priorProjects)</pre> </li> 
<li>Derive another class from both <code>CommonTests</code> and <code>
unittest.TestCase</code> 
<ul> 
<li>The former ensures that it inherits all the common test cases</li> 
<li>The latter ensures that the framework will find it, and know how to run it
</li> </ul></li> 
<li>This class creates a fixture, and adds a few fixture-specific tests 
<ul> 
<li> 
<pre>class TestEmpty(unittest.TestCase, CommonTests): '''Test an empty 
assignment table.''' def setUp(self): '''Create the empty assignment table.''' 
self.fixture = Assignment() def testNoConsultants(self): '''Make sure that 
nonexistent consultants aren't present.''' 
self.assertEqual(self.fixture.getByConsultant('nobody'), Set()) def 
testNoProjects(self): '''Make sure that nonexistent projects aren't present.''' 
self.assertEqual(self.fixture.getByProject('nothing'), Set())</pre> </li> </ul>
</li> 
<li>Run it 
<ul> 
<li>Framework finds <code>TestEmpty</code></li> 
<li>Goes through the test cycle (test, setup, run, teardown) for each <code>
testXYZ</code> method in it, <em>and</em> in <code>CommonTests</code></li> </ul>
</li> 
<li>Now add another shared test to <code>CommonTests</code>: 
<ul> 
<li> 
<pre> def testAddDelNew(self): '''Check that adding and then removing an 
assignment leaves things as they were.''' priorConsultants = 
self.fixture.getConsultants() priorProjects = self.fixture.getProjects() 
self.fixture.addAssignment('Alan', 'tables') self.fixture.delAssignment('Alan', 
'tables') self.assertEqual(self.fixture.getConsultants(), priorConsultants) 
self.assertEqual(self.fixture.getProjects(), priorProjects)</pre> </li> </ul>
</li> 
<li>And/or derive another test class: 
<ul> 
<li> 
<pre>class TestMulti(unittest.TestCase, CommonTests): '''Set up common tests 
with multiple assignments already present.''' def setUp(self): self.fixture = 
Assignment() self.fixture.addAssignment('Bhargan', 'dishes') 
self.fixture.addAssignment('Harald', 'dishes') 
self.fixture.addAssignment('Harald', 'floors') 
self.fixture.addAssignment('Rachel', 'floors') 
self.fixture.addAssignment('Rachel', 'counters') 
self.fixture.addAssignment('Sally', 'counters')</pre> </li> </ul></li> 
<li>Multiplicative effect: (common tests &times; derived classes) + specific 
tests</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Test-Driven Development</h2> 
<ul> 
<li>With <em>test-driven development</em> (TDD), you write your tests, then 
write the code
<ul> 
<li>A key element of agile development methodologies like eXtreme 
Programming&hellip;</li> 
<li>&hellip;but it was around long before they were&hellip;</li> 
<li>&hellip;and pays off in almost every context</li> </ul></li> 
<li>Seems backward, but has very real advantages: 
<ul> 
<li>Gives programmers a definite goal 
<ul> 
<li>Coding is finished when all tests run</li> 
<li>Particularly useful when trying to fix bugs in old code, as it forces you 
to figure out how to recreate the bug</li> 
<li>Helps prevent the &ldquo;one more feature&rdquo; syndrome</li> </ul></li> 
<li>Ensures that tests actually get written 
<ul> 
<li>People are often too tired, or too rushed, to test after coding</li> </ul>
</li> 
<li>Helps clarify the API before it is set in stone 
<ul> 
<li>If something is awkward to test, it can be redesigned before it's written
</li> </ul></li> 
<li>A great way to communicate requirements 
<ul> 
<li>I write the tests</li> 
<li>&ldquo;All&rdquo; you have to do is write code that passes those tests</li>
</ul></li> </ul></li> 
<li>Example: I want you to write a function that: 
<ul> 
<li>A single rectangle (represented as an instance of class <code>Rect</code>) 
as its first argument</li> 
<li>And a list of rectangles (each also an instance of <code>Rect</code>) as 
its second argument</li> 
<li>And returns <code>True</code> if the rectangles in the list completely 
cover the first rectangle, or<code>False</code> if they don't</li> 
<li>Best way for me to specify everything I want is to write some test cases
</li> 
<li> 
<pre>class TestOverlay(unittest.TestCase): def testNoRects(self): 
self.assert_(not overlay(Rect(0, 0, 1, 1), [])) def testWithSelf(self): r = 
Rect(0, 0, 1, 1) self.assert_(overlay(r, [r])) def testHalfOnly(self): 
self.assert_(not overlay(Rect(0, 0, 2, 2), [Rect(0, 0, 1, 2)])) def 
testTwoHalves(self): self.assert_(overlay(Rect(0, 0, 2, 2), [Rect(0, 0, 1, 2), 
Rect(1, 0, 2, 2)]))</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 13.1:</p> 
<p>Python has another unit testing module called <code>doctest</code>. It 
searches files for sections of text that look like interactive Python sessions, 
then re-executes those sections and checks the results. A typical use is shown 
below.</p> 
<pre>def ave(values): '''Calculate an average value, or 0.0 if 'values' is 
empty. &gt;&gt;&gt; ave([]) 0.0 &gt;&gt;&gt; ave([3]) 3.0 &gt;&gt;&gt; ave([15, 
-1.0]) 7.0 ''' sum = 0.0 for v in values: sum += v return sum / float(max(1, 
len(values))) if __name__ == '__main__': import doctest doctest.testmod()</pre> 
<p>Convert a handful of the tests you have written for other questions in this 
lecture to use<code>doctest</code>. Do you prefer it to <code>unittest</code>? 
Why or why not? Do you think<code>doctest</code> makes it easier to test small 
problems? Large ones? Would it be possible to write something similar for C, 
Java, Fortran, or Mathematica?</p> prev top next <br>
<br>

<h1>Automated Builds</h1> prev  Draft Version 590 next <br>
<br>

<h2>How Do You Rebuild A Program?</h2> 
<ul> 
<li>Most programming languages require you to compile programs before running 
them
<ul> 
<li>E.g., turn C source files into machine-specific <em>object files</em> 
<ul> 
<li>Which usually have a <code>.o</code> extension</li> </ul></li> </ul></li> 
<li>It's easy enough to create <code>overlap.o</code> from <code>overlap.c
</code>: just run <code>cc overlap.c</code></li> 
<li>But what if you have many source files? 
<ul> 
<li><code>cc *.c</code> is slow and inefficient if only one of your 117 source 
files has changed</li> </ul></li> 
<li>Worse, what if some files rely on others? 
<ul> 
<li>Suppose the code in <code>overlap.c</code> uses code in <code>rectangle.c
</code></li> 
<li>If you change both, but only recompile <code>overlap.c</code>, you'll be 
using out-of-date rectangles</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Automate, Automate, Automate</h2> 
<ul> 
<li>Remember rule #2: anything worth repeating is worth automating 
<ul> 
<li>Computers are good at details, and don't get bored, so have them do 
repetitive tasks</li> 
<li>We need: 
<ul> 
<li>A way to describe the tasks (what things to do)</li> 
<li>A way to specify the dependencies between them (when to do things)</li> 
</ul></li> </ul></li> 
<li>Most widely used tool for this is called <em>Make</em> 
<ul> 
<li>Invented in 1975 by Stuart Feldman at Bell Labs [Feldman 1979] </li> </ul>
</li> 
<li>The good news is that Make will: 
<ul> 
<li>Figure out what has changed</li> 
<li>Work out what is affected by those changes</li> 
<li>Execute commands to bring things up to date (e.g., by recompiling) 
<ul> 
<li>Commands are handed to the shell for execution, so they're the same ones 
you would run yourself</li> </ul></li> </ul></li> 
<li>The bad news is Make's syntax 
<ul> 
<li>Initially very simple, but has grown more complex over time</li> 
<li>Has turned into a little programming language in its own right (rule #11)
</li> 
<li>We will ignore the complex bits for now, and take a look at a better way 
to solve these problems inBackward, Forward, and Sideways</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Our Example</h2> 
<ul> 
<li>Make doesn't care what language you use</li> 
<li>In fact, it doesn't even care if you're using it to recompile things 
<ul> 
<li>Often used to run tests, keep web sites up to date, etc.</li> 
<li>Any task where one action depends on others is a good candidate</li> </ul>
</li> 
<li>Running example: Sakura Synthesis is studying organic fullerene production 
<ul> 
<li>Automated laboratory equipment runs experiments in batches to create files 
like this:</li> 
<li> 
<pre>Time: 1.2271 Concentration: 0.0050 Yield: 11.41 Time: 2.5094 
Concentration: 0.0055 Yield: 11.20 Time: 3.7440 Concentration: 0.0060 Yield: 
10.90</pre> </li> 
<li>Each experiment produces 20-30 files 
<ul> 
<li>May eventually have several thousand of them</li> </ul></li> 
<li>Want to: 
<ul> 
<li>Generate summary files showing the results for particular trials in 
tabular form</li> 
<li>Update a file showing the correlation between concentrations and yields 
based on those tabular summaries</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Hello, Make</h2> 
<ul> 
<li>Suppose we already have a program called <code>dat2csv.py</code> that 
reformats data as a table
<ul> 
<li>Use <em>comma-separated values (CSV)</em> for the table</li> </ul></li> 
<li>Put the following into a file called <code>hello.mk</code>: 
<ul> 
<li> 
<pre>hydroxyl_422.csv : hydroxyl_422.dat python dat2csv.py hydroxyl_422.dat 
&gt; hydroxyl_422.csv</pre> </li> 
<li>Note: that indentation <em>must</em> be a tab character, not eight spaces, 
or a mix of spaces and tabs
<ul> 
<li>Yeah, it's a wart, but we're stuck with it</li> </ul></li> </ul></li> 
<li>Some terminology: 
<ul> 
<li> 
<p> Figure 14.1: Structure of a Make Rule</p> <br>
<br>
</li> 
<li><code>hydroxyl_422.csv</code> is the <em>target</em> of the <em>rule</em>
</li> 
<li><code>hydroxyl_422.dat</code> is its <em>prerequisite</em> 
<ul> 
<li>We'll see in a moment that a target may have many prerequisites</li> </ul>
</li> 
<li>The compilation command is the rule's <em>action</em> 
<ul> 
<li>A rule may also have many actions</li> </ul></li> </ul></li> 
<li>Run <code>make -f hello.mk</code> 
<ul> 
<li>Make sees that the CSV file depends on the data file</li> 
<li>Since the CSV file doesn't exist, Make executes the rule's action (i.e., 
runs<code>dat2csv.py</code>)</li> </ul></li> 
<li>Run <code>make -f hello.mk</code> again 
<ul> 
<li><code>hydroxyl_422.csv</code> is newer than its prerequisite, so the 
action is<em>not</em> executed</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Multiple Targets</h2> 
<ul> 
<li>Very few programs consist of a single file 
<ul> 
<li>This Makefile describes two files that are independent of one another</li> 
<li> 
<pre>hydroxyl_422.csv : hydroxyl_422.dat python dat2csv.py hydroxyl_422.dat 
&gt; hydroxyl_422.csv methyl_422.csv : methyl_422.dat python dat2csv.py 
methyl_422.dat &gt; methyl_422.csv</pre> </li> </ul></li> 
<li>When you run <code>make -f double.mk</code>, only <code>hydroxyl_422.csv
</code> is compiled 
<ul> 
<li>The first target in the Makefile is the <em>default target</em></li> 
<li>Unless you tell it otherwise, that's all Make will update</li> </ul></li> 
<li>Run <code>make -f double.mk methyl_422.csv</code> to build <code>
methyl_422.csv</code></li> 
<li>Comment on this slide</li> </ul> 
<h2>Phony Targets</h2> 
<ul> 
<li>Obviously don't want to have to run Make separately for each possible 
target
<ul> 
<li>That would hardly count as &ldquo;automation&rdquo;</li> </ul></li> 
<li>Solution: create a <em>phony target</em> that: 
<ul> 
<li>Depends on all the things you want to recompile, but</li> 
<li>Doesn't correspond to any files, and so is never up to date 
<ul> 
<li>Making it therefore always executes its actions</li> </ul></li> 
<li> 
<pre>all : hydroxyl_422.csv methyl_422.csv hydroxyl_422.csv : hydroxyl_422.dat 
python dat2csv.py hydroxyl_422.dat &gt; hydroxyl_422.csv methyl_422.csv : 
methyl_422.dat python dat2csv.py methyl_422.dat &gt; methyl_422.csv</pre> </li> 
<li>Now, <code>make -f phony.mk all</code> recreates both <code>.csv</code> 
files</li> </ul></li> 
<li>Typical phony targets in a software project: 
<ul> 
<li><code>&quot;all&quot;</code>: recompile everything</li> 
<li><code>&quot;clean&quot;</code>: delete all temporary files, and everything 
produced by compilation</li> 
<li><code>&quot;install&quot;</code>: copy files to system directories 
<ul> 
<li>Many open source projects are installed by typing <code>make</code>, and 
then<code>make install</code></li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Automatic Variables</h2> 
<ul> 
<li>Make defines <em>automatic variables</em> to represent parts of rules 
<ul> 
<li>These variables are automatically redefined for each rule</li> 
<li>Names are unfortunately very cryptic 
<ul> 
<li>Keep a reference card handy</li> </ul></li> </ul></li> <code>&quot;$@&quot;
</code> The rule's target <br>
<code>&quot;$&lt;&quot;</code> The rule's first 
prerequisite <br>
<code>&quot;$?&quot;</code> All of the rule's out-of-date 
prerequisites <br>
<code>&quot;$^&quot;</code> All prerequisites <br>
<br>

<p> Table 14.1: Automatic Variables in Make</p> 
<li>Example 
<ul> 
<li> 
<pre>all : hydroxyl_422.csv methyl_422.csv hydroxyl_422.csv : hydroxyl_422.dat 
python dat2csv.py $&lt; &gt; $@ methyl_422.csv : methyl_422.dat python 
dat2csv.py $&lt; &gt; $@</pre> </li> 
<li>Note: by default, Make echoes actions before executing them</li> 
<li>Putting <code>&quot;@&quot;</code> at the start of the action line 
prevents this</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Pattern Rules</h2> 
<ul> 
<li>Most files of similar type (Java, C++, etc.) are compiled the same way 
<ul> 
<li>Rule #2 again: write a <em>pattern rule</em> specifying what to do in the 
general case</li> </ul></li> 
<li>Use the wildcard <code>&quot;%&quot;</code> to represent the stem of the 
file's name in the target and prerequisites
<ul> 
<li>Must use automatic variables in the actions 
<ul> 
<li>This is why they were invented</li> </ul></li> 
<li> 
<pre>all : hydroxyl_422.csv methyl_422.csv %.csv : %.dat python dat2csv.py 
$&lt; &gt; $@ clean : @rm -f *.csv</pre> </li> </ul></li> 
<li>Notice that there's another phony target in this Makefile 
<ul> 
<li><code>make -f rule.mk clean</code> will get rid of all the generated files
</li> 
<li>The <code>-f</code> flag stands for &ldquo;force&rdquo; 
<ul> 
<li>Tells <code>rm</code> not to report an error when trying to delete files 
that don't exist</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Dependencies</h2> 
<ul> 
<li>Next step: create an overall summary for each treatment 
<ul> 
<li>E.g., combine <code>hydroxyl_422.csv</code> and <code>hydroxyl_480.csv
</code> to create <code>hydroxyl_all.csv</code>, and similarly for the methyl 
files, using<code>summarize.py</code></li> </ul></li> 
<li><code>hydroxyl_all</code> must be rewritten if it is older than either 
<code>hydroxyl_422.csv</code> or <code>hydroxyl_480.csv</code> 
<ul> 
<li>Which must in turn be rewritten if they're newer than their corresponding 
<code>.dat</code> files</li> </ul></li> 
<li>In this case, also make the results depend on <code>summarize.py</code> and
<code>dat2csv.py</code> 
<ul> 
<li>If the programs change, there's a good chance the data file format has 
changed
<ul> 
<li>Or a bug has been found and fixed</li> </ul></li> </ul></li> 
<li>Updated Makefile, and its output when no CSV files exist, are: 
<ul> 
<li> 
<pre>all : hydroxyl_all.csv methyl_all.csv %_all.csv : %_422.csv %_480.csv 
summarize.py python summarize.py $^ &gt; $@ %.csv : %.dat dat2csv.py python 
dat2csv.py $&lt; &gt; $@ clean : @rm -f *.csv</pre> 
<pre>python dat2csv.py hydroxyl_422.dat &gt; hydroxyl_422.csv python 
dat2csv.py hydroxyl_480.dat &gt; hydroxyl_480.csv python summarize.py 
hydroxyl_422.csv hydroxyl_480.csv &gt; hydroxyl_all.csv python dat2csv.py 
methyl_422.dat &gt; methyl_422.csv python dat2csv.py methyl_480.dat &gt; 
methyl_480.csv python summarize.py methyl_422.csv methyl_480.csv &gt; 
methyl_all.csv rm hydroxyl_480.csv methyl_422.csv hydroxyl_422.csv 
methyl_480.csv</pre> </li> 
<li>Notice that Make automatically removes intermediate files at the end</li> 
</ul></li> 
<li>Often visualize dependencies as a <em>directed graph</em> 
<ul> 
<li>Dependencies can have dependencies, and so on</li> 
<li> 
<p> Figure 14.2: Visualizing Dependencies</p> <br>
<br>
</li> 
<li>Mark all the files that are out of date, and follow arrows to find out 
what will happen</li> 
<li>Note: Make can execute actions in any order it wants to, as long as it 
doesn't violate dependency ordering</li> </ul></li> 
<li>Notice that the rule <code>%_all.csv</code> takes precedence over the rule 
<code>%.csv</code> 
<ul> 
<li>Make uses the most specific rule available</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Defining Macros</h2> 
<ul> 
<li>Often want to define values inside a Makefile 
<ul> 
<li>E.g., the directory programs are to send their output to</li> 
<li>Or optimization flags for a compiler</li> </ul></li> 
<li>Do <em>not</em> want to set these options over and over again 
<ul> 
<li>Rule #3: anything repeated in two or more places will eventually be wrong 
in at least one</li> </ul></li> 
<li>Solution: define variables (usually called <em>macros</em>) 
<ul> 
<li>E.g., specify the directory where the lab machine puts data files:</li> 
<li> 
<pre>INPUT_DIR = /lab/gamma2100 all : hydroxyl_all.csv methyl_all.csv 
%_all.csv : %_422.csv %_480.csv python summarize.py $^ &gt; $@ %.csv : 
${INPUT_DIR}/%.dat python dat2csv.py $&lt; &gt; $@ clean : @rm -f *.csv</pre> 
</li> 
<li>Define by specifying name and value</li> 
<li>To get value, put a <code>&quot;$&quot;</code> in front of the name, <em>
and</em> parentheses or braces around it 
<ul> 
<li>Without the parentheses, Make will interpret <code>&quot;$XYZ&quot;</code> 
as the value of the variable<code>&quot;X&quot;</code>, followed by the 
characters<code>&quot;YZ&quot;</code></li> 
<li>Yes, it's ugly</li> </ul></li> </ul></li> 
<li>Sometimes useful to pass values into Make when invoking it 
<ul> 
<li>E.g., change the input directory</li> </ul></li> 
<li>Rather than rewriting the Makefile each time, you can specify <code>
name=value</code> pairs on the command line 
<ul> 
<li>Define a macro with the default value</li> 
<li>Override it when you want to</li> </ul></li> 
<li>So: 
<ul> 
<li><code>make -f macro.mk</code> sets <code>INPUT_DIR</code> to <code>
/lab/gamma2100</code></li> 
<li>But <code>make INPUT_DIR=/oldcrankymachine -f macro.mk</code> uses <code>
/oldcrankymachine</code></li> </ul></li> 
<li>Make also looks at environment variables 
<ul> 
<li>You can refer to <code>${HOME}</code> in a Makefile without having defined 
it</li> 
<li>Example: 
<ul> 
<li> 
<pre>VAL = original echo : @echo &quot;VAL is&quot; ${VAL} </pre> </li> 
<li> 
<pre>$ make -f env.mk echo </pre> </li> 
<li> 
<pre>VAL is original </pre> </li> 
<li> 
<pre>$ make -f env.mk VAR=changed echo </pre> </li> 
<li> 
<pre>VAL is changed </pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Analysis</h2> 
<ul> 
<li>Pro 
<ul> 
<li>Simple things are simple to do&hellip;</li> 
<li>&hellip;and not too difficult to read&hellip;</li> 
<li>&hellip;especially compared to the alternatives</li> </ul></li> 
<li>Con 
<ul> 
<li>The syntax is unpleasant</li> 
<li>Complex things are difficult to read&hellip;</li> 
<li>&hellip;and even more difficult to debug 
<ul> 
<li>Best you can do is use <code>echo</code> to print things as Make executes
</li> </ul></li> 
<li>Not really very portable 
<ul> 
<li>Hands commands to the shell for execution</li> 
<li>But commands use different flags on different operating systems</li> 
<li>Do you use <code>del</code> or <code>rm</code> to delete files?</li> </ul>
</li> </ul></li> 
<li>Alternatives 
<ul> 
<li>Ant 
<ul> 
<li>primarily for Java</li> 
<li>Less platform-dependent&hellip;</li> 
<li>&hellip;but just as hard to read and debug</li> </ul></li> 
<li>Integrated development environments 
<ul> 
<li>Most are proprietary and platform-specific</li> </ul></li> 
<li>SCons 
<ul> 
<li>Give users a library to manage dependencies and actions</li> 
<li>&ldquo;Makefile&rdquo; is actually a small program</li> 
<li>More powerful, and debuggable, but steeper learning curve</li> </ul></li> 
</ul></li> 
<li>Once builds are automated, the next step is to run them continuously 
<ul> 
<li>Every time someone checks something into version control, rebuild the 
software (or site), and re-run tests</li> 
<li><code>CruiseControl</code> and <code>Bitten</code> will both handle the 
details</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 14.1:</p> 
<p>How can you stop Make from removing intermediate files automatically when 
it finishes processing?</p> 
<p>Exercise 14.2:</p> 
<p>Make gets definitions from environment variables, command-line parameters, 
and explicit definitions in Makefiles. What order does it check these in?</p> 
prev top next <br>
<br>

<h1>Coding Style and Reading Code</h1> prev  Draft Version 574 next <br>
<br>

<h2>Introduction</h2> 
<ul> 
<li>Good programming style is very hard to teach 
<ul> 
<li>All the &ldquo;rules&rdquo; are either banal or overly restrictive 
<ul> 
<li>Saying, &ldquo;Make methods short, but not too short&rdquo; doesn't really 
help</li> 
<li>Neither does saying, &ldquo;No method shall be longer than sixty 
lines&rdquo;</li> </ul></li> 
<li>Matters aren't helped by the fact that the strength of programmers' 
opinions is inversely proportional to the amount of data they have</li> </ul>
</li> 
<li>But good style is tremendously important 
<ul> 
<li>Well-written code is less likely to contain errors</li> 
<li>And is much easier to maintain</li> </ul></li> 
<li>Rather than teaching you how to write well, this lecture will focus on how 
to<em>read</em> code 
<ul> 
<li>How to figure out how the code works</li> 
<li>How to find what you need to know before making a change</li> </ul></li> 
<li>Hope that you'll pick up ideas about good style along the way</li> 
<li>For a comprehensive guide to how open source Unix applications are (or 
should be) structured, try [Spinellis 2003] </li> 
<li>Comment on this slide</li> </ul> 
<h2>Why Read Code?</h2> 
<ul> 
<li>People doing creative work in almost every field routinely inspect, 
dissect, and critique what's come before
<ul> 
<li>Would you hire an architect who'd never looked at anyone else's buildings?
</li> </ul></li> 
<li>Programming is a sad exception 
<ul> 
<li>Most students only ever read one- or two-page fragments in textbooks</li> 
<li>Like reading sonnets, then being asked to write a novel</li> </ul></li> 
<li>Open source has made millions of lines of code available for inspection 
<ul> 
<li>Some good, some bad, most average</li> </ul></li> 
<li>Knowing how to read code is as useful as knowing how to read a proof 
<ul> 
<li>Learn by example how to accomplish specific things</li> 
<li>Figure out how to make changes in a particular program</li> 
<li>Figure out how to use the program</li> 
<li><em>Code inspections</em> are essential for achieving and maintaining 
quality</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Seven Plus or Minus</h2> 
<ul> 
<li>Known since the 1950s that human short term memory can hold 7&plusmn;2 
items [Hock 2004] 
<ul> 
<li>Seven random digits (as in phone numbers)</li> 
<li>Seven tasks that still have to be done</li> 
<li>Note: this is just an average 
<ul> 
<li>Some prodigies can remember thousands of pieces of information for short 
periods of time</li> </ul></li> </ul></li> 
<li>If we try to remember more than that, we either: 
<ul> 
<li>Make mistakes, or</li> 
<li>Create <em>chunks</em> so that we can remember things at a higher level 
<ul> 
<li>Musicians don't remember individual chords; they remember IV-V-I 
progression</li> 
<li>Chess players remember &ldquo;castled kingside&rdquo;, rather than the 
positions of five pieces</li> 
<li> 
<p> Figure 15.1: Chunking in Short-Term Memory</p> <br>
<br>
</li> </ul></li> 
<li> [Chase &amp; Simon 1973] studied what happened when novice and master 
chess players are shown actual and random positions
<ul> 
<li>Masters (naturally) remember actual positions better</li> 
<li>But they remember random positions <em>worse</em></li> 
<li>They're &ldquo;seeing&rdquo; patterns that aren't there</li> </ul></li> 
<li> 
<p> Figure 15.2: Actual Chess Position</p> <br>
<br>

<p> Figure 15.3: Retention of Actual Chess Position</p> <br>
<br>
<br>
<br>

</li> 
<li> 
<p> Figure 15.4: Random Chess Position</p> <br>
<br>

<p> Figure 15.5: Retention of Random Chess Position</p> <br>
<br>
<br>
<br>

</li> </ul></li> 
<li>What does this have to do with programming? 
<ul> 
<li>When you are reading and writing code, you have to keep a bunch of facts 
straight in your head for a short period of time
<ul> 
<li>What is this function supposed to return?</li> 
<li>What parameters does it have, and what do they mean?</li> 
<li>What does this loop's index refer to?</li> 
<li>Etc.</li> </ul></li> 
<li>The more odds and ends you require readers (including yourself) to keep 
track of, the greater their error rates will be
<ul> 
<li>Fundamental rule of good programming style is therefore to limit the 
amount of information needed at any one time</li> </ul></li> 
<li>Note that a hundred one-line methods is not an improvement over one 
hundred-line method</li> </ul></li> 
<li>A related rule: the greater the difference, the more likely we are to 
notice it
<ul> 
<li>So every difference in naming and layout ought to mean something&hellip;
</li> 
<li>&hellip;because readers' brains will assume that it does</li> 
<li>Conversely, every significant difference ought to be visually distinct</li>
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What Does This Function Do?</h2> 
<ul> 
<li>Start with a simple question: how to figure out what this code does? 
<ul> 
<li> 
<pre># Fill in citations. def bibRef(root, bibOutput, bibInfo): cites = 
root.getElementsByTagName('cite') for cite in cites: ref = 
str(cite.getAttribute('ref')) if (not ref) or (ref not in bibInfo): print 
&quot;Cannot satisfy '%s'&quot; % ref assert False cite.setAttribute('display', 
bibInfo[ref]) cite.setAttribute('href', '%s#%s' % (bibOutput, ref))</pre> </li> 
</ul></li> 
<li>First question: what's the context? 
<ul> 
<li>In this case, it's part of a program to fill in citations</li> 
<li><code>&lt;cite ref=&quot;castro-xml&quot;/&gt;</code> becomes <code>
&lt;cite display=&quot;Castro 2002&quot; href=&quot;bib.html#castro-xml&quot; 
ref=&quot;castro-xml&quot;/&gt;</code></li> </ul></li> 
<li>Ways to answer the question: 
<ul> 
<li>Guess based on function name 
<ul> 
<li>Assume <code>bibRef</code> stands for &ldquo;bibliographic reference&rdquo;
</li> 
<li>But it isn't a particularly informative name</li> </ul></li> 
<li>Read embedded documentation (such as comments) 
<ul> 
<li>&ldquo;Fill in citations.&rdquo; is more helpful than <code>bibRef</code>
</li> 
<li>Still doesn't tell us what <code>root</code>, <code>bibOutput</code>, and 
<code>bibInfo</code> are</li> 
<li>Or what side effects (if any) this function has</li> </ul></li> 
<li>Read the function body 
<ul> 
<li>For each citation element in <code>body</code>&hellip;</li> 
<li>&hellip;get the value of the element's <code>ref</code> attribute&hellip;
</li> 
<li>&hellip;make sure it's in <code>bibInfo</code> (presumably a 
dictionary)&hellip;</li> 
<li>&hellip;set the citation's <code>display</code> and <code>href</code> 
attributes</li> 
<li>Hm&hellip;that means <code>bibOutput</code> must be the name of the output 
file</li> 
<li>Notice how the explanation creates larger chunks from raws lines of code
</li> </ul></li> 
<li>Consult external documentation 
<ul> 
<li>In this case, there doesn't appear to be any</li> </ul></li> 
<li>Examine call(s) to the function 
<ul> 
<li>First job is to find it (or them)</li> 
<li><code>grep bibRef expandrefcite.py</code> finds exactly one call</li> 
<li> 
<pre> # Substitute information. for filename in args: filename, _, _, root = 
getFile(filename) genTime(root) crossRef(root, xrefInfo) bibRef(root, 
bibOutput, bibInfo) outfile = open(filename, 'w') 
outfile.write(root.toxml('utf-8')) outfile.close()</pre> </li> 
<li>Looking higher up, see that <code>bibOutput</code> is initialized to <code>
bib.html</code>, so our guess was pretty good</li> </ul></li> </ul></li> 
<li>You use these techniques (consciously or otherwise) whenever you are 
reading code
<ul> 
<li>The purpose of good style is to improve the odds of them working</li> </ul>
</li> 
<li>A good way to think about size and scope is the notion of a <em>program 
slice</em> 
<ul> 
<li>The subset of names in scope at a particular statement that are needed to 
understand what that statement does</li> 
<li>If the slice is much smaller than the method itself, the method is 
probably bloated</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Naming</h2> 
<ul> 
<li>Names of files, classes, methods, variables, and other things are the most 
visible clue to purpose
<ul> 
<li>A variable called <code>temperature</code> probably doesn't store a user 
name or the number of pottery shards found at a dig site</li> </ul></li> 
<li>Should therefore choose names that are both <em>meaningful</em> and <em>
readable</em> 
<ul> 
<li><code>current_surface_temperature_of_probe</code> is meaningful, but not 
readable</li> 
<li><code>cstp</code> is easier to read, but hard to understand</li> </ul></li>
<li>The smaller the scope of a name, the more compact it can be 
<ul> 
<li>It's OK to use <code>i</code> and <code>j</code> for indices in 
tightly-nested<code>for</code> loops</li> 
<li>But <em>not</em> OK if the loop bodies are several pages long 
<ul> 
<li>Of course, they shouldn't be anyway&hellip;</li> </ul></li> </ul></li> 
<li>The wider the scope of a name, the more descriptive it has to be 
<ul> 
<li>Call a class <code>ExperimentalRecord</code>, rather than <code>ER</code> 
or<code>ExpRec</code></li> </ul></li> 
<li>Compare: 
<ul> 
<li> Before After <br>

<pre>import reader,splitter,transpose import sys,os a=[] b=[] c=[] 
d=sys.argv[1] a=reader.readLinesFromFile(d) b=splitter.splitIntoSections(a) 
c=d.split('.') for i in range(len(b)): if 
os.path.isfile('%s.%d.dat'%(c[0],i+1)): print '%s.%d.dat already exists and 
cannot be overwritten!'%(c[0],i+1) break else: 
output=file('%s.%d.dat'%(c[0],i+1),'w') 
print&gt;&gt;output,transpose.transpose(b[i]) output.close()</pre> 
<pre>import sys, os import reader, splitter, transpose inputFileName = 
sys.argv[1] lines = reader.readLinesFromFile(inputFileName) sections = 
splitter.splitIntoSections(lines) fileNameStem = inputFileName.split('.')[0] 
for i in range(len(sections)): outputFileName = '%s.%d.dat' % (fileNameStem, 
i+1) if os.path.isfile(outputFileName): print '%s already exists and cannot be 
overwritten!' % outputFileName break else: output = file(outputFileName, 'w') 
print &gt;&gt; output, transpose.transpose(sections[i]) output.close()</pre> 
<br> <br>
</li> </ul></li> 
<li>Use naming conventions to indicate purpose 
<ul> 
<li>Constants written <code>ALL_UPPER_CASE_WITH_UNDERSCORES</code></li> 
<li>Class names written using <code>CamelCase</code> with first letter 
capitalized
<ul> 
<li>Name &ldquo;camel case&rdquo; comes from the humps in the middle</li> </ul>
</li> 
<li>Parameters, methods, local variables, etc., use <code>camelCase</code> 
with first letter in lower case</li> </ul></li> 
<li>Many other conventions make just as much sense 
<ul> 
<li>Write parameters, etc., using underscores, as in <code>current_maximum
</code></li> 
<li>Write class members like <code>this_</code>, <code>_this</code>, or <code>
m_this</code> 
<ul> 
<li>Not as useful in Python, where you have to refer to members as <code>
self.this</code> anyway</li> 
<li>But useful in C++, Java, and other languages</li> </ul></li> 
<li>Use an agreed list of abbrevations 
<ul> 
<li><code>currAveTemp</code> instead of <code>currentAverageTemperature</code>
</li> 
<li>&ldquo;Agreed&rdquo; is important: mixing <code>currAvTemp</code> and 
<code>currAveTemp</code> produces hard-to-spot bugs</li> </ul></li> </ul></li> 
<li>Most important thing is to <em>be consistent</em> 
<ul> 
<li>Anything consistent is readable after a while 
<ul> 
<li>Just watch kids learning to read French, Punjabi, and Korean</li> </ul>
</li> 
<li>But your brain automatically notices visual differences, and assumes 
they're important</li> 
<li>It actually does take longer to read code written in a mix of 
styles&hellip;</li> 
<li>&hellip;and the error rate is higher</li> </ul></li> 
<li>Conform to <code>PEP-008: Python Style Guide</code> unless you have a 
really good reason not to</li> 
<li>Comment on this slide</li> </ul> 
<h2>Idioms</h2> 
<ul> 
<li>Every language (human or computer) has <em>idioms</em> 
<ul> 
<li>Sayings or phrases whose meaning does not follow from the meaning of the 
words it is made up of
<ul> 
<li>E.g., &ldquo;face the music&rdquo; does not mean &ldquo;look at the 
orchestra&rdquo;</li> </ul></li> 
<li>A way to aggregate raw data into chunks</li> </ul></li> 
<li>As you read programs, look for uses of common idioms 
<ul> 
<li>Example: C/C++ and Java allow assignment in the middle of an expression 
<ul> 
<li><code>z = (y = x) + 2</code> assigns the value of <code>x</code> to <code>y
</code>, then adds 2 to that and assigns it to <code>z</code></li> </ul></li> 
<li>No one would (or should) ever use it in the manner show above, but it 
makes certain kinds of loops more compact
<ul> 
<li> Without Idiom Using Idiom <br>

<pre>line = infile.readLine(); while (line != null) { ...do something with 
line... line = infile.readLine(); }</pre> 
<pre>while ((line = infile.readLine()) != null) { ...do something with line... 
}</pre> <br>
<br>
</li> 
<li>Assign next line (if any) to <code>text</code>, then check for end of 
input, all in the top of the loop</li> </ul></li> 
<li>This can be even more compact in C and C++, which treat null as equivalent 
to false
<ul> 
<li> 
<pre>while (line = infile.readLine()) { ...do something with line... } </pre> 
</li> </ul></li> 
<li>But Python doesn't allow assignment in the middle of expressions 
<ul> 
<li>And in older versions, you couldn't iterate directly over a file using 
<code>for line in input:</code></li> 
<li>Solution was an idiom that looked like an infinite loop, but had a <code>
break</code> statement in it to handle end-of-input</li> 
<li> 
<pre>while 1: line = infile.readline() if not line: break ...do something with 
line...</pre> </li> 
<li>Note: using 1 instead of <code>True</code>, since older Pythons didn't 
define<code>True</code> either</li> </ul></li> 
<li>You can figure out what the code is doing even if you don't know the 
idiom&hellip;
<ul> 
<li>&hellip;but knowing the idiom makes it a lot simpler for your brain to 
chunk what it's reading</li> </ul></li> </ul></li> 
<li>Style guideline: use your language's idioms 
<ul> 
<li>If everyone else writes their code a certain way, write yours that way too 
<ul> 
<li>I never liked Python's <code>while 1: break</code> idiom, but I used it
</li> </ul></li> 
<li>Two ways to learn idioms: 
<ul> 
<li>Books on programming style (e.g., the &ldquo;Effective&rdquo; series from 
Addison-Wesley)</li> 
<li>Reading other people's code</li> </ul></li> </ul></li> 
<li>Note: idioms evolve over time 
<ul> 
<li>Languages gain new features, programmers learn new tricks, etc.</li> 
<li>People who have grown up with Java tend to write cleaner C than people who 
learned it as a first language</li> 
<li>So when reading code, prefer the style of newer code over that of older 
stuff</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Style Tools</h2> 
<ul> 
<li>A growing number of tools exist to check and enforce style guidelines 
<ul> 
<li>Look for things that the language spec and compilers allow, but which make 
code harder to read</li> </ul></li> 
<li><code>PyLint</code> 
<ul> 
<li>Parses programs to create an <em>annotated syntax tree</em> 
<ul> 
<li>A data structure that represents classes, loops, variables, etc.</li> 
<li> 
<p> Figure 15.6: Annotated Syntax Tree</p> <br>
<br>
</li> </ul></li> 
<li>Then searches the tree to find things that match problem patterns 
<ul> 
<li>Each pattern implemented as a class that looks for certain things in the 
tree</li> 
<li>Which means that users can write new checkers if they want to</li> </ul>
</li> 
<li> 
<pre>class Metal: name = &quot;aluminum&quot; def __init__(self): self.name = 
arg def meth(self, val): self.v = val</pre> </li> 
<li> 
<pre>pylint badcode.py </pre> 
<pre>************* Module badcode W: 8: Bad indentation. Found 6 spaces, 
expected 8 W: 0: Missing docstring W: 0: Missing required attribute 
&quot;__revision__&quot; W: 1:Metal: Missing docstring E: 5:Metal.__init__: 
Undefined variable 'arg' W: 7:Metal.meth: Missing docstring R: 1:Metal: Not 
enough public methods (1/2) W: 8:Metal.meth: Attribute 'v' defined outside 
__init__</pre> </li> </ul></li> 
<li><code>PyChecker</code> 
<ul> 
<li>Imports the module (or modules) 
<ul> 
<li>If the code doesn't run, <code>PyChecker</code> can't analyze it</li> </ul>
</li> 
<li>Uses compiled byte codes as well as source when doing analysis</li> 
<li> 
<pre>pychecker badcode.py </pre> 
<pre> Warnings... badcode.py:5: No global (arg) found </pre> </li> </ul></li> 
<li>Similar tools exist for [name of your language goes here] 
<ul> 
<li>Most check for much more than just indentation and naming conventions</li> 
<li>Can also find: 
<ul> 
<li><em>Dead code</em> (i.e., variables and methods that are never used)</li> 
<li>Unhandled exceptions</li> 
<li>Duplicate code</li> 
<li>And much more</li> </ul></li> </ul></li> 
<li>Use them during development 
<ul> 
<li>Don't check anything into version control unless it passes a style check
</li> 
<li>Take their warnings very seriously when debugging 
<ul> 
<li>If someone was sloppy enough to make style mistakes, they probably made 
more serious mistakes as well</li> </ul></li> </ul></li> 
<li>Use them when reading code 
<ul> 
<li>Many tools can reformat code so that it obeys style guidelines 
<ul> 
<li>Sometimes called <em>pretty-printers</em></li> </ul></li> 
<li>Do <em>not</em> reformat code just because you can 
<ul> 
<li>Makes it difficult to track and merge changes in version control</li> </ul>
</li> 
<li>But reformatting a copy to make it easier to read can save you headaches
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What About Documentation?</h2> 
<ul> 
<li>In an ideal world, all code would be accurately documented 
<ul> 
<li>And the Beatles would still be performing as a group&hellip;</li> </ul>
</li> 
<li>In this world, documentation is often missing 
<ul> 
<li>Or worse, it may have been up to date three years ago, but no longer 
describes the software correctly</li> </ul></li> 
<li>Many kinds of documentation are useful 
<ul> 
<li>Embedded in code to explain tricky bits 
<ul> 
<li>&ldquo;This is a while loop, instead of a for, because it may delete items 
from the list as it goes&rdquo;</li> </ul></li> 
<li>Associated with class/method headers to explain what they're for 
<ul> 
<li>Documentation for a library</li> 
<li>&ldquo;This function returns the first pair of non-overlapping 
subsequences that match the input pattern, or null otherwise&rdquo;</li> </ul>
</li> 
<li>Architectural descriptions 
<ul> 
<li>The architecture of a program is what you draw on the whiteboard when 
explaining its internals to other people</li> 
<li>May show relationships between classes, major modules, data flow, etc.</li>
<li>Often the most important documentation of all, since it's what gives other 
programmers a mental map of how everything fits together</li> </ul></li> 
<li>Requirements 
<ul> 
<li>Description of what needs the software is supposed to meet</li> 
<li>&ldquo;If more than 100 events arrive in a second, the seismograph 
interface must store them in a queue&ldquo; tells you to look for a seismograph 
interface, and a queue that feeds it data</li> </ul></li> 
<li>User guide 
<ul> 
<li>As above, knowing what the software is supposed to do often helps figure 
out how it works</li> </ul></li> </ul></li> 
<li>It's increasingly fashionable to embed some documentation in code, then 
extract and format it
<ul> 
<li>Javadoc (for Java) translates specially-formatted comments into HTML 
<ul> 
<li> Java HTML <br>

<pre>/** * Returns the least common ancestor of two species based on DNA * 
comparison, with certainty no less than the specified threshold. * Note that 
getConcestor(X, X, t) returns X for any threshold. * * @param left one of the 
base species for the search * @param right the other base species for the 
search * @param threshold the degree of certainty required * @return the common 
ancestor, or null if none is found * @see Species */ public Species 
getConcestor(Species left, Species right, float threshold) { 
...implementation... }</pre> 
<pre>&lt;p&gt;&lt;strong&gt;getConcestor&lt;/strong&gt;&lt;/p&gt; 
&lt;p&gt;&lt;code&gt;public&amp;nbsp;Species&amp;nbsp;getConcestor(Species&amp;nbsp;left,&amp;nbsp;Species&amp;nbsp;right,&amp;nbsp;float&amp;nbsp;threshold)&lt;/code&gt;&lt;/p&gt; 
&lt;blockquote&gt; &lt;p&gt;Returns the least common ancestor of two species 
based on DNA comparison, with certainty no less than the specified threshold. 
Note that getConcestor(X, X, t) returns X for any threshold.&lt;/p&gt; 
&lt;p&gt;&lt;strong&gt;Parameters:&lt;/strong&gt;&lt;/p&gt; &lt;blockquote&gt; 
&lt;p&gt;&lt;code&gt;left&lt;/code&gt; - one of the base species for the search 
&lt;p&gt;&lt;code&gt;right&lt;/code&gt; - the other base species for the search 
&lt;p&gt;&lt;code&gt;threshold&lt;/code&gt; - the degree of certainty required 
&lt;/blockquote&gt; &lt;p&gt;&lt;strong&gt;Parameters:&lt;/strong&gt;&lt;/p&gt; 
&lt;blockquote&gt; &lt;p&gt;the common ancestor, or null if none is 
found&lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;&lt;strong&gt;See 
Also:&lt;/strong&gt;&lt;/p&gt; &lt;blockquote&gt; 
&lt;p&gt;&lt;code&gt;Image&lt;/code&gt;&lt;/p&gt; &lt;/blockquote&gt; 
&lt;/blockquote&gt;</pre> <br>
<br>
</li> </ul></li> 
<li>Python's <code>PyDoc</code> module does similar things</li> </ul></li> 
<li>Embedded documentation is more likely to be up to date than external 
documentation
<ul> 
<li>It's right in front of programmers as they make changes</li> 
<li>Although that's no guarantee&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Traceability</h2> 
<ul> 
<li>Reproducibility is one of the things that makes science science 
<ul> 
<li>Anyone can (at least in principle) repeat your experiment to verify your 
results</li> </ul></li> 
<li><em>Traceability</em> is a key part of this in computational science 
<ul> 
<li>What program(s) did you use?</li> 
<li>Where did your data come from, and what did you do to it?</li> </ul></li> 
<li>Always include version control information in source files 
<ul> 
<li>Subversion can be told to look for strings like <code>$Revision: 421$
</code> when you submit changes, and replace the text after the colon with the 
appropriate information</li> 
<li>Allows the file to carry its identity with it when it's printed, archived, 
or emailed</li> 
<li>Usually put the keyword inside a string, so that version information is 
available inside the program</li> 
<li> 
<pre>__version__ = &quot;$Revision: 423 $&quot; if __name__ == '__main__': 
print __version__</pre> </li> </ul></li> 
<li>Data files are source files too! 
<ul> 
<li>Every original data file should go under version control, and have 
revision information stored in it
<ul> 
<li>Can record author and date of last change as well as version number</li> 
</ul></li> 
<li>Carry this information through when processing files 
<ul> 
<li>E.g., input file <code>biomes.dat</code> has a header <code>$Revision: 421$
</code></li> 
<li>Is processed by version 37 of <code>ecoanalyzer.py</code></li> 
<li>So include the following header (as comments) in the output file:</li> 
<li> 
<pre># $Revision: $ # From: biomes.dat version 421 # By: ecoanalyzer.py 
version 37 # On: 2005-09-22 12:14:07 EST</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Executable Documentation</h2> 
<ul> 
<li>Also increasingly fashionable to talk about <em>executable documentation
</em> 
<ul> 
<li>Things that describe the program in ways that the computer can check</li> 
</ul></li> 
<li>Assertions 
<ul> 
<li>Assertions at the top of a method are usually checking pre-conditions that 
must be true for the method to run properly</li> 
<li>Those at the bottom are guarantees of what will be true after the method 
has run
<ul> 
<li>Unless there are <code>return</code> statements embedded in the middle of 
the method&hellip;</li> 
<li>&hellip;which is another reason they're a bad idea</li> </ul></li> 
<li>Assertions in the middle of methods are usually checking: 
<ul> 
<li>Invariants (i.e., number of items in the <code>searched</code> list, plus 
the number in the<code>toSearch</code> list, stays constant)</li> 
<li>Old bugs: common to introduce assertions while debugging, then leave them 
in to detect the bug's reappearance</li> </ul></li> 
<li>When reading code, assertions let you compare your current understanding 
of the code with what it actually does
<ul> 
<li>If you see <code>assert x &lt; y</code>, and you don't know why <code>x
</code> has to be less than <code>y</code> at that point, you've lost track</li>
</ul></li> 
<li>So when writing code, add assertions: 
<ul> 
<li>To detect errors and mis-use early</li> 
<li>To help the next person understand how the code is supposed to behave</li> 
</ul></li> </ul></li> 
<li>Tests 
<ul> 
<li>Each test is really just a super-assertion 
<ul> 
<li>Each test that's up to date and runs correctly, that is</li> </ul></li> 
<li>They are <em>not</em> a substitute for documentation 
<ul> 
<li>Which is easier to read, <em>23</em> test cases, or one sentence 
explaining the relationship between a method's three Boolean input parameters?
</li> </ul></li> 
<li>But they <em>are</em> a definitive answer in cases of ambiguity</li> 
<li>When writing, use test-driven development to ensure that tests exist, and 
are kept up to date as code changes</li> 
<li>When reading, look for tests that use the classes or functions you're 
interested in, and make sure you understand why the given input produces the 
checked-for output</li> </ul></li> 
<li>Build 
<ul> 
<li>Every medium to large project has infrastructure to compile source files, 
create installers, run tests, etc.
<ul> 
<li>Make, Ant, SCons, etc.</li> </ul></li> 
<li>Knowing how the software is built can tell you a lot about what to look for
<ul> 
<li>Entire directories of source code may be ignored depending on the 
operating system you're on</li> 
<li>Different modules may be used depending on whether it's the Lite or 
Professional version</li> </ul></li> 
<li>Build control files are notoriously difficult to read 
<ul> 
<li>Often easier to perform a build, and look at its output to see what files 
are involved, what flags are used, etc.</li> </ul></li> 
<li>When writing code, try to keep the build as simple as possible 
<ul> 
<li>If any parts of the software are only conditionally included, make the 
conditions very prominent</li> 
<li>If you're linking non-standard libraries, make sure they're flagged too
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Active Reading</h2> 
<ul> 
<li>Sometimes, the only way to understand a piece of code is to get your hands 
dirty
<ul> 
<li>Logging</li> 
<li>Running in a debugger</li> 
<li>Dynamic code inspection tools</li> </ul></li> 
<li>Most languages have <em>logging</em> libraries that let programmers 
control debugging output
<ul> 
<li>Typical call is <code>log(&quot;GRID&quot;, LOG_DEBUG, &quot;Refining a %d 
X %d grid&quot;, dimX, dimY)</code></li> 
<li>First argument specifies topic (sometimes called &ldquo;channel&rdquo;) 
<ul> 
<li>Allows readers to filter messages (e.g., select only those related to grid 
updates)</li> </ul></li> 
<li>Second specifies level: only print message if user has asked for that much 
detail
<ul> 
<li> Level Meaning <br>
DEBUG Debugging output (of interest to programmers 
only) <br>
INFO Normal operations (e.g., a user logging in) <br>
WARN Something 
that requires an administrator's attention (e.g., a user is out of disk space) 
<br> ERROR Something wrong with the program that it can recover from (e.g., 
unable to open its own configuration file) <br>
CRITICAL System about to crash, 
missiles about to launch, yet another bad 1970s TV show being turned into a 
movie <br>
<br>

<p> Table 15.1: Typical Logging Levels</p> </li> </ul></li> 
<li>At start of program, specify where to send logging output 
<ul> 
<li>To screen</li> 
<li>To a file</li> 
<li>To a file that &ldquo;rolls over&rdquo; when it reaches a certain size</li>
<li>To a database</li> 
<li>Through a socket to a collector on some other machine</li> 
<li>Etc.</li> </ul></li> 
<li>When writing code, add logging statements to record important events 
<ul> 
<li>Set to &ldquo;no output&rdquo; by default to avoid annoying users</li> 
<li>When program starts to behave strangely, have users turn on logging and 
send you the trace</li> </ul></li> 
<li>Encourages cleaner coding 
<ul> 
<li>If there's no point at which you can print, &ldquo;Rotation 
complete&rdquo;, it'll be hard for readers to figure out which code is 
responsible for doing rotations</li> </ul></li> </ul></li> 
<li>Debuggers aren't just for finding bugs 
<ul> 
<li>Stepping through code is often the easiest way to figure out how it works 
<ul> 
<li>First pass: step over functions, rather than into them</li> 
<li>Then re-run, and dig down to the next level of detail</li> </ul></li> 
<li>Hardest part is often figuring out where to start 
<ul> 
<li>Depends on the architecture</li> 
<li>Command-line applications: start with <code>main</code> (or, in Python, 
<code>__name__ == '__main__'</code>)</li> 
<li>If the code plugs into a larger framework, set breakpoints on key methods, 
then examine the call stack to see how you got there</li> </ul></li> 
<li>Some debuggers are more graphical than others 
<ul> 
<li>Data Display Debugger (DDD) can draw box-and-arrow diagrams of data 
structures</li> 
<li> 
<p> Figure 15.7: Data Display Debugger (Courtesy of Andreas Zeller, The DDD 
Manual)</p> <br>
<br>
</li> </ul></li> </ul></li> 
<li>Integrated Development Environments 
<ul> 
<li>A good IDE is more than just a fancy editor and a symbolic debugger</li> 
<li>Good ones (like Eclipse) also include <em>code browsers</em> 
<ul> 
<li>Keep track of where classes, methods, and variables are defined</li> 
<li>Single click to jump from a variable to its definition, then to the 
definition of its class</li> 
<li>Another click to search for variables of a certain class (or its 
subclasses)</li> 
<li>And much, much more</li> </ul></li> 
<li>Similar tools available for old-fashioned text editors 
<ul> 
<li>Ctags parses source files and produces a database of the definitions they 
contain</li> 
<li>Single editor command jumps from use to definition</li> 
<li>Currently works for over 30 languages</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>The most efficient way to read code is almost always to: 
<ul> 
<li>Print it out 
<ul> 
<li>Paper has 4-10 times the resolution of even the best screen</li> </ul></li>
<li>Sit somewhere comfortable 
<ul> 
<li><em>Away</em> from email, the web, your pager, and other distractions</li> 
</ul></li> 
<li>Find an entry point (like <code>main</code>)</li> 
<li>Trace execution from there, skipping over stuff that looks straightforward 
<ul> 
<li>E.g., argument parsing and file I/O</li> </ul></li> 
<li>Put a question mark beside everything that doesn't immediately make sense
</li> 
<li>Once you're done, go back and try to answer your questions</li> </ul></li> 
<li>This also happens to be a good way to do a <em>code review</em> 
<ul> 
<li>Read a colleague's code in order to: 
<ul> 
<li>Find bugs</li> 
<li>Make sure she is following style guidelines</li> 
<li>Make sure she implemented what you asked for</li> </ul></li> 
<li>Code reviews are a more effective way to find bugs than running ad hoc 
tests
<ul> 
<li>Which is yet another good reason to learn how to read code</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Watching Programs Run</h1> prev  Draft Version 462 next <br>
<br>

<h2>Turing's Great Insight</h2> 
<ul> 
<li>Alan Turing's great insight was that programs are just another kind of data
<ul> 
<li>Source code is text that can be parsed line by line, using regular 
expressions, etc.</li> 
<li>Compiled programs are just bytes in memory</li> </ul></li> 
<li><em>Reflection</em> is the ability of software to examine itself as it runs
<ul> 
<li>What methods does this class contain?</li> 
<li>What lines of code have been executed?</li> 
<li>How much time is being spent executing each line of code?</li> </ul></li> 
<li>It may sound very abstract, but: 
<ul> 
<li>Every modern programming language provides it (to some extent)</li> 
<li>Many important tools rely on it</li> 
<li>A growing number of applications use it to make themselves more modular 
and easier to extend</li> </ul></li> 
<li>Will briefly describe features of other languages in order to explain 
things
<ul> 
<li>Trust me, it's not as scary as it first appears</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Faking Objects</h2> 
<ul> 
<li>If Python didn't have objects and classes, you could fake them using its 
other features
<ul> 
<li>Seeing how will give you a clearer picture of how Python's own objects work
</li> </ul></li> 
<li>Use a dictionary to store an object's members 
<ul> 
<li>Including its methods&hellip;</li> 
<li>&hellip;which are just functions that take the object as their first 
argument</li> 
<li>So for each class, write a function that creates such a dictionary</li> 
<li> 
<pre>def makeRect(x0, y0, x1, y1): '''Construct a rectangle 'object'.''' 
return {'x0' : x0, 'y0' : y0, 'x1' : x1, 'y1' : y1, 'area' : rectArea, 
'contains' : rectContains, 'str' : rectStr }</pre> </li> </ul></li> 
<li>Now write the &ldquo;methods&rdquo; 
<ul> 
<li>Remember, each one will be passed the object as its first argument</li> 
<li> 
<pre>def rectArea(obj): '''Calculate area of rectangle.''' return (obj['x1'] - 
obj['x0']) * (obj['y1'] - obj['y0']) def rectContains(obj, x, y): '''See if a 
rectangle contains an XY point.''' return (obj['x0'] &lt;= x &lt;= obj['x1']) 
and \ (obj['y0'] &lt;= y &lt;= obj['y1']) def rectStr(obj): '''Show as 
string.''' return '[%(x0)d,%(y0)d X %(x1)d,%(y1)d]' % obj</pre> </li> </ul></li>
<li>Write a function to run an arbitrary method 
<ul> 
<li>Look for it in the object's dictionary</li> 
<li>Pass it the object, and any other parameters given by the user</li> 
<li>Hand the result back to the original caller</li> 
<li> 
<pre>def run(obj, meth, *args, **kwargs): '''Run a method for an 'object', 
passing in arbitrary arguments.''' func = obj[meth] return func(obj, *args, 
**kwargs)</pre> </li> 
<li>Note: this function works for all &ldquo;classes&rdquo;</li> </ul></li> 
<li>Finally, write some tests to show how it works 
<ul> 
<li> 
<pre># Create a rectangle. block = makeRect(0, 0, 2, 2) print run(block, 
'str') # Calculate its area. print 'area is', run(block, 'area') # See if it 
contains a couple of points. print 'contains (1, 1)?', run(block, 'contains', 
1, 1) print 'contains (10, 10)?', run(block, 'contains', 10, 10)</pre> </li> 
</ul></li> 
<li>This is actually not very far from what Python actually does 
<ul> 
<li>Replace <code>run(obj, 'method', &hellip;)</code> with <code>
obj.method(&hellip;)</code></li> 
<li>Let programmers define classes to group related functions together 
<ul> 
<li>I.e., to make it clear that they're methods</li> </ul></li> </ul></li> 
<li>Classes also help implement inheritance 
<ul> 
<li>Instances of a child class get all the methods of their parent class(es)
</li> 
<li>If the child class redefines the method, the object gets a reference to 
the new one, rather than the old one</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How Other Languages Do It</h2> 
<ul> 
<li>Java's object model is more restrictive than Python's 
<ul> 
<li>All methods and members must be defined when code is compiled</li> 
<li>Can't be modified at runtime</li> 
<li>Less flexible, but makes automatic optimization easier</li> </ul></li> 
<li>Object stores its own data members, and a reference to the class it 
belongs to
<ul> 
<li>At runtime, the class is just another object</li> 
<li>Its members are its methods</li> 
<li><code>obj.meth(args)</code> is <code>obj.class[methodname](args)</code> 
<ul> 
<li>I.e., look up the class, look in it to find the method, and call that</li> 
</ul></li> </ul></li> 
<li>C++, Fortran-90, and other languages are all variations on the theme 
<ul> 
<li>Key idea: it's all functions underneath</li> 
<li>Object orientation is &ldquo;just&rdquo; a way to figure out which one to 
call</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Runtime Tricks</h2> 
<ul> 
<li>So, what's all this good for?</li> 
<li>Well, how do you think a debugger works? 
<ul> 
<li>Doesn't know anything about your code in particular</li> 
<li>So it uses reflection to look things up as it needs them</li> </ul></li> 
<li>Still useful even if you don't intend to write a debugger 
<ul> 
<li><code>hasattr(obj, attrName)</code> reports whether an object has an 
attribute with a particular name</li> 
<li><code>getattr(obj, attrName)</code> gets the value of an object's attribute
</li> 
<li><code>setattr(obj, attrName, newValue)</code> set an attribute's value 
<ul> 
<li>Yes, you can add attributes to particular objects after they have been 
created</li> </ul></li> 
<li><code>dir(obj)</code> lists all the attribute of an object</li> 
<li>All of these are very useful when debugging interactively</li> </ul></li> 
<li>Python's <code>import</code> statement is evaluated at runtime as well 
<ul> 
<li>Unlike C++'s <code>#include</code> or Java's <code>import</code>, which 
are evaluated by the compiler</li> </ul></li> 
<li>Can therefore decide at runtime which version of a class to load 
<ul> 
<li>If running a production system, load the real one</li> 
<li>If testing, load a fake version</li> 
<li> 
<pre>import sys if (len(sys.argv) &gt; 1) and (sys.argv[1] == '-d'): import 
testLib as lib else: import realLib as lib print lib.ackermann(3, 2)</pre> </li>
</ul></li> 
<li>Take this one step further, and use information in a file to control what 
modules Python loads and calls
<ul> 
<li>Key idea: everything you load dynamically must obey some kind of <em>
protocol</em> 
<ul> 
<li>A set of rules that allow two entities to communicate without knowing 
anything else about each other</li> 
<li>&ldquo;Everything reads text from standard input, and writes text to 
standard output&rdquo; is an example</li> </ul></li> 
<li>You have to know <em>something</em> in order to use code&hellip;</li> </ul>
</li> 
<li>Example: want to apply a series of filters to a set of strings 
<ul> 
<li>Just like Unix command line tools</li> 
<li>Protocol: every module must define a function called <code>func</code> 
that takes a list of strings as input, and produces another list of strings as 
output</li> 
<li> 
<pre>def func(lines): result = [] for i in range(1, len(lines), 2): 
result.append(lines[i]) return result</pre> </li> </ul></li> 
<li>Load modules dynamically using the <code>__import__</code> function 
<ul> 
<li>Does what the <code>import</code> statement does, but takes a string as an 
argument</li> 
<li>Note: must not include the trailing <code>.py</code></li> </ul></li> 
<li>The whole thing is surprisingly small 
<ul> 
<li> 
<pre>import sys filters = [] for moduleName in sys.argv[1:]: moduleName = 
moduleName[:-3] # strip off '.py' module = __import__(moduleName) func = 
getattr(module, 'func') filters.append(func) print filters lines = 
sys.stdin.readlines() for f in filters: lines = f(lines) for l in lines: print 
l,</pre> </li> </ul></li> 
<li>This is how systems like the Apache web server work 
<ul> 
<li>Modules being loaded are written in C, rather than Python</li> 
<li>Which modules to load is specified in a complex configuration file, rather 
than on the command line</li> 
<li>But the principles are the same</li> 
<li>Makes it very easy to add new components, swap real components for 
debugging versions, etc.</li> 
<li>Can equally well use it to control what mesh and solver classes to load, 
or which sequence comparison tests to import</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Coverage</h2> 
<ul> 
<li>As well as looking at code as a bunch of (static) bytes, we can watch what 
happens as it executes
<ul> 
<li>Very useful for debugging</li> 
<li>Even more useful for performance tuning</li> </ul></li> 
<li>When Python translates your program into bytecode, it keeps track of where 
instructions came from
<ul> 
<li>It can then make a record of which lines of code have been executed 
<ul> 
<li>Typically accumulate data over several runs of the program</li> </ul></li> 
<li>Allows you to see which bits of your program are no longer being used</li> 
<li>More importantly, which bits aren't being tested</li> </ul></li> 
<li>The <code>coverage</code> tool does four things: 
<ul> 
<li><code>coverage -x yourprogram.py &hellip;args&hellip;</code> runs your 
program to collect coverage data
<ul> 
<li>Data is accumulated in a file called <code>.coverage</code> so that you 
can collect information over several runs of your program</li> </ul></li> </ul>
</li> 
<li>Example: 
<ul> 
<li> 
<pre>import sys def foo(x, y): for i in x: y += 1 print 'result:', y def 
bar(z): if z &lt; 0: print &quot;shouldn't happen&quot; elif z == 0: print 
&quot;shouldn't happen either&quot; else: foo('abc', z) if __name__ == 
'__main__': for i in range(1, int(sys.argv[1])): bar(i)</pre> </li> 
<li> 
<pre>python coverage.py -x c.py 3 </pre> 
<pre>result: 4 result: 5 </pre> </li> 
<li> 
<pre>python coverage.py -r -m c.py </pre> 
<pre>Name Stmts Exec Cover Missing ------------------------------------- c 14 
12 85% 10, 12</pre> </li> 
<li> 
<pre>python coverage.py -a </pre> 
<pre>&gt; import sys &gt; def foo(x, y): &gt; for i in x: &gt; y += 1 &gt; 
print 'result:', y &gt; def bar(z): &gt; if z &lt; 0: ! print &quot;shouldn't 
happen&quot; &gt; elif z == 0: ! print &quot;shouldn't happen either&quot; &gt; 
else: &gt; foo('abc', z) &gt; if __name__ == '__main__': &gt; for i in range(1, 
int(sys.argv[1])): &gt; bar(i)</pre> </li> </ul></li> 
<li>Coverage is most useful when integrated with unit tests 
<ul> 
<li>Usually not economical to aim for 100% code coverage 
<ul> 
<li>Tests for simple get/set methods are as likely to be buggy as the methods 
themselves&hellip;</li> 
<li>&hellip;and some things (like the network cable being kicked out at 
exactly the wrong moment) really are hard to automate</li> </ul></li> 
<li>But very useful to know whether code coverage is going up or down 
<ul> 
<li>If someone checks in a large change set, and code coverage immediately 
drops from 80% to 70%, you probably want to have a close look at those changes
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Profiling</h2> 
<ul> 
<li>Rather than just flagging lines as they are executed, we could count how 
often each line executes
<ul> 
<li>The more often something runs, the more important it is to figure out how 
to make it fast</li> </ul></li> 
<li>If execution time is what we really care about, better to measure it 
directly
<ul> 
<li>A statement that takes 10 milliseconds to execute is ten thousand times 
more expensive than one than takes a microsecond</li> </ul></li> 
<li><em>Profiling</em> is the act of measuring aspects of a program's 
performance
<ul> 
<li>Typically measure execution time</li> 
<li>Can also measure disk usage, memory footprint, etc.</li> </ul></li> 
<li>Two approaches 
<ul> 
<li><em>Instrument</em> the code by inserting instructions to record the clock 
time
<ul> 
<li>Typically record time at start and end of each method call, and total up 
the differences</li> 
<li>Deterministic, but expensive</li> </ul></li> 
<li><em>Sample</em> the code by interrupting it at regular intervals to see 
where it is
<ul> 
<li>Builds a statistical profile of where in the code we're most likely to be
</li> 
<li>Non-deterministic, but impact can be reduced by reducing sampling 
frequency, and running the program for longer</li> </ul></li> 
<li>Both kinds of profiling distort the program's behavior 
<ul> 
<li>The Heisenberg Principle: measuring something changes it</li> </ul></li> 
</ul></li> 
<li>Python's <code>hotshot</code> module measures execution time 
<ul> 
<li>Create an instance of <code>hotshot.Profile</code> with the name of a log 
file as an argument
<ul> 
<li>Profile data accumulates in that file</li> </ul></li> 
<li>Use the profile object's <code>runcall</code> method to profile a single 
run of a function
<ul> 
<li>Which may of course call other functions</li> </ul></li> 
<li>To process the data, use <code>hotshot.stats</code> 
<ul> 
<li>Can load data from log files, sort it in various ways, print it, etc.</li> 
</ul></li> </ul></li> 
<li>Example: compare speed of 1000 handwritten substring function calls with 
built-in
<ul> 
<li> 
<pre>import sys def builtin(str, substr): return str.find(substr) def 
handwritten(str, substr): for i in range(0, len(str)-len(substr)): match = True 
for j in range(len(substr)): if substr[j] != str[i+j]: match = False break if 
match: return i return -1 def tests(num): Tests = [ ['a', ''], ['a', 'abc'], 
['abc', 'a'], ['pqrstuvwxyz', 'stuv'], ['pqrstuvwxyz', 'stuw'] ] for i in 
range(num): for (str, substr) in Tests: expected = builtin(str, substr) assert 
expected == handwritten(str, substr) if __name__ == '__main__': import hotshot, 
hotshot.stats Filename = 'substr.prof' num = int(sys.argv[1]) prof = 
hotshot.Profile(Filename) prof.runcall(tests, num) prof.close() stats = 
hotshot.stats.load(Filename) stats.strip_dirs() stats.sort_stats('time', 
'calls') stats.print_stats()</pre> 
<pre> 10001 function calls in 0.292 CPU seconds Ordered by: internal time, 
call count ncalls tottime percall cumtime percall filename:lineno(function) 
5000 0.165 0.000 0.165 0.000 substr.py:6(handwritten) 1 0.081 0.081 0.292 0.292 
substr.py:17(tests) 5000 0.045 0.000 0.045 0.000 substr.py:3(builtin) 0 0.000 
0.000 profile:0(profiler)</pre> </li> 
<li>Hm&hellip;built-in method is only two and a bit times faster?</li> 
<li>What does it cost for an empty function call?</li> 
<li> 
<pre>def builtin(str, substr): return 0 def handwritten(str, substr): return 0 
</pre> 
<pre> 10001 function calls in 0.166 CPU seconds Ordered by: internal time, 
call count ncalls tottime percall cumtime percall filename:lineno(function) 1 
0.098 0.098 0.166 0.166 empty.py:11(tests) 5000 0.034 0.000 0.034 0.000 
empty.py:7(handwritten) 5000 0.034 0.000 0.034 0.000 empty.py:4(builtin) 0 
0.000 0.000 profile:0(profiler)</pre> </li> 
<li>Take off overhead, and the difference is closer to 4X</li> 
<li>Still seems low, but at least now we have a way to investigate 
quantitatively</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>Major advances in programming come when languages start offering support 
for things the best programmers are doing anyway
<ul> 
<li>For loops and if/then/else formalized what good Fortran programmers were 
already doing</li> 
<li>Objects formalized the way good C, Pascal, and Lisp programmers managed 
their data structures and functions</li> </ul></li> 
<li>Java deserves credit for bringing two previously-esoteric practices into 
the mainstream
<ul> 
<li>Garbage collection: the computer recycles memory as it needs to</li> 
<li>Reflection: programs can inspect themselves at runtime</li> </ul></li> 
<li>Reflection simplifies the construction of large software systems 
<ul> 
<li>Most big applications are now frameworks that load plug-in components 
dynamically</li> 
<li>A little extra effort&hellip;</li> 
<li>&hellip;but it forces programmers to really, truly modularize their 
code&hellip;</li> 
<li>&hellip;which also reduces maintenance and customization costs</li> </ul>
</li> 
<li>Watching programs run is an essential part of the software development 
process
<ul> 
<li>Which parts of my code can be thrown away?</li> 
<li>Which parts am I actually testing? 
<ul> 
<li>Which parts of their work are my colleagues actually testing?</li> </ul>
</li> 
<li>Why is my program so slow? 
<ul> 
<li>Modern computer systems are so complex that it's practically impossible to 
figure this out from first principles</li> 
<li>So write the code, profile, and then start tuning</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 16.1:</p> 
<p>What percentage of your code is tests? Is tested?</p> 
<p>Exercise 16.2:</p> 
<p>Can you honestly say that you write tests before code? Find out how many 
tests currently pass or fail with a single command? Identify the tests 
associated with a bug? Tell if your code meets the team's standards?</p> 
<p>Exercise 16.3:</p> 
<p>Can you find out which functions use the most CPU time? How long threads 
spend blocked on I/O? Who allocates memory, where, for what? How accurate these 
numbers are? How today's profile differs from last month's? How the profile 
differs across machines?</p> prev top next <br>
<br>

<h1>Regular Expressions</h1> prev  Draft Version 560 next <br>
<br>

<h2>Introduction</h2> 
<ul> 
<li>How to count the blank lines in a file? 
<ul> 
<li>Most people consider a line with just spaces and tabs to be blank</li> 
<li>But examining characters one by one is tedious</li> 
<li>More complex patterns (like telephone numbers or email addresses) are hard 
to get right</li> </ul></li> 
<li>Solution: use <em>regular expressions</em> (REs) instead 
<ul> 
<li>Represent patterns as strings</li> 
<li>Just like the <code>&quot;*&quot;</code> in the shell's <code>*.txt</code>
</li> </ul></li> 
<li>Warning: the notation is ugly 
<ul> 
<li>Have to use what's on the keyboard, instead of inventing new symbols the 
way mathematicians do</li> 
<li>Can't use superscripts and subscripts</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Simple Example</h2> 
<ul> 
<li>Load the <code>re</code> module, then use <code>re.search(pattern, text)
</code> 
<ul> 
<li><code>pattern</code> is a regular expression that describes what you're 
looking for</li> 
<li><code>text</code> is the string you're searching in</li> </ul></li> 
<li>So what goes in <code>pattern</code>? 
<ul> 
<li>Letters, digits, and whitespace character match against themselves</li> 
<li>Punctuation characters have special meaning 
<ul> 
<li> Pattern Matches Doesn't Match Explanation <br>
<code>&lceil;a*&rfloor;
</code> <code>&quot;&quot;</code>, <code>&quot;a&quot;</code>, <code>
&quot;aa&quot;</code>, &hellip; <code>&quot;A&quot;</code>, <code>&quot;b&quot;
</code> <code>&lceil;*&rfloor;</code> means &ldquo;zero or more&rdquo; matching 
is case sensitive <br>
<code>&lceil;b+&rfloor;</code> <code>&quot;b&quot;</code>
,<code>&quot;bb&quot;</code>, &hellip; <code>&quot;&quot;</code> <code>
&lceil;+&rfloor;</code> means &ldquo;one or more&rdquo; <br>
<code>
&lceil;ab?c&rfloor;</code> <code>&quot;ac&quot;</code>, <code>&quot;abc&quot;
</code> <code>&quot;a&quot;</code>, <code>&quot;abbc&quot;</code> <code>
&lceil;?&rfloor;</code> means &ldquo;optional&rdquo; (zero or one) <br>
<code>
&lceil;[abc]&rfloor;</code> <code>&quot;a&quot;</code>, <code>&quot;b&quot;
</code>, or <code>&quot;c&quot;</code> <code>&quot;ab&quot;</code>, <code>
&quot;d&quot;</code> <code>&lceil;[&hellip;]&rfloor;</code> means &ldquo;one 
character from a set&rdquo; <br>
<code>&lceil;[a-c]&rfloor;</code> <code>
&quot;a&quot;</code>, <code>&quot;b&quot;</code>, or <code>&quot;c&quot;</code> 
Character ranges can be abbreviated <br>
<code>&lceil;[abc]*&rfloor;</code> 
<code>&quot;&quot;</code>, <code>&quot;ac&quot;</code>, <code>
&quot;baabcab&quot;</code>, &hellip; Operators can be combined: zero or more 
choices from<code>&quot;a&quot;</code>, <code>&quot;b&quot;</code>, or <code>
&quot;c&quot;</code> <br>
<br>

<p> Table 17.1: Basic Regular Expression Operators</p> </li> </ul></li> 
<li> 
<p> Figure 17.1: Matching</p> <br>
<br>
</li> </ul></li> 
<li><code>re.search</code> looks for a match anywhere in the text 
<ul> 
<li>Doesn't have to match the entire target string</li> 
<li> 
<pre>import re pattern = 'a[bc]*' for text in ['b', 'ab', 'accb', 'mad']: if 
re.search(pattern, text): print '&quot;%s&quot; matches &quot;%s&quot;' % 
(pattern, text) else: print '&quot;%s&quot; does not match &quot;%s&quot;' % 
(pattern, text)</pre> 
<pre>&quot;a[bc]*&quot; does not match &quot;b&quot; &quot;a[bc]*&quot; 
matches &quot;ab&quot; &quot;a[bc]*&quot; matches &quot;accb&quot; 
&quot;a[bc]*&quot; matches &quot;mad&quot;</pre> </li> 
<li><code>&lceil;a[bc]*&rfloor;</code> matches an <code>&quot;a&quot;</code>, 
followed by zero or more of either<code>&quot;b&quot;</code> or <code>
&quot;c&quot;</code> 
<ul> 
<li>Doesn't match <code>&quot;b&quot;</code> because there's no leading <code>
&quot;a&quot;</code></li> 
<li>Matches <code>&quot;ab&quot;</code> and <code>&quot;accb&quot;</code></li> 
</ul></li> 
<li>Why does it match <code>&quot;mad&quot;</code>? 
<ul> 
<li><code>re.search</code> looks for a match <em>anywhere</em> in <code>text
</code></li> 
<li>Skips the <code>&quot;m&quot;</code>, then <code>&lceil;a&rfloor;</code> 
matches<code>&quot;a&quot;</code>, and <code>&lceil;[bc]*&rfloor;</code> 
matches the empty string</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Anchoring</h2> 
<ul> 
<li>If <code>re.search</code> looks anywhere in the line, how to find blank 
lines?
<ul> 
<li>Don't consider <code>&quot;x \n&quot;</code> or <code>&quot; x\n&quot;
</code> blank</li> </ul></li> 
<li>Constrain what the RE can match using <em>anchors</em> 
<ul> 
<li><code>&lceil;^&rfloor;</code> matches the beginning of the string</li> 
<li><code>&lceil;$&rfloor;</code> matches the end</li> 
<li>Neither consumes any characters</li> 
<li> 
<p> Figure 17.2: Anchoring Matches</p> <br>
<br>
</li> </ul></li> 
<li>Examples 
<ul> 
<li> Pattern Text Result <br>
<code>&lceil;b+&rfloor;</code> <code>
&quot;abbc&quot;</code> Matches <br>
<code>&lceil;^b+&rfloor;</code> <code>
&quot;abbc&quot;</code> Fails (string doesn't start with <code>b</code>) <br>

<code>&lceil;c$&rfloor;</code> <code>&quot;abbc&quot;</code> Matches (string 
ends with<code>c</code>) <br>
<code>&lceil;^a*$&rfloor;</code> <code>aabaa
</code> Fails (something other than <code>&quot;a&quot;</code> between start 
and end of string) <br>
<br>

<p> Table 17.2: Anchoring Regular Expressions</p> </li> </ul></li> 
<li>Can now count blank lines in a file 
<ul> 
<li> 
<pre>import sys, re # Nothing but space, tab, carriage return, newline from 
start to end pattern = '^[ \t\r\n]*$' # Count matches in one file/stream. def 
count(filename, instream): count = 0 for line in instream: if 
re.search(pattern, line): count += 1 print '%s %d' % (filename, count) # Only 
standard instream? if len(sys.argv) == 1: count('&lt;stdin&gt;', sys.stdin) 
else: for filename in sys.argv[1:]: instream = open(filename, 'r') 
count(filename, instream) instream.close()</pre> </li> 
<li>Note: always behave like a polite command line filter 
<ul> 
<li>If no arguments given, read from standard input</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Escape Sequences</h2> 
<ul> 
<li>How to match against a literal <code>&quot;^&quot;</code> or <code>
&quot;*&quot;</code>? 
<ul> 
<li>Escape from the character's special meaning by putting <code>&quot;\&quot;
</code> in front of it</li> 
<li><code>&lceil;\$&rfloor;</code> matches a literal <code>&quot;$&quot;</code>
, and<code>&lceil;\\&rfloor;</code> matches a literal <code>&quot;\&quot;</code>
</li> </ul></li> 
<li>Must write these in Python as <code>&quot;\\$&quot;</code> and <code>
&quot;\\\\&quot;</code> 
<ul> 
<li>Two layers of compilation: 
<ul> 
<li>Python turn double backslashes into single backslash character</li> 
<li>Regular expression library then compiles single backslash plus something 
into special operation</li> 
<li> 
<p> Figure 17.3: Compiling Regular Expressions</p> <br>
<br>
</li> </ul></li> 
<li>This can get very confusing, very quickly 
<ul> 
<li><code>&quot;\t&quot;</code> is a tab character, which matches a tab 
character</li> 
<li>But <code>&quot;\\t&quot;</code> is the two-character sequence <code>
&lceil;\t&rfloor;</code>, which also matches a tab character</li> </ul></li> 
</ul></li> 
<li> </li> 
<li><code>&quot;\&quot;</code> is also used in shorthand notation for common 
character sets
<ul> 
<li> Sequence Equivalent Explanation <br>
<code>&lceil;\d&rfloor;</code> <code>
&lceil;[0-9]&rfloor;</code> Digits <br>
<code>&lceil;\w&rfloor;</code> <code>
&lceil;[a-zA-Z0-9_]&rfloor;</code> Word characters (i.e., those allowed in 
variable names) <br>
<code>&lceil;\s&rfloor;</code> <code>&lceil;[ 
\t\r\n]&rfloor;</code> Whitespace <br>
<br>

<p> Table 17.3: Regular Expression Escape Sequences</p> </li> </ul></li> 
<li>A couple of useful special cases: 
<ul> 
<li>The notation <code>&lceil;[^abc]&rfloor;</code> means &ldquo;anything <em>
except</em> the characters in this set&rdquo;</li> 
<li><code>&lceil;.&rfloor;</code> means &ldquo;any character except the end of 
line&rdquo;
<ul> 
<li>Equivalent to <code>&lceil;[^\n]&rfloor;</code></li> </ul></li> 
<li><code>&lceil;\b&rfloor;</code> anchors the match to a break between word 
and non-word characters
<ul> 
<li>Like <code>&lceil;^&rfloor;</code> and <code>&lceil;$&rfloor;</code>, 
doesn't consume any actual characters</li> 
<li> 
<p> Figure 17.4: Word/Non-Word Breaks</p> <br>
<br>
</li> </ul></li> </ul></li>
<li>Comment on this slide</li> </ul> 
<h2>Extracting Matches</h2> 
<ul> 
<li>Problem: to check for duplicate line numbers in an assembly language file 
<ul> 
<li>Line numbers are the first thing on the line, terminated by a colon 
<ul> 
<li> 
<pre> load D 1 10 : sub A B jlt A 20 </pre> </li> </ul></li> </ul></li> 
<li>First try: search each line with a regular expression 
<ul> 
<li>If it succeeds, extract the line number</li> 
<li> 
<pre>import sys, re # start of line, optional spaces, digits, more optional 
spaces, colon numbered = '^\\s*\\d+\\s*:' seen = {} for line in sys.stdin: if 
re.search(numbered, line): num = line.split()[0] if num in seen: print num 
else: seen[num] = True</pre> </li> </ul></li> 
<li>But what if there is no space between the line number and the colon? 
<ul> 
<li><code>'2 :'.split()</code> gives <code>['2', ':']</code>, but <code>
'2:'.split()'</code> gives <code>['2:']</code></li> 
<li>Don't want to search the string to find the longest leading sequence of 
digits</li> 
<li>Need a better way to extract the text that matched sub-patterns</li> </ul>
</li> 
<li>Result of <code>re.search</code> is actually a <em>match object</em> that 
records what what matched, and where
<ul> 
<li><code>mo.group()</code> returns the whole string that matched the RE</li> 
<li><code>mo.start()</code> and <code>mo.end()</code> are the indices of the 
match's location</li> 
<li> 
<pre>import re text = 'abbcb' for pattern in ['b+', 'bc*', 'b+c+']: mo = 
re.search(pattern, text) print '%s / %s =&gt; &quot;%s&quot; (%d, %d)' % \ 
(pattern, text, mo.group(), mo.start(), mo.end())</pre> 
<pre>b+ / abbcb =&gt; &quot;bb&quot; (1, 3) bc* / abbcb =&gt; &quot;b&quot; 
(1, 2) b+c+ / abbcb =&gt; &quot;bbc&quot; (1, 4)</pre> </li> </ul></li> 
<li>Every parenthesized subexpression in the RE is a <em>group</em> 
<ul> 
<li>Group 0 is the entire match</li> 
<li>Text that matched <em>Nth</em> parentheses (counting from left) is group 
<em>N</em></li> 
<li><code>mo.group(3)</code> is the text that matched the third subexpression, 
<code>m.start(3)</code> is where it started</li> </ul></li> 
<li>Extracting line numbers is now easy: 
<ul> 
<li> 
<pre>import sys, re # start of line, optional spaces, digits, more optional 
spaces, colon numbered = '^\\s*(\\d+)\\s*:' seen = {} for line in sys.stdin: mo 
= re.search(numbered, line) if mo: num = mo.group(1) if num in seen: print num 
else: seen[num] = True</pre> </li> </ul></li> 
<li>So is reversing two columns of numbers: 
<ul> 
<li> 
<pre># optional spaces, number, required spaces, number, optional spaces def 
reverse(instream, outstream): cols = '^\\s*(\\d+)\\s+(\\d+)\s*$' for line in 
instream: mo = re.match(cols, line) # If match, reverse numbers if mo: a, b = 
mo.group(1), mo.group(2) print &gt;&gt; outstream, '%s\t%s' % (b, a) # If no 
match, echo line (without adding extra newline at end) else: print &gt;&gt; 
outstream, line,</pre> </li> 
<li>Let's not forget to test it: 
<ul> 
<li> 
<pre>if __name__ == '__main__': fixture = '''\ # Leading comment followed by 
blank line 10 20 30\t40\t 50 60 70 80 \t90 100 ''' expected = '''\ # Leading 
comment followed by blank line 20\t10 40\t30 50 60 70 80 100\t90 ''' from 
cStringIO import StringIO instream = StringIO(fixture) outstream = StringIO() 
reverse(instream, outstream) assert outstream.getvalue() == expected</pre> </li>
</ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Compiling</h2> 
<ul> 
<li>The regular expression library compiles patterns into a more concise form 
for matching
<ul> 
<li>Each regular expression becomes a <em>finite state machine</em></li> 
<li>Library follows the arcs in the FSM as it reads characters</li> 
<li>Drawing FSMs is a good way to debug REs</li> 
<li> 
<p> Figure 17.5: Regular Expressions as Finite State Machines</p> <br>
<br>

</li> </ul></li> 
<li>You can improve a program's performance by compiling the RE once, and 
re-using the compiled form
<ul> 
<li>Use <code>re.compile(pattern)</code> to get the compiled RE</li> 
<li>Its methods have the same names and behavior as the functions in the <code>
re</code> module</li> 
<li>E.g., <code>matcher.search(text)</code> searches <code>text</code> for 
matches to the RE that was compiled to create<code>matcher</code></li> </ul>
</li> 
<li>Example: find all Title Case words in a document 
<ul> 
<li> 
<pre>def findAll(instream, outstream): matcher = 
re.compile('\\b([A-Z][a-z]*)\\b(.*)') for line in instream: mo = 
matcher.search(line) while mo: print &gt;&gt; outstream, mo.group(1) mo = 
matcher.search(mo.group(2))</pre> </li> 
<li>Notice how the function gets all matches: 
<ul> 
<li>Pattern captures what we want in group 1, and everything else on the line 
in group 2</li> 
<li>Each time there's a match, continue the search in the remainder captured 
in group 2</li> </ul></li> 
<li>Tests are straightforward</li> 
<li> 
<pre>if __name__ == '__main__': fixture = '''\ This has several &quot;Title 
Case&quot; words on Each Line (Some in parentheses). ''' expected = '''\ This 
Title Case Each Line Some ''' from cStringIO import StringIO instream = 
StringIO(fixture) outstream = StringIO() findAll(instream, outstream) assert 
outstream.getvalue() == expected print 'INPUT' print fixture print 'OUTPUT' 
print expected</pre> 
<pre>import re #- start:findAll def findAll(instream, outstream): matcher = 
re.compile('\\b([A-Z][a-z]*)\\b(.*)') for line in instream: mo = 
matcher.search(line) while mo: print &gt;&gt; outstream, mo.group(1) mo = 
matcher.search(mo.group(2)) #- end:findAll # start:test if __name__ == 
'__main__': fixture = '''\ This has several &quot;Title Case&quot; words on 
Each Line (Some in parentheses). ''' expected = '''\ This Title Case Each Line 
Some ''' from cStringIO import StringIO instream = StringIO(fixture) outstream 
= StringIO() findAll(instream, outstream) assert outstream.getvalue() == 
expected print 'INPUT' print fixture print 'OUTPUT' print expected # end:test
</pre> </li> </ul></li> 
<li>Compiled REs have many other useful methods 
<ul> 
<li>Including one that finds all matches, so you don't have to write the loop
</li> 
<li>All are also available as top-level functions in the <code>re</code> module
</li> 
<li> Method Purpose Example Result <br>
<code>split</code> Split a string on a 
pattern. <code>re.split('\\s*,\\s*', 'a, b ,c , d')</code> <code>['a', 'b', 
'c', 'd']</code> <br>
<code>findall</code> Find all matches for a pattern. 
<code>re.findall('\\b[A-Z][a-z]*', 'Some words in Title Case.')</code> <code>
['Some', 'Title', 'Case']</code> <br>
<code>sub</code> Replace matches with new 
text. <code>re.sub('\\d+', 'NUM', 'If 123 is 456')</code> <code>&quot;If NUM is 
NUM&quot;</code> <br>
<br>

<p> Table 17.4: Regular Expression Object Methods</p> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Using REs in Other Languages</h2> 
<ul> 
<li>Like sine and sorting, regular expressions are independent of language 
<ul> 
<li>RE libraries exist for C/C++, Java, Perl, Ruby, MATLAB, &hellip;</li> 
<li>Syntax varies slightly, but the ideas are the same</li> </ul></li> 
<li>Example: Java's <code>java.util.regex</code> package contains two classes: 
<ul> 
<li><code>Pattern</code>: a compiled regular expression</li> 
<li><code>Matcher</code>: the result of a match</li> 
<li>Typical usage: 
<ul> 
<li> 
<pre>public static String matchMiddle(String data) { String result = null; 
Pattern p = Pattern.compile(&quot;a(b|c)d&quot;); Matcher m = p.matcher(data); 
if (m.matches()) { result = m.group(1); } return result; }</pre> </li> </ul>
</li> </ul></li> 
<li>REs are actually built into languages like Perl and Ruby 
<ul> 
<li>Just as dictionaries are built into Python, and arrays into MATLAB</li> 
<li>Typical Perl usage: 
<ul> 
<li> 
<pre>open MAIL, 'mail.txt' while (&lt;MAIL&gt;) { if (($name, $value) = 
/^([^:]+): ?(.+)$/) { print &quot;Message header $name is $value\n&quot;; } }
</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>But Wait, There's More</h2> 
<ul> 
<li>We've only scratched the surface 
<ul> 
<li>Regular expressions have proved to be too useful to remain clean and 
elegant</li> </ul></li> 
<li>Use <code>&lceil;|&rfloor;</code> for either/or 
<ul> 
<li><code>&lceil;ab|cd&rfloor;</code> matches either <code>&quot;ab&quot;
</code> or <code>&quot;cd&quot;</code></li> 
<li><code>&lceil;a(b|c)d&rfloor;</code> matches either <code>&quot;abd&quot;
</code> or <code>&quot;acd&quot;</code></li> </ul></li> 
<li>Use <code>&lceil;pat{N}&rfloor;</code> to match exactly <em>N</em> 
occurrences of a pattern
<ul> 
<li>More generally, <code>&lceil;pat{M,N}&rfloor;</code> matches between <em>M
</em> and <em>N</em> occurrences</li> 
<li><code>&lceil;\d{2,3}&rfloor;</code> matches <code>&quot;19&quot;</code> or 
<code>&quot;207&quot;</code>, but not <code>&quot;3&quot;</code> or <code>
&quot;4567&quot;</code> 
<ul> 
<li>Well, OK, it <em>will</em> match the first three characters of <code>
&quot;456&quot;</code></li> 
<li>But <code>&lceil;^\d{2,3}&rfloor;</code> won't</li> </ul></li> </ul></li> 
<li>Most important thing is to build up complex REs one step at a time 
<ul> 
<li>Write something that matches part of what you're looking for</li> 
<li><em>Test it</em></li> 
<li>Add to it</li> 
<li>That's why they call it computer science: it's experimental</li> </ul></li>
<li>For a broader tutorial, see [Wilson 2005] 
<ul> 
<li>For Python-specific material, see <code>Andrew Kuchling's Python Regular 
Expression HOWTO</code></li> 
<li>And if you're going to be doing serious work, check out [Good 2005] or [
Friedl 2002] </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 17.1:</p> 
<p>By default, regular expression matches are <em>greedy</em>: the first term 
in the RE matches as much as it can, then the second part, and so on. As a 
result, if you apply the RE<code>&lceil;X(.*)X(.*)&rfloor;</code> to the string 
<code>&quot;XaX and XbX&quot;</code>, the first group will contain <code>
&quot;aX and Xb&quot;</code>, and the second group will be empty.</p> 
<p>It's also possible to make REs match <em>reluctantly</em>, i.e., to have 
the parts match as little as possible, rather than as much. Find out how to do 
this, and then modify the RE in the previous paragraph so that the first group 
winds up containing<code>&quot;a&quot;</code>, and the second group <code>
&quot; and XbX&quot;</code>.</p> prev top next <br>
<br>

<h1>Basic XML and XHTML</h1> prev  Draft Version 574 next <br>
<br>

<h2>Overview</h2> 
<ul> 
<li>XML is quickly becoming the standard way to store data 
<ul> 
<li>Web pages</li> 
<li>Spreadsheets</li> 
<li>Images</li> 
<li>Astronomical observations</li> </ul></li> 
<li>Bewildering variety of tools for dealing with it 
<ul> 
<li>And more appearing every day</li> </ul></li> 
<li>Even simple things can be tricky to do right 
<ul> 
<li>Generally agreed that standards are more complex than they should have 
been&hellip;</li> 
<li>&hellip;but no agreement on which bits should have been left out</li> </ul>
</li> 
<li>Examine: 
<ul> 
<li>The rules for creating legal XML</li> 
<li>The XML-compliant dialect of HTML (for web pages)</li> 
<li>The standard Python library for manipulating XML 
<ul> 
<li>Note: there are lots of others, each with its strengths</li> </ul></li> 
<li>Reading: 
<ul> 
<li> [Castro 2002] if all you care about is HTML</li> 
<li> [Castro 2000] if you want to know more about XML</li> 
<li> [Harold 2004] if you want to become an expert</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>History</h2> 
<ul> 
<li>1969-1986: Standard Generalized Markup Language (SGML) 
<ul> 
<li>Developed by Charles Goldfarb and others at IBM</li> 
<li>A way of adding information to medical and legal documents so that 
computers could process them
<ul> 
<li> 
<pre>&lt;person role=&quot;litigant&quot;&gt; 
&lt;given-name&gt;Charles&lt;/given-name&gt; 
&lt;surname&gt;Babbage&lt;/surname&gt; &lt;/person&gt;</pre> </li> 
<li>Allows computers to reliably find cases in which Charles Babbage sued 
someone</li> </ul></li> 
<li>Large (500-page spec) and complex</li> </ul></li> 
<li>1989: Tim Berners-Lee creates HyperText Markup Language (HTML) for the 
World Wide Web
<ul> 
<li>Much (much) simpler than SGML</li> 
<li>Anyone could write it, so everyone did</li> </ul></li> 
<li>Problem: HTML had a small, fixed set of tags 
<ul> 
<li>Everyone wanted to add new ones</li> 
<li>Solution: create a standard way to define a set of tags, and the 
relationships between them</li> </ul></li> 
<li>1998: first version of XML is standardized 
<ul> 
<li>A set of rules for defining markup languages</li> 
<li>Much more complex than HTML&hellip;</li> 
<li>&hellip;but still much simpler than SGML</li> </ul></li> 
<li>New version of HTML called XHTML was also defined 
<ul> 
<li>Like HTML, but obeys all XML rules</li> 
<li>Still a lot of non-XML compliant HTML out there, though</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Formatting Rules</h2> 
<ul> 
<li>For our purposes, an XML <em>document</em> contains <em>elements</em> and 
<em>text</em> 
<ul> 
<li>Full spec allows for external entity references, processing instructions, 
and other fun</li> </ul></li> 
<li>Elements are shown using <em>tags</em> 
<ul> 
<li>Must be enclosed in angle brackets <code>&quot;&lt;&gt;&quot;</code></li> 
<li>Full form: <code>&lt;tagname&gt;&hellip;&lt;/tagname&gt;</code></li> 
<li>Short form (if the element doesn't contain anything): <code>
&lt;tagname/&gt;</code></li> </ul></li> 
<li>Elements must be properly nested 
<ul> 
<li>If Y starts inside X, Y must end before X ends</li> 
<li>So <code>&lt;X&gt;&hellip;&lt;Y&gt;&hellip;&lt;/Y&gt;&lt;/X&gt;</code> is 
legal&hellip;</li> 
<li>&hellip;but <code>&lt;X&gt;&hellip;&lt;Y&gt;&hellip;&lt;/X&gt;&lt;/Y&gt;
</code> is not</li> </ul></li> 
<li>Every document must have a single root element 
<ul> 
<li>I.e., a single element must enclose everything else</li> 
<li>So the following is <em>not</em> a legal document 
<ul> 
<li> 
<pre>&lt;first&gt; This document is &lt;em&gt;illegal&lt;/em&gt; 
&lt;/first&gt; &lt;second&gt; because it does not have a unique root element. 
&lt;/second&gt;</pre> </li> </ul></li> </ul></li> 
<li>Text is normal printable text 
<ul> 
<li>Must use escape sequences to represent <code>&quot;&lt;&quot;</code> and 
<code>&quot;&gt;&quot;</code></li> 
<li>In XML, written <code>&amp;name;</code> 
<ul> 
<li> Sequence Character <br>
<code>&amp;lt;</code> <code>&lt;</code> <br>

<code>&amp;gt;</code> <code>&gt;</code> <br>
<code>&amp;quot;</code> <code>
&quot;</code> <br>
<code>&amp;amp;</code> <code>&amp;</code> <br>
<br>

<p> Table 18.1: Common XML Escape Sequences</p> </li> </ul></li> </ul></li> 
<li>Specific dialects of XML may or may not restrict which elements can appear 
inside which others, and where text can appear
<ul> 
<li>XHTML is very liberal</li> 
<li>MathML (Mathematical Markup Language) is stricter</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>XHTML</h2> 
<ul> 
<li>Most common use of XML is still XHTML (the XML version of hypertext)</li> 
<li>Basic tags: 
<ul> 
<li> <code>html</code> Root element of entire HTML document. <br>
<code>body
</code> Body of page (i.e., visible content). <br>
<code>h1</code> Top-level 
heading. Use<code>h2</code>, <code>h3</code>, etc. for second- and third-level 
headings. <br>
<code>p</code> Paragraph. <br>
<code>em</code> Emphasized text; 
browser or editor will usually display it in italics. <br>
<code>address</code> 
Address of document author (also usually displayed in italics). <br>
<br>

<p> Table 18.2: Common XHTML Tags</p> </li> </ul></li> 
<li>Note: XHTML includes both semantics (&ldquo;What does this mean?&rdquo;) 
and display (&ldquo;How should this be drawn?&rdquo;)
<ul> 
<li><code>h1</code> (level-1 heading) is semantic, <code>i</code> (italics) is 
display</li> 
<li>Now generally considered a bad thing 
<ul> 
<li>Documents should only contain semantics</li> 
<li>Display of that semantics should be specified separately&hellip;</li> 
<li>&hellip;so that different browsers (or devices) can do it differently</li> 
</ul></li> </ul></li> 
<li>Sample document: 
<ul> 
<li> 
<pre>&lt;html&gt; &lt;body&gt; &lt;h1&gt;Software Carpentry&lt;/h1&gt; 
&lt;p&gt;This course will introduce &lt;em&gt;essential software development 
skills&lt;/em&gt;, and show where and how they should be applied.&lt;/p&gt; 
&lt;address&gt;Greg Wilson (gvwilson@third-bit.com)&lt;/address&gt; 
&lt;/html&gt;</pre> <br>

<p> Figure 18.1: Simple Page Rendered by Firefox</p> <br>
<br>
<br>

<p> Figure 18.2: Simple Page Rendered by Internet Explorer</p> <br>
<br>
<br>

<br> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Attributes</h2> 
<ul> 
<li>Elements may also have <em>attributes</em> 
<ul> 
<li>Each attribute is a name/value pair that provides extra information about 
the element</li> 
<li>Enclosed in the opening tag 
<ul> 
<li><code>&lt;h1&gt;A Centered Heading&lt;/h1&gt;</code></li> 
<li><code>&lt;p&gt;This planet provided as-is.&lt;/p&gt;</code></li> </ul></li>
<li>Each name may appear at most once 
<ul> 
<li>Like keys in a dictionary</li> 
<li><code>&lt;p&gt;&hellip;&lt;/p&gt;</code> is illegal</li> </ul></li> 
<li>Values <em>must</em> be quoted 
<ul> 
<li>Old-style HTML often allowed things like <code>&lt;p&gt;&hellip;&lt;/p&gt;
</code>, but modern parsers will reject it</li> 
<li>Must use escape sequences for angle brackets, quotes, etc. inside values
</li> </ul></li> </ul></li> 
<li>Strictly speaking, attributes are redundant 
<ul> 
<li>Can always re-write XML using only elements 
<ul> 
<li>Usually more typing&hellip;</li> 
<li>&hellip;but that only matters if you're creating the XML by hand&hellip;
</li> 
<li>&hellip;and an increasing amount is created by machines, for machines</li> 
</ul></li> 
<li> With Attributes Without Attributes <br>

<pre>&lt;a b=&quot;c&quot;&gt; &lt;d e=&quot;f&quot;/&gt; &lt;/a&gt; </pre> 
<pre>&lt;a&gt; &lt;a-b&gt;c&lt;/a-b&gt; 
&lt;d&gt;&lt;d-e&gt;f&lt;/d-e&gt;&lt;/d&gt; &lt;/a&gt;</pre> <br>
<br>
</li> 
</ul></li> 
<li>You should use attributes when: 
<ul> 
<li>Each value can occur at most once for any element.</li> 
<li>The order of the values doesn't matter.</li> 
<li>Those values have no internal structure. 
<ul> 
<li>If you have to do any significant work on an attribute's value to figure 
out what it means, you should use an element instead.</li> </ul></li> </ul></li>
<li>Comment on this slide</li> </ul> 
<h2>More XHTML Tags</h2> 
<ul> 
<li>Well-written HTML pages have a <code>head</code> element as well as a 
<code>body</code> 
<ul> 
<li>Contains metadata about the page</li> 
<li> Element Example Purpose <br>
<code>title</code> <code>&lt;title/&gt;
</code> Page title (for display in title bar of browser, bookmarks, etc.) <br>

<code>meta</code> <code>&lt;meta/&gt;</code> Information about the document 
(typically, to help with search) <br>
<br>

<p> Table 18.3: More XHTML Tags</p> </li> </ul></li> 
<li>Well-written pages also use comments (just like code) 
<ul> 
<li>Introduce with <code>&lt;!--</code>, and end with <code>--&gt;</code></li> 
<li> 
<pre>&lt;html&gt; &lt;head&gt; &lt;title&gt;Comments Page&lt;/title&gt; 
&lt;meta name=&quot;author&quot; content=&quot;aturing&quot;/&gt; &lt;/head&gt; 
&lt;body&gt; &lt;!-- House style puts all titles in italics --&gt; 
&lt;h1&gt;&lt;em&gt;Welcome to the Comments Page&lt;/em&gt;&lt;/h1&gt; &lt;!-- 
Update this paragraph to describe the forum. --&gt; &lt;p&gt;Welcome to the 
Comments Forum.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;</pre> </li> </ul></li> 
<li>Many other tags can be used (and abused) in HTML pages 
<ul> 
<li>Use <code>ul</code> for an unordered (bulleted) list, and <code>ol</code> 
for an ordered (numbered) one
<ul> 
<li>Each list item is wrapped in <code>li</code></li> </ul></li> 
<li>Use <code>table</code> for tables 
<ul> 
<li>Each row is wrapped in <code>tr</code> (for &ldquo;table row&rdquo;)</li> 
<li>Within each row, column items are wrapped in <code>td</code> (for 
&ldquo;table data&rdquo;)</li> 
<li>Note: tables are often used to force multi-column layout, as well as for 
tabular data</li> </ul></li> 
<li> 
<pre>&lt;html&gt; &lt;head&gt; &lt;title&gt;Lists and Tables&lt;/title&gt; 
&lt;meta name=&quot;svn&quot; content=&quot;$Id: xml.swc 54 2005-04-13 
13:29:28Z gvwilson $&quot;/&gt; &lt;/head&gt; &lt;body&gt; &lt;table 
cellpadding=&quot;3&quot; border=&quot;1&quot;&gt; &lt;tr&gt; &lt;td 
align=&quot;center&quot;&gt;&lt;em&gt;Unordered List&lt;/em&gt;&lt;/td&gt; 
&lt;td align=&quot;center&quot;&gt;&lt;em&gt;Ordered List&lt;/em&gt;&lt;/td&gt; 
&lt;/tr&gt; &lt;tr&gt; &lt;td align=&quot;left&quot; valign=&quot;top&quot;&gt; 
&lt;ul&gt; &lt;li&gt;Hydrogen&lt;/li&gt; &lt;li&gt;Lithium&lt;/li&gt; 
&lt;li&gt;Sodium&lt;/li&gt; &lt;li&gt;Potassium&lt;/li&gt; 
&lt;li&gt;Rubidium&lt;/li&gt; &lt;li&gt;Cesium&lt;/li&gt; 
&lt;li&gt;Francium&lt;/li&gt; &lt;/ul&gt; &lt;/td&gt; &lt;td 
align=&quot;left&quot; valign=&quot;top&quot;&gt; &lt;ol&gt; 
&lt;li&gt;Helium&lt;/li&gt; &lt;li&gt;Neon&lt;/li&gt; 
&lt;li&gt;Argon&lt;/li&gt; &lt;li&gt;Krypton&lt;/li&gt; 
&lt;li&gt;Xenon&lt;/li&gt; &lt;li&gt;Radon&lt;/li&gt; &lt;/ol&gt; &lt;/td&gt; 
&lt;/tr&gt; &lt;/table&gt; &lt;/body&gt; &lt;/html&gt;</pre> 
<p> Figure 18.3: Lists and Tables</p> <br>
<br>
<br>
<br>
</li> 
<li>Note how Subversion keywords have been put in <code>meta</code> elements 
in document head
<ul> 
<li>Automatically updated each time the document is committed to version 
control</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Connecting to Other Data</h2> 
<ul> 
<li>How to put an image in a page? 
<ul> 
<li>XML documents can only contain text, so you can't store an image or audio 
clip directly in a page
<ul> 
<li>Unless you encode it as text</li> </ul></li> 
<li>Usual solution is to store a reference to the external file using the 
<code>img</code> tag 
<ul> 
<li>The <code>src</code> argument specifies where to find the image file</li> 
</ul></li> 
<li> 
<pre>&lt;html&gt; &lt;head&gt; &lt;title&gt;Images&lt;/title&gt; &lt;meta 
name=&quot;svn&quot; content=&quot;$Id: xml.swc 54 2005-04-13 13:29:28Z 
gvwilson $&quot;/&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Our Logo&lt;/h1&gt; 
&lt;img src=&quot;../../img/swc_logo.jpg&quot; alt=&quot;[Software Carpentry 
Logo]&quot;/&gt; &lt;/body&gt; &lt;/html&gt;</pre> 
<p> Figure 18.4: Images in Pages</p> <br>
<br>
<br>
<br>
</li> 
<li>Important to always use the <code>alt</code> attribute to specify 
alternative text
<ul> 
<li>Screen readers for people with visual handicaps use this instead of the 
image</li> 
<li>And it's good documentation for search engines</li> </ul></li> </ul></li> 
<li>Often, the &ldquo;other data&rdquo; you want to connect to is other HTML 
pages
<ul> 
<li>This is what makes it hypertext&hellip;</li> 
<li>Use the <code>a</code> element to create a link 
<ul> 
<li>The text inside the element is displayed and (usually) underlined for 
clicking</li> 
<li>The <code>href</code> attribute specifies what the link is pointing at</li>
<li>Both local filenames and URLs are supported</li> </ul></li> 
<li> 
<pre>&lt;html&gt; &lt;head&gt; &lt;title&gt;Links&lt;/title&gt; &lt;meta 
name=&quot;svn&quot; content=&quot;$Id: xml.swc 54 2005-04-13 13:29:28Z 
gvwilson $&quot;/&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;A Few of My Favorite 
Places&lt;/h1&gt; &lt;ul&gt; &lt;li&gt;&lt;a 
href=&quot;http://www.google.com&quot;&gt;Google&lt;/a&gt;&lt;/li&gt; 
&lt;li&gt;&lt;a 
href=&quot;http://www.python.org&quot;&gt;Python&lt;/a&gt;&lt;/li&gt; 
&lt;li&gt;&lt;a href=&quot;http://www.nature.com/index.html&quot;&gt;Nature 
Online&lt;/a&gt;&lt;/li&gt; &lt;li&gt;Examples in this lecture: &lt;ul&gt; 
&lt;li&gt;&lt;a href=&quot;comments.html&quot;&gt;Comments&lt;/a&gt;&lt;/li&gt; 
&lt;li&gt;&lt;a href=&quot;image.html&quot;&gt;Images&lt;/a&gt;&lt;/li&gt; 
&lt;li&gt;&lt;a href=&quot;list_table.html&quot;&gt;Lists and 
Tables&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/body&gt; 
&lt;/html&gt;</pre> 
<p> Figure 18.5: Links in Pages</p> <br>
<br>
<br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Accessibility</h2> 
<ul> 
<li>The web is not a particularly friendly place if you're visually disabled 
<ul> 
<li>Screenreaders have a hard time dealing with web pages that use graphics 
instead of text for buttons&hellip;</li> </ul></li> 
<li><code>Top 10 Accessible Web Authoring Practices</code> describes what you 
should do to make your pages more accessible
<ul> 
<li>All of these things help search engines and other automatic tools as well
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Document Object Model</h2> 
<ul> 
<li>The <em>Document Object Model</em> (DOM) is a cross-language standard for 
representing XML documents as trees
<ul> 
<li>Elements, attributes, and text all represented as objects</li> 
<li>Strengths: 
<ul> 
<li>Much easier to manipulate trees than strings</li> 
<li>Same basic model in many different languages (which lowers the learning 
cost)</li> </ul></li> 
<li>Weaknesses: 
<ul> 
<li>Needs a lot of memory for large documents</li> 
<li>Its generic model doesn't take advantage of the more advanced features of 
some languages</li> </ul></li> </ul></li> 
<li>Most popular alternative is SAX (the <em>Simple API for XML</em>) 
<ul> 
<li>Turns an XML document into a stream of events 
<ul> 
<li>&ldquo;Element, element, text, element, text&hellip;</li> </ul></li> 
<li>Easy to do very simple things&hellip;</li> 
<li>&hellip;but anything complex requires the programmer to reimplement a 
subset of DOM</li> </ul></li> 
<li>Python comes with a simple implementation of DOM called <code>minidom
</code> 
<ul> 
<li>Fast, sturdy, and well documented&hellip;</li> 
<li>&hellip;if you understand all the terminology, and know more or less what 
you're looking for)</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Basics</h2> 
<ul> 
<li>Every DOM tree has a single root representing the document as a whole 
<ul> 
<li>Doesn't correspond to anything that's actually <em>in</em> the document
</li> </ul></li> 
<li>This element has a single child, which is the root node of the document
</li> 
<li>This node, and other element nodes, may have three types of children: 
<ul> 
<li>Other elements</li> 
<li>Text nodes</li> 
<li>Attribute nodes</li> </ul></li> 
<li>Every node keeps track of what its parent is 
<ul> 
<li>Allows programs to search up the tree, as well as down</li> </ul></li> 
<li>Example: 
<ul> 
<li> XML DOM Tree <br>

<pre>&lt;root&gt; &lt;first&gt;element&lt;/first&gt; &lt;second 
attr=&quot;value&quot;&gt;element&lt;/second&gt; &lt;third-element/&gt; 
&lt;/root&gt;</pre> 
<p> Figure 18.6: A DOM Tree</p> <br>
<br>
<br>
<br>
</li> </ul></li> 
<li>Note: it's common to forget that text and attributes are stored in nodes 
of their own
<ul> 
<li>Some other Python implementations of DOM don't bother</li> 
<li>Make simple things simpler&hellip;</li> 
<li>&hellip;but only a little bit</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Creating a Tree</h2> 
<ul> 
<li>Usual way to create a DOM tree is to parse a file 
<ul> 
<li>If this is the file:</li> 
<li> 
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;planet name=&quot;Mercury&quot;&gt; &lt;period 
units=&quot;days&quot;&gt;87.97&lt;/period&gt; &lt;/planet&gt;</pre> </li> 
<li>Parse and print like this:</li> 
<li> 
<pre>import xml.dom.minidom doc = xml.dom.minidom.parse('mercury.xml') print 
doc.toxml('utf-8')</pre> 
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;planet name=&quot;Mercury&quot;&gt; &lt;period 
units=&quot;days&quot;&gt;87.97&lt;/period&gt; &lt;/planet&gt;</pre> </li> </ul>
</li> 
<li>The <code>toxml</code> method can be called on the document, or on any 
element node
<ul> 
<li>Note that we specify <code>&quot;utf-8&quot;</code> as the character 
encoding</li> 
<li>DOM trees <em>always</em> store text as <em>Unicode</em>, so when you're 
converting the tree to text, you must tell the library how to represent 
characters</li> </ul></li> 
<li>Can also create a tree by parsing a string 
<ul> 
<li>Works just like parsing a file</li> 
<li> 
<pre>import xml.dom.minidom src = '''&lt;planet name=&quot;Venus&quot;&gt; 
&lt;period units=&quot;days&quot;&gt;224.7&lt;/period&gt; &lt;/planet&gt;''' 
doc = xml.dom.minidom.parseString(src) print doc.toxml('utf-8')</pre> 
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;planet name=&quot;Venus&quot;&gt; &lt;period 
units=&quot;days&quot;&gt;224.7&lt;/period&gt; &lt;/planet&gt;</pre> </li> </ul>
</li> 
<li>Finally, can build a tree by hand 
<ul> 
<li> 
<pre>import xml.dom.minidom impl = xml.dom.minidom.getDOMImplementation() doc 
= impl.createDocument(None, 'planet', None) root = doc.documentElement 
root.setAttribute('name', 'Mars') period = doc.createElement('period') 
root.appendChild(period) text = doc.createTextNode('686.98') 
period.appendChild(text) print doc.toxml('utf-8')</pre> 
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;planet 
name=&quot;Mars&quot;&gt;&lt;period&gt;686.98&lt;/period&gt;&lt;/planet&gt;
</pre> </li> 
<li><code>xml.dom.minidom</code> is really just a wrapper around other 
platform-specific XML libraries
<ul> 
<li>Have to reach inside it and get the underlying implementation object to 
create the<code>document</code> node</li> 
<li>That node then knows how to create other elements in the document</li> 
<li>Library explains what the first and third arguments to <code>createDocument
</code> are</li> 
<li>Middle one tells <code>createDocument</code> what type of element the 
document's root node should be</li> </ul></li> 
<li>Set attributes of element nodes using <code>setAttribute(attributeName, 
newValue)</code> 
<ul> 
<li>Remember, all attribute values are strings</li> 
<li>If you want to store an integer or a Boolean, you have to convert it 
yourself</li> </ul></li> 
<li>Add new nodes to existing ones by: 
<ul> 
<li>Asking the document to create the node</li> 
<li>Appending it to a node that's already part of the tree</li> </ul></li> 
</ul></li> 
<li>Notice that the output of the preceding example wasn't nicely indented 
<ul> 
<li>We didn't tell DOM to create text nodes containing carriage returns and 
blanks</li> 
<li>Most machine-generated XML doesn't</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Walking a Tree</h2> 
<ul> 
<li>Often want to visit each node in the tree 
<ul> 
<li>E.g., print an outline of the document showing element nesting</li> </ul>
</li> 
<li>Simplest way is to write a recursive function 
<ul> 
<li> 
<pre>import xml.dom.minidom src = '''&lt;solarsystem&gt; &lt;planet 
name=&quot;Mercury&quot;&gt;&lt;period 
units=&quot;days&quot;&gt;87.97&lt;/period&gt;&lt;/planet&gt; &lt;planet 
name=&quot;Venus&quot;&gt;&lt;period 
units=&quot;days&quot;&gt;224.7&lt;/period&gt;&lt;/planet&gt; &lt;planet 
name=&quot;Earth&quot;&gt;&lt;period 
units=&quot;days&quot;&gt;365.26&lt;/period&gt;&lt;/planet&gt; 
&lt;/solarsystem&gt; ''' def walkTree(currentNode, indent=0): spaces = ' ' * 
indent if currentNode.nodeType == currentNode.TEXT_NODE: print spaces + 'TEXT' 
+ ' (%d)' % len(currentNode.data) else: print spaces + currentNode.tagName for 
child in currentNode.childNodes: walkTree(child, indent+1) doc = 
xml.dom.minidom.parseString(src) walkTree(doc.documentElement)</pre> 
<pre>solarsystem TEXT (1) planet period TEXT (5) TEXT (1) planet period TEXT 
(5) TEXT (1) planet period TEXT (6) TEXT (1)</pre> </li> 
<li>Node's type is stored in a member variable called <code>nodeType</code> 
<ul> 
<li><code>ELEMENT_NODE</code>, <code>TEXT_NODE</code>, <code>ATTRIBUTE_NODE
</code>, <code>DOCUMENT_NODE</code></li> </ul></li> 
<li>If a node is an element, its children are stored in a list called <code>
childNodes</code> 
<ul> 
<li>A read-only structure</li> 
<li>See how to add, delete, and move children in a moment</li> </ul></li> 
<li>If a node is a text node, the text is in the member <code>data</code> 
<ul> 
<li>The single-character text nodes are the carriage returns separating 
elements</li> </ul></li> </ul></li> 
<li>Traversing a tree like this is just one of many recurring patterns in 
object-oriented programming
<ul> 
<li>We'll discuss them briefly in Backward, Forward, and Sideways</li> </ul>
</li> 
<li>The <em>Visitor</em> pattern is used to separate traversal of a data 
structure from operations on its elements
<ul> 
<li>One class traverses a particular kind of structure the same way each time
</li> 
<li>User then defines the operation 
<ul> 
<li>Derive a class, pass a function as an argument, etc.</li> 
<li>The fact that this can be done in several different ways is what makes it 
a pattern</li> </ul></li> 
<li>Step 1: define generic behavior 
<ul> 
<li> 
<pre>class Visitor(object): def __init__(self): pass def visit(self, node): # 
When given the document, skip to the root. if node.nodeType == 
node.DOCUMENT_NODE: self.visit(node.documentElement) return # Handle other 
types of nodes. self.before(node) self.at(node) if node.nodeType == 
node.ELEMENT_NODE: for child in node.childNodes: self.visit(child) 
self.after(node) def doNothing(self, node): pass before = doNothing at = 
doNothing after = doNothing</pre> </li> 
<li>Users call <code>Visitor.visit</code> with the root node of the tree they 
want to traverse</li> 
<li>Override one or more of the three do-nothing methods to perform actions 
before, at, or after nodes</li> </ul></li> 
<li>Step 2: derive a class that does something useful (like count how many 
nodes are in the tree)
<ul> 
<li> 
<pre>class Counter(Visitor): def __init__(self): Visitor.__init__(self) 
self.count = 0 def at(self, node): if node.nodeType == node.ELEMENT_NODE: 
self.count += 1</pre> </li> 
<li>Initialize <code>count</code> to zero before traversing</li> 
<li>Increment the count at each element node</li> </ul></li> 
<li>Step 3: test 
<ul> 
<li> 
<pre>if __name__ == '__main__': src = 
'&lt;a&gt;&lt;b&gt;c&lt;/b&gt;&lt;d&gt;e&lt;/d&gt;&lt;f&gt;g&lt;h/&gt;i&lt;/f&gt;&lt;/a&gt;' 
tree = xml.dom.minidom.parseString(src) c = Counter() c.visit(tree) assert 
c.count == 5</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Modifying the Tree</h2> 
<ul> 
<li>Modifying trees in place is a little bit tricky 
<ul> 
<li>Helps to draw lots of pictures</li> </ul></li> 
<li>Example: want to <em>emphasize</em> the first word of each paragraph 
<ul> 
<li>Get the text node below the paragraph</li> 
<li>Take off the first word</li> 
<li>Insert a new <code>&lt;em/&gt;</code> element whose only child is a text 
node containing that word</li> 
<li> 
<p> Figure 18.7: Modifying the DOM Tree</p> <br>
<br>
</li> </ul></li> 
<li>Ah, but it's not that simple 
<ul> 
<li>What if the first child of the paragraph already has some markup around it?
<ul> 
<li>E.g., what if the paragraph starts with a link?</li> </ul></li> 
<li>Could just wrap the first child with <code>&lt;em/&gt;</code> 
<ul> 
<li>But if (for example) the link contains several words, this will look wrong
</li> </ul></li> 
<li>We'll ignore this problem for now</li> </ul></li> 
<li>First part of solution: find all the paragraphs using <code>
getElementsByTagName</code>, and iterate over them 
<ul> 
<li>You'll use this method a lot&hellip;</li> 
<li> 
<pre>def emphasize(doc): paragraphs = doc.getElementsByTagName('p') for para 
in paragraphs: first = para.firstChild if first.nodeType == first.TEXT_NODE: 
emphasizeText(doc, para, first)</pre> </li> </ul></li> 
<li>Second part: break the paragraph text into pieces, and handle each piece 
in turn
<ul> 
<li>Create a new node for each piece</li> 
<li>Push it onto the front of the paragraph's child list</li> 
<li>Once they've all been handled, get rid of the original text node</li> 
<li> 
<pre>def emphasizeText(doc, para, textNode): # Look for optional spaces, a 
word, and the rest of the paragraph. m = re.match(r'^(\s*)(\S*)\b(.*)$', 
str(textNode.data)) if not m: return leadingSpace, firstWord, restOfText = 
m.groups() if not firstWord: return # If there's text after the first word, 
re-save it. if restOfText: restOfText = doc.createTextNode(restOfText) 
para.insertBefore(restOfText, para.firstChild) # Emphasize the first word. emph 
= doc.createElement('em') emph.appendChild(doc.createTextNode(firstWord)) 
para.insertBefore(emph, para.firstChild) # If there's leading space, re-save 
it. if leadingSpace: leadingSpace = doc.createTextNode(leadingSpace) 
para.insertBefore(leadingSpace, para.firstChild) # Get rid of the original 
text. para.removeChild(textNode)</pre> </li> </ul></li> 
<li>Third part: test it 
<ul> 
<li>Yes, it really is part of the program</li> 
<li> 
<pre>if __name__ == '__main__': src = '''&lt;html&gt;&lt;body&gt; 
&lt;p&gt;First paragraph.&lt;/p&gt; &lt;p&gt;Second paragraph contains 
&lt;em&gt;emphasis&lt;/em&gt;.&lt;/p&gt; &lt;p&gt;Third paragraph.&lt;/p&gt; 
&lt;/body&gt;&lt;/html&gt;''' doc = xml.dom.minidom.parseString(src) 
emphasize(doc) print doc.toxml('utf-8')</pre> 
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;html&gt;&lt;body&gt; &lt;p&gt;&lt;em&gt;First&lt;/em&gt; 
paragraph.&lt;/p&gt; &lt;p&gt;&lt;em&gt;Second&lt;/em&gt; paragraph contains 
&lt;em&gt;emphasis&lt;/em&gt;.&lt;/p&gt; &lt;p&gt;&lt;em&gt;Third&lt;/em&gt; 
paragraph.&lt;/p&gt; &lt;/body&gt;&lt;/html&gt;</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>There's a lot of hype in hypertext 
<ul> 
<li>Haven't yet heard anyone claim that XML will cure the common cold, but I'm 
sure it's been said</li> </ul></li> 
<li>Strengths: 
<ul> 
<li>One set of rules for people to learn</li> 
<li>One parser can handle all of their data 
<ul> 
<li>At least, the low-level syntactic bits&mdash;still need to figure out what 
all those tags<em>mean</em></li> </ul></li> </ul></li> 
<li>Weaknesses: 
<ul> 
<li>Raw XML is hard to read 
<ul> 
<li>Particularly if it has been generated by a machine</li> </ul></li> 
<li>A lot of data isn't actually trees 
<ul> 
<li>When storing a 2D matrix or a table, you have to organize data by row or 
by column&hellip;</li> 
<li>&hellip;either of which makes the other hard to access</li> </ul></li> 
<li>There are a lot of complications and subtleties 
<ul> 
<li>Most applications ignore most of them</li> 
<li>Which means that they fail (usually badly) when confronted with something 
outside the subset they understand</li> </ul></li> </ul></li> 
<li>Like Inglish speling, it's here to stay</li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>A Mini-Project</h1> prev  Draft Version 398 next <br>
<br>

<h2>Eating Your Own Cooking</h2> 
<ul> 
<li>Been talking since the first lecture about the importance of tools, and 
about building your own to automate repetitive tasks</li> 
<li>This lecture takes a look at some of the tools used to manage the raw 
material for this course
<ul> 
<li>Show technologies like XML and regular expressions in action</li> 
<li>Show how to design something simple, and grow it over time</li> </ul></li> 
<li>Starting point: lecture slides are written in a simple XML format 
<ul> 
<li>Root of each lecture is a <code>&lt;lec/&gt;</code> element with <code>
title</code> and <code>id</code> attributes</li> 
<li>May contain one or more <code>&lt;topic/&gt;</code> elements 
<ul> 
<li>Must have <code>title</code> attribute</li> 
<li>May optionally have a <code>summary</code> attribute (used to construct 
the syllabus)</li> </ul></li> 
<li>Topics contain one or more <code>&lt;slide/&gt;</code> elements 
<ul> 
<li>These contain <code>&lt;b1/&gt;</code> (for &ldquo;bullet level 1&rdquo;), 
which contain<code>&lt;b2/&gt;</code>, and so on</li> 
<li>May also contain tables, images, and code fragments</li> </ul></li> </ul>
</li> 
<li>Our task is to validate these files to make sure that: 
<ul> 
<li>They contain only printable characters</li> 
<li>Tabs haven't been used for indentation</li> 
<li>The ID in the root <code>&lt;lec/&gt;</code> element matches the filename
</li> 
<li>All the external files the lecture references (such as images and sample 
code) exist</li> </ul></li> 
<li>Solution: write a command-line utility that: 
<ul> 
<li>Takes a list of filenames, along with</li> 
<li>Some command-line flags specifying which checks to run (or omit), and</li> 
<li>Reports any problems</li> </ul></li> 
<li>You probably won't ever need to do this for lecture slides&hellip; 
<ul> 
<li>&hellip;but at some point, you probably <em>will</em> want to check the 
integrity of data files, experimental results, etc.</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Checking for Tabs</h2> 
<ul> 
<li>Start with the simplest task: checking for tabs in files 
<ul> 
<li>Open each file in turn</li> 
<li>Check each line for tabs 
<ul> 
<li>Note: could also read entire contents of file into a string, and search 
for tabs in that</li> </ul></li> 
<li>If any found, print message</li> 
<li> 
<pre>#!/usr/bin/env python '''Check for tabs in one or more files.''' import 
sys def checkTabs(filename): '''Look for tabs.''' infile = open(filename, 'r') 
for line in infile.readlines(): if line.find('\t') &gt;= 0: print '%s contains 
tabs' % filename break infile.close() if __name__ == '__main__': for filename 
in sys.argv[1:]: checkTabs(filename)</pre> </li> </ul></li> 
<li>Great&mdash;except it only works on files 
<ul> 
<li>Can't pipe things to it, because it doesn't know how to read standard input
</li> </ul></li> 
<li>Implement the standard Unix convention: if no filenames provided, read 
from standard input
<ul> 
<li>Hm&hellip;<code>sys.stdin</code> is an already-open file, not a filename
</li> 
<li>Change signature of <code>checkTabs</code> to take both the filename, and 
an open file
<ul> 
<li>Move the <code>open</code> and <code>close</code> to the main body</li> 
</ul></li> 
<li> 
<pre>#!/usr/bin/env python '''Check for tabs in one or more files, or on 
standard input.''' import sys def checkTabs(filename, infile): '''Look for 
tabs.''' for line in infile.readlines(): if line.find('\t') &gt;= 0: print '%s 
contains tabs' % filename break if __name__ == '__main__': if len(sys.argv) == 
1: checkTabs('&lt;stdin&gt;', sys.stdin) else: for filename in sys.argv[1:]: 
infile = open(filename, 'r') checkTabs(filename, infile) infile.close()</pre> 
</li> </ul></li> 
<li>Great&mdash;except it doesn't report errors like missing or unreadable 
files
<ul> 
<li>Printing a stack trace doesn't count</li> </ul></li> 
<li>Fix by wrapping the code in an exception handler 
<ul> 
<li>Only catch the kinds of exceptions we think are reasonable to expect 
<ul> 
<li>In this case, <code>IOError</code></li> </ul></li> 
<li>Don't want the error handling to mask errors that we didn't anticipate</li>
<li> 
<pre>#!/usr/bin/env python '''Check for tabs in one or more files, or on 
standard input, and report errors.''' import sys def checkTabs(filename, 
infile): '''Look for tabs.''' for line in infile.readlines(): if 
line.find('\t') &gt;= 0: print '%s contains tabs' % filename break if __name__ 
== '__main__': try: if len(sys.argv) == 1: checkTabs('&lt;stdin&gt;', 
sys.stdin) else: for filename in sys.argv[1:]: infile = open(filename, 'r') 
checkTabs(filename, infile) infile.close() except IOError, e: print &gt;&gt; 
sys.stderr, e</pre> </li> 
<li>Note: could equally well put the exception handler: 
<ul> 
<li>Inside the <code>else</code> (since we don't think I/O errors can happen 
while reading standard input)</li> 
<li>Inside the <code>for</code> (so that if an error occurs while reading one 
file, the program continues on to the next)</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Running Tools</h2> 
<ul> 
<li>Now, how to run the validation tool? 
<ul> 
<li><code>python check_tabs.py file1 fil2 file&hellip;</code> will work&hellip;
</li> 
<li>&hellip;but typing in a bunch of filenames every time would be annoying 
<ul> 
<li>Which means that we wouldn't do it as often as we should</li> </ul></li> 
<li>And we know we're going to have other validation tools to run as well</li> 
</ul></li> 
<li>Put the command in a Makefile 
<ul> 
<li>If it's worth doing again, it's worth automating</li> </ul></li> 
<li>Directory structure of the course: 
<ul> 
<li>A root directory 
<ul> 
<li>The Makefile goes here</li> </ul></li> 
<li><code>lec</code> for lecture notes (in <code>.swc</code> files)</li> 
<li><code>util</code> for utility programs (like the validation tools)</li> 
<li><code>img</code> for images 
<ul> 
<li>Images for <code>lec/xyz.swc</code> go in the <code>img/xyz</code> 
directory</li> </ul></li> 
<li><code>src</code> for source code 
<ul> 
<li><code>src/xyz</code> holds sample files for the XYZ lecture</li> </ul></li>
</ul></li> 
<li>Makefile runs tab checker on all <code>.swc</code> files 
<ul> 
<li> 
<pre># Re-make everything used in the Software Carpentry course. all : @echo 
'options: clean validate' clean : @rm -f *~ */*~ */*/*~ validate : @python 
util/check_tabs.py lec/*.swc</pre> </li> 
<li>Note: also added a <code>clean</code> target that gets rid of editor 
backup files ending in<code>~</code></li> 
<li>And a default target called <code>all</code>, that lists the things the 
Makefile can do</li> 
<li>Remember, the <code>&quot;@&quot;</code> in front of the commands means, 
&ldquo;Don't echo the command before running it&rdquo;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Checking for Printable Characters</h2> 
<ul> 
<li>Next on the list: make sure that files only contain printable characters 
<ul> 
<li>I.e., whitespace, alphanumeric, and punctuation</li> </ul></li> 
<li>Some editors insert &ldquo;smart&rdquo; (curly) quotes, automatically 
convert<code>&quot;---&quot;</code> into <code>&quot;&mdash;&quot;</code>, etc. 
<ul> 
<li>But other editors can't display these</li> 
<li>So disallow them, and require authors to use XML escape sequences for 
anything special</li> </ul></li> 
<li>Solution: make sure every character in the file is in <code>
string.printable</code> 
<ul> 
<li>Contains letters, digits, spaces, and common punctuation</li> 
<li>Easier to use this than to write our own regular expression</li> </ul></li>
<li>Should we add this function to the existing validation program, or create 
a second program?
<ul> 
<li>The former lets the checking functions share the code that opens files, 
handles errors, etc.</li> 
<li>The latter makes it easier to re-use the pieces separately</li> </ul></li> 
<li>Solution: put them in the same program, and provide command-line flags to 
disable certain tests
<ul> 
<li>Might be philosophically purer to have the flags turn tests on&hellip;</li>
<li>&hellip;but the normal case is going to be run them all</li> </ul></li> 
<li>Parse command-line options using the <code>getopt</code> module 
<ul> 
<li>First argument is the list of command-line arguments to parse 
<ul> 
<li>Not including <code>sys.argv[0]</code>, which is the name of the program
</li> </ul></li> 
<li>Second is a string telling it what flags to look for, and whether they 
take arguments
<ul> 
<li><code>&quot;a:bcd:&quot;</code> means &ldquo;-a and -d have an argument, 
-b and -c don't&rdquo;</li> </ul></li> 
<li> 
<pre> doPrintable = True doTabs = True settings, filenames = 
getopt.getopt(sys.argv[1:], 'pt') for (opt, arg) in settings: if opt == '-p': 
doPrintable = False elif opt == '-t': doTabs = False</pre> </li> </ul></li> 
<li>Have to make another change to <code>checkTabs</code> 
<ul> 
<li>It and <code>checkPrintable</code> need to process the same data</li> 
<li>So neither can read that data in from the file 
<ul> 
<li>Unless we want to open and read the file twice</li> </ul></li> 
<li>Solution: separate input, processing, and output 
<ul> 
<li>Main body reads data and calls validation functions</li> </ul></li> 
<li> 
<pre> try: if not filenames: lines = sys.stdin.readlines() 
checkTabs('&lt;stdin&gt;', lines) checkPrintable('&lt;stdin&gt;', lines) else: 
for filename in filenames: infile = open(filename, 'r') lines = 
infile.readlines() infile.close() checkTabs(filename, lines) 
checkPrintable(filename, lines) except IOError, e: print &gt;&gt; sys.stderr, e
</pre> </li> 
<li>Change to <code>checkTabs</code> is easy</li> 
<li> 
<pre>def checkTabs(filename, lines): '''Look for tabs.''' for line in lines: 
if line.find('\t') &gt;= 0: print '%s contains tabs' % filename break</pre> 
</li> 
<li>And <code>checkPrintable</code> is simple as well</li> 
<li> 
<pre>def checkPrintable(filename, lines): '''Look for non-printable 
characters.''' for line in lines: for c in line: if c not in string.printable: 
print '%s contains non-printable characters' % filename print line break</pre> 
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Checking Glossary Entries</h2> 
<ul> 
<li>Course has a glossary that defines new or unusual terms 
<ul> 
<li>Entries in lectures are formatted as <code>&lt;d 
ref=&quot;immutable&quot;&gt;Immutable&lt;/d&gt;</code> 
<ul> 
<li><code>&lt;d/&gt;</code> for &ldquo;definition&rdquo;</li> 
<li><code>ref</code> attribute is the term that appears in the glossary</li> 
<li>Contained text is displayed in-line</li> </ul></li> 
<li>Glossary is structured like this: 
<ul> 
<li> 
<pre>&lt;glossary&gt; &lt;glosssec title=&quot;A&quot;&gt; &lt;glossitem 
id=&quot;absolute_path&quot; term=&quot;absolute 
path&quot;&gt;...definition...&lt;/glossitem&gt; &lt;glossitem 
id=&quot;abstract_data_types&quot; term=&quot;abstract data 
types&quot;&gt;...&lt;/glossitem&gt; &lt;glossitem 
id=&quot;access_control&quot; term=&quot;access 
control&quot;&gt;...&lt;/glossitem&gt; ... &lt;glossitem 
id=&quot;automatic_variables&quot; term=&quot;automatic variables (in 
Make)&quot;&gt;...&lt;/glossitem&gt; &lt;/glosssec&gt; ... &lt;/glossary&gt;
</pre> </li> </ul></li> </ul></li> 
<li>Goal: make sure every term is defined once, and only once 
<ul> 
<li>Read in the glossary</li> 
<li>Record the item IDs</li> 
<li>Read a set of files, marking items as they're seen 
<ul> 
<li>If an item has already been marked, report the duplication</li> </ul></li> 
<li>At the end, look for items that haven't been marked off</li> </ul></li> 
<li>Hm&hellip;what happens if we're only checking one file? 
<ul> 
<li>Want to be able to suppress the check for all items being marked off</li> 
<li>So need two flags: 
<ul> 
<li>One to specify the name of the glossary file (so we don't try to read it 
as a lecture file)</li> 
<li>One to turn off the check for all items being marked off</li> </ul></li> 
<li> 
<pre> glossary = None doGlossaryComplete = True doPrintable = True doTabs = 
True settings, filenames = getopt.getopt(sys.argv[1:], 'G:gpt') for (opt, arg) 
in settings: if opt == '-G': glossary = arg elif opt == '-g': 
doGlossaryComplete = False elif opt == '-p': doPrintable = False elif opt == 
'-t': doTabs = False</pre> </li> 
<li>Note: if no glossary file specified, don't check glossary items at all</li>
</ul></li> 
<li>Now have enough logic that it's worth reorganizing the main processing loop
<ul> 
<li>If no filenames specified, set the list of filenames to <code>
['&lt;stdin&gt;']</code></li> 
<li>Write a function <code>readFile</code> to open and read a file 
<ul> 
<li>If the function name is <code>&quot;&lt;stdin&gt;&quot;</code>, it reads 
from<code>sys.stdin</code></li> 
<li>Have function function return both a list of lines, and the XML DOM tree
</li> 
<li>We need the first to check for tabs and printable characters, and the 
second to look for glossary items</li> </ul></li> 
<li>Modified processing code includes checks for what to do with the glossary 
<ul> 
<li> 
<pre> try: if glossary: glossary = readGlossaryFile(glossary) if not 
filenames: filenames = ['&lt;stdin&gt;'] for filename in filenames: lines, doc 
= readFile(filename) checkTabs(filename, lines) checkPrintable(filename, lines) 
if glossary: checkGlossary(filename, doc, glossary) if glossary and 
doGlossaryComplete: checkGlossaryComplete(glossary) except IOError, e: print 
&gt;&gt; sys.stderr, e except xml.parsers.expat.ExpatError, e: print &gt;&gt; 
sys.stderr, e</pre> </li> </ul></li> 
<li>Then write <code>readFile</code> 
<ul> 
<li> 
<pre>def readFile(filename): if filename == '&lt;stdin&gt;': data = 
sys.stdin.read() else: infile = open(filename, 'r') data = infile.read() 
infile.close() infile = cStringIO.StringIO(data) lines = infile.readlines() doc 
= xml.dom.minidom.parseString(data) return lines, doc</pre> </li> </ul></li> 
</ul></li> 
<li>Three functions left to write 
<ul> 
<li><code>readGlossaryFile</code> builds a dictionary whose keys are the terms 
defined in the glossary
<ul> 
<li>Values are <code>None</code> for now&mdash;see why in a moment</li> 
<li> 
<pre>def readGlossaryFile(filename): if filename is None: return None infile = 
open(filename, 'r') doc = xml.dom.minidom.parse(infile) terms = 
doc.getElementsByTagName('glossitem') result = {} for term in terms: t = 
str(term.getAttribute('id')) result[t] = None return result</pre> </li> </ul>
</li> 
<li><code>checkGlossary</code> processes uses of glossary terms in a single 
lecture file
<ul> 
<li>Records the name of the file in which the term appears in the <code>
glossary</code> dictionary</li> 
<li>If some other filename is already there, reports duplicate definition</li> 
<li> 
<pre>def checkGlossary(filename, doc, glossary): defns = 
doc.getElementsByTagName('d') for defn in defns: d = 
str(defn.getAttribute('ref')) if d not in glossary: print 'term %s in %s 
missing from glossary' % (d, filename) elif glossary[d] is not None: print 
'term %s defined in %s and %s' % (d, filename, glossary[d]) else: glossary[d] = 
filename</pre> </li> </ul></li> 
<li><code>checkGlossaryComplete</code> looks for glossary entries without 
associated filenames
<ul> 
<li>I.e., terms that are in the glossary, but aren't highlighted anywhere in 
the lectures</li> 
<li> 
<pre>def checkGlossaryComplete(glossary): unused = [] for g in glossary: if 
glossary[g] is None: unused.append(g) if unused: unused.sort() print 'unused 
terms' for u in unused: print '\t%s' % u</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Checking Cross-References</h2> 
<ul> 
<li>Last task (for now): check external files 
<ul> 
<li>Every code fragment and image that's referenced must exist</li> 
<li>Every code file and image must be referenced</li> </ul></li> 
<li>Obvious opportunities for abstraction 
<ul> 
<li>Get the set of files in a directory</li> 
<li>Get the set of files referenced in the lecture file</li> 
<li>Report differences in both directions</li> </ul></li> 
<li>Follow the pattern used for checking the glossary 
<ul> 
<li><code>-I dir</code> specifies the root directory for images 
<ul> 
<li>If none provided, don't check images</li> </ul></li> 
<li><code>-C dir</code> specifies the root directory for code fragments 
<ul> 
<li>Ditto</li> </ul></li> 
<li>Use the value of the lecture's <code>id</code> attribute to determine 
which particular subdirectory to search
<ul> 
<li>No point having a &ldquo;don't bother to check completeness&rdquo; option, 
since each lecture's files are stored separately</li> </ul></li> </ul></li> 
<li>Add options to <code>getopt.getopt</code> string, and four more lines to 
the main processing loop
<ul> 
<li> 
<pre> if codeRootDir: checkFiles(filename, doc, codeRootDir, 'code', 'src') if 
imageRootDir: checkFiles(filename, doc, imageRootDir, 'img', 'src')</pre> </li> 
</ul></li> 
<li>Write <code>checkFiles</code> 
<ul> 
<li>Construct the path to the directory</li> 
<li>Find out what it contains 
<ul> 
<li>Subtract things like the <code>.svn</code> directory</li> 
<li>Note how we've left room for other things to be excluded?</li> </ul></li> 
<li>Find out what's used in the document 
<ul> 
<li>Using a <code>Set</code> automatically handles multiple references to a 
single source file</li> </ul></li> 
<li>Rely on set subtraction to find differences</li> 
<li> 
<pre>def checkFiles(filename, doc, rootDir, eltName, attrName): # What should 
we ignore? Excludes = ['.svn'] # Find out where we're supposed to look. docId = 
str(doc.documentElement.getAttribute('id')) dir = os.path.join(rootDir, docId) 
if not os.path.isdir(dir): print &gt;&gt; sys.stderr, 'Missing directory: %s' % 
dir return # Find out what's there that we care about. actual = 
Set(os.listdir(dir)) for e in Excludes: actual.discard(e) # Find what's used in 
the document. elts = doc.getElementsByTagName(eltName) referenced = Set() for e 
in elts: if e.hasAttribute(attrName): 
referenced.add(str(e.getAttribute(attrName))) # Show differences (if any). 
showDiff(filename, dir, 'not found', referenced - actual) showDiff(filename, 
dir, 'unused', actual - referenced)</pre> </li> 
<li>Then write the helper function <code>showDiff</code> 
<ul> 
<li> 
<pre>def showDiff(filename, dir, title, values): if len(values): print '%s 
(for file %s and directory %s):' % (title, filename, dir) for v in values: 
print '\t%s' % v</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>It took an hour to write and debug this code 
<ul> 
<li>Started with something simple</li> 
<li>Tested everything as I wrote it 
<ul> 
<li>Found and fixed 31 errors in the lecture notes</li> </ul></li> </ul></li> 
<li>Now type <code>make clean</code> and <code>make validate</code> before 
doing a commit
<ul> 
<li>Ensures that what goes into the repository has at least some chance of 
being sensible</li> 
<li>Ensures that what other people add to the course will conform to style and 
usage rules</li> </ul></li> 
<li>Course materials include several other tools 
<ul> 
<li>Re-run sample programs and check that the output stored in the lectures is 
still correct</li> 
<li>Translate lecture notes, glossary, and bibliography into HTML</li> 
<li>Extract <code>summary</code> values from each <code>&lt;topic/&gt;</code> 
element to create HTML version of course syllabus</li> 
<li>Etc.</li> </ul></li> 
<li> [Clark 2004] discusses other things you can do to automate routine 
project maintenance tasks
<ul> 
<li>Prevents your project materials from rusting 
<ul> 
<li>Which makes those materials easier to share</li> 
<li>And gives you higher confidence that they're working correctly</li> </ul>
</li> 
<li>Gives you more time to concentrate on things that actually require human 
attention</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 19.1:</p> 
<p>What does <code>getopt</code> do when it encounters an argument it doesn't 
recognize? Write a short program that demonstrates this behavior, that can be 
run on its own without the user passing in any command-line arguments.</p> prev 
top next <br>
<br>

<h1>Binary Data</h1> prev  Draft Version 546 next <br>
<br>

<h2>Isn't It All 'Binary'?</h2> 
<ul> 
<li>All data is stored as 1's and 0's</li> 
<li>But those 1's and 0's may represent: 
<ul> 
<li>Characters that can be displayed as text</li> 
<li>Something else</li> </ul></li> 
<li>That &ldquo;something else&rdquo; is (misleadingly) called <em>binary data
</em> 
<ul> 
<li>Usually means &ldquo;anything you can't manipulate it with a standard text 
editor&rdquo;</li> </ul></li> 
<li>Why use it? 
<ul> 
<li>Size 
<ul> 
<li><code>&quot;10239472&quot;</code> is 8 bytes long</li> 
<li>The 32-bit integer it represents is 4 bytes</li> 
<li><code>&quot;False&quot;</code> is 5 bytes, 0 is one bit (40:1)</li> </ul>
</li> 
<li>Speed 
<ul> 
<li>Takes dozens of operations to add the integer represented by <code>
&quot;34&quot;</code> to the one represented by <code>&quot;57&quot;</code></li>
</ul></li> 
<li>Hardware interfaces 
<ul> 
<li>Somewhere, something has to convert the electrical signal from the gas 
chromatograph to a readable number</li> </ul></li> 
<li>Lack of anything better 
<ul> 
<li>It's possible to represent images as text (ASCII art, PostScript)</li> 
<li>But sound? Or movies?</li> </ul></li> </ul></li> 
<li>A lot of scientific data is stored in binary formats 
<ul> 
<li>Important to know how to work with it</li> 
<li>But please, don't write code to do this unless you absolutely have to 
<ul> 
<li>Good libraries exist for working with every image, sound, and video format 
out there</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How Numbers Are Stored</h2> 
<ul> 
<li>Positive numbers stored in base-2 format 
<ul> 
<li>10012 is <em>(1&times;23)+(0&times;22)+(0&times;21)+(1&times;20) = 9</em>
</li> </ul></li> 
<li>Could use sign-and-value for negative numbers 
<ul> 
<li>00112 would be 310, 10112 would be -310</li> 
<li>But then there'd be two representations of zero (0000 and 1000)</li> </ul>
</li> 
<li>More efficient to use <em>two's complement</em> 
<ul> 
<li>&ldquo;Roll over&rdquo; when going below zero, like a car's odometer</li> 
<li>11112 is -110, 11102 is -210, etc.</li> 
<li>10002 is the most negative 4-bit integer, 01112 the most positive</li> 
<li>Asymmetric: there is one more negative number than positive 
<ul> 
<li>Since there has to be room for 0 in the middle</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Bitwise Operators</h2> 
<ul> 
<li>Like most languages, Python has four operators that work on bits 
<ul> 
<li> Name Symbol Purpose Example <br>
And <code>&amp;</code> 1 if both bits 
are 1, 0 otherwise <code>0110 &amp; 1010 = 0010</code> <br>
Or <code>|</code> 1 
if either bit is 1 <code>0110 &amp; 1010 = 1110</code> <br>
Xor <code>^</code> 
1 if the bits are different, 0 if they're the same <code>0110 &amp; 1010 = 1100
</code> <br>
Not <code>~</code> Flip each bit <code>~0110 = 1001</code> <br>

<br> 
<p> Table 20.1: Bitwise Operators in Python</p> </li> 
<li>Note: the name &ldquo;xor&rdquo; is short for &ldquo;exclusive or&rdquo;, 
i.e., either/or</li> </ul></li> 
<li>Common to store several independent yes-or-no flags as a set of bits 
<ul> 
<li>Example: need to record whether a sample contains any mercury, phosphorus, 
or chlorine</li> 
<li>Use bit 1 for mercury, bit 2 for phosphorus, bit 3 for chlorine</li> 
<li> 
<p> Figure 20.1: Using Bits to Record Sets of Flags</p> <br>
<br>
</li> 
<li>Define constants to test for particular elements</li> 
<li> 
<pre># hex binary MERCURY = 0x01 # 0001 PHOSPHORUS = 0x02 # 0010 CHLORINE = 
0x04 # 0100 # Sample contains mercury and chlorine sample = MERCURY | CHLORINE 
print 'sample: %04x' % sample # Check for various elements for (flag, name) in 
[[MERCURY, &quot;mercury&quot;], [PHOSPHORUS, &quot;phosphorus&quot;], 
[CHLORINE, &quot;chlorine&quot;]]: if sample &amp; flag: print 'sample 
contains', name else: print 'sample does not contain', name</pre> 
<pre>sample: 0005 sample contains mercury sample does not contain phosphorus 
sample contains chlorine</pre> </li> </ul></li> 
<li>Can use and, or, and not to set specific bits to 1 or 0 
<ul> 
<li>To set the <em>ith</em> of <code>x</code> to 1: 
<ul> 
<li>Create a value <code>mask</code> in which bit <em>i</em> is 1 and all 
others are 0</li> 
<li>Use <code>x = x | mask</code></li> </ul></li> 
<li>To set the <em>ith</em> of <code>x</code> to 0: 
<ul> 
<li>Create a value <code>mask</code> in which bit <em>i</em> is 1 and all 
others are 0</li> 
<li>Negate it using <code>~</code>, so that the <em>ith</em> bit is 0, and all 
the others are 1</li> 
<li>Use <code>x = x &amp; mask</code></li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Shifting</h2> 
<ul> 
<li>Shifting an integer's bits left <em>N</em> places written as <code>x 
&lt;&lt; N</code> 
<ul> 
<li>Each leftward shift corresponds to multiplying by 2</li> 
<li>Just as shifting a decimal number left corresponds to multiplying by 10
</li> 
<li>Example: 6&lt;&lt;2 is 01102&lt;&lt;2, or 11002, which is 12</li> </ul>
</li> 
<li>Shifting a number right corresponds to division by 2 (throwing away the 
remainder)
<ul> 
<li>710&gt;&gt;1 is 01112&gt;&gt;1, or 00112, which is 310</li> </ul></li> 
<li>Shifting is <em>not</em> more efficient than multiplication and division 
on modern computers</li> 
<li>What happens if the top bit changes value as a result of a shift? 
<ul> 
<li>610&lt;&lt;1 = 01102&lt;&lt;1 = 11002</li> 
<li>On a 4-bit machine, this is -410, not 1210</li> 
<li>Some machines preserve the sign bit when shifting down 
<ul> 
<li>So 11002&gt;&gt;1 = 11102, instead of 01102</li> 
<li>Depends on the hardware being used</li> 
<li>Java provides a separate operator for this</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Floating Point</h2> 
<ul> 
<li>Floating point numbers are more complicated 
<ul> 
<li>A 32-bit float has: 
<ul> 
<li>One bit for the sign</li> 
<li>23 bits for the <em>mantissa</em> (or value)</li> 
<li>8 bits for the <em>exponent</em></li> 
<li> 
<p> Figure 20.2: Floating Point Representation</p> <br>
<br>
</li> </ul></li> 
</ul></li> 
<li>This means that you can only represent a fixed set of values 
<ul> 
<li>If the actual value isn't in that set, you must settle for the closest 
available approximation</li> </ul></li> 
<li>Consequence #1: values are unevenly spaced 
<ul> 
<li>Imagine we only had 6 bits for each floating-point number (1 sign, 3 
mantissa, 2 exponent)</li> 
<li>Means less absolute precision for numbers with larger magnitudes</li> 
<li> 
<p> Figure 20.3: Uneven Spacing of Floating-Point Numbers</p> <br>
<br>
</li> 
</ul></li> 
<li>Consequence #2: roundoff errors 
<ul> 
<li>Our system can represent 6, and it can represent &frac14;, but not 
5&frac34;</li> 
<li>So <em>6 - 0.25</em> is <em>6</em>, not <em>5.75</em> 
<ul> 
<li>And if <em>6 - 0.25 - 0.25 - 0.25 - 0.25</em> is evaluated left to right, 
the answer is still<em>6</em></li> </ul></li> 
<li>This is <em>not</em> random 
<ul> 
<li>Happens exactly the same way every time</li> </ul></li> 
<li>But it <em>is</em> very hard to reason about 
<ul> 
<li>Which is why people get Ph.D.'s in numerical analysis</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Binary I/O</h2> 
<ul> 
<li>Read and write binary data using standard file methods 
<ul> 
<li><code>f.read(N)</code> reads (up to) next N bytes 
<ul> 
<li>Result is returned as a string, but there's no guarantee its contents are 
readable</li> 
<li>If the file is empty, returns <code>None</code></li> </ul></li> 
<li><code>f.write(str)</code> writes the bytes in the string <code>str</code>
</li> </ul></li> 
<li>Caution: must open files in <em>binary mode</em> on Windows 
<ul> 
<li><code>input = open(filename, 'rb')</code> (and similarly for output)</li> 
<li>Otherwise, the low-level routines Python relies on convert Windows line 
endings<code>&quot;\r\n&quot;</code> to Unix-style <code>&quot;\n&quot;</code>
&hellip;</li> 
<li>&hellip;which is an unkind thing to do to an image</li> 
<li>Example: open a file using <code>&quot;r&quot;</code>, then in <code>
&quot;rb&quot;</code> 
<ul> 
<li>Identical on Unix, but different on Windows</li> 
<li> 
<pre>import sys print sys.platform for mode in ('r', 'rb'): f = 
open('open_binary.py', mode) s = f.read(40) f.close() print repr(s)</pre> 
<pre>linux2 'import sys\nprint sys.platform\nfor mode i' 'import sys\nprint 
sys.platform\nfor mode i'</pre> </li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Packing and Unpacking</h2> 
<ul> 
<li>In C and Fortran, an integer is a raw 32-bit value 
<ul> 
<li><code>fwrite(&amp;array, sizeof(int), 3, file)</code> will write 3 4-byte 
integers from address<code>array</code> to <code>file</code></li> </ul></li> 
<li>Python, Java, and other languages usually don't use raw values 
<ul> 
<li>There's no guarantee that things like lists are stored contiguously in 
memory&hellip;</li> 
<li>&hellip;so programs need to <em>pack</em> data into contiguous bytes for 
writing&hellip;</li> 
<li>&hellip;and <em>unpack</em> those bytes to recreate the structures when 
reading</li> </ul></li> 
<li>Packing looks a lot like formatting a string 
<ul> 
<li>A format specifies the data types being packed (including sizes, where 
appropriate)</li> 
<li>This format exactly determines how much memory is required by the packed 
representation</li> 
<li>The result of packing is a chunk of bytes 
<ul> 
<li>Stored as a string in Python</li> 
<li>But as mentioned above, it's not a string of characters</li> </ul></li> 
<li> 
<p> Figure 20.4: Packing Data</p> <br>
<br>
</li> </ul></li> 
<li>Unpacking reverses this process 
<ul> 
<li>Read bytes from a &ldquo;string&rdquo; according to a format</li> 
<li>Use the data in these bytes to create Python data structures</li> 
<li>Return the result as a tuple of values</li> 
<li> 
<p> Figure 20.5: Unpacking Data</p> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The struct Module</h2> 
<ul> 
<li>Use Python's <code>struct</code> module to pack and unpack 
<ul> 
<li><code>pack(fmt, v1, v2, &hellip;)</code> packs the values <code>v1</code>, 
<code>v2</code>, etc. according to <code>fmt</code>, returning a string</li> 
<li><code>unpack(fmt, str)</code> unpacks the values in <code>str</code> 
according to<code>fmt</code>, returning a tuple</li> 
<li><code>calcsize(fmt)</code> calculates how large (in bytes) the data 
produced using<code>fmt</code> will be 
<ul> 
<li>Packing and unpacking are <em>always</em> fixed-size operations</li> </ul>
</li> </ul></li> 
<li>Format specifiers 
<ul> 
<li> Format Meaning <br>
<code>&quot;c&quot;</code> Single character (i.e., 
string of length 1) <br>
<code>&quot;B&quot;</code> Unsigned 8-bit integer <br>

<code>&quot;h&quot;</code> Short (16-bit) integer <br>
<code>&quot;i&quot;
</code> 32-bit integer <br>
<code>&quot;f&quot;</code> 32-bit float <br>
<code>
&quot;d&quot;</code> Double-precision (64-bit) float <br>
<code>&quot;2&quot;
</code> String of fixed size (see below) <br>
<br>

<p> Table 20.2: Format Specifiers in Python</p> </li> 
<li>Any format can be preceded by a count 
<ul> 
<li>E.g., <code>&quot;4i&quot;</code> is four integers</li> </ul></li> 
<li>Must <em>always</em> specify the size of strings 
<ul> 
<li>E.g., <code>&quot;4s&quot;</code> for a 4-character string</li> 
<li>Otherwise, how would <code>unpack</code> know how much data to use?</li> 
</ul></li> 
<li>How much data is packed is specified by the format 
<ul> 
<li>Can pack the lowest 8 or 16 bits of an integer using <code>&quot;B&quot;
</code> or <code>&quot;h&quot;</code> instead of the full 32</li> </ul></li> 
</ul></li> 
<li>Example: pack two integers, using only 16 bits for each 
<ul> 
<li> 
<pre>import struct fmt = 'hh' # two 16-bit integers x = 31 y = 65 binary = 
struct.pack(fmt, x, y) print 'binary representation:', repr(binary) normal = 
struct.unpack(fmt, binary) print 'back to normal:', normal</pre> 
<pre>binary representation: '\x1f\x00A\x00' back to normal: (31, 65) </pre> 
</li> 
<li>Uh, what's <code>'\x1f\x00A\x00'</code>?</li> 
<li>If Python finds a character in a string that doesn't have a printable 
representation, it prints a 2-digit<em>hexadecimal</em> (base-16) escape 
sequence
<ul> 
<li>Uses the letters A-F (or a-f) to represent the digits from 10 to 15</li> 
</ul></li> 
<li>So this string represents the four bytes <code>['\x1f', '\x00', 'A', 
'\x00']</code> 
<ul> 
<li>1f16 is (1&times;16 + 15), or 31</li> 
<li>ASCII code for the letter <code>&quot;A&quot;</code> is 6510</li> </ul>
</li> </ul></li> 
<li>Note that the least significant byte of the integer comes first 
<ul> 
<li>This is called <em>little-endian</em>, and is used by all Intel processors
</li> 
<li>Other chips put the most significant byte first (big-endian)</li> 
<li>If you move data from one architecture to another, it's your 
responsibility to flip the bytes&hellip;</li> 
<li>&hellip;because <em>the machine doesn't know what the bytes mean</em></li> 
<li> 
<pre>import struct packed = struct.pack('4c', 'a', 'b', 'c', 'd') print 
'packed string:', repr(packed) left16, right16 = struct.unpack('hh', packed) 
print 'as two 16-bit integers:', left16, right16 all32 = struct.unpack('i', 
packed) print 'as a single 32-bit integer', all32[0] float32 = 
struct.unpack('f', packed) print 'as a 32-bit float', float32[0]</pre> 
<pre>packed string: 'abcd' as two 16-bit integers: 25185 25699 as a single 
32-bit integer 1684234849 as a 32-bit float 1.67779994081e+22</pre> </li> </ul>
</li> 
<li>Can be very hard to track down errors in packing and unpacking 
<ul> 
<li>Unpacking the wrong type, or too many/too few values, produces garbage</li>
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Packing Variable-Length Data</h2> 
<ul> 
<li>How to store a variable-length vector of integers? 
<ul> 
<li>Store the number of elements in a fixed-size header</li> 
<li>Then store that many integers one by one</li> 
<li> 
<p> Figure 20.6: Packing a Variable-Length Vector</p> <br>
<br>
</li> </ul>
</li> 
<li>Packing is easy: 
<ul> 
<li> 
<pre>def packVec(vec): buf = struct.pack('i', len(vec)) for v in vec: buf += 
struct.pack('i', v) return buf</pre> </li> </ul></li> 
<li>Unpacking is a little harder 
<ul> 
<li>Use <code>calcsize('i')</code> instead of hard-coding the number 4 
<ul> 
<li>64-bit machines are on their way&hellip;</li> </ul></li> 
<li>Each pass through the unpacking loop, have to step up to the right 
location in the packed string</li> 
<li> 
<pre>def unpackVec(buf): # Get the count of the number of elements in the 
vector. intSize = struct.calcsize('i') count = struct.unpack('i', 
buf[0:intSize])[0] # Get 'count' values, one by one. pos = intSize result = [] 
for i in range(count): v = struct.unpack('i', buf[pos:pos+intSize]) 
result.append(v[0]) pos += intSize return result</pre> </li> </ul></li> 
<li>And then we test: 
<ul> 
<li> 
<pre>if __name__ == '__main__': tests = [ [], [1], [1, 2], [-3, 456, 7890] ] 
for t in tests: s = packVec(t) v = unpackVec(s) assert v == t</pre> </li> </ul>
</li> 
<li>Problem: what if you want to pack strings, but don't know their length in 
advance?</li> 
<li>Solution: create the format string on the fly, and save the string's 
length as well as its characters
<ul> 
<li> 
<pre>import struct def packStrings(strings): result = '' for s in strings: 
length = len(s) format = 'i%ds' % length result += struct.pack(format, length, 
s) return result def unpackStrings(buf): intSize = struct.calcsize('i') pos = 0 
result = [] while pos &lt; len(buf): length = struct.unpack('i', 
buf[pos:pos+intSize])[0] pos += intSize format = '%ds' % length s = 
struct.unpack(format, buf[pos:pos+length])[0] pos += length result.append(s) 
return result if __name__ == '__main__': tests = ['', 'a', 'bcd'] for i in 
range(len(tests)): t = tests[0:i+1] buffer = packStrings(t) result = 
unpackStrings(buffer) assert result == t</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Metadata</h2> 
<ul> 
<li>Literally, &ldquo;data about data&rdquo; 
<ul> 
<li>I.e., data that describes other data, such as the date it was collected, 
or its format</li> </ul></li> 
<li>When creating binary files, put a header at the start of the file that 
describes the format of the data the file contains
<ul> 
<li>Advantages: 
<ul> 
<li>One parser handles all data files</li> 
<li>Can't lose the format: programs come and go, but data is forever</li> </ul>
</li> 
<li>Disadvantages: 
<ul> 
<li>Slower (generality always is)</li> 
<li>Reader is more complicated than a single special-purpose reader would 
be&hellip;</li> 
<li>&hellip;but simpler than the sum of all the special-purpose readers you'd 
have to write&hellip;</li> 
<li>&hellip;and you only have to debug it once</li> </ul></li> </ul></li> 
<li>Files have a three-part structure: 
<ul> 
<li>Integer (fixed size) recording the length of the metadata</li> 
<li>Metadata (<em>N</em> bytes) describing the format of the records in the 
file</li> 
<li>The records themselves</li> 
<li> 
<p> Figure 20.7: Structure of a Binary File With Metadata</p> <br>
<br>
</li> 
</ul></li> 
<li>Step 1: store a list of identically-structured records to a file 
<ul> 
<li> 
<pre>def store(outstream, format, data): '''Store records in a file. Each 
record is either a list or a tuple; all records must have exactly the same 
format.''' # Length of metadata. s = struct.pack(&quot;i&quot;, len(format)) 
outstream.write(s) # Metadata. outstream.write(format) # Records. for d in 
data: d = [format] + list(d) # Build pack's argument list s = struct.pack(*d) # 
Apply pack to those arguments outstream.write(s)</pre> </li> 
<li>Notice how <code>struct.pack</code> is called 
<ul> 
<li>It takes each value to be packed as a separate argument, rather than 
taking a list of values</li> 
<li>First argument has to be the format</li> 
<li>So create a list with the format, and the values to be packed, and apply 
<code>struct.pack</code> to it</li> 
<li>Common pattern when using variable number of arguments</li> </ul></li> 
</ul></li> 
<li>Step 2: unpack the bytes created by <code>store</code> 
<ul> 
<li>Read the size of the metadata, then the metadata, then the data</li> 
<li> 
<pre>def retrieve(instream): '''Retrieve records from a file whose format is: 
'i' : length of metadata metadata : record format descriptor records : actual 
data''' # Length of metadata. numBytes = struct.calcsize(&quot;i&quot;) s = 
instream.read(numBytes) formatLen = struct.unpack(&quot;i&quot;, s)[0] # 
Metadata. format = instream.read(formatLen) recordLen = struct.calcsize(format) 
# Records. data = [] s = instream.read(recordLen) while s: assert len(s) == 
recordLen d = list(struct.unpack(format, s)) data.append(d) s = 
instream.read(recordLen) # Done return data</pre> </li> 
<li>Notice the <code>assert</code> in the reading loop 
<ul> 
<li>Defensive programming</li> </ul></li> </ul></li> 
<li>Step 3: test that it works 
<ul> 
<li>Just as important as steps 1 and 2</li> 
<li> 
<pre>if __name__ == '__main__': from cStringIO import StringIO tests = [ ['i', 
[[1]]], ['i', [[1], [2]]], ['3s', [['xyz']]], ['3s', [['abc'], ['def']]], 
['f3s', [[1.0, 'pqr']]], ['f3s', [[2.0, 'stu'], [3.0, 'vwx']]] ] for (format, 
data) in tests: outstream = StringIO() store(outstream, format, data) instream 
= StringIO(outstream.getvalue()) dup = retrieve(instream) assert data == dup
</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Relational Databases</h1> prev  Draft Version 547 next <br>
<br>

<h2>It's All Tables</h2> 
<ul> 
<li>Flat text and XML both have their place, but most of the data people 
really care about is stored in<em>relational databases</em> 
<ul> 
<li>Originated with E. F. Codd's work in the late 1960s and early 1970s</li> 
<li>By the 1980s, Oracle and IBM's DB2 dominated the market</li> 
<li>Open source alternatives like <code>MySQL</code> and <code>PostgreSQL
</code> emerged in the 1990s</li> 
<li><code>SQLite</code> offers a lightweight alternative for small jobs 
<ul> 
<li>Originally designed for use in small web sites</li> 
<li>Stores entire database in a single file on disk (which simplifies backup 
and recovery)</li> </ul></li> </ul></li> 
<li>The bad news: it's a huge topic 
<ul> 
<li>Oracle's documentation would fill this room 
<ul> 
<li>No matter what room you're in</li> </ul></li> </ul></li> 
<li>The good news: you only need to know a little to do most of the things you 
need to
<ul> 
<li>A few key ideas</li> 
<li>A little syntax</li> 
<li> [Fehily 2003] is a good tutorial and reference guide</li> </ul></li> 
<li>When to use a relational database: 
<ul> 
<li>Lots of data</li> 
<li>Mostly facts, rather than objects 
<ul> 
<li>I.e., not images, video clips, etc.</li> 
<li>Although a database may be the best place to store information <em>about
</em> these</li> </ul></li> 
<li>Complex queries 
<ul> 
<li>&ldquo;Find all experiments done with the Mark VII that had yields greater 
than 30%, that didn't use cadmium disulfide as a reagant&rdquo;</li> 
<li>Relational database can answer these questions directly</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Getting Started</h2> 
<ul> 
<li>A database is a collection of zero or more <em>tables</em>, each of which 
has a name, and represents a relation
<ul> 
<li>Basically, each table stores one kind of fact</li> </ul></li> 
<li>Each table has a fixed set of named <em>columns</em> 
<ul> 
<li>Like the fields in a form, or the members of an object</li> 
<li>All the values in a column have the same type</li> 
<li>Like XML attributes, values in a column shouldn't have any internal 
structure
<ul> 
<li>I.e., you shouldn't have to parse them in order to use them</li> </ul></li>
</ul></li> 
<li>Each table has zero or more <em>rows</em>, each of which represents a 
separate<em>record</em> 
<ul> 
<li>One or more values in each record form its <em>key</em></li> 
<li>Unlike a dictionary, database doesn't guarantee uniqueness of keys: you 
have to</li> </ul></li> 
<li>Example: experimental data 
<ul> 
<li> 
<p> Figure 21.1: Database Tables</p> <br>
<br>
</li> 
<li>We'll use these tables as a running example</li> </ul></li> 
<li>A <em>foreign key</em> is a value (or set of values) in one table that 
identifies a record in another
<ul> 
<li>For example, the values in the <code>Login</code> column in <code>Involved
</code> identify records in the <code>Person</code> table</li> </ul></li> 
<li>The example database illustrates an important rule of database design: no 
redundant information
<ul> 
<li>Natural to combine <code>Experiment</code> and <code>Involved</code> 
tables into one</li> 
<li> 
<p> Figure 21.2: A Combined Table</p> <br>
<br>
</li> 
<li>But now some information appears in two or more places&hellip;</li> 
<li>&hellip;which makes updates, consistency checks, and queries all harder to 
do</li> 
<li>Frequently have to make up attributes (like <code>InvolvedId</code>) to 
relate these tables</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Basic SQL</h2> 
<ul> 
<li>Interact with database using a specialized language called <em>SQL</em> 
(Structured Query Language)
<ul> 
<li>Several versions have been standardized&hellip;</li> 
<li>&hellip;and every database adds its own quirks</li> </ul></li> 
<li>To create a table, specify its name, and the names and types of its columns
<ul> 
<li>Should also specify whether values in that column can be null (i.e., 
undefined)</li> 
<li> 
<pre>CREATE TABLE Person( Login TEXT NOT NULL, LastName TEXT NOT NULL, 
FirstName TEXT NOT NULL );</pre> </li> </ul></li> 
<li>To insert values into a table, specify the name of the tables, and the 
values to be inserted
<ul> 
<li>Each <code>INSERT</code> creates a new row</li> 
<li> 
<pre>INSERT INTO Person VALUES(&quot;skol&quot;, &quot;Kovalevskaya&quot;, 
&quot;Sofia&quot;); INSERT INTO Person VALUES(&quot;mlom&quot;, 
&quot;Lomonosov&quot;, &quot;Mikhail&quot;); INSERT INTO Person 
VALUES(&quot;dmitri&quot;, &quot;Mendeleev&quot;, &quot;Dmitri&quot;); INSERT 
INTO Person VALUES(&quot;ivan&quot;, &quot;Pavlov&quot;, &quot;Ivan&quot;);
</pre> </li> </ul></li> 
<li>To erase a table, use <code>DROP TABLE <em>name</em></code> 
<ul> 
<li>Remember, back up early, back up often&hellip;</li> </ul></li> 
<li>Usual way to run queries like this is to put them in a file, and give it 
to the database manager
<ul> 
<li>E.g., <code>sqlite &lt; make_running_example.sql</code></li> </ul></li> 
<li>Most database managers also provide an interactive prompt, GUI tools, etc.
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Simple Queries</h2> 
<ul> 
<li>Suppose we want to get the login IDs of everyone in the system, along with 
their names
<ul> 
<li>Write this query almost exactly as we just said it</li> 
<li> 
<pre>SELECT Person.FirstName, Person.LastName, Person.Login FROM Person; </pre>
<pre>Sofia|Kovalevskaya|skol Mikhail|Lomonosov|mlom Dmitri|Mendeleev|dmitri 
Ivan|Pavlov|ivan</pre> </li> 
<li>Exact output depends on your database manager</li> 
<li>Usually run it through a text filter, or view it in a GUI</li> </ul></li> 
<li>How about sorting rows by login ID instead of by the order they were added 
to the database?
<ul> 
<li> 
<pre>SELECT Person.FirstName, Person.LastName, Person.Login FROM Person ORDER 
BY Person.Login ASC;</pre> 
<pre>Dmitri|Mendeleev|dmitri Ivan|Pavlov|ivan Mikhail|Lomonosov|mlom 
Sofia|Kovalevskaya|skol</pre> </li> 
<li>Note: SQL doesn't stick to single-word keywords (e.g., <code>ORDER BY
</code>)</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Joins</h2> 
<ul> 
<li>A <em>join</em> is a query that combines information from two (or more) 
tables
<ul> 
<li>Construct the <em>cross product</em> of the tables by combining each row 
of the first with each row of the second</li> 
<li>Discard rows that don't meet some criteria</li> 
<li>Select columns from the surviving rows</li> </ul></li> 
<li>Example: find out who has done experiments for each project 
<ul> 
<li> 
<pre>SELECT Project.ProjectName, Involved.Login FROM Project, Involved WHERE 
Project.ProjectId = Involved.ProjectId;</pre> 
<pre>Antigravity|mlom Antigravity|mlom Teleportation|dmitri Teleportation|skol 
Teleportation|ivan Teleportation|mlom Time Travel|skol Time Travel|skol Time 
Travel|ivan</pre> </li> 
<li>Construct cross product of <code>Person</code> and <code>Involved</code> 
(which has 4&times;9=36 rows)</li> 
<li>Throw away those for which the project IDs taken from the two tables don't 
match</li> 
<li>Select the columns of interest</li> 
<li> 
<p> Figure 21.3: Join In Action</p> <br>
<br>
</li> </ul></li> 
<li>Note: <code>mlom</code> appears twice for the <code>Antigravity</code> 
project because he did two experiments for it
<ul> 
<li>Use the <code>DISTINCT</code> keyword to eliminate duplicates</li> 
<li> 
<pre>SELECT DISTINCT Project.ProjectName, Involved.Login FROM Project, 
Involved WHERE Project.ProjectId = Involved.ProjectId;</pre> 
<pre>Antigravity|mlom Teleportation|dmitri Teleportation|skol 
Teleportation|ivan Teleportation|mlom Time Travel|skol Time Travel|ivan</pre> 
</li> </ul></li> 
<li>How to find people who have done experiments for two (or more) projects? 
<ul> 
<li>First attempt: use <code>AND</code> 
<ul> 
<li> 
<pre>SELECT DISTINCT Person.Login FROM Person, Involved WHERE (ProjectId = 
1214) AND (ProjectId = 1709);</pre> 
<pre></pre> </li> 
<li>Doesn't work because <code>ProjectId</code> cannot simultaneously be 1214 
and 1709</li> </ul></li> 
<li>Second attempt: use <code>OR</code> 
<ul> 
<li> 
<pre>SELECT DISTINCT Person.Login FROM Person, Involved WHERE (ProjectId = 
1214) OR (ProjectId = 1709);</pre> 
<pre>skol mlom dmitri ivan </pre> </li> 
<li>Doesn't work because every project's ID is either 1214 and 1709</li> </ul>
</li> </ul></li> 
<li>Right solution that works is to join the <code>Involved</code> table with 
itself, so that we have two project IDs in the same row
<ul> 
<li>Then select rows where the person is the same, but the project IDs are 
different</li> 
<li>Remember, everything is done row-by-row</li> 
<li> 
<pre>SELECT DISTINCT A.Login FROM Involved A, Involved B WHERE (A.Login = 
B.Login) AND (A.ProjectId != B.ProjectId);</pre> 
<pre>mlom skol ivan </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Negation and Nested Queries</h2> 
<ul> 
<li>How to find everyone who <em>hasn't</em> been experimenting with time 
travel?
<ul> 
<li>Can't just select rows of <code>Involved</code> where <code>ProjectId
</code> is not 1737, since both Kovalevskaya and Pavlov have worked on other 
projects</li> 
<li> 
<pre>SELECT DISTINCT Involved.Login FROM Involved WHERE (Involved.ProjectId != 
1737);</pre> 
<pre>mlom dmitri skol ivan </pre> </li> </ul></li> 
<li>Solution is counter-intuitive, but well-defined: 
<ul> 
<li>Select the rows we <em>don't</em> want</li> 
<li>Subtract them from all possible rows</li> </ul></li> 
<li>Requires use of <em>nested queries</em> 
<ul> 
<li>Database manager runs the inner query first, then applies the outer query 
to the inner query's result</li> 
<li><code>NOT IN</code> means exactly what it says</li> 
<li> 
<pre>SELECT DISTINCT Login FROM Involved WHERE Login NOT IN (SELECT Login FROM 
Involved WHERE Involved.ProjectId = 1737);</pre> 
<pre>mlom dmitri </pre> </li> </ul></li> 
<li>These are useful for many other things as well 
<ul> 
<li>Example: how many people have done experiments for exactly one project?
</li> 
<li>Solution: find the people who've done experiments for none, or for two or 
more, and subtract them from everyone</li> 
<li> 
<pre>SELECT DISTINCT Login FROM Involved WHERE Login NOT IN (SELECT A.Login 
FROM Involved A, Involved B WHERE (A.Login = B.Login) AND (A.ProjectId != 
B.ProjectId));</pre> 
<pre>dmitri </pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Aggregation</h2> 
<ul> 
<li>Often need to <em>aggregate</em> (combine) values from different rows 
<ul> 
<li>Total sales, fastest trip, etc.</li> </ul></li> 
<li>SQL provides built-in functions 
<ul> 
<li>Example: how much time has Mikhail spent on antigravity experiments?</li> 
<li> 
<pre>SELECT SUM(Experiment.Hours) FROM Involved, Experiment WHERE 
(Involved.Login = &quot;mlom&quot;) AND (Involved.ProjectId = 1214) AND 
(Involved.ProjectId = Experiment.ProjectId) AND (Involved.ExperimentId = 
Experiment.ExperimentId);</pre> 
<pre>15.8 </pre> </li> </ul></li> 
<li>How much time has each scientist spent on experiments? 
<ul> 
<li>Use <code>GROUP BY</code> to apply aggregation function to specific 
subsets of rows</li> 
<li> 
<pre>SELECT Involved.Login, SUM(Experiment.Hours) FROM Involved, Experiment 
WHERE (Involved.ProjectId = Experiment.ProjectId) AND (Involved.ExperimentId = 
Experiment.ExperimentId) GROUP BY Involved.Login;</pre> 
<pre>ivan|5.5 dmitri|7 skol|4.5 mlom|23 </pre> </li> 
<li>Note: negative hours on time travel experiments really mess up 
budgeting&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Using Other Languages</h2> 
<ul> 
<li>Usually don't write entire application in SQL, or run SQL in sub-shell</li>
<li>Instead, embed SQL in the programming language of your choice 
<ul> 
<li>Visual Basic, Java, Perl, Python, &hellip;</li> 
<li>PHP was designed for exactly this purpose</li> </ul></li> 
<li>Key concepts: 
<ul> 
<li>A <em>connection</em> is a way to get commands from the program to the 
database, and results back
<ul> 
<li>Typically a socket, but other methods are used as well</li> </ul></li> 
<li>A <em>cursor</em> is a pointer to a database operation 
<ul> 
<li>Like a cursor in an editor</li> </ul></li> </ul></li> 
<li>Example: get the names of all the scientists into a Python program 
<ul> 
<li> 
<pre>import sqlite connection = sqlite.connect(&quot;running.db&quot;) cursor 
= connection.cursor() cursor.execute(&quot;SELECT FirstName, LastName FROM 
Person;&quot;) results = cursor.fetchall(); for r in results: print r 
cursor.close(); connection.close();</pre> 
<pre>('Sofia', 'Kovalevskaya') ('Mikhail', 'Lomonosov') ('Dmitri', 
'Mendeleev') ('Ivan', 'Pavlov')</pre> </li> 
<li>Need the right <em>driver</em> to connect to the database</li> 
<li>Everything else (on the Python side) is the same, regardless of the kind 
of database
<ul> 
<li>Although as mentioned before, the SQL might be different</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Handling Null Values</h2> 
<ul> 
<li>Real-world data always has holes in it 
<ul> 
<li>Some people don't have cell phone numbers, some authors' birth dates are 
unknown&hellip;</li> </ul></li> 
<li>Represent this in a database using the special value <code>NULL</code> 
<ul> 
<li><em>Not</em> the same as zero, empty string, False, etc.</li> 
<li>Instead, means &ldquo;nothing known at all&rdquo;</li> </ul></li> 
<li>Check to see if a value is null using <code>IS NULL</code></li> 
<li>The result of any computation involving <code>NULL</code> is <code>NULL
</code> 
<ul> 
<li><code>2 + NULL</code> is <code>NULL</code>, <code>NULL OR True</code> is 
<code>NULL</code>, etc. 
<ul> 
<li>Although in some databases, <code>False AND NULL</code> is <code>False
</code>, and <code>True OR NULL</code> is <code>True</code></li> </ul></li> 
</ul></li> 
<li>By default, columns may contain <code>NULL</code>, but this can be 
prohibited when the table is created
<ul> 
<li>An example of an <em>integrity constraint</em></li> 
<li> 
<pre>CREATE TABLE Experiment( ProjectId INTEGER NOT NULL, ExperimentId INTEGER 
NOT NULL, NumInvolved INTEGER NOT NULL, ExperimentDate DATE, Hours REAL NOT 
NULL );</pre> </li> </ul></li> 
<li>Have to write queries to account for <code>NULL</code> 
<ul> 
<li><code>Experiment.ExperimentDate &lt;&gt; 1901-05-01</code> selects all 
experiments that weren't conducted on May 1, 1901,<em>and</em> all experiments 
whose date is<code>NULL</code> (since <code>NULL</code> isn't equal to anything 
except itself)</li> 
<li>Have to use <code>(Experiment.ExperimentDate &lt;&gt; 1901-05-01) AND 
(Experiment.ExperimentDate IS NOT NULL)</code></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Concurrency</h2> 
<ul> 
<li>The biggest challenge in database programming isn't formulated 
queries&mdash;it's handling<em>concurrency</em> 
<ul> 
<li>Two or more things happening at once</li> 
<li>In the database world, one user changing the database while another is 
making a query</li> </ul></li> 
<li>A related problem is the need to ensure <em>atomic</em> (or indivisible) 
operations
<ul> 
<li>Sequence of operations is &ldquo;remove $100.00 from grant #19823&rdquo;, 
then &ldquo;add $100.00 to grant #17928&rdquo;</li> 
<li>Don't want money to disappear if computer goes down in between</li> </ul>
</li> 
<li>Solution to both problems is to use a <em>transaction</em> 
<ul> 
<li>A set of operations which all work as if nothing else was going on, or 
have no effect on the database</li> 
<li>ACID: 
<ul> 
<li>Atomic: either all are performed, or none</li> 
<li>Consistent: database is in a legal state when the transaction ends</li> 
<li>Isolated: no operation outside the transaction sees the database in any 
intermediate state</li> 
<li>Durable: once the user is notified that the operation has completed, its 
effects are permanent</li> </ul></li> </ul></li> 
<li>Transactions sometimes used for queries, but should always be used for 
updates
<ul> 
<li>Example: change Kovalevskaya's login ID from <code>&quot;skol&quot;</code> 
to<code>&quot;kovalev&quot;</code></li> 
<li> 
<pre>BEGIN TRANSACTION; UPDATE Person SET Login = &quot;kovalev&quot; WHERE 
Login = &quot;skol&quot;; UPDATE Involved SET Login = &quot;kovalev&quot; WHERE 
Login = &quot;skol&quot;; END TRANSACTION; SELECT * FROM Person WHERE (Login = 
&quot;kovalev&quot;) OR (Login = &quot;skol&quot;); SELECT * FROM Involved 
WHERE (Login = &quot;kovalev&quot;) OR (Login = &quot;skol&quot;);</pre> 
<pre>kovalev|Kovalevskaya|Sofia 1709|1|2|kovalev 1737|1|1|kovalev 
1737|2|1|kovalev</pre> </li> 
<li>Wrap the changes in a transaction so that: 
<ul> 
<li>No query can run after <code>Person</code> changes, but before <code>
Involved</code> changes</li> 
<li>If database goes down in the middle of the operation, database doesn't 
become inconsistent</li> </ul></li> </ul></li> 
<li>So why not use transactions everywhere? 
<ul> 
<li>Because they require the database to <em>serialize</em> some operations
</li> 
<li>Which slows the system down</li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Client-Side Web Programming</h1> prev  Draft Version 534 next <br>
<br>

<h2>Small Pieces, Loosely Joined</h2> 
<ul> 
<li>The Unix command line was the world's first <em>component object model</em>
<ul> 
<li>Allowed programmers to build small pieces, then connect them in arbitrary 
ways</li> </ul></li> 
<li>Key features: 
<ul> 
<li>Low barriers to entry: it's easy to add one more tool to the toolbox</li> 
<li>Common data format: stream of strings</li> 
<li>Common communication protocol: <code>stdin</code>, <code>stdout</code>, 
and zero/nonzero exit codes</li> </ul></li> 
<li>The Web succeeded (in part) because it followed the same model 
<ul> 
<li>Data format: HTML (now XML)</li> 
<li>Communication protocol: HTTP</li> </ul></li> 
<li>This lecture looks at how to build programs that get data from the web 
<ul> 
<li>Next lecture will discuss simple ways to build programs that supply data
</li> 
<li>If you want to know more, [Goerzen 2004] is a comprehensive guide</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Distributed Is Different</h2> 
<ul> 
<li>Distributed systems are fundamentally different from unitary systems 
<ul> 
<li>Small program can ignore these differences&hellip;</li> 
<li>&hellip;but every industrial-strength application eventually has to deal 
with them</li> </ul></li> 
<li>Difference #1: concurrency 
<ul> 
<li>As in databases, means &ldquo;several things happening at once&rdquo;</li> 
<li>Can lead to: 
<ul> 
<li>Deadlock: A is waiting for B while B is waiting for A</li> 
<li><em>Race conditions</em>: final result depends on whether A or B goes last
</li> </ul></li> </ul></li> 
<li>Difference #2: partial failure 
<ul> 
<li>One component fails while others are still healthy</li> 
<li>If you've waited five seconds for a web site to respond, should you assume 
that it's down, or keep waiting?</li> 
<li>There's a whole industry devoted to dealing with this</li> </ul></li> 
<li>Both differences make distributed applications <em>much</em> harder to 
debug than unitary ones
<ul> 
<li>Often have <em>heisenbugs</em> (which only appear intermittently)</li> 
<li>And it's usually impossible to get a complete picture of the system's state
</li> 
<li>Solution: get it right the first time</li> </ul></li> 
<li>For now, we will ignore both problems 
<ul> 
<li>Write small programs that use the web, but aren't used by others</li> 
<li>Assume that everything else is reliable</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Under the Hood</h2> 
<ul> 
<li>These days, the Internet runs on a family of communication standards called
<em>Internet Protocol</em> (IP) 
<ul> 
<li>Defines everything from electrical signal strengths on up</li> </ul></li> 
<li>Using IP, process communicate through <em>sockets</em> 
<ul> 
<li>Each socket is one end of a point-to-point communication channel 
<ul> 
<li>Provides the same kind of read and write operations as files</li> </ul>
</li> 
<li>Every socket is uniquely identified by host address and a port number</li> 
<li>A <em>host address</em> is four 8-bit numbers, like 24.153.22.195 
<ul> 
<li>Most addresses have symbolic names, like <code>www.third-bit.com</code>
</li> </ul></li> 
<li>A <em>port</em> is just a number in the range 0-65535 
<ul> 
<li>0-1023 are reserved for the operating system</li> </ul></li> </ul></li> 
<li>Most commonly used member of the IP family is <em>Transmission Control 
Protocol</em> (TCP) 
<ul> 
<li>Guarantees that any data sent is received, in order 
<ul> 
<li>Like a phone call</li> </ul></li> 
<li>Lots of applications use TCP directly 
<ul> 
<li>Email, instant messaging, FTP, games&hellip;</li> </ul></li> 
<li>But don't worry: we'll be programming at a much higher level</li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>The Hypertext Transfer Protocol</h2> 
<ul> 
<li>HTTP (the HyperText Transfer Protocol) specifies how programs exchange 
documents over the web
<ul> 
<li>Originally designed to support file download</li> 
<li>Has grown in many ways 
<ul> 
<li>Some of them unnatural</li> </ul></li> </ul></li> 
<li>Three stages in a typical transaction: 
<ul> 
<li> 
<p> Figure 22.1: HTTP Request Cycle</p> <br>
<br>
</li> 
<li>A <em>client</em> program opens a connection to a <em>web server</em> 
<ul> 
<li>Clients are typically browsers, such as <code>Firefox</code></li> 
<li><code>Apache Web Server</code> is the most widely used, but many others 
exist</li> </ul></li> 
<li>The client sends a request containing 
<ul> 
<li>The thing the client wants (such as the name of a web page)</li> 
<li><em>Headers</em> that define the type of transaction</li> 
<li>Anything else the server might need (e.g., a file for upload)</li> </ul>
</li> 
<li>The server replies with: 
<ul> 
<li>Headers that define the status (success or failure) and the type of data 
being sent</li> 
<li>Data (such as the actual web page)</li> </ul></li> </ul></li> 
<li>This cycle may be repeated many times to display one web page 
<ul> 
<li>Each image is requested and downloaded separately</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>HTTP Request</h2> 
<ul> 
<li>An HTTP request has three parts 
<ul> 
<li> 
<p> Figure 22.2: HTTP Request Format</p> <br>
<br>
</li> </ul></li> 
<li>HTTP request line 
<ul> 
<li>HTTP method is usually either <code>GET</code> or <code>POST</code> 
<ul> 
<li><code>GET</code> typically used to fetch information</li> 
<li><code>POST</code> usually used to submit form data, or to upload files</li>
</ul></li> 
<li>URL is the thing the request wants 
<ul> 
<li>Typically a path to a file, such as <code>/index.html</code></li> 
<li>But other information (discussed below) can be put there as well</li> 
<li>Entirely up to the server how to interpret the URL</li> </ul></li> 
<li>HTTP version 
<ul> 
<li>Usually <code>HTTP/1.0</code></li> </ul></li> </ul></li> 
<li>Headers 
<ul> 
<li>A set of name/value pairs 
<ul> 
<li>A given name may appear many times, i.e., may be associated with many 
values</li> </ul></li> 
<li>Examples: 
<ul> 
<li><code>Accept: text/html</code></li> 
<li><code>Accept-Language: en, fr</code></li> 
<li><code>If-Modified-Since: 16-May-2005</code></li> </ul></li> </ul></li> 
<li>Body is any extra data associated with the request 
<ul> 
<li>Used with web forms, to upload files, etc.</li> </ul></li> 
<li>Note: there's no magic 
<ul> 
<li>An HTTP request is just text&mdash;any program that wants to can create 
them or parse them</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>HTTP Response</h2> 
<ul> 
<li>Just as simple as a request 
<ul> 
<li> 
<p> Figure 22.3: HTTP Response Format</p> <br>
<br>
</li> </ul></li> 
<li>HTTP response line 
<ul> 
<li>Once again, version is typically <code>HTTP/1.0</code></li> 
<li>Status code is a number indicating what happened 
<ul> 
<li>200: everything worked</li> 
<li>404: page not found</li> </ul></li> 
<li>Status phrase repeats that information in a human-readable phrase (like 
&ldquo;OK&rdquo; or &ldquo;not found&rdquo;)</li> </ul></li> 
<li>Headers are once again name/value pairs</li> 
<li>Then there must be a blank line to signal the end of headers 
<ul> 
<li>Common error to forget this</li> </ul></li> 
<li>Body is whatever data the server wants to send back 
<ul> 
<li>A web page, an image, etc.</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Example</h2> 
<ul> 
<li>Fetch a page from the course site 
<ul> 
<li> 
<pre>import sys, socket HttpRequest = \ '''GET /greeting.html HTTP/1.0 ''' s = 
socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
s.connect((&quot;www.third-bit.com&quot;, 80)) s.send(HttpRequest) response = 
'' while True: data = s.recv(1024) if not data: break response += data 
s.close() print response</pre> 
<pre>HTTP/1.1 404 Not Found Date: Sat, 02 Jul 2005 11:16:44 GMT Server: 
Apache/2.0.54 (Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_python/3.1.3 Python/2.3.5 
PHP/4.3.10-9 mod_ssl/2.0.54 OpenSSL/0.9.7e Content-Length: 394 Connection: 
close Content-Type: text/html; charset=iso-8859-1 &lt;!DOCTYPE HTML PUBLIC 
&quot;-//IETF//DTD HTML 2.0//EN&quot;&gt; &lt;html&gt;&lt;head&gt; 
&lt;title&gt;404 Not Found&lt;/title&gt; &lt;/head&gt;&lt;body&gt; 
&lt;h1&gt;Not Found&lt;/h1&gt; &lt;p&gt;The requested URL /greeting.html was 
not found on this server.&lt;/p&gt; &lt;hr&gt; &lt;address&gt;Apache/2.0.54 
(Debian GNU/Linux) DAV/2 SVN/1.1.4 mod_python/3.1.3 Python/2.3.5 PHP/4.3.10-9 
mod_ssl/2.0.54 OpenSSL/0.9.7e Server at pyre.third-bit.com Port 
80&lt;/address&gt; &lt;/body&gt;&lt;/html&gt;</pre> </li> </ul></li> 
<li>Request has no headers 
<ul> 
<li>So the blank line that signals &hellip;end of headers&rdquo; is right 
after the request line</li> </ul></li> 
<li>Create a socket 
<ul> 
<li><code>socket.AF_INET</code> means &ldquo;an Internet socket&rdquo;</li> 
<li><code>socket.SOCK_STREAM</code> means &ldquo;use TCP&rdquo;</li> </ul></li>
<li>Connect to the server 
<ul> 
<li>Port 80 is the standard one for web servers</li> </ul></li> 
<li>Send the request, and read response data until there's nothing more to read
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Fetching Pages</h2> 
<ul> 
<li>Opening sockets, constructing HTTP requests, and parsing responses is 
tedious
<ul> 
<li>So most languages provide libraries to do the work for you</li> 
<li>In Python, that library is called <code>urllib</code></li> </ul></li> 
<li><code>urllib.urlopen(URL)</code> does what your browser would do if you 
gave it the URL
<ul> 
<li>Parse it to figure out what server to connect to</li> 
<li>Connect to that server</li> 
<li>Send an HTTP request</li> 
<li>Give the calling program an object that looks like a file, from which to 
read response data</li> </ul></li> 
<li>Example: read the test page the easy way 
<ul> 
<li> 
<pre>import urllib instream = 
urllib.urlopen(&quot;http://www.third-bit.com/greeting.html&quot;) lines = 
instream.readlines() instream.close() for line in lines[:5]: print line,</pre> 
</li> </ul></li> 
<li>Note: <code>readlines</code> wouldn't do the right thing if the thing 
being read was an image
<ul> 
<li>Use <code>read</code> to grab the bytes in that case</li> 
<li>Up to the client application to do the right thing</li> </ul></li> 
<li>Example: make a list of the links in a web page 
<ul> 
<li>The first step in build a <em>web spider</em> that can explore the web on 
its own
<ul> 
<li>That, plus a search engine, and you're Google&hellip;</li> </ul></li> 
<li>Fetch the page</li> 
<li>Parse it to extract all the links 
<ul> 
<li>Should use XML, but regular expressions are good enough to give you the 
idea</li> </ul></li> 
<li> 
<pre>import urllib, re from sets import Set instream = 
urllib.urlopen(&quot;http://www.third-bit.com/index.html&quot;) page = 
instream.read() instream.close() links = 
re.findall(r'href=\&quot;[^\&quot;]+\&quot;', page) temp = Set() for x in 
links: temp.add(x[6:-1]) links = list(temp) links.sort() for x in links: print x
</pre> 
<pre>#ack #news #rules #search /MT/mt.cgi /blog 
/cgi-bin/awstats.pl?config=www.third-bit.com 
http://books.slashdot.org/books/05/06/16/1930227.shtml 
http://projects.edgewall.com/trac http://subversion.tigris.org 
http://weblog.infoworld.com/udell 
http://weblog.infoworld.com/udell/2005/06/23.html 
http://www.amazon.com/exec/obidos/redirect?path=ASIN/0974514071&amp;link_code=as2&amp;camp=1789&amp;tag=thirdbit-20&amp;creative=9325 
http://www.amazon.com/exec/obidos/redirect?tag=thirdbit-20&amp;amp;creative=9325&amp;amp;camp=1789&amp;amp;link_code=as2&amp;amp;path=ASIN/0974514071 
http://www.apache.org http://www.artima.com 
http://www.artima.com/chapters/book.jsp?num=114451 http://www.cs.utoronto.ca 
http://www.debian.org http://www.jonahgroup.com http://www.list.org 
http://www.oreillynet.com http://www.oreillynet.com/cs/user/print/a/5862 
http://www.pragmaticprogrammer.com/titles/gwd/index.html 
http://www.provost.utoronto.ca http://www.python.org http://www.python.org/psf 
http://www.sf.net http://www.techbookreport.com/tbr0172.html 
http://www.third-bit.com/pyweb/index.html http://www.third-bit.com/swc 
http://www.third-bit.com/trac/argon http://www.third-bit.com/trac/pyre 
http://www.third-bit.com/trac/pyre/newticket http://www.third-bit.com/trac/swc 
http://www.third-bit.com/~gvwilson http://www.utoronto.ca mailinglists.html 
mailto:gvwilson@cs.utoronto.ca old-presentations.html past.html reading.html 
style.css</pre> </li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Passing Parameters</h2> 
<ul> 
<li>Sometimes want to provide extra information as part of a URL 
<ul> 
<li>Example: when searching on Google, have to specify what the search terms 
are</li> </ul></li> 
<li>Could do this as part of the URL 
<ul> 
<li>Amazon puts ISBNs in URLs</li> </ul></li> 
<li>More flexible to add parameters to the URL 
<ul> 
<li><code>http://www.google.com?q=Python</code> searches for pages related to 
Python</li> 
<li><code>&quot;?&quot;</code> separates the parameters from the rest of the 
URL</li> 
<li>If there are multiple parameters, they are separated from each other by 
<code>&quot;&amp;&quot;</code> 
<ul> 
<li><code>http://www.google.ca/search?q=Python&amp;client=firefox</code></li> 
</ul></li> 
<li>Each parameter takes the form <code>&quot;name=value&quot;</code></li> 
<li>Spaces are replaced by <code>&quot;+&quot;</code> (so &ldquo;web 
programming&rdquo; becomes &ldquo;web+programming&rdquo;)
<ul> 
<li>We'll see what to do about actual <code>&quot;+&quot;</code>'s in a moment
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Special Characters</h2> 
<ul> 
<li>Question: what if you want to include <code>&quot;?&quot;</code> or <code>
&quot;&amp;&quot;</code> in a parameter?</li> 
<li>Answer: you <em>URL encode</em> it using <code>&quot;%&quot;</code> 
followed by its 2-digit hexadecimal code
<ul> 
<li> Character Encoding <br>
<code>&quot;#&quot;</code> <code>%23</code> <br>

<code>&quot;$&quot;</code> <code>%24</code> <br>
<code>&quot;%&quot;</code> 
<code>%25</code> <br>
<code>&quot;&amp;&quot;</code> <code>%26</code> <br>

<code>&quot;+&quot;</code> <code>%2B</code> <br>
<code>&quot;,&quot;</code> 
<code>%2C</code> <br>
<code>&quot;/&quot;</code> <code>%2F</code> <br>
<code>
&quot;:&quot;</code> <code>%3A</code> <br>
<code>&quot;;&quot;</code> <code>%3B
</code> <br>
<code>&quot;=&quot;</code> <code>%3D</code> <br>
<code>
&quot;?&quot;</code> <code>%3F</code> <br>
<code>&quot;@&quot;</code> <code>%40
</code> <br>
<br>

<p> Table 22.1: URL Encoding</p> </li> </ul></li> 
<li>Example: to search Google for &ldquo;grade = A+&rdquo;, use <code>
http://www.google.ca/search?q=grade+%3D+A%2B</code></li> 
<li>Helper functions: 
<ul> 
<li><code>urllib.quote(str)</code> replaces special characters in <code>str
</code> with escape sequences</li> 
<li><code>urllib.unquote(str)</code> replaces escape sequences with characters
</li> 
<li><code>urllib.urlencode(params)</code> takes a dictionary, or a list of 
pairs, and constructs the entire query parameter string
<ul> 
<li> 
<pre>import urllib print urllib.urlencode({'surname' : 'hopper', 'forename' : 
'grace'}) print urllib.urlencode([('surname', 'turing'), ('forename', 'alan')])
</pre> 
<pre>surname=hopper&amp;forename=grace surname=turing&amp;forename=alan </pre> 
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Web Services</h2> 
<ul> 
<li>Suppose you want to write a script that actually <em>does</em> search 
Google
<ul> 
<li>Construct a URL: easy</li> 
<li>Send it and read the response: no problem</li> 
<li>Parse the response: hmm, there's a lot of junk on the page&hellip;</li> 
</ul></li> 
<li>Many first-generation web applications relied on <em>screen scraping</em> 
<ul> 
<li>Problem is that whenever the site changes its layout, your application 
breaks</li> </ul></li> 
<li>Modern <em>web services</em> are designed more intelligently 
<ul> 
<li>When a client sends a request, it indicates that it wants machine-readable 
XML, rather than human-readable HTML</li> 
<li>Much easier to parse</li> 
<li>Much less likely to change over time</li> 
<li>An example of a <em>remote procedure call</em></li> 
<li> 
<p> Figure 22.4: Remote Procedure Call Using HTTP</p> <br>
<br>
</li> 
<li>Actually, all HTTP requests are remote procedure calls 
<ul> 
<li>Implicitly invoking a function called &ldquo;fetch me this file&rdquo;</li>
</ul></li> </ul></li> 
<li>Most web services use the Simple Object Access Protocol (SOAP) 
<ul> 
<li>Despite its name, it's anything but simple</li> 
<li>Luckily, there are libraries to hide the details for most widely-used web 
services</li> </ul></li> 
<li>Example: fetch information about a book from Amazon 
<ul> 
<li>Amazon has defined an API for web services</li> 
<li>You need to get a license key in order to use it 
<ul> 
<li>They're free</li> 
<li>Allows Amazon to throttle requests to one per second per client</li> </ul>
</li> 
<li>Use functions in <code>amazon.py</code> to search by various criteria</li> 
<li>Result is a list of objects with information about items that matched the 
search criteria</li> 
<li> 
<pre>import sys, amazon # Format multiple authors' names nicely. def 
prettyName(arg): if type(arg) in (list, tuple): arg = ', '.join(arg[:-1]) + ' 
and ' + arg[-1] return arg if __name__ == '__main__': # Get information. key, 
asin = sys.argv[1], sys.argv[2] amazon.setLicense(key) items = 
amazon.searchByASIN(asin) # Handle errors. if not items: print 'Nothing found 
for', asin if len(items) &gt; 1: print len(items), 'items found for', asin # 
Display information. item = items[0] productName = item.ProductName ourPrice = 
item.OurPrice authors = prettyName(item.Authors.Author) print '%s: %s (%s)' % 
(authors, productName, ourPrice)</pre> </li> 
<li>Note: much more code devoted to creating human-readable output than to 
getting the information</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>Most computers now spend more time communicating than they do calculating
</li> 
<li>Every few years, we put another layer on top of the pile of protocols to 
make communication easier
<ul> 
<li>TCP, HTTP, web services&hellip;</li> </ul></li> 
<li>Getting information from the web is now (almost) as easy as getting it 
from a file</li> 
<li>See in the next lecture how to <em>provide</em> information to others</li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>CGI</h1> prev  Draft Version 547 next <br>
<br>

<h2>The Active Web</h2> 
<ul> 
<li>The web is far more than just a fancy replacement for inter-library loan
</li> 
<li>Most of its power comes from the fact that browsers can interact with 
programs
<ul> 
<li>More accurately, browsers can ask web servers to interact with programs on 
their behalf</li> </ul></li> 
<li>This lecture looks at what to do if you <em>receive</em> an HTTP request 
<ul> 
<li>Very important that you also attend the next lecture on security before 
putting programs of your own on the web</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Common Gateway Interface</h2> 
<ul> 
<li>How to let everyday users write programs that handle HTTP requests? 
<ul> 
<li>Option #1: Require them to write socket-level code 
<ul> 
<li>Complicated and error-prone</li> 
<li>Can only have one program listening to a socket at a time</li> </ul></li> 
<li>Option #2: have the web server accept the HTTP request, and then invoke 
the user's code
<ul> 
<li>Recompiling the web server every time someone wants to add functionality 
would be a pain</li> 
<li>So define a protocol that lets web servers invoke arbitrary external 
programs</li> </ul></li> </ul></li> 
<li>The <em>Common Gateway Interface</em> (CGI) is a simple set of rules that 
specifies:
<ul> 
<li>How a web server passes information to a program</li> 
<li>How that program passes information back to the web server</li> 
<li>Yes, it's another protocol&hellip;</li> </ul></li> 
<li>CGI does <em>not</em> specify: 
<ul> 
<li>A particular language 
<ul> 
<li>You can use Fortran, the shell, C, Java, Perl, Python&hellip;</li> </ul>
</li> 
<li>How the web server figures out what program to run 
<ul> 
<li>Each web server has its own rules</li> 
<li>We'll (briefly) talk about Apache's</li> </ul></li> </ul></li> 
<li>When a CGI is run, the web server sends it information: 
<ul> 
<li>Through environment variables (which are strings) 
<ul> 
<li> Name Purpose Example <br>
<code>REQUEST_METHOD</code> What kind of HTTP 
request is being handled <code>GET</code> or <code>POST</code> <br>
<code>
SCRIPT_NAME</code> The path to the script that's executing <code>
/cgi-bin/post_photo.py</code> <br>
<code>QUERY_STRING</code> The query 
parameters following<code>&quot;?&quot;</code> in the URL <code>
name=mydog.jpg&amp;expires=never</code> <br>
<code>CONTENT_TYPE</code> The type 
of any extra data being sent with the request <code>img/jpeg</code> <br>
<code>
CONTENT_LENGTH</code> How much extra data is being sent with the request (in 
bytes) <code>17290</code> <br>
<br>

<p> Table 23.1: CGI Environment Variables</p> </li> </ul></li> 
<li>On standard input 
<ul> 
<li>If there is extra data, the web server will send <code>CONTENT_LENGTH
</code> bytes to the CGI program on standard input</li> </ul></li> </ul></li> 
<li>The CGI program sends data back to the web server via standard output 
<ul> 
<li>In most cases, the web server forwards this directly to the client</li> 
<li>Which means that the CGI program is responsible for creating headers</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>MIME Types</h2> 
<ul> 
<li>Clients and servers need a way to specify data types to each other 
<ul> 
<li>Remember, bytes are just bytes</li> </ul></li> 
<li><em>Multipurpose Internet Mail Extensions</em> (MIME) standard specifies 
how to do this
<ul> 
<li>Organizes data types into families, and provides a two-part name for each 
type</li> </ul></li> Family Specific Type Describes <br>
Text <code>text/html
</code> Web pages <br>
Image <code>image/jpeg</code> JPEG-format image <br>

Audio <code>audio/x-mp3</code> MP3 audio file <br>
<code>Video</code> <code>
video/quicktime</code> Apple Quicktime video format <br>
Application-specific 
data <code>application/pdf</code> Adobe PDF document <br>
<br>

<p> Table 23.2: Common MIME Types</p> 
<li>Comment on this slide</li> </ul> 
<h2>Hello, CGI</h2> 
<ul> 
<li>Simplest possible CGI pays no attention to query parameters or extra data 
<ul> 
<li>Just prints HTML to standard output, to be relayed to the client</li> 
<li>Also prints the <code>Content-type</code> header to tell the client to 
expect HTML
<ul> 
<li>And a blank line to separate the headers from the data</li> </ul></li> 
<li> 
<pre>#!/python/python.exe # Headers and an extra blank line print 
'Content-type: text/html\n' # Body print 
'&lt;html&gt;&lt;body&gt;&lt;p&gt;Hello, 
CGI!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</pre> </li> </ul></li> 
<li>But the whole point of CGI is to generate content dynamically 
<ul> 
<li>Show a list of environment variables</li> 
<li> 
<pre>#!/python/python.exe import os, cgi # Headers and an extra blank line 
print 'Content-type: text/html\n' # Body print '&lt;html&gt;&lt;body&gt;' keys 
= os.environ.keys() keys.sort() for k in keys: print '&lt;p&gt;%s: 
%s&lt;/p&gt;' % (cgi.escape(k), cgi.escape(os.environ[k])) print 
'&lt;/body&gt;&lt;/html&gt;'</pre> </li> 
<li>You'll use this frequently when debugging&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Creating Forms</h2> 
<ul> 
<li>HTML <em>forms</em> allow users to enter text, choose items from lists, 
etc.
<ul> 
<li>Not nearly as sophisticated as desktop interfaces</li> 
<li>Although programmers are doing more every day (particularly using 
Javascript)</li> </ul></li> 
<li>Create a form using a <code>&lt;form/&gt;</code> element 
<ul> 
<li><code>action</code> is the URL to send data to</li> 
<li><code>method</code> specifies the type of HTTP request to send (e.g., 
<code>&quot;POST&quot;</code>)</li> </ul></li> 
<li>Inside the form, can have: 
<ul> 
<li><code>&lt;select/&gt;</code> elements to let users choose values from a 
list
<ul> 
<li>List items specified using <code>&lt;option/&gt;</code> elements</li> </ul>
</li> 
<li><code>&lt;input/&gt;</code> elements for other kind of data 
<ul> 
<li>If <code>type</code> is <code>&quot;text&quot;</code>, get a one-line text 
entry box</li> 
<li>If <code>type</code> is <code>&quot;checkbox&quot;</code>, get an on/off 
checkbox</li> 
<li><code>&quot;submit&quot;</code> and <code>&quot;reset&quot;</code> create 
buttons to submit the form, or re-set the data to initial values</li> </ul></li>
<li> 
<pre>&lt;html&gt; &lt;body&gt; &lt;form 
action=&quot;http://www.third-bit.com/cgi-bin/simple_form.py&quot; 
method=&quot;POST&quot;&gt; &lt;p&gt;Sequence: &lt;input 
name=&quot;sequence&quot; type=&quot;text&quot; value=&quot;GATTACA&quot;/&gt; 
Search type: &lt;select name=&quot;search_type&quot;&gt; &lt;option&gt;Exact 
match&lt;/option&gt; &lt;option selected=&quot;selected&quot;&gt;Similarity 
match&lt;/option&gt; &lt;option&gt;Sub-match&lt;/option&gt; &lt;/select&gt; 
&lt;/p&gt; &lt;p&gt;Programs: &lt;input checked=&quot;checked&quot; 
name=&quot;program&quot; type=&quot;checkbox&quot; 
value=&quot;FROG-11&quot;&gt;FROG (version 1.1)&lt;/input&gt; &lt;input 
name=&quot;program&quot; type=&quot;checkbox&quot; 
value=&quot;FROG-beta&quot;&gt;FROG (2.0 beta)&lt;/input&gt; &lt;input 
checked=&quot;checked&quot; name=&quot;program&quot; type=&quot;checkbox&quot; 
value=&quot;Bayes-Hart&quot;&gt;Bayes-Hart&lt;/input&gt; &lt;/p&gt; &lt;p&gt; 
&lt;input type=&quot;submit&quot;/&gt; &lt;input type=&quot;reset&quot;/&gt; 
&lt;/p&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;</pre> </li> 
<li> 
<p> Figure 23.1: A Simple Form</p> <br>
<br>
</li> </ul></li> 
<li>Notice that each <code>&lt;input/&gt;</code> element has a <code>name
</code> attribute 
<ul> 
<li>These become the names of the parameters that the client sends to the 
server</li> 
<li>The input elements' values are the parameters' values</li> 
<li>Submitting the form shown above with default values produces: 
<ul> 
<li><code>os.environ['REQUEST_METHOD']</code>: <code>&quot;POST&quot;</code>
</li> 
<li><code>os.environ['SCRIPT_NAME']</code>: <code>
&quot;/cgi-bin/simple_form.py&quot;</code></li> 
<li><code>os.environ['CONTENT_TYPE']</code>: <code>
&quot;application/x-www-form-urlencoded&quot;</code></li> 
<li><code>os.environ['REQUEST_LENGTH']</code>: <code>&quot;80&quot;</code></li>
<li>Standard input: <code>
sequence=GATTACA&amp;search_type=Similarity+match&amp;program=FROG-11&amp;program=Bayes-Hart
</code></li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Handling Forms</h2> 
<ul> 
<li>We <em>could</em> handle form data directly 
<ul> 
<li>Read and parse environment variables</li> 
<li>Read extra data from standard input</li> </ul></li> 
<li>The mechanics are the same each time, so use Python's <code>cgi</code> 
module instead
<ul> 
<li>Defines a dictionary-like object called <code>FieldStorage</code> 
<ul> 
<li>Keys are parameter names</li> 
<li>Values are either strings (if there's a single value assocatied with the 
parameter) or lists (if there are many)</li> </ul></li> 
<li>When one is created, it reads and stores information contained in the URL 
and environment</li> 
<li>Program can then read extra data from <code>sys.stdin</code></li> </ul>
</li> 
<li>Example: show the parameters send to a script 
<ul> 
<li> 
<pre>#!/usr/bin/env python import cgi print 'Content-type: text/html\n' print 
'&lt;html&gt;&lt;body&gt;' form = cgi.FieldStorage() for key in form.keys(): 
value = form.getvalue(key) if isinstance(value, list): value = '[' + ', 
'.join(value) + ']' print '&lt;p&gt;%s: %s&lt;/p&gt;' % (cgi.escape(key), 
cgi.escape(value)) print '&lt;/body&gt;&lt;/html&gt;'</pre> </li> 
<li> URL Value of <code>a</code> Value of <code>b</code> <br>
<code>
http://www.third-bit.com/swc/show_params.py?a=0</code> <code>&quot;0&quot;
</code> None <br>
<code>
http://www.third-bit.com/swc/show_params.py?a=0&amp;b=hello</code> <code>
&quot;0&quot;</code> <code>&quot;hello&quot;</code> <br>
<code>
http://www.third-bit.com/swc/show_params.py?a=0&amp;b=hello&amp;a=22</code> 
<code>[0, 22]</code> <code>&quot;hello&quot;</code> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Development Tips</h2> 
<ul> 
<li>When developing scripts, it helps to add <code>import cgitb; cgitb.enable()
</code> at the top 
<ul> 
<li><code>cgitb</code> is the CGI traceback module</li> 
<li>When enabled, it will create a web page showing a stack trace when 
something goes wrong in your script</li> </ul></li> 
<li>Testing whether a <code>FieldStorage</code> value is a string or a list is 
tedious
<ul> 
<li>In almost all cases, you'll know whether to expect one value or many</li> 
<li>Use <code>FieldStorage.getfirst(name)</code> to get the unique value 
<ul> 
<li>Returns the first, if there are many</li> </ul></li> 
<li><code>FieldStorage.getlist(name)</code> always returns a list of values 
<ul> 
<li>Empty list if there's no data associated with <code>name</code></li> 
<li>If there's only one value, get a single-item list</li> </ul></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Maintaining State</h2> 
<ul> 
<li>Often want to change the data a server is managing, as well as read it 
<ul> 
<li>Update a description of an experiment</li> 
<li>Change your preferred email address</li> 
<li>Add items to a shopping cart</li> </ul></li> 
<li>Your CGI programs can do this any way they want 
<ul> 
<li>You want it to be simple, fast, and secure&hellip;</li> 
<li>&hellip;but these are not always compatible</li> </ul></li> 
<li>The industrial-strength solution is to use a relational database 
<ul> 
<li>A <em>three-tier architecture</em> (browser, web server, database)</li> 
<li> 
<p> Figure 23.2: Three Tier Architecture</p> <br>
<br>
</li> 
<li>CGI program stuffs parameters from HTTP requests into SQL queries</li> 
<li>Runs the queries</li> 
<li>Translates results into HTML to send back to the client</li> </ul></li> 
<li>Simple programs can often get away with using files 
<ul> 
<li>The CGI program re-reads the file each time it processes a request</li> 
<li>And re-writes it if there have been any updates</li> </ul></li> 
<li>Example: append messages to a web page 
<ul> 
<li>Old messages are saved in a file, one per line 
<ul> 
<li> 
<pre>Hi, is anyone reading this site? I was wondering the same thing. I wasn't 
sure if we were supposed to post here. Good point. Is there way to delete 
messages?</pre> </li> </ul></li> 
<li>Script checks the incoming parameters to decide what to do 
<ul> 
<li>If <code>newmessage</code> is there, append it, and display results</li> 
<li>If <code>newmessage</code> <em>isn't</em> there, someone's visiting the 
page, rather than submitting the form</li> 
<li> 
<pre>#!/usr/bin/env python import sys, cgi import cgitb; cgitb.enable() # Get 
existing messages. infile = open('messages.txt', 'r') lines = [x.rstrip() for x 
in infile.readlines()] infile.close() # Add more data? form = 
cgi.FieldStorage() if form.has_key('newmessage'): 
lines.append(form.getfirst('newmessage')) outfile = open('messages.txt', 'w') 
for line in lines: print &gt;&gt; outfile, line outfile.close() # Display. 
print 'Content-Type: text/html\n' print '&lt;html&gt;&lt;body&gt;' for line in 
lines: print '&lt;p&gt;' + line + '&lt;/p&gt;' print ''' &lt;form 
action=&quot;http://www.third-bit.com/swc/message_form.py&quot; 
method=&quot;post&quot;&gt; &lt;p&gt;Your message: &lt;input 
name=&quot;newmessage&quot; type=&quot;text&quot;/&gt; &lt;/p&gt; &lt;p&gt; 
&lt;input type=&quot;submit&quot;/&gt; &lt;input type=&quot;reset&quot;/&gt; 
&lt;/p&gt; &lt;/form&gt; ''' print '&lt;/body&gt;&lt;/html&gt;'</pre> </li> 
</ul></li> 
<li>Note: there is no static HTML page 
<ul> 
<li>What the user sees is always generated by a program</li> </ul></li> 
<li>Note also: a lot of this program is devoted to copying values into an HTML 
<em>template</em> 
<ul> 
<li>There are lots of good systems out there, in many languages, for doing this
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What About Concurrency?</h2> 
<ul> 
<li>What happens if two users try to save messages at the same time? 
<ul> 
<li>First instance of <code>message_form.py</code> opens <code>messages.txt
</code>, reads lines, closes file</li> 
<li>Second instance opens <code>messages.txt</code>, reads <em>the same lines
</em>, closes file</li> 
<li>First instance re-opens file, writes out original data plus one new line
</li> 
<li>Second instance re-opens file, writes out original plus a <em>different
</em> new line</li> 
<li>First instance's message has been lost!</li> 
<li>A race condition</li> </ul></li> 
<li>Solution is to <em>lock</em> the file 
<ul> 
<li>As the name implies, gives one process exclusive rights to the file</li> 
<li>After the first process <em>acquires</em> the lock, any other process that 
tries to read or write the file is<em>suspended</em> until the first <em>
releases</em> it</li> </ul></li> 
<li>Mechanics are different on different operating systems 
<ul> 
<li>But the Python Cookbook includes a generic file locking function that 
works on both Unix and Windows</li> </ul></li> 
<li>Modified solution: 
<ul> 
<li>Open file</li> 
<li>Acquire lock 
<ul> 
<li>If someone else is using the file, blocks until file is available</li> 
</ul></li> 
<li>Read existing messages</li> 
<li>If there's a new message: 
<ul> 
<li><em>Seek</em> to the beginning of the file</li> 
<li>Overwrite data</li> </ul></li> 
<li>And oh yeah, release the lock 
<ul> 
<li>Otherwise, everyone else will wait forever</li> </ul></li> 
<li> 
<pre>#!/usr/bin/env python import sys, cgi, fcntl import cgitb; cgitb.enable() 
# Get existing messages. msgfile = open('messages.txt', 'r+') 
fcntl.flock(msgfile.fileno(), fcntl.LOCK_EX) lines = [x.rstrip() for x in 
msgfile.readlines()] # Add more data? form = cgi.FieldStorage() if 
form.has_key('newmessage'): lines.append(form.getfirst('newmessage')) 
msgfile.seek(0) for line in lines: print &gt;&gt; msgfile, line # Unlock and 
close. fcntl.flock(msgfile.fileno(), fcntl.LOCK_UN) msgfile.close() # Display. 
print 'Content-Type: text/html\n' print '&lt;html&gt;&lt;body&gt;' for line in 
lines: print '&lt;p&gt;' + line + '&lt;/p&gt;' print ''' &lt;form 
action=&quot;http://www.third-bit.com/swc/locking_form.py&quot; 
method=&quot;post&quot;&gt; &lt;p&gt;Your message: &lt;input 
name=&quot;newmessage&quot; type=&quot;text&quot;/&gt; &lt;/p&gt; &lt;p&gt; 
&lt;input type=&quot;submit&quot;/&gt; &lt;input type=&quot;reset&quot;/&gt; 
&lt;/p&gt; &lt;/form&gt; ''' print '&lt;/body&gt;&lt;/html&gt;'</pre> </li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Who Are You Again?</h2> 
<ul> 
<li>What about maintaining state on the client side? 
<ul> 
<li>Need to know which shopping cart to display for a particular user</li> 
<li>But HTTP is a stateless protocol</li> 
<li>If a client makes a second (or third, or fourth&hellip;) request, server 
has no reliable way of connecting it to the first one
<ul> 
<li>Can guess based on host, elapsed time, etc.</li> 
<li>But it's just a guess</li> </ul></li> </ul></li> 
<li>Solution is for the server to create a <em>cookie</em> 
<ul> 
<li>A string that is sent to the client in an HTTP response header</li> 
<li>Client saves it (either in memory or on disk)</li> 
<li>The next time the client sends a request to the site, it sends the cookie 
back to the server</li> 
<li>Like giving someone a claim check for their luggage</li> </ul></li> 
<li>To create a cookie: 
<ul> 
<li>Create an instance of <code>Cookie.SimpleCookie</code> 
<ul> 
<li>Do not use <code>SmartCookie</code>: it is potentially insecure</li> </ul>
</li> 
<li>Add values to the cookie (it acts like a dictionary) 
<ul> 
<li>Typically add things like the user's ID, the time of the visit, etc.</li> 
</ul></li> 
<li>Convert it to a string (e.g., by printing it) to create the required HTTP 
header</li> </ul></li> 
<li>To use a cookie: 
<ul> 
<li>Create a cookie</li> 
<li>Get the value associated with the environment variable <code>
&quot;HTTP_COOKIE&quot;</code></li> 
<li>Pass that value to the cookie's <code>load</code> method</li> </ul></li> 
<li>Example: count the number of times a user has visited a web site 
<ul> 
<li>If there's no cookie, create one with a count of 1</li> 
<li>Otherwise, increment the count</li> 
<li>Create a new cookie to send back to the user</li> 
<li>Display the count</li> 
<li> 
<pre>#!/usr/bin/env python import sys, os, Cookie import cgitb; cgitb.enable() 
# Get old count. count = 0 if os.environ.has_key('HTTP_COOKIE'): cookie = 
Cookie.SimpleCookie() cookie.load(os.environ['HTTP_COOKIE']) if 
cookie.has_key('count'): count = int(cookie['count'].value) # Create new count. 
count += 1 cookie = Cookie.SimpleCookie() cookie['count'] = count # Display. 
print 'Content-Type: text/html' print cookie print print 
'&lt;html&gt;&lt;body&gt;' print '&lt;p&gt;Visits: %d&lt;/p&gt;' % count print 
'&lt;/body&gt;&lt;/html&gt;'</pre> </li> </ul></li> 
<li>Can control how long a cookie is valid by setting an expiry value 
<ul> 
<li>Either the number of milliseconds</li> 
<li>Or the time it should expire (in UTC) 
<ul> 
<li>Use <code>time.asctime(time.gmtime())</code></li> </ul></li> </ul></li> 
<li>Warning: do <em>not</em> put sensitive information in cookies 
<ul> 
<li>Browsers store them in files on disk</li> 
<li>Villains can watch network traffic, and steal data</li> </ul></li> 
<li>Cookies should instead be random values that act as keys into server-side 
information
<ul> 
<li>Talk about this more in the next lecture</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summmary</h2> 
<ul> 
<li>CGI is example of <em>event-driven programming</em> 
<ul> 
<li>The framework invokes your code at specific times, and passes it specific 
information</li> 
<li>What happens the rest of the time isn't your concern 
<ul> 
<li>At least, until something goes wrong, and you have to debug it</li> </ul>
</li> </ul></li> 
<li>Simple CGI programs can accomplish a lot 
<ul> 
<li>The entire first generation of web applications were built this way</li> 
</ul></li> 
<li>But please, attend the next lecture on security before making anything 
publicly available</li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Security</h1> prev  Draft Version 604 next <br>
<br>

<h2>Evil Exists</h2> 
<ul> 
<li>This may be the most important lecture in the course 
<ul> 
<li>Assuming you care about your data, your bank account, your 
reputation&hellip;</li> 
<li>&hellip;and those of others</li> </ul></li> 
<li>Computer security is a collective responsibility 
<ul> 
<li>A system is only as strong as its weakest component</li> 
<li>If you are creating CGI scripts, or sending data over the web, you are 
putting others at risk as well as yourself</li> </ul></li> 
<li>Impossible to cover anything more than the basics in this lecture 
<ul> 
<li>Please read [Schneier 2003] and [Schneier 2005] for broader, non-alarmist 
coverage</li> 
<li>If you want the details, try [Thompson &amp; Chase 2005] and [Skoudis 2004]
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What Are We Trying to Do?</h2> 
<ul> 
<li>Security systems try to achieve many (often contradictory) goals 
<ul> 
<li>Let everyone who should be able to do something do it easily&hellip;</li> 
<li>&hellip;while blocking people who <em>shouldn't</em> be able to&hellip;
</li> 
<li>&hellip;and gathering information about their attempts</li> </ul></li> 
<li>All three parts are important 
<ul> 
<li>Most people are trustworthy most of the time 
<ul> 
<li>Preventing legitimate users from doing things annoys them</li> 
<li>If people are sufficiently annoyed, they'll turn security off, or find 
ways around it</li> 
<li>Example: best way to ensure villains can't access data is to erase 
it&hellip;</li> 
<li>&hellip;which encourages people to write it down on scraps of paper</li> 
</ul></li> 
<li>Have to design the system for the villainous minority 
<ul> 
<li>Any system that relies on trust will eventually be abused</li> 
<li>Be honest: do you <em>always</em> put a quarter in the jar when you get a 
cup of coffee in the staff room?</li> </ul></li> 
<li>Keeping track of how villains are trying to break in is (almost) as 
important as preventing them
<ul> 
<li>A good way to find holes in your system</li> 
<li>Often important to build an audit trail in order to take legal or 
disciplinary action</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Technology Alone Cannot Solve the Problem!</h2> 
<ul> 
<li>This is the only exclamation mark in a topic title in the whole course</li>
<li>Most successful attacks use <em>social engineering</em>, rather than 
technology
<ul> 
<li>Call up your bank, and see if you can get your credit card balance without 
your PIN</li> 
<li>Helps if you sound like a grandmother who is close to tears because her 
poodle has just been hit by a car</li> </ul></li> 
<li>Second most successful way to attack a system is to get a job with the 
company running it
<ul> 
<li>Burn an extra copy of credit card data while backing up the server</li> 
<li>Take notes of all the &ldquo;to be fixed later&rdquo; points that come up 
during the security audit of the web site</li> 
<li>Many companies choose not to press charges, rather than deal with bad 
publicity after a security failure</li> 
<li>Example: AOL employee sold 92 million customer records to a spammer for 
$100,000
<ul> 
<li>Combination of inside job, and stealing the credentials of more privileged 
user</li> </ul></li> </ul></li> 
<li>Exploiting carelessness is the third 
<ul> 
<li>Many people don't bother to change the default password on their wireless 
router</li> 
<li>Many more choose easily-guessed passwords 
<ul> 
<li>&ldquo;Easy&rdquo; if you have the right tools, that is</li> 
<li>But remember: once one villain builds a tool, they can all use it</li> 
</ul></li> </ul></li> 
<li>In fact, technology often makes systems <em>less</em> secure 
<ul> 
<li>Example: facial recognition software that works correctly 99% of the time
</li> 
<li>So one person in a hundred is mistakenly identified as a potential 
terrorist</li> 
<li>300,000 passengers a day in a busy airport</li> 
<li>That's one false alarm every 30 seconds</li> 
<li>How much attention do you think the guards will pay to the system after a 
week on the job?</li> </ul></li> 
<li>There is still a lot you can do, both as a user and as a programmer 
<ul> 
<li>This lecture concentrates on the latter</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How to Think About Security</h2> 
<ul> 
<li>Security systems are responsible for: 
<ul> 
<li><em>Authentication</em>: who are you?</li> 
<li><em>Authorization</em>: who is allowed to do what?</li> 
<li><em>Access control</em>: how are authorization rules enforced?</li> </ul>
</li> 
<li>Every exploit attacks one or more of these 
<ul> 
<li>Convince the system you are someone else 
<ul> 
<li>A regular user (if you're trying to buy stuff with someone else's credit 
card)</li> 
<li>An administrator (or someone else with special privileges)</li> </ul></li> 
<li>Convince it that you're allowed to do something you're not 
<ul> 
<li>E.g., give yourself administrative privileges</li> </ul></li> 
<li>Circumvent its enforcement of the rules 
<ul> 
<li>A browser bug lets Javascript in a page send copies of your cookies to a 
villain's site</li> </ul></li> </ul></li> 
<li>When analyzing security, look for ways to compromise the three A's 
<ul> 
<li>Use <em>defense in depth</em></li> 
<li>If your first security mechanism fails, is there another one behind it 
just in case?</li> 
<li>Remember: the real purpose of a bicycle lock is to convince thieves to go 
and steal something else</li> </ul></li> 
<li>First step is always <em>risk assessment</em> 
<ul> 
<li>What is most important to you? 
<ul> 
<li>I.e., what will cause the most pain if it's broken, or broken into?</li> 
</ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 1: Don't Trust Your Input</h2> 
<ul> 
<li>Anyone who knows the URL of your web application can send it data 
<ul> 
<li>I.e., anyone who has a web browser, knows how to &ldquo;View 
Source&rdquo;, and can read HTML forms</li> </ul></li> 
<li>Therefore no guarantee that the HTTP request you receive was generated 
from your form
<ul> 
<li>The input provided for a selection list may not be one of the values you 
offered</li> 
<li>The input for a text field may be longer than the maximum you specified
</li> 
<li>Some parameters may be missing from <code>QUERY_STRING</code>, while 
unexpected ones may be present</li> 
<li><code>QUERY_STRING</code> may not even be formatted according to the HTTP 
specification</li> </ul></li> 
<li>You must <em>validate</em> all of the input before using it 
<ul> 
<li>Check that all the parameters you expect, and only those, are present</li> 
<li>Check that values meet constraints 
<ul> 
<li>You usually have to do this anyway</li> 
<li>E.g., check that the string provided for &ldquo;Atomic Number&rdquo; 
actually represents an integer</li> 
<li>Or that a villain hasn't replaced <code>&quot;price=399.99&quot;</code> 
with<code>&quot;price=3.99&quot;</code> in the query string</li> </ul></li> 
<li>Make sure that special characters have been escaped 
<ul> 
<li>But watch out for double-escaping</li> 
<li>And don't reinvent the wheel: every language's library has routines to do 
URL escaping, HTML escaping, etc.</li> </ul></li> </ul></li> 
<li>In practice, if input can't be validated, best to reject the request 
entirely
<ul> 
<li>One exception: if your application is evolving, you might want to see if 
this input was meant for an old version</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Paths and I/O</h2> 
<ul> 
<li>Always check filenames supplied by user 
<ul> 
<li>Just a special case of the preceding rule, but an important one</li> </ul>
</li> 
<li>Example: controlling access to documents 
<ul> 
<li>All your documents live below <code>/web/docs</code></li> 
<li>When you get a URL, you check that <code>url[:9] == '/web/docs'</code> to 
prevent people from accessing<code>/home/dknuth/grades.xsl</code></li> 
<li>So someone sends you <code>/web/docs/../../home/dknuth/grades.xsl</code>
</li> 
<li>Solution: normalize paths before using them, and then check whether the 
result lies in or below the directories you want to open up</li> 
<li>Analysis: circumventing access control 
<ul> 
<li>But also using a weakness in authorization</li> 
<li>The web server (which is running the CGI on the client's behalf) shouldn't 
have permission to read anything it doesn't absolutely need to</li> </ul></li> 
</ul></li> 
<li>Example: temporary files 
<ul> 
<li>While handling requests, a CGI creates a temporary file <code>
/tmp/1728397.cgidata</code> (where 1728397 is a random number)</li> 
<li>A villain with an account on the system writes a Python script that 
repeatedly looks in<code>/tmp</code> for <code>*.cgidata</code> files 
<ul> 
<li>When it finds one, it makes a copy for the villain to inspect later</li> 
<li>Or overwrites its contents with fabricated data</li> </ul></li> 
<li>Analysis?</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Rule 2: Never Run User Commands</h2> 
<ul> 
<li>Suppose you want to build a search engine 
<ul> 
<li>Can't be bothered to look for strings in files yourself, so you run <code>
grep</code> in a sub-process</li> 
<li> 
<pre>#!/usr/bin/env python import os, cgi form = cgi.FieldStorage() term = 
form['term'] cmd = 'grep %s data.txt' % term instream = os.popen(cmd, 'r') 
results = instream.readlines() instream.close() print 'Content-type: 
text/html\n' print '&lt;html&gt;&lt;body&gt;' for line in results: print 
'&lt;p&gt;', cgi.escape(line), '&lt;/p&gt;' print '&lt;/body&gt;&lt;/html&gt;'
</pre> </li> </ul></li> 
<li>What happens if someone sends a URL with <code>&quot;term=dummy 
/dev/null;rm -rf *&quot;</code>? 
<ul> 
<li><code>cmd</code> becomes <code>grep term=dummy /dev/null; rm -rf * data.txt
</code></li> 
<li><code>grep</code> produces no output (since <code>/dev/null</code> is 
always empty)</li> 
<li>Then the web server deletes everything it can, recursively</li> 
<li>Oops</li> </ul></li> 
<li>Adding quotes around terms and escaping special characters hide the 
problem rather than eliminating it
<ul> 
<li>Right solution: don't rely on external programs</li> 
<li>More specifically, if there's a layer of interpretation between you and 
what you're running, then there's one more weak spot for a villain to attack
</li> </ul></li> 
<li>Note that the same thing can happen even if you don't rely on outside 
programs
<ul> 
<li>If <code>expr</code> is a string, <code>eval(expr)</code> interprets it as 
if it had been typed in then and there</li> 
<li>Sometimes used to let people specify complex search criteria 
<ul> 
<li>HTTP request contains <code>
&quot;criteria=record.left+record.right&amp;lt;0&quot;</code></li> 
<li>CGI plugs it into a standard loop</li> 
<li> 
<pre>#!/usr/bin/env python import os, cgi form = cgi.FieldStorage() criteria = 
form['criteria'] results = [] for record in readRecords(): keep = 
eval(criteria) if keep: results.append(record.title) print 'Content-type: 
text/html\n' print '&lt;html&gt;&lt;body&gt;' for title in results: print 
'&lt;p&gt;', cgi.escape(title), '&lt;/p&gt;' print '&lt;/body&gt;&lt;/html&gt;'
</pre> </li> </ul></li> 
<li>But it has the same problem as using the shell 
<ul> 
<li>Exercise for the reader: construct an HTTP query string that will do 
something evil</li> </ul></li> </ul></li> 
<li><em>SQL injection</em> is a variation on the theme 
<ul> 
<li>Your program expects a user name</li> 
<li>Constructs SQL to query the database like this:</li> 
<li> 
<pre>query = &quot;SELECT * FROM Data WHERE Username='%s'&quot; % username 
cursor.execute(query) results = cursor.fetchall();</pre> </li> 
<li>But someone enters this as their user name:</li> 
<li> 
<pre>fred'; UPDATE Employees SET Salary = 1000000 WHERE username = 'me</pre> 
</li> 
<li>The resulting SQL is legal (all the quotes match), but probably isn't what 
the programmer wanted</li> </ul></li> 
<li><em>Cross-site scripting</em> is the same problem in another guise 
<ul> 
<li>If a bulletin board or discussion forum lets you post HTML, you can 
include Javascript in it</li> 
<li>When someone views what you wrote, their browser runs that Javascript</li> 
<li>It can harvest information from your machine, and post it to the attacker
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Cryptography 101</h2> 
<ul> 
<li><em>Encryption</em> is the process of obscuring information so that it 
can't be read without special knowledge
<ul> 
<li>Recovering the information is called <em>decryption</em></li> </ul></li> 
<li>An algorithm for encrypting and decrypting is called a <em>cipher</em></li>
<li>Original and encrypted messages are called <em>plaintext</em> and <em>
ciphertext</em> respectively</li> 
<li>All classical (pre-1970s) ciphers are <em>symmetric</em> 
<ul> 
<li>Same key is used for both encryption and decryption</li> 
<li>Which means that the key can only be shared among trusted parties</li> 
</ul></li> 
<li><em>Asymmetric</em> ciphers have two keys 
<ul> 
<li>Each undoes the other's effects</li> 
<li>(Practically) impossible to determine one given the other</li> </ul></li> 
<li>Asymmetric systems are often called <em>public-key</em> systems 
<ul> 
<li>Publish one key, keep the other secret 
<ul> 
<li>The published key is called the <em>public key</em>, the unpublished one 
is called the<em>private key</em></li> 
<li>If you know how the underlying modulus is built you can relatively easily 
derive one key from the other.</li> </ul></li> 
<li>Anyone who wants to send a message to you encrypts it using the public key 
<ul> 
<li>You're the only one who can decrypt it</li> </ul></li> 
<li>Asymmetric systems can be used sign a message. 
<ul> 
<li>You send a text and append cypher of it encrypted with your private key.
</li> 
<li>Everybody can decript the cypher text with the public key and if it must 
be identical with the clear text.</li> 
<li>Then it is guaranteed that the message was encrypted with the private key 
(unless the system is cracked).</li> 
<li>It is also guaranteed that the clear text was not changed, e.g. to not buy 
10 cars instead of 1.</li> 
<li>Which is better then for regular signatures.</li> </ul></li> 
<li> 
<p> Figure 24.1: Secure Communication with Asymmetric Keys</p> <br>
<br>
</li> 
</ul></li> 
<li>Note: symmetric encryption is typically many times faster than asymmetric 
encryption
<ul> 
<li>Usual scheme these days is to use asymmetric encryption (slow) to exchange 
a one-time symmetric key</li> 
<li>Then use the symmetric key (fast) for the rest of the transaction</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How Asymmetric Cryptography Works?</h2> 
<ul> 
<li>Best know algorithm is RSA 
<ul> 
<li>Invented by Ron Rivest, Adi Shamir and Len Adleman in 1977 at MIT.</li> 
<li>Where might the name RSA come from?</li> </ul></li> 
<li>Bases on Fermat's little theorem 
<ul> 
<li>For every a it is a ** (p-1) % p == 1 if p is a prime number.</li> </ul>
</li> 
<li>Now choose two large prime numbers p and q.</li> 
<li>Compute n = p*q. 
<ul> 
<li>How n is factorized is actually the important secret.</li> </ul></li> 
<li>Choose an integer e != 0 which is not disible by (p-1) and by (q-1).</li> 
<li>Compute an integer d such that d*e % ((p-1)(q-1)) == 1. 
<ul> 
<li>Therefore (a ** e) ** d == (a ** d) ** e == a (modulo n). 
<ul> 
<li>In other words, some text encrypted with e and than encrypted again with d 
returns to the original.</li> 
<li>Same way, first encrypted with d and then with e gives the original.</li> 
</ul></li> </ul></li> 
<li>n and e are published.</li> 
<li>Factorizing n allows you to generate d. 
<ul> 
<li>If you can do this you get immediately an A in this course.</li> 
<li>And most likely a Turing Award, a Fields Medal or a Nobel Prize.</li> 
<li>And probably some trouble from secret services.</li> </ul></li> 
<li>Most people consider cracking RSA as complicated as factorization. 
<ul> 
<li>But there is no proof that you cannot crack RSA in another way.</li> </ul>
</li> 
<li>Which computers can factorize numbers in polynomial time?</li> 
<li>Comment on this slide</li> </ul> 
<h2>Securing HTTP</h2> 
<ul> 
<li>HTTP sends data as cleartext 
<ul> 
<li>As is too often the case, security was ignored in HTTP's original design
</li> </ul></li> 
<li>Netscape later developed HTTPS (Secure HTTP) to protect confidential 
information
<ul> 
<li>Uses a different port (443 instead of 80) protocol (<code>https</code> in 
URL instead of<code>http</code>)</li> 
<li>Encrypts data between the browser and the web server</li> 
<li>Does not guarantee secure storage on the server 
<ul> 
<li>Far too many web sites store sensitive information in databases as 
cleartext</li> 
<li>Gives villains another point of attack</li> </ul></li> </ul></li> 
<li>Another flaw in HTTP is its built-in password handling (called <em>basic 
authentication</em>) 
<ul> 
<li>Sends the user name and password <em>as cleartext</em> 
<ul> 
<li>Actually, encoded using base-64&hellip;</li> 
<li>&hellip;but that's not a cipher</li> </ul></li> 
<li>Never use HTTP basic authentication</li> 
<li>Note: having users submit ID and password via a form is also insecure 
<ul> 
<li>Form data isn't encrypted</li> </ul></li> </ul></li> 
<li>Alternative: 
<ul> 
<li>Have user provide ID and password over secure connection</li> 
<li>Use a random number as a cookie 
<ul> 
<li>Do not just use a sequence of integer session IDs: too easy for attackers 
to fabricate</li> </ul></li> 
<li>Give that to the client to track the session 
<ul> 
<li>When it comes back, use it as a key into a dictionary of active sessions
</li> </ul></li> </ul></li> 
<li>Still not perfect 
<ul> 
<li>If villains can snoop on network traffic, they can <em>hijack</em> sessions
<ul> 
<li>Insert a copy of your cookie into their message</li> </ul></li> 
<li>Also vulnerable to <em>replay attacks</em> 
<ul> 
<li>Copy the cookie (or an entire message) and re-send it later</li> 
<li>Useful if the message means &ldquo;open the vault door&rdquo;</li> </ul>
</li> </ul></li> 
<li>Note: none of this helps if there is spyware on the client machine 
<ul> 
<li>These days, this is much more likely than someone sniffing network traffic
</li> 
<li>Keep your anti-virus protection and spyware monitors up to date, and run 
them regularly
<ul> 
<li>What else is there for your machine to do at 3:00 a.m.?</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How do you login remotely?</h2> 
<ul> 
<li>Data are send as cleartext in <code>&quot;rlogin&quot;</code> and <code>
&quot;telnet&quot;</code>. 
<ul> 
<li>Even account names and passwords are sent in clear text.</li> 
<li>Everybody on the same sub-net can easily track them.</li> </ul></li> 
<li>Use <code>&quot;ssh&quot;</code> instead whenever possible. 
<ul> 
<li>Most machines these have only ssh, anyway.</li> </ul></li> 
<li>For the same reasons use <code>&quot;scp&quot;</code> instead of <code>
&quot;ftp&quot;</code>.</li> 
<li>Comment on this slide</li> </ul> 
<h2>Do and Don't</h2> 
<ul> 
<li>Always consult an expert when designing a system that relies on encryption 
<ul> 
<li>Easy to use a perfectly good cipher in a way that either weakens the 
crypto, or provides no real security</li> 
<li>Example: 802.11 wireless networking took a cipher that is secure when used 
correctly&hellip;</li> 
<li>&hellip;and created a system which gives away both your data and your 
private key to eavesdroppers
<ul> 
<li>Then they burned it into ROM on millions of devices</li> </ul></li> </ul>
</li> 
<li>Never rely on keeping your algorithm secret 
<ul> 
<li>Security must depend only on secrecy of keys</li> </ul></li> 
<li>Never design your own ciphers 
<ul> 
<li>Unless you have a Ph.D. in cryptography, in which case you should be 
teaching this section of the course</li> 
<li>Use the best well-known ciphers&mdash;they have been thoroughly tested, 
and are more secure than anything you could invent
<ul> 
<li>3DES or AES for symmetric encryption</li> 
<li>RSA, DSA, or EC-DSA for public-key</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>This lecture has only scratched the surface 
<ul> 
<li>Have discussed only a tiny fraction of the issues that programmers face
</li> 
<li>Haven't talked about user-level issues at all</li> </ul></li> 
<li>If you are going to do anything that's even a little bit complicated, 
please talk to a professional
<ul> 
<li>The guy down the hall who once read an O'Reilly book on Perl doesn't count
</li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Teamware</h1> prev  Draft Version 398 next <br>
<br>

<h2>Introduction</h2> 
<ul> 
<li>No programmer is an island 
<ul> 
<li>You may be the only person writing code today, but you: 
<ul> 
<li>Probably depend on tools and libraries written by other people</li> 
<li>May have inherited the project from someone else</li> 
<li>Ought to be thinking about who's going to take over once you're gone</li> 
</ul></li> </ul></li> 
<li>As open source spreads, being able to work in teams becomes even more 
important</li> 
<li>This lecture looks at some of the things teams have to do to stay 
productive
<ul> 
<li>All of which will make you more productive as an individual, too</li> </ul>
</li> 
<li>Introduce the ideas by showing you how to use a web-based project 
coordination tool called Trac
<ul> 
<li>Open source</li> 
<li>Reliable</li> 
<li>Easy to set up and install</li> 
<li>Modular, so that you can add new features (relatively) easily)</li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Overview</h2> 
<ul> 
<li>Trac is a Python CGI program that provides: 
<ul> 
<li>A <em>repository browser</em>, so that users can inspect the contents and 
history of a version control repository</li> 
<li>An <em>issue tracker</em> for managing a shared to-do list</li> 
<li><em>Mailing lists</em>, to help groups stay in touch</li> 
<li>A <em>wiki</em> for creating web pages and making links to other items in 
Trac</li> 
<li>A <em>roadmap</em>, for keeping track of upcoming <em>milestones</em>, and 
what's to be done for them</li> 
<li>A <em>dashboard</em>, which graphs statistics about project progress and 
status</li> 
<li>A <em>timeline</em> showing recent project activity</li> 
<li>A <em>weblog</em>, which reports timeline events to interested parties</li>
</ul></li> 
<li>These are all integrated 
<ul> 
<li>To-do items can refer to web pages, which can refer to particular 
revisions of files, etc.</li> </ul></li> 
<li>A single Trac installation can manage any number of projects 
<ul> 
<li>Each project's files are stored in a separate Subversion repository</li> 
<li>Everything else stored in a single shared database 
<ul> 
<li>SQLite for development work and small sites</li> 
<li>PostgreSQL for large sites</li> </ul></li> 
<li> 
<p> Figure 25.1: Trac Architecture</p> <br>
<br>
</li> </ul></li> 
<li>Relies on host to handle authentication 
<ul> 
<li>Every user must have an account on the underlying Linux system</li> 
<li>One less password for them to remember</li> </ul></li> 
<li>Home page looks like pretty much every other web portal's home page 
<ul> 
<li> 
<p> Figure 25.2: Typical Trac Home Page</p> <br>
<br>
</li> </ul></li> 
<li>Examine each of the components in turn below</li> 
<li>Comment on this slide</li> </ul> 
<h2>Repository Browser and Timeline</h2> 
<ul> 
<li>The repository browser is a web-based interface to Subversion 
<ul> 
<li>Read-only: cannot update local files, or commit changes</li> 
<li>Implementing this would require giving web pages the ability to mess with 
your hard drive</li> 
<li>If you don't know why this is a bad thing, please re-read the lecture on 
security</li> </ul></li> 
<li>Read-only is more useful than you'd think 
<ul> 
<li>Browse directories and files to see what they contain</li> 
<li> 
<p> Figure 25.3: Browsing Directories and Files</p> <br>
<br>
</li> 
<li>View old versions of files</li> 
<li> 
<p> Figure 25.4: Viewing an Old Version of a File</p> <br>
<br>
</li> 
<li>See changes made to files over time</li> 
<li> 
<p> Figure 25.5: Viewing File Changes</p> <br>
<br>
</li> </ul></li> 
<li>Following a changeset link takes you to the timeline view 
<ul> 
<li>Shows all recent project events</li> 
<li> 
<p> Figure 25.6: The Timeline</p> <br>
<br>
</li> 
<li>Filter control lets you select what types of events you want to see, from 
how long ago</li> 
<li> 
<p> Figure 25.7: Filtering Events</p> <br>
<br>
</li> 
<li>Very useful if you've been busy with other things for a while, and need to 
find out what's happened in your absence</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Issue Tracker</h2> 
<ul> 
<li>An issue tracker (sometimes called a <em>bug tracker</em> is a tool for 
managing a shared to-do list
<ul> 
<li>What needs to be done?</li> 
<li>Who's responsible for each task?</li> 
<li>What state is each task in?</li> </ul></li> 
<li>Essential tool for managing long-lived or multi-person projects 
<ul> 
<li>But only as useful as the information in it</li> 
<li>Trac's issue tracker is simpler than most, in order to make entering data 
very easy</li> 
<li>Most large projects use more complicated tools, such as <em>Bugzilla</em>
</li> </ul></li> 
<li>To create a <em>ticket</em>: 
<ul> 
<li>Follow the &ldquo;New Ticket&rdquo; link</li> 
<li> 
<p> Figure 25.8: Creating a New Ticket</p> <br>
<br>
</li> 
<li>Fill in the fields 
<ul> 
<li>Who you are</li> 
<li>A one-line title for the ticket</li> 
<li>What kind of ticket it is</li> 
<li>How important it is</li> 
<li>When it needs to be resolved</li> 
<li>A description of the issue</li> </ul></li> 
<li>And submit</li> </ul></li> 
<li>To see what tickets are already in the system: 
<ul> 
<li>Follow either the &ldquo;View My Tickets&rdquo; or &ldquo;View Project 
Tickets&rdquo; link
<ul> 
<li>The first shows your tickets across all projects</li> 
<li>The second shows all tickets for the current project</li> </ul></li> 
<li>Tickets can be sorted and filtered in various ways</li> </ul></li> 
<li>Click on a ticket to view or update it 
<ul> 
<li>All the information entered by the original author</li> 
<li>A flag showing whether it is <em>open</em> (i.e., still needs work) or <em>
closed</em> (completed)</li> 
<li>Any comments other people have added to the ticket 
<ul> 
<li>Every time you change a ticket, you should explain why</li> 
<li>Like commenting on changes you submit to version control</li> </ul></li> 
</ul></li> 
<li>Note: after updating a ticket, go back to the timeline view 
<ul> 
<li>Time of change, ticket ID, and comment are displayed</li> 
<li>The display is a link back to the ticket 
<ul> 
<li>Information is more useful when it's connected</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>How to Write Tickets</h2> 
<ul> 
<li>A badly-written ticket is better than no ticket at all, but not by much
</li> 
<li>The summary should be short and informative 
<ul> 
<li>Aim is to help people who are looking at 100 summaries find the one(s) 
they care about</li> 
<li>&ldquo;Bug in seq comp&rdquo; is bad</li> 
<li>&ldquo;Seq. comparison returns wrong probabilities for bivalves&rdquo; is 
much better</li> </ul></li> 
<li>Usually have three kinds of tickets: 
<ul> 
<li>Bugs</li> 
<li>Feature requests (i.e., someone wants the software to do something it 
doesn't)</li> 
<li>Questions 
<ul> 
<li>I.e., &ldquo;Does anyone know how to parse external entities with 
Expat?&rdquo;</li> 
<li>Or, &ldquo;How many old versions of Windows are we going to support?&rdquo;
</li> 
<li>May seem odd to file these as issues, but they are for the person who's 
asking</li> 
<li>And it's more efficient than posting them to the mailing list</li> </ul>
</li> </ul></li> 
<li>Whole team has to agree on what importance values mean 
<ul> 
<li>Low: cosmetic UI problem, minor workflow annoyance with obvious 
workaround, etc.</li> 
<li>High: program crashes, returns wrong result, inadvertently launches 
nuclear assault on Iceland, etc.</li> 
<li>Medium: anything in between</li> 
<li>In the weeks and days leading up to a release, perform regular <em>triage
</em> 
<ul> 
<li>Go through the open issues, and re-set their priorities so that everyone 
knows what they ought to be working on</li> </ul></li> </ul></li> 
<li>Description: provide all the information someone needs to know to address 
the issue
<ul> 
<li>For a bug, need: 
<ul> 
<li>Software configuration, including package versions, operating system, etc.
</li> 
<li>Sequence of steps or unit test case that triggers the fault</li> 
<li>Configuration files, input data, screenshots of the fault, etc.</li> </ul>
</li> 
<li>Similar level of detail for feature requests and questions</li> 
<li>Remember, it may be weeks or months before the issue is addressed</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Mailing Lists</h2> 
<ul> 
<li>Trac assumes that everyone has a mail reader that they're happy with</li> 
<li>Doesn't try to compete 
<ul> 
<li>No way to compose or send mail in Trac</li> 
<li>Users don't have mailboxes on the system</li> </ul></li> 
<li>Instead, Trac creates one mailing list for each project 
<ul> 
<li>Everyone who's a member of a project is automatically on that list</li> 
<li>Only project members can send mail to it</li> </ul></li> 
<li>Every user must <em>whitelist</em> one or more email addresses with Trac 
<ul> 
<li>The opposite of <em>blacklisting</em>: specifies who's allowed in, instead 
of who's to be kept out</li> 
<li> 
<p> Figure 25.9: Whitelisting an Email Address</p> <br>
<br>
</li> 
<li>Trac will accept mail from any whitelisted address</li> 
<li>User must specify which of those addresses to forward project mail to</li> 
<li>This way, people can send from any external mail account, but all project 
mail arrives in one place</li> </ul></li> 
<li>Timeline shows old mail messages as well as other events 
<ul> 
<li>Not threaded by topic: unnecessary complexity for small projects</li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Wiki</h2> 
<ul> 
<li>A wiki is a simple web-based system for creating web pages 
<ul> 
<li>Term comes from the Hawaiian &ldquo;wiki wiki&rdquo;, meaning 
&ldquo;faster faster&rdquo;</li> </ul></li> 
<li>If you have logged in, and have permissions to edit the wiki, then every 
page has an &ldquo;Edit&rdquo; button
<ul> 
<li>Clicking this displays the page source in a text edit box</li> 
<li> 
<p> Figure 25.10: Editing a Wiki Page</p> <br>
<br>
</li> </ul></li> 
<li>Syntax is much simpler than standard HTML 
<ul> 
<li>Blank lines separate paragraphs</li> 
<li>Any word in <em>CamelCase</em> is automatically interpreted as a link to a 
page with that name</li> 
<li><code>= Title =</code> creates a level-1 heading, <code>== Subtitle ==
</code> creates a level-2 heading, etc.</li> 
<li>Series of indented lines beginning with <code>*</code> is displayed as a 
list</li> 
<li>Anything ending in <code>.png</code>, <code>.jpg</code>, or <code>.gif
</code> is automatically displayed as an image</li> </ul></li> 
<li>Doesn't let you do everything&hellip; 
<ul> 
<li>&hellip;e.g., you can't specify alignment of table items&hellip;</li> 
<li>&hellip;but it makes it very easy to create meeting minutes, notes for 
first-time users, etc.</li> </ul></li> 
<li>Once you've made changes, you can preview the page, or commit the changes 
<ul> 
<li>Pages are saved in the database, rather than in Subversion</li> 
<li>Translated from wiki syntax into HTML when the page is viewed</li> 
<li>Note: no conflict resolution mechanism 
<ul> 
<li>If two people try to edit a wiki page at the same time, the second one to 
commit will be denied</li> 
<li>So put large and/or frequently-updated documents under version control 
instead</li> </ul></li> </ul></li> 
<li>Wiki syntax offers shortcuts for referring to other things in Trac 
<ul> 
<li><code>#22</code> links to ticket 22</li> 
<li><code>@41</code> links to email message 41</li> 
<li><code>[94]</code> links to revision 94 in the version control repository
</li> 
<li><code>source:path/to/filename.txt</code> links to a particular file in the 
Subversion repository
<ul> 
<li><code>source:path/to/filename.txt#94</code> links to a particular version 
of the file</li> </ul></li> </ul></li> 
<li>You can use this same syntax in: 
<ul> 
<li>Tickets (to refer to changesets, file versions, email messages, etc.)</li> 
<li>Email messages (as long as your mailer sends messages as plain text, 
rather than HTML)</li> 
<li>Subversion commit comments</li> 
<li>Just about everywhere else</li> 
<li>Remember, information is more useful when it's connected</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Roadmap and Milestones</h2> 
<ul> 
<li>A milestone is a time by which something is supposed to be done 
<ul> 
<li>A roadmap is just a collection of milestones</li> </ul></li> 
<li>Usually give milestone symbolic names, like &ldquo;version 2 beta 
release&rdquo;
<ul> 
<li>That way, when the date changes, you don't have a milestone called 
&ldquo;April 1&rdquo; whose due date is May 15</li> </ul></li> 
<li>Trac requires you to associate every issue with a milestone 
<ul> 
<li>Default is the empty milestone, which means &ldquo;sometime&rdquo;</li> 
</ul></li> 
<li>Can sort and view tickets by milestone 
<ul> 
<li>Moving low-priority tickets from upcoming milestone to later ones is part 
of pre-release triage process</li> </ul></li> 
<li>Much (much) simpler than most project management tools 
<ul> 
<li>No Gantt charts, no dependency graphs, etc.</li> 
<li>They're overkill for small projects 
<ul> 
<li>Particularly research projects, which frequently change direction</li> 
</ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Dashboard</h2> 
<ul> 
<li>The dashboard is a graphical complement to the timeline view 
<ul> 
<li>Plot changes to code, tickets, etc. over time</li> 
<li> 
<p> Figure 25.11: Dashboard Display</p> <br>
<br>
</li> 
<li>Allow users to compare activity in various projects 
<ul> 
<li>Has anyone been working on this project in the last few weeks?</li> 
<li>Has this project's test coverage been going up or down?</li> </ul></li> 
<li>In an educational setting, allow people to compare their projects against 
a class average
<ul> 
<li>Which can be very motivational</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Blogging</h2> 
<ul> 
<li>Weblogs (or <em>blogs</em>) started off as on-line journals 
<ul> 
<li>Author updates a file with new journal entries 
<ul> 
<li>File written in an XML format called <em>RSS</em></li> </ul></li> 
<li>Blog-reading software downloads file at irregular intervals 
<ul> 
<li>If anything has changed since the last time, display the titles of new 
articles</li> </ul></li> 
<li> 
<p> Figure 25.12: How Blogs Work</p> <br>
<br>
</li> 
<li>A <em>publish-subscribe</em> system 
<ul> 
<li>If you no longer want to read a blog, stop polling for updates</li> 
<li>Helps reduce information overload</li> </ul></li> </ul></li> 
<li>Every Trac project creates two blogs 
<ul> 
<li>One includes only articles by people (announcements of new releases, 
commentary on the world at large, etc.)</li> 
<li>The other also includes all timeline events</li> 
<li>Project members and supervisors can subscribe to be notified of changes to 
files and tickets, etc.</li> 
<li> 
<p> Figure 25.13: A Trac Timeline Blog</p> <br>
<br>
</li> </ul></li> 
<li>The &ldquo;Compose Blog Entry&rdquo; page allows project members to create 
entries for the announcements blog
<ul> 
<li>Note: only people logged in to that Trac installation can comment on 
entries</li> 
<li>Occasionally annoying, but helps reduce <em>comment spam</em></li> </ul>
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Administration</h2> 
<ul> 
<li>Trac is administered from the command line, rather than through the web 
<ul> 
<li>Simpler to write and maintain</li> 
<li>Makes it simpler for administrators to create a dozen accounts in a single 
step, etc.</li> </ul></li> 
<li>Two interfaces: 
<ul> 
<li>A standalone command-line tool called <code>trac-admin</code></li> 
<li>A Python library, so that administrators can write scripts to do whatever 
they want</li> </ul></li> 
<li>As mentioned earlier, Trac relies on underlying operating system to manage 
user accounts
<ul> 
<li>Authentication is (only) as secure as your password policy</li> </ul></li> 
<li>Trac uses (person, project, permission) triples for authorization 
<ul> 
<li>E.g., <code>(aturing, enigma, WIKI_WRITE)</code> or <code>(ghopper, demo, 
TICKET_READ)</code></li> 
<li>Every operation requires one or more permissions</li> 
<li>If there isn't a triple giving you a permission, you don't have it</li> 
</ul></li> 
<li>Some standard <em>roles</em> are pre-defined (and more can be added) 
<ul> 
<li>A role is a set of permissions</li> 
<li><code>(jvn, funiac, ROLE_DEVELOPER)</code> gives a user all the 
permissions associated with the developer role</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>And that's it 
<ul> 
<li>At least, so far&mdash;Trac is under active development</li> </ul></li> 
<li>All you need to run a small or medium-sized project 
<ul> 
<li>Very useful for geographically-distributed collaborations</li> 
<li>Just as useful when one person has to manage his or her own work over the 
course of months or years</li> 
<li>Harder to lose a database than a lab notebook&hellip;</li> </ul></li> 
<li>If Trac is too small for your needs, there are many larger alternatives 
<ul> 
<li><em>SourceForge</em> is by far the most famous</li> 
<li>Will host open source projects for free on their machines</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 25.1:</p> 
<p>Can you find out what bugs are currently being worked on? What feature 
requests have been deferred? Which files were changed to fix a problem? What 
fixes are currently being tested? How long it took to fix/implement something?
</p> 
<p>Exercise 25.2:</p> 
<p>What is the status of the overnight build? The overnight regression tests? 
The issue database? The team's discussions?</p> prev top next <br>
<br>

<h1>Extreme Programming</h1> prev  Draft Version 588 next <br>
<br>

<h2>Code Early, Code Often</h2> 
<ul> 
<li>Knowing how to write code doesn't tell you how to run a project 
<ul> 
<li>Where do you start?</li> 
<li>What do you do next?</li> 
<li>Who's responsible for what?</li> 
<li>How do you tell when you're done?</li> </ul></li> 
<li>Answers to these questions define a <em>development process</em></li> 
<li>Dozens have been formalized and described 
<ul> 
<li>But in practice, almost none are followed to the letter</li> 
<li>Every real-world situation and team is different, so real process is 
always a variation on the theme
<ul> 
<li>I always add extra garlic to my chili&hellip;</li> 
<li>&hellip;and just about everything else, come to think of it</li> </ul></li>
</ul></li> 
<li>This lecture looks at a process called <em>Extreme Programming</em> (XP) 
<ul> 
<li>Best suited to small teams that are trying to cope with 
constantly-changing requirements</li> 
<li>Which is a good description of many scientific research teams</li> </ul>
</li> 
<li>Look at two alternatives in the next couple of lectures</li> 
<li>Remember: every team is different 
<ul> 
<li>Most important thing is not which process you use, but that you're paying 
attention to process</li> 
<li> [DeMarco &amp; Lister 1999] is a good introduction to teams and 
productivity</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Waterfalls and Spirals</h2> 
<ul> 
<li>In order to understand XP, you have to understand what it's a reaction 
against</li> 
<li>Also have to understand the cost of change 
<ul> 
<li>The later a change is made, the more expensive it is to implement</li> 
<li> 
<p> Figure 26.1: The Cost of Change</p> <br>
<br>
</li> 
<li>Therefore important to make decisions early, and stick to them</li> </ul>
</li> 
<li>The <em>waterfall model</em>, described by Royce in 1970, describes 
development flowing through several phases
<ul> 
<li>Requirements analysis</li> 
<li>Design</li> 
<li>Implementation</li> 
<li>Testing</li> 
<li>Maintenance</li> 
<li> 
<p> Figure 26.2: The Waterfall Model</p> <br>
<br>
</li> 
<li>Problems: 
<ul> 
<li>If different people responsible for different phases, then no one has to 
deal with the consequences of their mistakes</li> 
<li>Whoever is responsible for testing has to make up all the lost time from 
the previous phases</li> 
<li>Time lag: it can take a long time for changes in requirements to filter 
through to the finished product</li> </ul></li> </ul></li> 
<li>The <em>spiral model</em> described by Boehm in 1986 wraps this on itself 
<ul> 
<li>Get a goal from the customer, design, implement, and test it, and repeat 
<ul> 
<li>Note: Royce actually advocated doing this too, but most people have 
forgotten that</li> </ul></li> 
<li>Key ideas: 
<ul> 
<li>The code teaches you about the problem</li> 
<li>Customers can only find out what they actually want by playing with a 
working system</li> </ul></li> 
<li>But Boehm still envisaged cycles lasting from six months to two years 
<ul> 
<li>And division of labor</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Enter the Extremists</h2> 
<ul> 
<li>XP arose in the 1990s to cope with: 
<ul> 
<li>Ever-changing requirements</li> 
<li>Internet time 
<ul> 
<li>Six-month iterations were longer than the lifespan of the average dot-com
</li> </ul></li> </ul></li> 
<li>Assumption: change is cheaper than it used to be 
<ul> 
<li>Note: less data to support this than some XP advocates would have you 
believe&hellip;</li> </ul></li> 
<li>Basic idea: each iteration lasts only one to four weeks 
<ul> 
<li>Implies that each version is only a small step forward from the previous 
one</li> 
<li>Benefit is constant course corrections from the customers 
<ul> 
<li>Equivalently, can re-direct project every couple of weeks to deal with 
changes</li> </ul></li> </ul></li> 
<li>Problem: how to ensure that developers stay on track when the track is 
constantly changing direction?</li> 
<li>Comment on this slide</li> </ul> 
<h2>Core Practices</h2> 
<ul> 
<li>Solution is a process built around twelve core practices, which are 
usually grouped into four areas</li> 
<li>Detailed feedback 
<ul> 
<li>Test driven development: write tests before code in order to get instant 
feedback on correctness</li> 
<li>Planning game: described below</li> 
<li>Onsite customer: must be a customer representative on site to answer 
developers' questions at all times
<ul> 
<li>Subsequent revisions to the process acknowledged that this is sometimes 
not possible</li> 
<li>But frequent contact between developers and customers still essential</li> 
</ul></li> 
<li>Pair programming: also described below</li> </ul></li> 
<li>Continuous process 
<ul> 
<li>Small releases, so that customers can quickly check out all of the changes 
and additions</li> 
<li>Continuous integration: everyone builds and run tests on a very tight cycle
<ul> 
<li>Preferably several times an hour while coding</li> </ul></li> 
<li>Continuous refactoring: everyone cleans up what they're about to work on 
before they start work on it
<ul> 
<li>And follows through into other modules if there are ripple effects</li> 
<li>Ensures that code is always clean enough for the next person to start work
</li> </ul></li> </ul></li> 
<li>Shared understanding 
<ul> 
<li>Simple design: speaks for itself 
<ul> 
<li>In practice, design of a rapidly-evolving system may seem simple to those 
who've watched it evolve, but not to newcomers</li> </ul></li> 
<li>System metaphor: use simple analogies to provide a high-level overview of 
the system
<ul> 
<li>E.g., it's an assembly line, a blackboard, etc.</li> 
<li>Gives everyone a common language with which to discuss it</li> </ul></li> 
<li>Collective code ownership: everyone is allowed to change any part of the 
system
<ul> 
<li>No one is a bottleneck (i.e., you're never waiting on &ldquo;the GUI 
guy&rdquo;)</li> 
<li>Everyone has to (potentially) eat their own cooking</li> </ul></li> 
<li>Coding standard: essential to making collective ownership possible</li> 
</ul></li> 
<li>Programmer welfare 
<ul> 
<li>Sustainable pace: no one works overtime</li> 
<li>Because in almost all cases, overtime actually puts the project behind 
<ul> 
<li>Tired people make more mistakes, which then have to be fixed</li> 
<li>And fixing things downstream is more time-consuming than slowing down and 
getting them right in the first place</li> </ul></li> 
<li>Programmer turnover delays projects as well 
<ul> 
<li>Lose all the implicit knowledge in the departing programmer's head</li> 
<li>Remaining team members have to spend time bringing newcomers up to speed
</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Planning Game</h2> 
<ul> 
<li>At the start of each iteration, customers write <em>user stories</em> to 
define the functionality they want added or changed
<ul> 
<li>Each one is just a few sentences long 
<ul> 
<li>Each one should fit on a 3&times;5 index card</li> </ul></li> 
<li>Describes functionality, <em>not</em> features 
<ul> 
<li>I.e., what the system can do, not how it does it</li> </ul></li> 
<li>It's the developers' job to figure out what features to add to implement 
the desired functionality</li> </ul></li> 
<li>Set of user stories define the project requirements 
<ul> 
<li>As project evolves, throw away or update old ones as well as adding new 
ones</li> </ul></li> 
<li>Developers then estimate how long each user story will take to implement 
in ideal weeks
<ul> 
<li>I.e., five perfect interruption-free days</li> </ul></li> 
<li>Customers and developers then decide which stories to include in this 
iteration, and which to leave for the next
<ul> 
<li>If something is too big to fit into an iteration, break it down into 
smaller pieces</li> 
<li>You're going to do this anyway when developing it&hellip;</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Pair Programming</h2> 
<ul> 
<li><em>Pair programming</em> is the practice of having two people work 
together at one computer
<ul> 
<li>One types while the other watches and comments</li> 
<li>Predates XP, but was popularized by it</li> </ul></li> 
<li>Seems like a waste of resources, but: 
<ul> 
<li>Two pairs of eyes are more likely to spot errors as they're being made 
than one
<ul> 
<li>In fact, because of cognitive dissonance, the person watching is much more 
likely to spot errors than the one typing</li> </ul></li> 
<li>Fewer errors translates into less time spent debugging 
<ul> 
<li>The earlier something is fixed, the cheaper the fix is</li> </ul></li> 
<li>And pair programming helps ensure wider understanding of the system 
<ul> 
<li>More people able to work on more things</li> </ul></li> </ul></li> 
<li>Feels strange the first time you do it 
<ul> 
<li>And you need to reorganize desk layout to prevent back and neck problems
</li> </ul></li> 
<li>But unlike many claims made in software engineering, there's empirical 
evidence that it actually works [Williams &amp; Kessler 2003] 
<ul> 
<li>Though comparisons are usually made against two programmers who are both 
testing their own work&hellip;</li> 
<li>&hellip;rather than against one programmer developing, and another testing 
independently</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Project Velocity</h2> 
<ul> 
<li>Once the iteration is under way, the team tracks the <em>project velocity
</em> 
<ul> 
<li>How quickly are user stories actually being implemented?</li> </ul></li> 
<li>Use this to predict how long it's going to take to finish the agreed-upon 
work
<ul> 
<li>If it has taken 70 programmer-days to implement the first ten stories, 
it's safe to bet that it'll take 140 PD to implement the remaining twenty</li> 
<li>Hoping for a miraculous improvement in productivity is always a mistake
</li> </ul></li> 
<li>What to do if the team isn't going to have everything done by the deadline?
<ul> 
<li>Asking them to work longer hours is counter-productive</li> 
<li>So extend the deadline&hellip;</li> 
<li>&hellip;or cut back the number of stories that are going to be implemented 
<ul> 
<li>This is why you have a customer representative on site</li> </ul></li> 
<li>Resources, features, and schedule are not independent variables 
<ul> 
<li>You can set two, but the third then sets itself</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Down Side</h2> 
<ul> 
<li>XP and related methodologies have been criticized almost as widely as they 
have been adopted
<ul> 
<li>For every bandwagon there's an equal and opposite anti-bandwagon</li> </ul>
</li> 
<li>Some of this is just taking pot-shots at easy targets, like: 
<ul> 
<li><em>&ldquo;I think maybe concentration is the enemy. Seriously. If you're 
working on something that is so complex that you actually need to concentrate, 
there's too much chance that it's too hard.&rdquo;</em> (Ron Jeffries) </li> 
</ul></li> 
<li>But some of the criticisms are well-founded 
<ul> 
<li>If developers don't have considerable self-discipline, XP quickly 
degenerates into &ldquo;cowboy coding&rdquo;
<ul> 
<li>Busy, rather than productive</li> </ul></li> 
<li>Customers often need to know what they're going to get more than a few 
weeks in advance
<ul> 
<li>You can't add software to a space probe three days before launch</li> </ul>
</li> 
<li>Many programmers don't like to work in pairs 
<ul> 
<li>&ldquo;I trust my account to do my tax return on her own; why don't you 
trust me to code?&rdquo;</li> </ul></li> 
<li>XP is intrinsically limited to small teams 
<ul> 
<li>Which in turn means small projects</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>Many people find that their productivity goes up when they adopt XP</li> 
<li>But others find that their productivity goes up when they adopt 
diametrically opposed processes
<ul> 
<li>Like the one will see in the next lecture</li> </ul></li> 
<li>Option #1: most people program in the worst possible way, and <em>anything
</em> is an improvement</li> 
<li>Option #2: the most important thing isn't which process you adopt, it's 
that you actually adopt one
<ul> 
<li>What matters is that you're paying attention to process</li> 
<li>And thinking about how to improve it</li> 
<li><em>&ldquo;The unexamined life is not worth living.&rdquo;</em> (Socrates) 
</li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>The ICONIX Process</h1> prev  Draft Version 588 next <br>
<br>

<h2>Do It Once, Do It Right</h2> 
<ul> 
<li>Extreme Programming is one end of the spectrum 
<ul> 
<li>If your requirements are always perpetually in flux, focus your process on 
adapting to/coping with change</li> </ul></li> 
<li>This lecture looks at the other end 
<ul> 
<li>Well, one of the other ends&mdash;it's not like programmers would ever 
make anything as simple as a two-ended spectrum</li> </ul></li> 
<li>The <em>ICONIX process</em> was developed by Doug Rosenberg and colleagues 
<ul> 
<li>See [Rosenberg &amp; Stephens 2005] for the definitive guide</li> 
<li>A simple alternative to the Rational Unified Process (RUP) and other 
heavyweight paperwork-oriented processes</li> </ul></li> 
<li>Emphasizes up-front analysis and design 
<ul> 
<li>Reduces total cost and time to delivery dramatically&hellip;</li> 
<li>&hellip;provided your requirements are relatively stable</li> </ul></li> 
<li>Probably not appropriate for small, exploratory projects 
<ul> 
<li>But probably <em>is</em> if you're writing software that's going into a 
space probe</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>The Unified Modeling Language</h2> 
<ul> 
<li>Many disciplines rely on graphical notations with precisely-defined 
semantics for design and communication
<ul> 
<li>Architectural blueprints</li> 
<li>Circuit diagrams</li> 
<li>Feynman diagrams</li> </ul></li> 
<li>Thousands have been invented for programming, but only a handful have ever 
gained widespread acceptance
<ul> 
<li>Flowcharts 
<ul> 
<li> 
<p> Figure 27.1: Flowcharts</p> <br>
<br>
</li> 
<li>More useful than advocates of structured programming in the 1970s believed
</li> 
<li>See [Scanlan 1989] for evidence and discussion</li> </ul></li> 
<li>Entity-relationship diagrams 
<ul> 
<li>Used to design database tables</li> 
<li> 
<p> Figure 27.2: Entity-Relationship Diagrams</p> <br>
<br>
</li> </ul></li> 
<li>Class diagrams 
<ul> 
<li> 
<p> Figure 27.3: Class Diagrams</p> <br>
<br>
</li> 
<li>Who inherits from whom?</li> 
<li>Which classes refer directly to which others</li> </ul></li> </ul></li> 
<li>The <em>Unified Modeling Language</em> (UML) combines several notations 
used in<em>object-oriented analysis and design</em> (OOAD) 
<ul> 
<li>Its three principal authors all had their favorite ways of doing things
</li> 
<li>Unlike most designs by committee, this one actually (mostly) makes sense
</li> </ul></li> 
<li>UML 2.0 is very large 
<ul> 
<li>The ICONIX process uses only five kinds of diagram 
<ul> 
<li>Four from UML, plus one to bridge an important gap</li> </ul></li> 
<li>Each diagram corresponds to a step in the analysis and design process</li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>From Here to There</h2> 
<ul> 
<li>What we have: a prototype of a user interface 
<ul> 
<li> [Johnson 2000] will help you avoid horrible mistakes</li> 
<li>If you're trying to get a group talking, [Powazek 2001] is essential 
reading as well</li> </ul></li> 
<li>Draw it on paper (one screenshot per page) 
<ul> 
<li>Use sticky notes and the like for menus, dialogs, etc.</li> 
<li>Test subjects are less likely to hold back criticism of something that 
looks thrown together</li> </ul></li> 
<li>Write some HTML pages by hand</li> 
<li>Fire up Visual Basic or another drag-and-drop GUI builder</li> 
<li>Make it <em>very</em> clear that this is just a prototype! 
<ul> 
<li>Or your boss will want to ship it to the customer</li> </ul></li> 
<li>What we want: working code 
<ul> 
<li>That does what it's supposed to</li> 
<li>That's been tested</li> 
<li>That we can maintain</li> 
<li> 
<p> Figure 27.4: ICONIX: Start and End Points</p> <br>
<br>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Use Cases</h2> 
<ul> 
<li>First step is to translate our fuzzy ideas about how the interface should 
be used into something more exact</li> 
<li>A <em>use case</em> is a short point-form story that describes how a user 
accomplishes a particular task
<ul> 
<li>Usually written point-form</li> </ul></li> 
<li>Example: Sally wants to run a mitosis simulator for each temperature in a 
range
<ul> 
<li>Sally selects &ldquo;File&hellip; Set Simulation Parameters&rdquo; 
<ul> 
<li>System displays &ldquo;Simulation Parameters&rdquo; dialog with default 
values</li> </ul></li> 
<li>Sally changes &ldquo;Temperature&rdquo; from &ldquo;Single&rdquo; to 
&ldquo;Range&rdquo;
<ul> 
<li>System disables temperature entry control for single temperature</li> 
<li>System enables temperature entry controls for &ldquo;Start&rdquo;, 
&ldquo;Increment&rdquo;, and &ldquo;End&rdquo;</li> </ul></li> 
<li>Sally enters values and clicks &ldquo;OK&rdquo; 
<ul> 
<li>If any values illegal or inconsistent, dialog beeps and displays error 
message explaining the problem</li> 
<li>Otherwise, simulator updates its values, and dialog disappears</li> </ul>
</li> 
<li>Sally selects &ldquo;File&hellip; Run&rdquo; 
<ul> 
<li>System enables &ldquo;Pause&rdquo; and &ldquo;Stop&rdquo; buttons and 
begins running simulations</li> </ul></li> </ul></li> 
<li>Yes, it's a lot of detail 
<ul> 
<li>But you're going to have to work it all out at some point</li> 
<li>And many studies have shown that writing it down and checking it <em>before
</em> you start coding leads to a working program faster</li> 
<li>Also allows QA and technical writing to overlap their work with development
<ul> 
<li>Note: make sure they're involved in writing test cases</li> 
<li>If QA can't think of a way to test something, fix it</li> 
<li>Ditto if technical writer can't think of a way to explain it</li> </ul>
</li> </ul></li> 
<li>A <em>use case diagram</em> shows the relationships between 
<ul> 
<li>The <em>actors</em> in the system (i.e., the users and major system 
components)</li> 
<li>The individual use cases</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Domain Model</h2> 
<ul> 
<li>At this point, have a rough idea of the major elements of the <em>domain 
model</em> 
<ul> 
<li>The set of abstractions the system will use to represent the real world
</li> </ul></li> 
<li>Example: domain model for a traffic simulator may contain: 
<ul> 
<li>Vehicles</li> 
<li>Vehicle types 
<ul> 
<li>E.g., bicycle, motorcycle, small car, family car, light truck, heavy 
truck&hellip;</li> 
<li>Each vehicle is an instance of exactly one vehicle type</li> </ul></li> 
<li>Drivers</li> 
<li>Driver behaviors 
<ul> 
<li>A set of statistical rules determining speed, likelihood of signalling, 
etc.</li> 
<li>Typically shared by many drivers</li> </ul></li> 
<li>Road segments</li> 
<li>Intersections 
<ul> 
<li>Each road segments connects to exactly two intersections</li> 
<li>Each intersection connects to one or more road segments</li> 
<li>&ldquo;One&rdquo; in order to model dead end streets</li> </ul></li> 
<li>Graphical display and other GUI elements</li> 
<li>Configuration files</li> 
<li>Etc.</li> </ul></li> 
<li><em>Domain model diagram</em> shows relationships between domain model 
elements
<ul> 
<li> 
<p> Figure 27.5: Domain Model Diagram</p> <br>
<br>
</li> 
<li>Inheritance: one element is a specialization of another</li> 
<li>Association: one element refers to another (or two elements refer to each 
other)
<ul> 
<li>Usually annotate with <em>multiplicity</em></li> 
<li>I.e., one-to-one, one-to-many, many-to-many</li> </ul></li> </ul></li> 
<li>If you don't get the domain model right, everything else will go wrong</li>
<li>Note: writing use cases, and defining a domain model, is always iterative 
<ul> 
<li>Discussion about use cases uncovers new domain model elements</li> 
<li>Discussion about domain model uncovers new use cases</li> 
<li>Use a whiteboard, colored markers, and patience</li> </ul></li> 
<li>Like any notation, domain model diagrams exist to help you think and 
communicate
<ul> 
<li>Add comments as appropriate to make meaning clear</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Robustness Diagrams</h2> 
<ul> 
<li>Re-read the use cases, and classify the objects in the domain model into: 
<ul> 
<li><em>Boundary objects</em>, which actors use to communicate with the system 
<ul> 
<li>The simulator's input widgets and graphical display</li> </ul></li> 
<li><em>Entity objects</em>, which are from the core of the domain 
<ul> 
<li>Vehicle types, road segments, etc.</li> </ul></li> 
<li><em>Control objects</em>, which connect boundary objects to entity objects 
<ul> 
<li>Represent the &ldquo;intelligence&rdquo; in the application</li> 
<li>E.g., driver behaviors</li> </ul></li> </ul></li> 
<li>A <em>robustness diagram</em> shows actors' relationships with these 
objects
<ul> 
<li> 
<p> Figure 27.6: Robustness Diagram</p> <br>
<br>
</li> </ul></li> 
<li>The bridge between &ldquo;what&rdquo; and &ldquo;how&rdquo; 
<ul> 
<li>What's being implemented: use cases and domain model</li> 
<li>How it's being implemented: we'll see in a moment</li> </ul></li> 
<li>Rules make intuitive sense from definitions: 
<ul> 
<li>Actors communicate only with boundary objects</li> 
<li>Boundary objects communicate only with actors and controllers</li> 
<li>Controllers communicate with anything except actors</li> 
<li>Entity objects can only talk to controllers</li> </ul></li> 
<li>These rules are what the graphical notation is for 
<ul> 
<li>Forces us to classify things</li> 
<li>Limits how those things can use each other</li> 
<li>Yes, it's constraining: that's the whole point</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Class Diagrams</h2> 
<ul> 
<li>A <em>class diagram</em> shows: 
<ul> 
<li>What members and methods each class has</li> 
<li>How classes are derived from each other</li> 
<li>Which classes talk directly to each other 
<ul> 
<li>Either by holding references</li> 
<li>Or by being passed to one another as parameters</li> </ul></li> </ul></li> 
<li>Note: 
<ul> 
<li>Show classes, <em>not</em> individual objects</li> 
<li>Don't show exact nature of relationship (for example, list vs. dictionary) 
<ul> 
<li>Some things are better left to code</li> </ul></li> </ul></li> 
<li>Might seem redundant, given that we already have a domain model diagram 
<ul> 
<li>And given that they use the same notation</li> </ul></li> 
<li>Class diagram (almost) always contains more information than domain model 
diagram
<ul> 
<li>Extra objects added to manage relationships between main classes</li> 
<li>What members each class has, what its methods will be called, etc.</li> 
</ul></li> 
<li>Domain model is for talking to users; class diagram is for talking to 
developers</li> 
<li>An easy way to spot flaws in a design 
<ul> 
<li>Tangled lines are usually a sign of tangled flow of control</li> 
<li>One big class in the middle that talks to all the others are usually a 
sign of poor decomposition</li> 
<li>Twenty-seven layers of derivation are usually a sign that you should 
switch to decaf</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Sequence Diagrams</h2> 
<ul> 
<li>Last piece of the puzzle is to connect the system's static and dynamic 
aspects</li> 
<li>A <em>sequence diagram</em> shows what methods objects call to communicate 
with each other during a particular use case
<ul> 
<li>Object shown at the top</li> 
<li>Lifespan of method invocation shown by rectangle</li> 
<li>Method invocations shown by arrows</li> 
<li> 
<p> Figure 27.7: Sequence Diagram</p> <br>
<br>
</li> </ul></li> 
<li>Note: creating class diagram and sequence diagrams is also iterative 
<ul> 
<li>&ldquo;Discover&rdquo; methods as you realize there's no way for X to ask 
Y to do something</li> 
<li>Sometimes realize that one entity ought to be split into several, or vice 
versa</li> 
<li>Again, the discussion around the diagrams is as important as the diagrams 
themselves</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Actual Order</h2> 
<ul> 
<li>Now that you know what the pieces are, let's put them together</li> 
<li>Phase 1: 
<ul> 
<li>Identify real-world domain objects and their relationships</li> 
<li>Start drawing domain model diagram</li> 
<li>Draw use case diagrams 
<ul> 
<li>Don't write the use cases themselves yet</li> </ul></li> </ul></li> 
<li>Phase 2: 
<ul> 
<li>Start writing use cases</li> 
<li>Create robustness diagram 
<ul> 
<li>Iterate, iterate, iterate</li> </ul></li> 
<li>Update domain model diagram to reflect your discoveries</li> </ul></li> 
<li>Phase 3: 
<ul> 
<li>Draw sequence diagram for each use case</li> 
<li>Create class diagram by combining information from domain model and 
sequence diagrams</li> </ul></li> 
<li>Phase 4: 
<ul> 
<li>Write code that implements class diagram</li> </ul></li> 
<li>Most important rule: if you change something, update everything upstream 
from it that refers to it
<ul> 
<li>E.g., if you add a method while writing code, put it in the class diagram 
and sequence diagram</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Note on Tools</h2> 
<ul> 
<li>Drawing UML diagrams by hand is tedious, error-prone, and 
counter-productive
<ul> 
<li>&ldquo;Counter-productive&rdquo; because there's no way to automatically 
check a hand-drawn diagram against your actual code</li> </ul></li> 
<li>Specialized tools to aid in constructing diagrams have been around a long 
time</li> 
<li>Span the spectrum from: 
<ul> 
<li>Pure modeling tools: help users create diagrams, but don't integrate with 
code</li> 
<li>Round-trip engineering tools: can translate models into skeletal code, and 
modified code back into models</li> 
<li>Some integrate with IDEs, support multiple languages, can talk to 
databases, etc.</li> 
<li><code>ArgoUML</code> is probably the most advanced open source UML tool 
available</li> </ul></li> 
<li>Most programmers haven't adopted UML modeling tools because: 
<ul> 
<li>The tools are expensive and/or difficult to learn 
<ul> 
<li>If people can't do something useful with a tool in the first hour, they 
usually stop trying</li> </ul></li> 
<li>But more importantly, they don't find modeling useful 
<ul> 
<li>&ldquo;Use the source, Luke&rdquo;</li> </ul></li> 
<li>There's a lot of chicken-and-egg in this 
<ul> 
<li>Until enough programmers create models, and can read them, there's little 
incentive for any particular programmer to do so</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Summary</h2> 
<ul> 
<li>Seems like a lot of work, doesn't it?</li> 
<li>But remember: 
<ul> 
<li>You're going to do all of this anyway 
<ul> 
<li>You're just doing it in your head&hellip;</li> 
<li>&hellip;where it's no use to anyone else</li> </ul></li> 
<li>It takes less total time 
<ul> 
<li>See [Glass 2002] , [McConnell 2004] , and [McConnell 1996] for the evidence
</li> 
<li>And the next time someone tells you that XYZ will improve your 
productivity, ask them for similar evidence&hellip;</li> </ul></li> </ul></li> 
<li>So why don't all large projects use this kind of process? 
<ul> 
<li>Ignorance, laziness, and lack of competitive pressure 
<ul> 
<li>American car makers in the 1970s sold lots of gas-guzzling rust buckets
</li> 
<li>Then Volkswagen and Toyota arrived</li> </ul></li> 
<li>It's inappropriate 
<ul> 
<li>Not good at handling rapidly-changing requirements</li> </ul></li> 
<li>Learning curve 
<ul> 
<li>Yes, it'll make you faster on future projects&hellip;</li> 
<li>&hellip;but learning it will slow you down on this one&hellip;</li> 
<li>&hellip;and if you don't meet this deadline, there won't <em>be</em> any 
future projects</li> </ul></li> </ul></li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>The Nevex Process</h1> prev  Draft Version 547 next <br>
<br>

<h2>A Happy Medium</h2> 
<ul> 
<li>Very few individuals or teams stick to a textbook process 
<ul> 
<li>A process is just a tool</li> 
<li>You should always adapt tools to local needs&hellip;</li> 
<li>&hellip;and personalities</li> </ul></li> 
<li>This lecture is a slightly fictionalized account of what Nevex did in 
1999-2005
<ul> 
<li>A computer security startup (acquired by Baltimore, then by 
Hewlett-Packard)</li> 
<li>Shipped several major versions of a complex product, and many patches</li> 
<li>Met deadlines <em>without</em> lots of late nights and weekends</li> </ul>
</li> 
<li>Starting point: 
<ul> 
<li>Version 3.2 of GRACE shipped last week</li> 
<li>Version 3.3 has to ship in approximately eight months</li> 
<li>Personnel available are: 
<ul> 
<li>One overall manager</li> 
<li>Nine developers (two junior, four intermediate, three senior)</li> 
<li>One developer support (installers, build, etc.)</li> 
<li>Four quality assurance (QA)</li> 
<li>One technical writer</li> 
<li>One system administrator</li> 
<li>One help desk</li> 
<li>One product manager (marketing, sales support, etc.)</li> 
<li>One secretary/HR/office admin</li> </ul></li> </ul></li> 
<li>Project lifecycle: 
<ul> 
<li> 
<p> Figure 28.1: Project Lifecycle</p> <br>
<br>
</li> </ul></li> 
<li>Goal: meet schedule and quality goals <em>without</em> heroic effort 
<ul> 
<li>No point getting something flaky to the trade show if half the development 
team quits the week after</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>All the Vision You'll Ever Need</h2> 
<ul> 
<li>Important to have everyone on the same page 
<ul> 
<li>Because common sense isn't</li> </ul></li> 
<li>Exercise: have everyone on the team fill out the following form 
independently, and compare answers
<ul> 
<li>Bits in <em>italics</em> are typical answers: have your team members 
replace them with their answers</li> </ul></li> (Problem statement) The problem 
of <em>not being able to access the BIND molecular database remotely</em> <br>

(Target market) affects <em>scientists studying protein interactions.</em> <br>

(Impact) The impact is that <em>they can only inspect/update single records at 
a time via a browser.</em> <br>
(Solution) Our solution is to <em>let 
programmers search and update the database programmatically using multiple 
languages.</em> <br>
(Specific audience) For <em>programmers</em> <br>
who want 
to <em>incorporate BIND into a larger application</em> <br>
(Technical details) 
our product is a <em>web services API based on SOAP</em> <br>
that <em>supports 
remote calls into the core BIND API.</em> <br>
(Competitive comparison) Unlike 
<em>screen-scraping</em> <br>
our product <em>can be used directly and reliably 
in many languages.</em> <br>
<br>

<li>Comment on this slide</li> </ul> 
<h2>Analysis &amp; Estimation</h2> 
<ul> 
<li><em>&ldquo;Plans are useless, but planning is invaluable.&rdquo;</em> 
(Dwight D. Eisenhower)</li> 
<li>Product manager gathers requirements from customers 
<ul> 
<li>Customers often say, &ldquo;We want feature X.&rdquo; 
<ul> 
<li>Often means, &ldquo;I heard someone mention this while I was waiting for a 
flight.&rdquo;</li> </ul></li> 
<li>Product manager turns that into, &ldquo;We want the product to be able to 
do Y.&rdquo;
<ul> 
<li>What do customers want to be able to do that they can't right now?</li> 
<li>What does the product make them do that they don't want to have to?</li> 
</ul></li> </ul></li> 
<li>Developers analyze the feature requests provided by the product manager 
<ul> 
<li>How can the capability be implemented? 
<ul> 
<li>Often involves researching new technologies, competitors' products, etc.
</li> </ul></li> 
<li>What are the risks and unknowns? 
<ul> 
<li>Best way to find out is often to build some throwaway code</li> 
<li>This goes under version control like anything else&hellip;</li> 
<li>&hellip;but should <em>not</em> then be &ldquo;grown&rdquo; into the 
product</li> </ul></li> 
<li>How long will it take? 
<ul> 
<li>We'll return to this topic below</li> </ul></li> 
<li>Usually takes 3-6 weeks to do A&amp;E</li> </ul></li> 
<li>What's everyone else doing while this is going on? 
<ul> 
<li>Providing estimates of their own, of course</li> 
<li>Every feature must be tested and documented</li> 
<li>Must also be added to the daily build, and to the installer</li> 
<li>So QA, documentation, and developer support need to add time estimates to 
the A&amp;E too</li> </ul></li> 
<li>When all A&amp;E's are done, the product manager collects the estimates 
<ul> 
<li>Total time is (for example) 9000 work-days</li> 
<li>But only 2000 work-days are available 
<ul> 
<li>Fifteen people in development, QA, tech writing, and technical support</li>
<li>Eight months of five days a week, minus statutory holidays</li> 
<li>Minus 20% for sick days, emergency bug fixes for existing customers, etc.
</li> 
<li>No team ever works at 100% capacity, so don't schedule that way!</li> </ul>
</li> </ul></li> 
<li>So now the product manager has to <em>prioritize</em> 
<ul> 
<li>Which features are most cost-effective to develop? 
<ul> 
<li>I.e., will satisfy the most customer needs for the least effort?</li> 
<li>Developers don't know enough (don't have enough customer contact) to make 
this decision</li> </ul></li> 
<li>Usual way to do this is to build a 3&times;3 grid 
<ul> 
<li>Rank each feature low-medium-high on importance and time required</li> 
<li>More honest than the false accuracy of a 1-10 scale</li> 
<li> 
<p> Figure 28.2: Feature Rankings</p> <br>
<br>
</li> </ul></li> 
<li>Product manager is <em>not</em> allowed to shave developers' time estimates
<ul> 
<li>If she is, developers will start padding their estimates&hellip;</li> 
<li>&hellip;or supplying random numbers, secure in the knowledge that they 
won't be able make the deadline anyway</li> </ul></li> 
<li>Letting managers make up &ldquo;science fiction schedules&rdquo; is one of 
the most common mistakes companies make
<ul> 
<li>The other is not doing enough testing early on</li> </ul></li> 
<li>Yes, customers (and your marketing department) will complain if their 
feature doesn't make it onto the schedule
<ul> 
<li>But putting it in the schedule <em>when you know that schedule is fiction
</em> doesn't improve the chances of it getting implemented on time</li> 
<li>It's better to live up to small promises than break big ones</li> </ul>
</li> </ul></li> 
<li>End result of A&amp;E process is a schedule that everyone believes is 
achievable
<ul> 
<li>Yes, it contains a lot of guesswork&hellip;</li> 
<li>&hellip;but it's better than nothing&hellip;</li> 
<li>&hellip;and estimates improve with practice</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>What Goes Into an A&amp;E</h2> 
<ul> 
<li>No template is ideal for all A&amp;E's 
<ul> 
<li>Every A&amp;E is different, because every problem is different</li> 
<li>Requiring team members to express their ideas in a fixed way just leads to 
fewer ideas</li> </ul></li> 
<li>Typical A&amp;E has these sections: 
<ul> 
<li>Title, author(s), revision history</li> 
<li>Executive summary (abstract) 
<ul> 
<li>One paragraph</li> 
<li>Tells someone browsing through dozens of A&amp;E's whether this is one 
they should read</li> </ul></li> 
<li>Background 
<ul> 
<li>Aim is to provide a context for evaluating decisions</li> 
<li>Introduce the problem to a reasonably knowledgeable developer</li> 
<li>Don't explain what the Internet is&hellip;</li> 
<li>Imagine writing for who you were when you started the project</li> </ul>
</li> 
<li>User stories 
<ul> 
<li>What will people be able to do (or do better) when this feature is 
implemented?</li> 
<li>Often the starting point from which QA develops test cases, and the 
technical writer develops documentation</li> </ul></li> 
<li>Often find there's an easy way to give customers half of what they want, 
and a harder way to do it all
<ul> 
<li>Estimate both, and discuss pros and cons&hellip;</li> 
<li>&hellip;because the product manager may decide to go with the cheap 50% 
solution when putting the schedule together</li> 
<li>&ldquo;Not everything worth doing is worth doing well.&rdquo;</li> </ul>
</li> 
<li>For each alternative: 
<ul> 
<li>How long will it take to create? To test? To document? To add to the build 
and installer?</li> 
<li>What impact will it have on other features?</li> 
<li>How risky is it (i.e., how certain are you of your estimate)?</li> </ul>
</li> 
<li>Do <em>not</em> gloss over the hard bits 
<ul> 
<li>This is when you do your hard thinking (while you're still fresh)!</li> 
<li>&ldquo;We parse the XML configuration file, and then a miracle 
happens&rdquo; is<em>not</em> a good A&amp;E</li> </ul></li> 
<li>References 
<ul> 
<li>These days, usually a list of URLs</li> 
<li>Include pointers to prototypes stored in the version control repository
</li> </ul></li> </ul></li> 
<li>Time estimates come from experience 
<ul> 
<li>You can usually estimate how much code you'll have to write to implement 
something
<ul> 
<li>If you can't, you should go back and think it through in more detail</li> 
</ul></li> 
<li>You should know how long it takes you to develop working code 
<ul> 
<li>Just as runners keep track of their times for running 1000 meters, or how 
much they can bench press</li> 
<li>The most elaborate version of this is Watts Humphrey's Personal Software 
Process (PSP)</li> 
<li>In practice, enough to keep track of how many days you spend on each 
module you write&hellip;</li> 
<li>&hellip;where &ldquo;days spent&rdquo; includes debugging time</li> </ul>
</li> 
<li>Your first estimates will be wildly wrong 
<ul> 
<li>But the more you estimate, the better your estimates will become</li> </ul>
</li> </ul></li> 
<li>Expect to revise this document several times 
<ul> 
<li>Project manager assigns task of reviewing A&amp;E to specific developer(s) 
<ul> 
<li>Ensures that reviews actually get done&hellip;</li> 
<li>&hellip;and that knowledge and decisions are communicated</li> </ul></li> 
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Getting It Built</h2> 
<ul> 
<li>Developers then finish designs 
<ul> 
<li>Purpose is to convince people (including themselves) that they can 
actually build things the way they intend to
<ul> 
<li>Very easy to believe incompatible things when it's all in your head</li> 
<li>The act of writing it down (explaining it) forces brings these issues out 
into the open&hellip;</li> 
<li>&hellip;and ensures that other people know what you think they think you 
think</li> 
<li>Also helps you remember later why you're doing something a particular way
</li> </ul></li> 
<li>Note that design overlaps analysis 
<ul> 
<li>After all, it's impossible to estimate how long it will take to build 
something if you don't know how you're going to build it</li> </ul></li> </ul>
</li> 
<li>Level of detail varies widely 
<ul> 
<li>The better developers understand the product and the technologies it uses, 
the less risk there is of a lightweight design leading to nasty surprises</li> 
<li>The greater the cost of delivering the wrong thing, the more detailed the 
design should be
<ul> 
<li>But it doesn't help to do a detailed design that customers can't understand
</li> </ul></li> </ul></li> 
<li>Up-front design is a tool for managing risk 
<ul> 
<li>The later you change or fix something, the more expensive it is</li> 
<li>But the more time you invest up front, the longer it is until you discover 
that you need to make changes</li> </ul></li> 
<li>Write the code 
<ul> 
<li>Also overlaps analysis and design 
<ul> 
<li>Build throwaway prototypes while doing analysis</li> 
<li>Expect to refine design during early stages of construction</li> 
<li>If you're still refining the design a week before you're due to ship, 
something has gone wrong</li> </ul></li> 
<li>Remember that coding includes writing unit tests 
<ul> 
<li>These are the developer's responsibility</li> 
<li>Include coverage analysis in the daily build &amp; test to ensure that new 
code is being tested</li> 
<li>In theory, QA should refuse to test features that aren't exercised by unit 
tests</li> </ul></li> </ul></li> 
<li>Often refactor old code while adding new stuff 
<ul> 
<li>Your skills (and coding style) improve over time 
<ul> 
<li>Or the person working on the feature in Version 3.3 knows something the 
Version 3.2 author didn't</li> </ul></li> 
<li>The problem changes over time 
<ul> 
<li>A good solution to last year's requirements may not be a good solution to 
this year's</li> </ul></li> </ul></li> 
<li>As features are completed, update the design to reflect what was actually 
built
<ul> 
<li>If you don't, then: 
<ul> 
<li>The next person who has to work with the code will have a harder time</li> 
<li>You'll have to start from further behind the next time you need to modify 
this section</li> </ul></li> 
<li>Making sure this happens is the project manager's job</li> </ul></li> 
<li>Maintenance usually starts before the product goes out the door 
<ul> 
<li>Fix bugs left over from the previous cycle while adding features in this 
one</li> 
<li>Start fixing bugs in new features as QA discovers them</li> 
<li>Last quarter of a project cycle is usually nothing <em>but</em> bug fixing
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Other Activities</h2> 
<ul> 
<li>Quality assurance starts at the same time as development 
<ul> 
<li>As soon as feature specifications are firm, QA can: 
<ul> 
<li>Start making up lists of tests to run</li> 
<li>Start writing utility programs</li> </ul></li> 
<li>And of course, there's always bug fixes to the previous version to 
test&hellip;</li> </ul></li> 
<li>QA's usual role is to find bugs in the finished product 
<ul> 
<li>Yes, developers should do this as they're coding&hellip;</li> 
<li>&hellip;but in practice, they are usually too focused on particular 
features to find wider issues</li> 
<li>Developers also tend not to be good at testing 
<ul> 
<li>Subconsciously don't <em>want</em> to find problems</li> 
<li>Focus on the parts they're most familiar with, rather than the product as 
a whole</li> </ul></li> </ul></li> 
<li>QA's real job is to figure out <em>why</em> bugs are happening 
<ul> 
<li><em>&ldquo;Trying to improve the quality of software by doing more testing 
is like trying to lose weight by weighing yourself more often.&rdquo;</em> 
(Steve McConnell)</li> 
<li>So that developers stop making that kind of mistake</li> </ul></li> 
<li>Documentation also starts before product is available 
<ul> 
<li>Describe new GUI screens based on mock-ups drawn for A&amp;E</li> 
<li>Write new on-line help</li> 
<li>If the technical writer can't figure out how to explain a feature, the 
developer should redesign it</li> </ul></li> 
<li>Developer support starts work on installers the same day developers start 
on new features
<ul> 
<li>Makes sure the daily build &amp; test keeps running 
<ul> 
<li>And chastises developers who've broken things</li> </ul></li> 
<li>Everyone has a status report in their mailbox when they arrive each morning
</li> </ul></li> 
<li>Schedule is <em>always</em> up to date 
<ul> 
<li>Developers provide progress reports every week (at least) 
<ul> 
<li>Doing this at 9:00 a.m. Monday works better than asking for it at 4:45 on 
Friday</li> </ul></li> 
<li>Always based on <em>binary milestones</em> 
<ul> 
<li>If you allow percentages, then many tasks will be 90% done for 90% of the 
lifetime of the project</li> 
<li>Instead, break tasks down into subtasks that are at most a few days long, 
and either completed or not completed</li> 
<li>Describe milestones in terms of <em>verifiable deliverables</em> (i.e., 
things that someone else can check)</li> </ul></li> 
<li>The real purpose of a schedule is to help the project manager cut corners 
when things go wrong
<ul> 
<li>How far off track are we?</li> 
<li>What can we cut (or scale back) to get on track?</li> </ul></li> </ul></li>
<li>Comment on this slide</li> </ul> 
<h2>After the Party's Over</h2> 
<ul> 
<li>The last thing you do is write the <em>release log</em> and assign the 
release a<em>version number</em> 
<ul> 
<li>Leave this until the end because: 
<ul> 
<li>You may discover that what you thought was going to be one release 
actually needs to be several</li> 
<li>Marketing may change its mind based on what the competition is calling <em>
their</em> releases</li> </ul></li> 
<li>Refer to the release by a codename (like &ldquo;Beryllium&rdquo; or 
&ldquo;Munich&rdquo;) while it's under development</li> </ul></li> 
<li>Always do a <em>post mortem</em> on the project after shipping 
<ul> 
<li>What went right (that we want to do again)?</li> 
<li>What went wrong (that we want to avoid next time)?</li> 
<li>Usually best to bring in a neutral outsider to facilitate 
<ul> 
<li>Feedback is only as useful as it is honest</li> </ul></li> </ul></li> 
<li>And then start the next round of A&amp;E's 
<ul> 
<li>Because while the development team has been wrapping up this release, the 
product manager has been preparing for the next one</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Exercises</h2> 
<p>Exercise 28.1:</p> 
<p>Does your manager know when you expect to complete your current task? How 
inaccurate the schedule currently is?</p> 
<p>Exercise 28.2:</p> 
<p>Can you find out when your manager expects you to complete your current 
task (without asking her directly)? When team members expect to complete their 
current tasks (without asking them directly)? Who would be affected if you 
slipped a week?</p> prev top next <br>
<br>

<h1>Backward, Forward, and Sideways</h1> prev  Draft Version 534 next <br>
<br>
<h2>And Now We May Begin</h2> 
<ul> 
<li>From one perspective, this course has just scratched the surface</li> 
<li>From another, it has introduced you to the 20% of software engineering 
that accounts for 80% of what professional developers do
<ul> 
<li>Techniques</li> 
<li>Supported by tools</li> </ul></li> 
<li>In this lecture, look at a few of the next steps you might want to take
</li> 
<li>Comment on this slide</li> </ul> 
<h2>Numerical Programming</h2> 
<ul> 
<li>In the beginning there was Fortran 
<ul> 
<li>A great leap forward</li> 
<li>But not really mathematics</li> </ul></li> 
<li>Then, in the late 1960s, APL 
<ul> 
<li>Started as a notation for linear algebra</li> 
<li>Turned out it could be implemented on a computer</li> 
<li>&ldquo;Programming in mathematics&rdquo; 
<ul> 
<li>If you read Greek backwards</li> 
<li>See <code>http://www.users.cloud9.net/~bradmcc/APL.html</code> for the 
scary details</li> </ul></li> </ul></li> 
<li>MATLAB emerged in the early 1980s as a scripting tool for BLAS (the Basic 
Linear Algebra Subroutines)
<ul> 
<li>High-level language for pushing Fortran arrays around</li> 
<li>Graphics, OO, and many other capabilities added over the years</li> </ul>
</li> 
<li>Python's equivalent is the <code>Numeric</code> module (sometimes referred 
to as NumPy)
<ul> 
<li>A high-performance C library wrapped in a high-level interface</li> 
<li>Core package provides efficient multidimensional arrays 
<ul> 
<li>Much slower than compiled C or Fortran&hellip;</li> 
<li>&hellip;but much easier to write&hellip;</li> 
<li>&hellip;and <em>much</em> faster than pure Python</li> </ul></li> 
<li>Add-ons provide random number generation, FFTs, and linear algebra</li> 
<li>Forms the basis of other packages 
<ul> 
<li><code>matplotlib</code> for MATLAB-style plotting</li> 
<li>PIL (Python Imaging Library) for image processing</li> </ul></li> </ul>
</li> 
<li>NumPy is being replaced with a new <code>numarray</code> module 
<ul> 
<li>Extra hands always welcome</li> </ul></li> 
<li>Also worth looking at <code>SciPy</code> 
<ul> 
<li>A collection of scientific utilities built on top of Numpy</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Imaging</h2> 
<ul> 
<li>The <code>Python Imaging Library</code> is a toolkit for working with 
images in just about every format you'll ever encounter
<ul> 
<li>Scale, crop, overlay, merge, etc.</li> 
<li>Open source, but commercial support is available</li> </ul></li> 
<li>Example: reduce the amount of green in an image, but only where there 
isn't a lot of red
<ul> 
<li> 
<pre>import sys, Image # Color bands in image. RED, GREEN, BLUE = 0, 1, 2 # 
Read image. im = Image.open(sys.argv[1]) # Split the image into individual 
bands. source = im.split() # Create a bitmask of regions where there's red. def 
lessThan100(x): if x &gt; 128: return x else: return 0 mask = 
source[RED].point(lessThan100) # Process the green band. def reduceByHalf(x): 
return x * 0.75 out = source[GREEN].point(reduceByHalf) # Paste the processed 
band back, but only where red was &lt; 100. source[GREEN].paste(out, None, 
mask) # Build a new multiband image. im = Image.merge(im.mode, source) # Save 
for display. im.save(sys.argv[2])</pre> </li> 
<li> 
<p> Figure 29.1: Original Image</p> <br>
<br>
</li> 
<li> 
<p> Figure 29.2: Processed Image</p> <br>
<br>
</li> </ul></li> 
<li>Note: if you're looking for a professional-quality image editing tool, try 
<code>GIMP</code> 
<ul> 
<li>It's complex, but also powerful</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>A Better Way to Build</h2> 
<ul> 
<li>Said back in Automated Builds that Make has turned into a small 
programming language
<ul> 
<li>A very clumsy one at that: confusing syntax, no debugger, &hellip;</li> 
</ul></li> 
<li>The same thing happens eventually to every other build management tool 
<ul> 
<li>So why not start with a real programming language, and embed a build 
management tool in that?</li> </ul></li> 
<li><code>SCons</code> combines the most useful features of Make with the full 
power of Python
<ul> 
<li>Instead of a Makefile, you write an SConstruct file</li> 
<li>Use function calls in that file to tell SCons what you want to build, and 
how
<ul> 
<li>Like Make, it has a rich set of default rules</li> </ul></li> 
<li>But when you want to do something complicated, you can use any feature of 
Python you want
<ul> 
<li>E.g., build up a list of filenames, fetch a build rule from a database, 
etc.</li> </ul></li> </ul></li> 
<li>Example: build either a normal or a debugging version of a program, and 
include an extra source file on Windows
<ul> 
<li> 
<pre># What does the program depend on? dependencies = ['file1.c', 'file2.c'] 
if os.platform == 'win32': dependencies.append('win32.c') # Which version are 
we building? if 'debug' in COMMAND_LINE_TARGETS: Program('hello_dbg', 
dependencies) else: Program('hello', dependencies)</pre> </li> </ul></li> 
<li>Pro 
<ul> 
<li>Don't have to learn a new language 
<ul> 
<li>And the authors of the build tool don't have to create and maintain one, 
either</li> </ul></li> 
<li>There's a debugger</li> </ul></li> 
<li>Con 
<ul> 
<li>Much less widely used than Make or Ant (which is the Java equivalent of 
Make)</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Integrating with C</h2> 
<ul> 
<li>Been saying since the first lecture that you should: 
<ul> 
<li>Write the first version in Python (or some other very high-level language)
</li> 
<li>Find out whether it's fast enough, and if not, what's slowing it down</li> 
<li>Optimize only those parts that you need to</li> </ul></li> 
<li>The most effective way to optimize programs written in high-level 
languages like Python and MATLAB is often to rewrite core modules in C (or some 
other low-level language)
<ul> 
<li>Also a good way to handle inherited code: wrapping tried-and-trusted C or 
Fortran in Python is safer and easier than rewriting</li> 
<li>And faster</li> </ul></li> 
<li>If you don't speak C, [Kernighan &amp; Ritchie 1998] is the standard 
introduction
<ul> 
<li> [Ullman &amp; Liyanage 2004] is somewhat gentler</li> </ul></li> 
<li>Python represents things using a C structure of type <code>PyObject</code> 
that contains:
<ul> 
<li>A type code (so that the interpreter knows how to interpret the rest of 
the structure)</li> 
<li>A union large enough to hold any basic value 
<ul> 
<li>In Python's case, the two 64-bit values needed to store a complex number
</li> </ul></li> 
<li>A <em>reference count</em> to keep track of how many other objects are 
pointing at this thing
<ul> 
<li>When a thing is created, its reference count is initialized to 1</li> 
<li>When its count drops to 0, Python can <em>garbage collect</em> it</li> 
</ul></li> 
<li> 
<p> Figure 29.3: How Python Represents Values</p> <br>
<br>
</li> </ul></li> 
<li>Every C function that the interpreter calls must take two arguments: 
<ul> 
<li><code>self</code> is <code>NULL</code> for pure functions, and an object 
for methods</li> 
<li><code>args</code> is a variable-length list of arguments 
<ul> 
<li>Use the function <code>PyArg_ParseTuple</code> to extract arguments' values
</li> 
<li>I.e., get the raw integer out of the first, a string pointer out of the 
second, etc.</li> </ul></li> </ul></li> 
<li>Example: take an integer and return three times its value 
<ul> 
<li>Not particularly exciting, but it illustrates the main points</li> 
<li> 
<pre>/* Triple an integer value. */ static PyObject * triple(PyObject * self, 
PyObject * args) { int val; if (!PyArg_ParseTuple(args, &quot;i&quot;, 
&amp;val)) { return NULL; } val = val * 3; return Py_BuildValue(&quot;i&quot;, 
val); }</pre> </li> 
<li>Returns <code>NULL</code> to signal error</li> 
<li>Otherwise, uses <code>Py_BuildValue</code> to build a Python structure 
with the result value</li> </ul></li> 
<li>Need some <em>boilerplate</em> to bring this function to the Python 
interpreter's attention
<ul> 
<li> 
<pre>/* Table of module contents (handed back to Python at initialization). */ 
static PyMethodDef contents[] = { {&quot;triple&quot;, triple, METH_VARARGS}, 
{NULL, NULL} }; /* Initialization function. */ void inittriple() { 
Py_InitModule(&quot;triple&quot;, contents); }</pre> </li> 
<li>The array <code>contents</code> has one entry for each function</li> 
<li>The initialization function: 
<ul> 
<li>Has a name of the form <code>initXYZ</code> for the module <code>XYZ</code>
</li> 
<li>Calls <code>Py_InitModule</code> to pass the table of module contents to 
the interpreter</li> </ul></li> </ul></li> 
<li>To use: 
<ul> 
<li>Compile the C to create a <em>shared library</em> (<code>.dll</code> on 
Windows,<code>.so</code> on Unix)</li> 
<li>Copy the result to a directory that's on Python's search path</li> 
<li>Then <code>import triple</code> and call <code>triple.triple(11)</code>
</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Integrating the Other Way</h2> 
<ul> 
<li>It's simpler with <em>SWIG</em> 
<ul> 
<li>Simple Wrapper Interface Generator</li> 
<li>Interprets specially-formatted comments in C header files to generate 
Python wrappers
<ul> 
<li>Or Perl, Java, Tcl, &hellip;</li> </ul></li> </ul></li> 
<li>Similar tools exist to connect Python to Fortran</li> 
<li>Can also go the other way, and <em>embed</em> Python in C/C++ 
<ul> 
<li>Every large application eventually needs an interactive command interpreter
</li> 
<li>To embed: 
<ul> 
<li>Initialize a Python interpreter object</li> 
<li>Convert application values into Python objects</li> 
<li>Pass the interpreter a string containing the code to be executed, and the 
values to execute it on</li> 
<li>Unwrap the result</li> </ul></li> </ul></li> 
<li>Multilanguage programming isn't simple 
<ul> 
<li>And multilanguage debugging is downright hard</li> 
<li>But both are often simpler (as well as more efficient) than the 
alternatives</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Design Patterns</h2> 
<ul> 
<li>A <em>design pattern</em> is a way of doing things 
<ul> 
<li>E.g., porches, locked-room mysteries, and nested loops</li> 
<li>Too fuzzy to put in a library, but a great way to talk about design issues
</li> </ul></li> 
<li>The architect Christopher Alexander invented the term 
<ul> 
<li> [Gamma et al 1995] applied the notion to object-oriented programming</li> 
<li>Now dozens of books, conferences, etc.</li> 
<li>Easiest way to explain is by example</li> </ul></li> 
<li>Singleton 
<ul> 
<li>Synopsis: ensure that only one instance of a class is created</li> 
<li>Context: want every object that uses a class to use the same instance of 
that class
<ul> 
<li>E.g., the graphics driver for the screen</li> </ul></li> 
<li>Forces: 
<ul> 
<li>There must be exactly one instance of the class</li> 
<li>All objects that use the class must have access to that instance</li> </ul>
</li> 
<li>Solution: 
<ul> 
<li>Make the constructor private so that other classes can't get at it</li> 
<li>Provide a static method for construction</li> 
<li>Have that method keep a copy of the first object it creates, and re-use it 
on subsequent calls</li> </ul></li> </ul></li> 
<li>Filter 
<ul> 
<li>Synopsis: dynamically connect objects to transform a data stream</li> 
<li>Context: some computations most easily expressed as a sequence of 
transformations
<ul> 
<li>E.g., image processing, or Unix commands joined by pipes</li> 
<li>Allows uses to mix and match operations easily</li> </ul></li> 
<li>Forces: 
<ul> 
<li>Every filter should read and write the same format, so that they can be 
chained together</li> 
<li>It should be possible to chain filters together in arbitrary orders</li> 
</ul></li> 
<li>Solution: 
<ul> 
<li>Have each filter implement an interface that reads and writes data</li> 
<li>Define special cases for sources (that only write) and sinks (that only 
read)</li> 
<li>Provide filters with a way to signal that they have nothing more to produce
</li> </ul></li> </ul></li> 
<li>Visitor 
<ul> 
<li>Synopsis: separate traversal of a complex structure from operations on 
that structure</li> 
<li>Context: want an easy way to do walk around a complex structure 
<ul> 
<li>E.g., visit each node in a graph once</li> </ul></li> 
<li>Forces: 
<ul> 
<li>Many different operations may need to be performed</li> 
<li>Structure is complex enough that visiting elements is error-prone</li> 
<li>The types of objects in the structure, and the ways they are connected, 
change infrequently</li> </ul></li> 
<li>Solution #1: create an iterator class with do-nothing methods that are 
called at specific times
<ul> 
<li>This class takes care of things like remembering which nodes have already 
been seen</li> 
<li>Users derive their own iterators from this, filling in methods to do what 
they want</li> </ul></li> 
<li>Solution #2: create one iterator class that takes a <em>callback</em> 
argument
<ul> 
<li>Callback only provides methods that do things</li> 
<li>Iterator calls these at appropriate times</li> </ul></li> 
<li>Solution #1 is simpler, but: 
<ul> 
<li>Some languages (like C) don't support derivation, so you have to use 
solution #2</li> 
<li>Solution #2 allows you to re-use callbacks with different kinds of 
collections</li> </ul></li> </ul></li> 
<li>Not just about object-oriented design 
<ul> 
<li>User interface patterns</li> 
<li>Business patterns</li> 
<li>Anti-patterns (things to avoid)</li> </ul></li> 
<li>In practice, serve two purposes: 
<ul> 
<li>Communication: a concise way for designers to communicate with each other 
<ul> 
<li>And argue out exactly what they mean</li> </ul></li> 
<li>Education: gives them a way to communicate what they know to newcomers</li>
</ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>Refactoring</h2> 
<ul> 
<li><em>Refactoring</em> is the process of changing (hopefully, improving) the 
design of existing code
<ul> 
<li>Clean it up to make changes easier (or possible)</li> 
<li>Term popularized by Martin Fowler 
<ul> 
<li>Often described in terms of &ldquo;code smells&rdquo; and corresponding 
cures</li> 
<li>Equivalent to an anti-pattern and an algorithm for fixing it</li> 
<li> [Fowler 1999] is a catalog of refactorings</li> </ul></li> 
<li>Design patterns describe code at rest; refactorings describe code in motion
</li> </ul></li> 
<li>Smell: method or function body runs to several pages 
<ul> 
<li>Cure: use <em>Extract Method</em> to break the method into smaller 
meaningful pieces
<ul> 
<li>Do <em>not</em> break up arbitrarily, just to satisfy coding conventions
</li> 
<li>Each new method should make sense on its own</li> </ul></li> </ul></li> 
<li>Smell: function or method with many parameters 
<ul> 
<li>If a method takes eleven strings as parameters, sooner or later you'll 
pass them in the wrong order</li> 
<li>Cure: store values as members of the object, rather than passing them as 
parameters
<ul> 
<li>But it's bad to introduce members called <code>param1</code> and <code>
param2</code></li> </ul></li> 
<li>Alternative cure: use the <code>Introduce Parameter Object</code> to 
combine co-occurring parameters into one value</li> </ul></li> 
<li>Smell: duplicated code 
<ul> 
<li>Cure: use Extract Method once again, of course</li> 
<li>But what if code is only <em>almost</em> duplicated?</li> 
<li>Use <em>Introduce Parameter</em> to give callers a way to signal exactly 
what they want&hellip;</li> 
<li>&hellip;or use <em>Pull Up Method</em> to move shared code into 
parent&hellip;</li> 
<li>&hellip;and <em>Form Template Method</em> to have that shared code call 
something that each child class defines</li> </ul></li> 
<li>Smell: complex Boolean expressions in conditionals 
<ul> 
<li>Cure: <em>Introduce Explaining Variable</em> to give sub-expressions 
meaningful names</li> 
<li>Particularly effective when it's used to turn nested if-then-elses into a 
lookup table</li> </ul></li> 
<li>Same benefits as patterns: communication shorthand, and education</li> 
<li>But there's one big difference: it's possible to build tools to do 
refactoring for you
<ul> 
<li>The Eclipse IDE for Java is the best known example</li> 
<li>Highlight a method, say &ldquo;Rename&rdquo;, and the IDE changes all the 
calls too
<ul> 
<li>Able to do this because it continuously re-parses source code as you type
</li> </ul></li> 
<li>Move methods up into parent class, split classes in two, and much, much 
more</li> 
<li>If this doesn't convince you to upgrade from a dumb editor, I don't know 
what will&hellip;</li> </ul></li> 
<li>Very important to have unit tests in place <em>before</em> starting to 
refactor
<ul> 
<li>Without this, you have no way of knowing what else your refactoring might 
have broken</li> 
<li> [Feathers 2005] is an excellent guide to how to fit useful tests back 
onto inherited applications</li> </ul></li> 
<li>Comment on this slide</li> </ul> 
<h2>And a Little Light Reading</h2> 
<ul> 
<li> [Brand 1995] looks at how buildings can be designed to change and grow 
gracefully over time
<ul> 
<li>Everything he says is directly applicable to large programs</li> </ul></li>
<li> [Steele 1999] shows you how a great computer scientist thinks about a 
particularly hard problem</li> 
<li> [Margolis &amp; Fisher 2002] describes work at Carnegie-Mellon University 
aimed at making computer science a less hostile environment for women and other 
underrepresented groups
<ul> 
<li>Note: while the gender ratio in computing as a whole is about six to one, 
the ratio in open source is closer to 200:1</li> </ul></li> 
<li><code>Internet Groupware for Scientific Collaboration</code> talks about 
how much more the web could do for scientists</li> 
<li>Comment on this slide</li> </ul> 
<h2>The Rules</h2> 
<ul> 
<li>A week of hard work can sometimes save you an hour of thought.</li> 
<li>If it's worth doing again, it's worth automating.</li> 
<li>Anything repeated in two or more places will eventually be wrong in at 
least one.</li> 
<li>The three chief virtues of a programmer are laziness, impatience, and 
hubris.</li> 
<li>It's not what you know, it's what you can.</li> 
<li>The deadline isn't when you're supposed to finish; the deadline is when it 
starts to be late.</li> 
<li>Never debug standing up.</li> 
<li>Tools are signposts, not destinations.</li> 
<li>Not everything worth doing is worth doing well.</li> 
<li>Code unto others as you would have others code unto you.</li> 
<li>Every complex file format eventually turns into a badly-designed 
programming language.</li> 
<li>Tools are amplifiers: they allow good programmers to be better, and bad 
ones to be worse.</li> 
<li>They call it computer science because it's experimental.</li> 
<li>Programs come and go; data is forever.</li> 
<li>There's no such thing as one program.</li> 
<li>Discipline matters more than genius.</li> 
<li>Comment on this slide</li> </ul> 
<h2>Conclusion</h2> 
<ul> 
<li>&ldquo;A good teacher has a value above pearls, but a good student has a 
value above rubies.&rdquo;</li> 
<li>Thank you, and good luck</li> 
<li>Comment on this slide</li> </ul> prev top next <br>
<br>

<h1>Bibliography</h1> prev  Draft Version 574 next <br>
<br>
[Agans 2002] 
David J. Agans:Debugging. American Management Association, 2002, 0814471684. 
<br>  Its first sentence says, &ldquo;This book tells you how to find out 
what's wrong with stuff, quick,&rdquo; and that's exactly what it does. In 
fifteen (very) short chapters, the author presents nine simple rules to help 
you track down and fix problems in software, hardware, or anything else. His 
war stories are entertaining (although I think one or two are urban myths), and 
his advice is eminently practical. <br>
[Brand 1995] Stewart Brand: How 
Buildings Learn. Penguin USA, 1995, 0140139966. <br>
 This beautiful, 
thought-provoking book starts with the observation that most architects spend 
their time re-working or extending existing buildings, rather than creating new 
ones from scratch. Of course, if Brand had written &ldquo;program&rdquo; 
instead of &ldquo;building&rdquo;, and &ldquo;programmer&rdquo; where he'd 
written &ldquo;architect&rdquo;, everything he said would have been true of 
computing as well. A lot of software engineering books try to convey the same 
message about allowing for change, but few do it so successfully. By presenting 
examples ranging from the MIT Media Lab to a one-room extension to a house, 
Brand encourages us to see patterns in the way buildings change (or, to adopt 
Brand's metaphor, the way buildings learn from their environment and from use). 
Concurrently, he uses those insights to argue that since buildings are always 
going to be modified, they should be designed to accommodate unanticipated 
change. <br>
[Castro 2002] Elizabeth Castro: HTML for the World Wide Web. 
Peachpit Press, 2000, 0321130073. <br>
 A clean, clear, comprehensive guide to 
creating HTML for the web, with good coverage of Cascading Style Sheets (CSS). 
<br> [Castro 2000] Elizabeth Castro: XML for the World Wide Web. Peachpit 
Press, 2000, 0201710986. <br>
 Like other books in Peachpit's Visual Quickstart 
series, this one is beautifully designed, and easy to read without ever being 
condescending. Its 16 chapters and 4 appendices are organized into 1- and 
2-page explanations of particular topics, from writing non-empty elements to 
namespaces, schemas, and XML transformation. Throughout, Castro strikes a 
perfect balance between &ldquo;what&rdquo;, &ldquo;why&rdquo;, and 
&ldquo;how&rdquo;, and provides a surprising amount of detail without ever 
overwhelming the reader. <br>
[Chase &amp; Simon 1973] W.G. Chase and H.A. 
Simon: &quot;Perception in chess&quot;,Cognitive Psychology, vol. 4, no. , pp. 
55-81, 1973. <br>
 The original paper comparing the performance of novice and 
master chess players when confronted with actual and random positions. <br>

[Clark 2004] Mike Clark: Pragmatic Project Automation. Pragmatic Bookshelf, 
2004, 0974514039. <br>
 This entry in the Pragmatic Bookshelf series focuses on 
getting your project to build itself, and (more importantly) tell you how the 
build went, automatically. Clark doesn't confine himself to running Make at 
3:00 a.m.; he also covers ways of automatically re-running tests, building and 
testing installers, monitoring applications, and more. <br>
[DeMarco &amp; 
Lister 1999] Tom DeMarco and Timothy Lister: Peopleware. Dorset House, 1999, 
0932633439. <br>
 This was the first book I ever read that said that the 
leading cause of software project failure was people, rather than technology. 
Using anecdotes, humor, and common sense, DeMarco and Lister explain how 
important good physical space, aligning authority with responsibility, and 
clear direction are. <br>
[Fehily 2003] Chris Fehily: SQL. Peachpit Press, 
2003, 0321118030. <br>
 This very readable book describes the 5% of SQL that 
covers 95% of real-world needs. While the book moves a little slowly in some 
places, the examples are exceptionally clear. <br>
[Feldman 1979] Stuart I. 
Feldman: &quot;Make---A Program for Maintaining Computer Programs&quot;,
Software: Practice and Experience, vol. 9, no. 4, pp. 255-265, 1979. <br>
 The 
original description of Make. Last time I checked, Stu Feldman was a vice 
president at IBM, which shows you just how far a good tool can take you&hellip; 
<br> [Feathers 2005] Michael C. Feathers: Working Effectively with Legacy Code. 
Prentice-Hall PTR, 2005, 0131177052. <br>
 Most programmers spend most of their 
time fixing bugs, porting to new platforms, adding new features---in short, 
changing existing code. If that code is exercised by unit tests, then changes 
can be made quickly and safely; if it isn't, they can't, so your first job when 
you inherit legacy code should be to write some. That's where this book comes 
in. What to know three different ways to inject a test into a C++ class without 
changing the code? They're here. Want to know which classes or methods to focus 
testing on? Read his discussion of pinch points. Need to break inter-class 
dependencies in Java so that you can test one module without having to 
configure the entire application? That's in here too, along with dozens of 
other useful bits of information. Everything is illustrated with small 
examples, all of them clearly explained and to the point. There are lots of 
simple diagrams, and a short glossary; all that's missing is hype. <br>
[Fowler 
1999] Martin Fowler: Refactoring. Addison-Wesley Professional, 1999, 0201485672.
<br>  Like architects, most programmers spend most of their time renovating, 
rather than creating something completely new on a blank sheet of paper. This 
book presents and analyzes patterns that come up again and again when programs 
are being reorganized. Some of these are well-known, such as placing common 
code in a utility method. Others, such as replacing temporary objects with 
queries, or replacing constructors with factory methods, are subtler, but no 
less important. Each entry includes a section on motivation, the mechanics of 
actually carrying out the transformation, and an example in Java. <br>
[Friedl 
2002] Jeffrey E. F. Friedl: Mastering Regular Expressions. O'Reilly, 2002, 
0596002890. <br>
 The definitive programmer's guide to regular expressions. <br>
[Gamma et al 1995] Erich Gamma, Richard Helm, Ralph Johnson, and John Vlissides:
Design Patterns. Addison-Wesley, 1995, 0201633612. <br>
 The book that started 
the software design patterns movement. Much of the discussion has been 
superseded by more recent books, and the use of C++ and Smalltalk for examples 
feels a little dated, but it is still a landmark in programming. <br>
[Glass 
2002] Robert L. Glass: Facts and Fallacies of Software Engineering. 
Addison-Wesley Professional, 2002, 0321117425. <br>
 I really wish someone had 
given me something like this book when I took my first programming job. If 
nothing else, it would have been a better way to start thinking about the 
profession I had stumbled into than the &ldquo;everybody knows&rdquo; factoids 
that I soaked up at coffee time. Some of what he says is well-known: good 
programmers are up to N times better than bad ones (his value for N is 28), 
reusable components are three times harder to build than non-reusable ones, and 
so on. Other facts aren't part of the zeitgeist, though they should be. For 
example, most of us know that maintenance consumes 40-80% of software costs, 
but did you know that roughly 60% of that is enhancements, rather than bug 
fixes? Or that if more than 20-25% of a component has to be modified, it is 
more efficient to re-write it from scratch? Best of all, Glass backs up every 
statement he makes with copious references to the primary literature; if you 
still disagree with him, you'd better be sure you have as much evidence for 
your point of view as he has for his. <br>
[Goerzen 2004] John Goerzen: 
Foundations of Python Network Programming. APress, 2004, 1590593715. <br>
 This 
book looks at how to handle several common protocols, including HTTP, SMTP, and 
FTP. Goerzen also doesn't delve as deeply into their internals, but instead on 
how to build clients that use them. His approach is to build solutions to 
complex problems one step at a time, explaining each addition or modification 
along the way. He occasionally assumes more background knowledge than most 
readers of this book are likely to have, but only occasionally, and makes up 
for it by providing both clear code, and clear explanations of why this 
particular function has to do things in a particular order, or why that one 
really ought to be multithreaded. <br>
[Good 2005] Nathan A. Good: Regular 
Expression Recipes. APress, 2005, 159059441X. <br>
 A great how-to for regular 
expressions, with examples in many different languages. <br>
[Gunderloy 2004] 
Mike Gunderloy:Coder to Developer. Sybex, 2004, 078214327X. <br>
 This 
practical, readable book is subtitled &ldquo;Tools and Strategies for 
Delivering Your Software&rdquo;, and that's exactly what it's about. Project 
planning, source code control, unit testing, logging, and build management are 
all there. Importantly, so are newer topics, like building plugins for your 
IDE, code generation, and things you can do to protect your intellectual 
property. Everything is clearly explained, and illustrated with well-chosen 
examples. While the focus is definitely on .NET, Gunderloy covers a wide range 
of other technologies, both proprietary and open source. I'm already using two 
new tools based on references from this book, and plan to make the chapter on 
&ldquo;Working with Small Teams&rdquo; required reading for my students. <br>

[Harold 2004] Elliotte Rusty Harold: Effective XML. Addison-Wesley, 2004, 
0321150406. <br>
 This book explains which of XML's many features should be 
used when: Item 12 tells you to store metadata in attributes, and then spends 
six pages explaining why, while Item 24 analyzes the strengths and weaknesses 
of various schema languages, and Item 38 covers character set encodings. It's 
more than most developers will ever want to know, but when you need it, you 
really need it. <br>
[Hock 2004] Roger R. Hock: Forty Studies that Changed 
Psychology. Prentice Hall, 2004, 0131147293. <br>
 In forty short chapters, 
Hock describes the turning points in our understanding of how our minds work. 
The book isn't just about psychology; you'll also learn a lot about how science 
gets done, and about the scientists who do it. <br>
[Hunt &amp; Thomas 1999] 
Andrew Hunt and David Thomas:The Pragmatic Programmer. Addison-Wesley, 1999, 
020161622X. <br>
 This book is about those things that make up the difference 
between typing in code that compiles, and writing software that reliably does 
what it's supposed to. Topics range from gathering requirements through design, 
to the mechanics of coding, testing, and delivering a finished product. The 
second section, for example, covers &ldquo;The Evils of Duplication&rdquo;, 
&ldquo;Orthogonality&rdquo;, &ldquo;Reversibility&rdquo;, &ldquo;Tracer 
Bullets&rdquo;, &ldquo;Prototypes and Post-It Notes&rdquo;, and &ldquo;Domain 
Languages&rdquo;, and illuminates each with plenty of examples and short 
exercises. <br>
[Johnson 2000] Jeff Johnson: GUI Bloopers. Morgan Kaufmann, 
2000, 1558605827. <br>
 Most books on GUI design are long on well-meaning 
aesthetic principles, but short on examples of what it means to put those 
principles into practice. In contrast, GUI Bloopers presents case study after 
case study: what's wrong with this dialog? What should its creators have done 
instead. And, most importantly, why? The net effect is to teach all of the same 
principles that other books try to, but in a grounded, understandable way. <br>

[Kernighan &amp; Pike 1984] Brian W. Kernighan and Rob Pike: The Unix 
Programming Environment. Prentice Hall, 1984, 013937681X. <br>
 I have long 
believed that this book is the real secret to Unix's success. It doesn't just 
show readers how to use Unix---it explains<em>why</em> the operating system is 
built that way, and how its &quot;lots of little tools&quot; philosophy keeps 
simple tasks simple, while making hard ones doable. <br>
[Kernighan &amp; 
Ritchie 1998] Brian W. Kernighan and Dennis Ritchie: The C Programming Language
. Prentice Hall PTR, 1998, 0131103628. <br>
 The classic description of the one 
programming language every serious programmer absolutely, positively has to 
learn. <br>
[Knuth 1998] Donald E. Knuth: The Art of Programming. 
Addison-Wesley, 1998, 0201485419. <br>
 The lifework of the man who invented 
many of the basic concepts of algorithm analysis, these massive tomes are like 
Everest: awe-inspiring, but not for the weak of heart. Most readers will find [
Sedgewick 2001] much more approachable. <br>
[Langtangen 2004] Hans P. 
Langtangen:Python Scripting for Computational Science. Springer-Verlag, 2004, 
3540435085. <br>
 The book's aim is to show scientists and engineers with 
little formal training in programming how Python can make their lives better. 
Regular expressions, numerical arrays, persistence, the basics of GUI and web 
programming, interfacing to C, C++, and Fortran: it's all here, along with 
hundreds of short example programs. Some readers may be intimidated by the 
book's weight, and the dense page layout, but what really made me blink was 
that I didn't find a single typo or error. It's a great achievement, and a 
great resource for anyone doing scientific programming. <br>
[Lutz &amp; Ascher 
2003] Mark Lutz and David Ascher: Learning Python. O'Reilly, 2003, 0596002815. 
<br>  This is not only the best introduction to Python on the market, it is one 
of the best introductions to any programming language that I have ever read. 
Lutz and Ascher cover the entire core of the language, and enough of its 
advanced features and libraries to give readers a feeling for just how powerful 
Python is. In keeping with the spirit of the language itself, their writing is 
clear, their explanations lucid, and their examples well chosen. <br>
[Margolis 
&amp; Fisher 2002] Jane Margolis and Allan Fisher: Unlocking the Clubhouse. MIT 
Press, 2002, 0262133989. <br>
 This book describes a project at Carnegie-Mellon 
University that tried to figure out why so few women become programmers, and 
what can be done to correct the imbalance. Its first six chapters describe the 
many small ways in which we are all, male and female, are conditioned to 
believe that computers are &quot;boy's things&quot;. Sometimes it's as simple 
as putting the computer in the boy's room, because &quot;he's the one who uses 
it most&quot;. Later on, the &quot;who needs a social life?&quot; atmosphere of 
undergraduate computer labs drives many women away (and many men, too). The 
last two chapters describe what the authors have done to remedy the situation 
at high schools and university. This work proves that by being conscious of the 
many things that turn women off computing, and by viewing computer science from 
different angles, we can attract a broader cross-section of society, which can 
only make our discipline a better place to be. The results are impressive: 
female undergraduate enrolment at CMU rose by more than a factor of four during 
their work, while the proportion of women dropping out decreased significantly. 
<br> [Martelli 2005] Alex Martelli, Anna Ravenscroft, and David Ascher: Python 
Cookbook. O'Reilly, 2005, 0596007973. <br>
 A useful reference for every 
serious Python programmer, this book is a collection of tips and tricks, some 
very simple, others so complex that they require careful line-by-line reading. 
The book's companion web site is updated regularly. <br>
[Mason 2005] Mike 
Mason:Pragmatic Version Control Using Subversion. Pragmatic Bookshelf, 2005, 
0974514063. <br>
 Yet another book from the folks at Pragmatic, this one is 
everything you'll ever need to know about Subversion, which is on its way to 
becoming the version control system of choice for open source development. <br>

[McConnell 2004] Steve McConnell: Code Complete. Microsoft Press, 2004, 
0735619670. <br>
 This classic is a handbook of do's and don'ts for working 
programmers. It covers everything from how to avoid common mistakes in C to how 
to set up a testing framework, how to organize multi-platform builds, and how 
to coordinate the members of a team. In short, it is everything I wished 
someone had told me<em>before</em> I started my first full-time programming job.
<br> [McConnell 1996] Steve McConnell: Rapid Development. Microsoft Press, 
1996, 1556159005. <br>
 This book describes what it takes to develop robust 
code quickly, what mistakes are often made in the name of rapid development, 
and how to identify and analyze potential risks. It includes a list of 25 best 
practices, and discusses things that most other books leave out (like 
recovering from disasters and dealing with impossible demands). Unlike most 
&ldquo;how to do it better&rdquo; books, it isn't try to sell any particular 
practice or style, which adds even more weight to McConnell's carefully 
balanced opinions. <br>
[McConnell 1997] Steve McConnell: Software Project 
Survival Guide. Microsoft Press, 1997, 1572316217. <br>
 A condensed 
manager-level version of the same author'sRapid Development. <br>
[Pilgrim 2004]
Mark Pilgrim:Dive Into Python. APress, 2004, 1590593561. <br>
 A good 
introduction to Python, which is also available on-line at<code>Dive Into Python
</code>. <br>
[Powazek 2001] Derek M. Powazek: Design for Community. New 
Riders, 2001, 0735710759. <br>
 This book isn't about web logging, streaming 
video, or managing mailing lists. Instead, it's about how to structure web 
sites so that they will foster on-line communities. The writing is personal 
without being sappy or overbearing, and the author draws upon a wealth of 
personal experience to explain why you sometimes don't want to make it easy for 
people to post comments, or how best to deal with abusive posters. There's a 
lot of no-nonsense analysis of the cost of interactivity, and interviews with 
the creators of some of the web's most successful community sites. <br>
[Ray 
&amp; Ray 2003] Deborah S. Ray and Eric J. Ray: Unix. Peachpit Press, 2003, 
0321170105. <br>
 A gentle introduction to Unix, with many examples. <br>

[Rosenberg &amp; Stephens 2005] Doug Rosenberg and Matt Stephens: Use Case 
Driven Object Modeling with UML. Addison-Wesley, 2005, 0321278275. <br>
 An 
update of Rosenberg's 1999 book of the same name; in just eight chapters, the 
authors present a slimmed-down core of UML organized around a four-stage design 
process. Each stage has clearly defined steps, and concrete milestones which 
specify what ought to be produced (i.e., how to tell when you're finished). <br>
[Scanlan 1989] David A. Scanlan: &quot;Structured Flowcharts Outperform 
Pseudocode: An Experimental Comparison&quot;,IEEE Software, vol. 6, no. 5, pp. 
28-36, 1989. <br>
 Describes an experimental comparison of pseudocode with 
equivalently-structured flowcharts, in which flowcharts did much better than in 
earlier studies. <br>
[Schneier 2003] Bruce Schneier: Beyond Fear. Springer, 
2003, 0387026207. <br>
 A thought-provoking look at how we are encouraged to 
think about security, and how much security is actually desirable. For example, 
he explains why security systems must not just work well, but fail well, and 
why secrecy often undermines security instead of enhancing it. <br>
[Schneier 
2005] Bruce Schneier: Secrets and Lies. Wiley, 2005, 0471453803. <br>
 Having 
written the standard book on cryptography, Schneier now argues that technology 
alone can't solve most real security problems. The book covers systems and 
threats, the technologies used to protect and intercept data, and strategies 
for proper implementation of security systems. Rather than blind faith in 
prevention, Schneier advocates swift detection and response to an attack, while 
maintaining firewalls and other gateways to keep out the amateurs. <br>

[Sedgewick 2001] Robert Sedgewick: Algorithms in C, Parts 1-5. Addison-Wesley 
Professional, 2001, 0201756080. <br>
 Far too many programmers still think and 
code as if resizeable vectors and string-to-pointer hash tables were the only 
data structures ever invented. These books are a guide to all the other 
conceptual tools that working programmers ought to have at their fingertips, 
from sorting and searching algorithms to different kinds of trees and graphs. 
The analysis isn't as deep as that in Knuth's monumentalThe Art of Programming, 
but that makes the book far more accessible. And while the author's use of C 
may seem old-fashioned in an age of Java and C#, it does ensure that nothing 
magical is hidden inside an overloaded operator or virtual method call. <br>

[Skoudis 2004] Ed Skoudis: Malware. Prentice-Hall, 2004, 0131014056. <br>
 This 
647-page tome is a survey of harmful software, from viruses and worms through 
Trojan horses, root kits, and even malicious microcode. Each threat is 
described and analyzed in detail, and the author gives plenty of examples to 
show exactly how the attack works, and how to block (or at least detect) it. 
The writing is straightforward, and the case studies in Chapter 10 are funny 
without being too cute. <br>
[Spinellis 2003] Diomidis Spinellis: Code Reading. 
Addison-Wesley, 2003, 0201799405. <br>
 The book's preface says it best: 
&ldquo;The reading of code is likely to be one of the most common activities of 
a computing professional, yet it is seldom taught as a subject or formally used 
as a method for learning how to design and program.&rdquo; Spinellis isn't the 
first person to make this point, but he is the first person I know of to do 
something about it. In this book, he walks through hundreds of examples of C, 
C++, Java, and Perl, drawn from dozens of Open Source projects such as Apache, 
NetBSD, and Cocoon. Each example illustrates a point about how programs are 
actually built. How do people represent multi-dimensional tables in C? How do 
people avoid nonreentrant code in signal handlers? How do they create packages 
in Java? How can you recognize that a data structure is a graph? A hashtable? 
That it might contain a race condition? And on, and on, real-world issue after 
real-world issue, each one analyzed and cross-referenced. There's also a 
section on additional documentation sources, and a chapter on tools that can 
help you make sense of whatever you've just inherited. <br>
[Steele 1999] Guy 
L. Steele Jr.: &quot;Growing a Language&quot;,Journal of Higher-Order and 
Symbolic Computation, vol. 12, no. 3, pp. 221-236, 1999. <br>
 The best (and 
wittiest) discussion ever published of how programming languages ought to 
evolve. <br>
[Spolsky 2004] Joel Spolsky: Joel on Software. APress, 2004, 
1590593898. <br>
Joel on Software collects some of the witty, insightful 
articles Spolsky has blogged over the past few years. His observations on 
hiring programmers, measuring how well a development team is doing its job, the 
API wars, and other topics are always entertaining and informative. Over the 
course of forty-five short chapters, he ranges from the specific to the general 
and back again, tossing out pithy observations on the commoditization of the 
operating system, why you need to hire more testers, and why NIH (the 
not-invented-here syndrome) isn't necessarily a bad thing. <br>
[Thompson &amp; 
Chase 2005] Herbert H. Thompson and Scott G. Chase: The Software Vulnerability 
Guide. Charles River Media, 2005, 1584503580. <br>
 My current favorite guide 
to computer security for programmers, this books walks through each major 
family of security holes in turn: faulty permission models, bad passwords, 
macros, dynamic linking and loading, buffer overflow, format strings and 
various injection attacks, temporary files, spoofing, and more. <br>
[Ullman 
&amp; Liyanage 2004] Larry Ullman and Marc Liyanage: C Programming. Peachpit 
Press, 2004, 0321287630. <br>
 A gentle introduction to C, with many examples. 
<br> [Williams &amp; Kessler 2003] Laurie Williams and Rober Kessler: Pair 
Programming Illuminated. Addison-Wesley, 2003, 0201745763. <br>
 A combination 
of an instruction manual, a summary of the authors' empirical studies of pair 
programming's effectiveness, and advocacy, this book is the reference guide for 
anyone who wants to introduce pair programming into their development team. <br>
[Wilson 2005] Greg Wilson: Data Crunching. Pragmatic Bookshelf, 2005, 
0974514071. <br>
 Every day, all around the world, programmers have to recycle 
legacy data, translate from one vendor's proprietary format into another's, 
check that configuration files are internally consistent, and search through 
web logs to see how many people have downloaded the latest release of their 
product. It may not be glamorous, but knowing how to do it efficiently is 
essential to being a good programmer. This book describes the most useful data 
crunching techniques, explains when you should use them, and shows how they 
will make your life easier. <br>
<br>
prev top next <br>
<br>

<h1>Glossary</h1> prev  Draft Version 611 next <br>
<br>

<h2>A</h2> 
<dl> 
<dt> absolute path: </dt> 
<dd> Yuan Gan </dd> 
<dt> abstract data types: </dt> 
<dd></dd> 
<dt> access control: </dt> 
<dd></dd> 
<dt> access control lists: </dt> 
<dd></dd> 
<dt> acquire a lock: </dt> 
<dd></dd> 
<dt> action: </dt> 
<dd></dd> 
<dt> actors: </dt> 
<dd></dd> 
<dt> aggregate: </dt> 
<dd></dd> 
<dt> alias: </dt> 
<dd></dd> 
<dt> anchor (in regular expression): </dt> 
<dd></dd> 
<dt> annotated syntax tree: </dt> 
<dd></dd> 
<dt> assertion: </dt> 
<dd></dd> 
<dt> asymmetric cipher: </dt> 
<dd></dd> 
<dt> atomic: </dt> 
<dd> Abhishek Ranjan </dd> 
<dt> attribute (in XML): </dt> 
<dd></dd> 
<dt> authentication: </dt> 
<dd></dd> 
<dt> authorization: </dt> 
<dd></dd> 
<dt> automatic variables (in Make): </dt> 
<dd></dd> </dl> 
<h2>B</h2> 
<dl> 
<dt> basic authentication: </dt> 
<dd></dd> 
<dt> binary data: </dt> 
<dd></dd> 
<dt> binary milestone: </dt> 
<dd></dd> 
<dt> binary mode: </dt> 
<dd></dd> 
<dt> blacklist: </dt> 
<dd> Jeremy Hussell </dd> 
<dt> boilerplate: </dt> 
<dd></dd> 
<dt> boundary object: </dt> 
<dd></dd> 
<dt> branch: </dt> 
<dd></dd> 
<dt> breakpoint: </dt> 
<dd> Abhishek Ranjan </dd> 
<dt> breakpoint, conditional: </dt> 
<dd></dd> 
<dt> bug tracker: </dt> 
<dd></dd> 
<dt> Bugzilla: </dt> 
<dd></dd> </dl> 
<h2>C</h2> 
<dl> 
<dt> call stack: </dt> 
<dd></dd> 
<dt> callback: </dt> 
<dd></dd> 
<dt> camel case: </dt> 
<dd></dd> 
<dt> chain: </dt> 
<dd></dd> 
<dt> child class: </dt> 
<dd></dd> 
<dt> chunk: </dt> 
<dd></dd> 
<dt> cipher: </dt> 
<dd></dd> 
<dt> ciphertext: </dt> 
<dd></dd> 
<dt> class: </dt> 
<dd></dd> 
<dt> class diagram: </dt> 
<dd> Simona Mindy </dd> 
<dt> client: </dt> 
<dd></dd> 
<dt> code browser: </dt> 
<dd></dd> 
<dt> code inspection: </dt> 
<dd></dd> 
<dt> code review: </dt> 
<dd></dd> 
<dt> cognitive dissonance: </dt> 
<dd></dd> 
<dt> collision: </dt> 
<dd></dd> 
<dt> comment spam: </dt> 
<dd> Alireza Moayerzadeh </dd> 
<dt> commit: </dt> 
<dd></dd> 
<dt> Common Gateway Interface: </dt> 
<dd></dd> 
<dt> component object model: </dt> 
<dd></dd> 
<dt> component testing: </dt> 
<dd></dd> 
<dt> concurrency: </dt> 
<dd></dd> 
<dt> connection: </dt> 
<dd></dd> 
<dt> constructor: </dt> 
<dd></dd> 
<dt> control object: </dt> 
<dd></dd> 
<dt> cookie: </dt> 
<dd></dd> 
<dt> Coordinated Universal Time: </dt> 
<dd></dd> 
<dt> core dump: </dt> 
<dd> Nilesh Bansal </dd> 
<dt> cross product: </dt> 
<dd> Amit Chandel </dd> 
<dt> cross-site scripting: </dt> 
<dd></dd> 
<dt> CSV: </dt> 
<dd></dd> 
<dt> cursor: </dt> 
<dd></dd> 
<dt> CVS: </dt> 
<dd></dd> </dl> 
<h2>D</h2> 
<dl> 
<dt> dashboard: </dt> 
<dd></dd> 
<dt> data member: </dt> 
<dd></dd> 
<dt> data modeling: </dt> 
<dd> Lei Jiang </dd> 
<dt> database column: </dt> 
<dd></dd> 
<dt> database key: </dt> 
<dd> Amit Chandel </dd> 
<dt> database row: </dt> 
<dd></dd> 
<dt> database table: </dt> 
<dd> Amit Chandel </dd> 
<dt> daylight savings time: </dt> 
<dd></dd> 
<dt> dead code: </dt> 
<dd></dd> 
<dt> deadlock: </dt> 
<dd> Yuan Gan </dd> 
<dt> debuggee: </dt> 
<dd></dd> 
<dt> decryption: </dt> 
<dd></dd> 
<dt> default target: </dt> 
<dd></dd> 
<dt> defense in depth: </dt> 
<dd></dd> 
<dt> defensive programming: </dt> 
<dd></dd> 
<dt> derive: </dt> 
<dd></dd> 
<dt> design pattern: </dt> 
<dd> Lei Jiang </dd> 
<dt> development process: </dt> 
<dd> Yuan Gan </dd> 
<dt> dictionary: </dt> 
<dd></dd> 
<dt> dictionary key: </dt> 
<dd></dd> 
<dt> directed graph: </dt> 
<dd></dd> 
<dt> directory tree: </dt> 
<dd></dd> 
<dt> docstrings: </dt> 
<dd></dd> 
<dt> document: </dt> 
<dd></dd> 
<dt> Document Object Model: </dt> 
<dd></dd> 
<dt> domain model: </dt> 
<dd> Lei Jiang </dd> 
<dt> domain model diagram: </dt> 
<dd></dd> 
<dt> drive: </dt> 
<dd></dd> 
<dt> driver: </dt> 
<dd></dd> </dl> 
<h2>E</h2> 
<dl> 
<dt> element (in XML): </dt> 
<dd></dd> 
<dt> embed: </dt> 
<dd></dd> 
<dt> encryption: </dt> 
<dd></dd> 
<dt> entity object: </dt> 
<dd></dd> 
<dt> environment variable: </dt> 
<dd> Nilton Bila </dd> 
<dt> epoch: </dt> 
<dd> Nilton Bila </dd> 
<dt> error: </dt> 
<dd></dd> 
<dt> escape sequence: </dt> 
<dd></dd> 
<dt> event-driven programming: </dt> 
<dd></dd> 
<dt> exception: </dt> 
<dd></dd> 
<dt> executable documentation: </dt> 
<dd></dd> 
<dt> exponent: </dt> 
<dd></dd> 
<dt> extend: </dt> 
<dd></dd> 
<dt> Extreme Programming: </dt> 
<dd> Tingting Zou </dd> </dl> 
<h2>F</h2> 
<dl> 
<dt> fail: </dt> 
<dd></dd> 
<dt> filename extension: </dt> 
<dd></dd> 
<dt> filter: </dt> 
<dd></dd> 
<dt> finite state machine: </dt> 
<dd></dd> 
<dt> fixture: </dt> 
<dd></dd> 
<dt> flag: </dt> 
<dd></dd> 
<dt> foreign key: </dt> 
<dd></dd> 
<dt> form: </dt> 
<dd></dd> </dl> 
<h2>G</h2> 
<dl> 
<dt> garbage collect: </dt> 
<dd> Nilesh Bansal </dd> 
<dt> getter: </dt> 
<dd></dd> 
<dt> group: </dt> 
<dd></dd> 
<dt> greedy matching: </dt> 
<dd></dd> </dl> 
<h2>H</h2> 
<dl> 
<dt> heap: </dt> 
<dd> Abhishek Ranjan </dd> 
<dt> heisenbug: </dt> 
<dd></dd> 
<dt> hexadecimal: </dt> 
<dd></dd> 
<dt> hijack: </dt> 
<dd></dd> 
<dt> host address: </dt> 
<dd></dd> 
<dt> HTTP header: </dt> 
<dd> Nilesh Bansal </dd> </dl> 
<h2>I</h2> 
<dl> 
<dt> ICONIX process: </dt> 
<dd></dd> 
<dt> idiom: </dt> 
<dd></dd> 
<dt> immutable: </dt> 
<dd></dd> 
<dt> in-place operator: </dt> 
<dd></dd> 
<dt> inheritance: </dt> 
<dd></dd> 
<dt> instance: </dt> 
<dd></dd> 
<dt> instruction pointer: </dt> 
<dd></dd> 
<dt> instrument: </dt> 
<dd></dd> 
<dt> Integrated Development Environment: </dt> 
<dd></dd> 
<dt> integration testing: </dt> 
<dd></dd> 
<dt> integrity constraint: </dt> 
<dd></dd> 
<dt> internet protocol: </dt> 
<dd> Nilesh Bansal </dd> 
<dt> invert: </dt> 
<dd></dd> 
<dt> issue tracker: </dt> 
<dd></dd> </dl> 
<h2>J</h2> 
<dl> 
<dt> join: </dt> 
<dd> Amit Chandel </dd> </dl> 
<h2>K</h2> 
<dl> </dl> 
<h2>L</h2> 
<dl> 
<dt> leap second: </dt> 
<dd></dd> 
<dt> leap year: </dt> 
<dd></dd> 
<dt> Liskov Substitution Principle: </dt> 
<dd></dd> 
<dt> little-endian: </dt> 
<dd> Alireza Moayerzadeh </dd> 
<dt> local time: </dt> 
<dd></dd> 
<dt> lock: </dt> 
<dd></dd> 
<dt> logging: </dt> 
<dd></dd> </dl> 
<h2>M</h2> 
<dl> 
<dt> macro: </dt> 
<dd></dd> 
<dt> mailing list: </dt> 
<dd></dd> 
<dt> Make: </dt> 
<dd></dd> 
<dt> mantissa: </dt> 
<dd></dd> 
<dt> match object: </dt> 
<dd></dd> 
<dt> memory model: </dt> 
<dd></dd> 
<dt> merge: </dt> 
<dd></dd> 
<dt> method: </dt> 
<dd> Nilton Bila </dd> 
<dt> milestone: </dt> 
<dd></dd> 
<dt> module: </dt> 
<dd></dd> 
<dt> multi-valued assignment: </dt> 
<dd></dd> 
<dt> multiplicity: </dt> 
<dd></dd> 
<dt> Multipurpose Internet Mail Extensions: </dt> 
<dd></dd> 
<dt> mutable: </dt> 
<dd></dd> </dl> 
<h2>N</h2> 
<dl> 
<dt> nested query: </dt> 
<dd></dd> </dl> 
<h2>O</h2> 
<dl> 
<dt> object: </dt> 
<dd> Lei Jiang </dd> 
<dt> object-oriented analysis and design (OOAD): </dt> 
<dd> Tingting Zou </dd> 
<dt> operating system: </dt> 
<dd> Nikos Sarkas </dd> 
<dt> operator overloading: </dt> 
<dd> Nilton Bila </dd> 
<dt> optimistic concurrency: </dt> 
<dd> Tingting Zou </dd> 
<dt> outcome, actual: </dt> 
<dd></dd> 
<dt> outcome, expected: </dt> 
<dd></dd> 
<dt> override: </dt> 
<dd></dd> </dl> 
<h2>P</h2> 
<dl> 
<dt> pack: </dt> 
<dd></dd> 
<dt> pair programming: </dt> 
<dd></dd> 
<dt> parent class: </dt> 
<dd></dd> 
<dt> parent directory: </dt> 
<dd></dd> 
<dt> pass: </dt> 
<dd></dd> 
<dt> path: </dt> 
<dd></dd> 
<dt> pattern rule: </dt> 
<dd></dd> 
<dt> pessimistic concurrency: </dt> 
<dd> Tingting Zou </dd> 
<dt> phony target: </dt> 
<dd></dd> 
<dt> pipe: </dt> 
<dd> Abhishek Ranjan </dd> 
<dt> plaintext: </dt> 
<dd></dd> 
<dt> polymorphism: </dt> 
<dd></dd> 
<dt> port: </dt> 
<dd></dd> 
<dt> post mortem: </dt> 
<dd></dd> 
<dt> post mortem debugging: </dt> 
<dd></dd> 
<dt> post-condition: </dt> 
<dd></dd> 
<dt> pre-condition: </dt> 
<dd></dd> 
<dt> prerequisite: </dt> 
<dd></dd> 
<dt> pretty-printer: </dt> 
<dd></dd> 
<dt> private key: </dt> 
<dd></dd> 
<dt> process: </dt> 
<dd></dd> 
<dt> profiling: </dt> 
<dd></dd> 
<dt> program slice: </dt> 
<dd></dd> 
<dt> project velocity: </dt> 
<dd></dd> 
<dt> protocol: </dt> 
<dd></dd> 
<dt> public key: </dt> 
<dd></dd> 
<dt> public key cryptography: </dt> 
<dd></dd> 
<dt> publish-subscribe: </dt> 
<dd></dd> </dl> 
<h2>Q</h2> 
<dl> </dl> 
<h2>R</h2> 
<dl> 
<dt> race condition: </dt> 
<dd></dd> 
<dt> raise exception: </dt> 
<dd></dd> 
<dt> record: </dt> 
<dd> Amit Chandel </dd> 
<dt> refactor: </dt> 
<dd></dd> 
<dt> reference count: </dt> 
<dd></dd> 
<dt> reflection: </dt> 
<dd></dd> 
<dt> register: </dt> 
<dd></dd> 
<dt> regression: </dt> 
<dd></dd> 
<dt> regression testing: </dt> 
<dd></dd> 
<dt> regular expression: </dt> 
<dd> Abhishek Ranjan </dd> 
<dt> relational database: </dt> 
<dd> Yuan Gan </dd> 
<dt> relative path: </dt> 
<dd> Yuan Gan </dd> 
<dt> release a lock: </dt> 
<dd></dd> 
<dt> release log: </dt> 
<dd> A file (often a spreadsheet) that records exactly what was shipped to 
whom, when.</dd> 
<dt> reluctant matching: </dt> 
<dd></dd> 
<dt> remote procedure call: </dt> 
<dd></dd> 
<dt> replay attack: </dt> 
<dd></dd> 
<dt> repository: </dt> 
<dd></dd> 
<dt> repository browser: </dt> 
<dd></dd> 
<dt> risk assessment: </dt> 
<dd></dd> 
<dt> roadmap: </dt> 
<dd></dd> 
<dt> robustness diagram: </dt> 
<dd></dd> 
<dt> role: </dt> 
<dd></dd> 
<dt> root directory: </dt> 
<dd> Nilton Bila </dd> 
<dt> RSS: </dt> 
<dd> Alireza Moayerzadeh </dd> 
<dt> rule: </dt> 
<dd></dd> </dl> 
<h2>S</h2> 
<dl> 
<dt> sample: </dt> 
<dd></dd> 
<dt> scaffolding: </dt> 
<dd></dd> 
<dt> screen scraping: </dt> 
<dd></dd> 
<dt> search path: </dt> 
<dd></dd> 
<dt> seek: </dt> 
<dd></dd> 
<dt> sequence: </dt> 
<dd></dd> 
<dt> sequence diagram: </dt> 
<dd></dd> 
<dt> server: </dt> 
<dd> Nilesh Bansal </dd> 
<dt> setter: </dt> 
<dd></dd> 
<dt> shared library: </dt> 
<dd></dd> 
<dt> shell: </dt> 
<dd></dd> 
<dt> short-circuit evaluation: </dt> 
<dd></dd> 
<dt> Simple API for XML: </dt> 
<dd> Alireza Moayerzadeh </dd> 
<dt> single-step: </dt> 
<dd></dd> 
<dt> slice: </dt> 
<dd></dd> 
<dt> social engineering: </dt> 
<dd></dd> 
<dt> socket: </dt> 
<dd></dd> 
<dt> SourceForge: </dt> 
<dd> Nikos Sarkas </dd> 
<dt> sparse: </dt> 
<dd></dd> 
<dt> spawn: </dt> 
<dd></dd> 
<dt> special method: </dt> 
<dd></dd> 
<dt> spiral model: </dt> 
<dd></dd> 
<dt> SQL: </dt> 
<dd></dd> 
<dt> SQL injection: </dt> 
<dd></dd> 
<dt> stack frame: </dt> 
<dd></dd> 
<dt> stack pointer: </dt> 
<dd></dd> 
<dt> standard error: </dt> 
<dd></dd> 
<dt> standard input: </dt> 
<dd></dd> 
<dt> standard output: </dt> 
<dd></dd> 
<dt> state assertion: </dt> 
<dd></dd> 
<dt> static space: </dt> 
<dd></dd> 
<dt> status code: </dt> 
<dd></dd> 
<dt> step into: </dt> 
<dd></dd> 
<dt> step over: </dt> 
<dd></dd> 
<dt> submodule: </dt> 
<dd></dd> 
<dt> Subversion: </dt> 
<dd></dd> 
<dt> suspended process: </dt> 
<dd></dd> 
<dt> SWIG: </dt> 
<dd></dd> 
<dt> symbolic debugger: </dt> 
<dd></dd> 
<dt> symmetric cipher: </dt> 
<dd></dd> 
<dt> system testing: </dt> 
<dd></dd> </dl> 
<h2>T</h2> 
<dl> 
<dt> tag (in XML): </dt> 
<dd></dd> 
<dt> target: </dt> 
<dd></dd> 
<dt> target program: </dt> 
<dd></dd> 
<dt> template: </dt> 
<dd></dd> 
<dt> test: </dt> 
<dd></dd> 
<dt> test result: </dt> 
<dd></dd> 
<dt> test suite: </dt> 
<dd></dd> 
<dt> test-driven development (TDD): </dt> 
<dd> Alireza Moayerzadeh </dd> 
<dt> testing, bottom-up: </dt> 
<dd></dd> 
<dt> text: </dt> 
<dd></dd> 
<dt> three-tier architecture: </dt> 
<dd></dd> 
<dt> ticket: </dt> 
<dd></dd> 
<dt> ticket, closed: </dt> 
<dd></dd> 
<dt> ticket, open: </dt> 
<dd></dd> 
<dt> time structure: </dt> 
<dd></dd> 
<dt> time zone: </dt> 
<dd></dd> 
<dt> timeline: </dt> 
<dd></dd> 
<dt> traceability: </dt> 
<dd></dd> 
<dt> transaction: </dt> 
<dd> Nikos Sarkas </dd> 
<dt> Transmission Control Protocol (TCP): </dt> 
<dd> Nikos Sarkas </dd> 
<dt> triage: </dt> 
<dd></dd> 
<dt> tuple: </dt> 
<dd></dd> 
<dt> two's complement: </dt> 
<dd></dd> </dl> 
<h2>U</h2> 
<dl> 
<dt> Unicode: </dt> 
<dd> Nikos Sarkas (see also ). </dd> 
<dt> Unified Modeling Language (UML): </dt> 
<dd> Lei Jiang </dd> 
<dt> unit testing: </dt> 
<dd></dd> 
<dt> unpack: </dt> 
<dd></dd> 
<dt> URL encode: </dt> 
<dd></dd> 
<dt> use case: </dt> 
<dd> Tingting Zou </dd> 
<dt> use case diagram: </dt> 
<dd> Simona Mindy </dd> 
<dt> user stories: </dt> 
<dd> Simona Mindy </dd> </dl> 
<h2>V</h2> 
<dl> 
<dt> validate: </dt> 
<dd></dd> 
<dt> verifiable deliverable: </dt> 
<dd></dd> 
<dt> version control system: </dt> 
<dd></dd> 
<dt> version number: </dt> 
<dd> Large projects typically use multi-part version numbers to identify 
software releases. In extreme cases, &ldquo;6.2.3.1407&rdquo; means major 
version 6, minor version 2, patch 3, build 1407. The major version number is 
only incremented when significant changes are made, where 
&ldquo;significant&rdquo; means &ldquo;changes that make this version's 
data/configuration/whatever impossible for older versions to read&rdquo;. Minor 
version numbers are what most people think of as releases. If you've added a 
few new features, changed part of the GUI, etc., you increment the minor 
version number and throw it to customers. Patches are things that don't have 
their own installers. If, for example, you need to change one HTML form, or one 
DLL, you will often just mail that out to customers, along with instructions 
about where to put it, rather than creating a new installer. You should still 
give it a number, though, and make an entry in your release log. Finally, the 
build number is incremented every time you create a new version of the product 
for QA to test. Build numbers are never reset, i.e. you don't go from 
5.2.2.1001 to 6.0.0.0, but from 5.2.2.1001 to 6.0.0.1002, and so on. Build 
numbers are what developers care about: they're often only matched up with 
version numbers after the fact (i.e. you create build #1017, QA says, 
&ldquo;Yeah, it looks good,&rdquo; so you say, &ldquo;All right, this'll be 
6.1.0,&rdquo; and voila, you have 6.1.0.1017.) Finally, groups will sometimes 
identify pre-releases as &ldquo;beta 1&rdquo;, &ldquo;beta 2&rdquo;, and so on, 
as in &quot;6.2 beta 2&quot;. Again, this label is usually attached to a 
particular build after the fact&mdash;you wait until QA (or whoever) says that 
build #1017 is good enough to send out to customers, then tag it in version 
control.</dd> 
<dt> virtual machine: </dt> 
<dd></dd> 
<dt> visitor: </dt> 
<dd></dd> </dl> 
<h2>W</h2> 
<dl> 
<dt> watchpoint: </dt> 
<dd></dd> 
<dt> waterfall model: </dt> 
<dd> Simona Mindy </dd> 
<dt> web services: </dt> 
<dd></dd> 
<dt> web spider: </dt> 
<dd> Simona Mindy </dd> 
<dt> weblog: </dt> 
<dd> Jeremy Hussell </dd> 
<dt> whitelist: </dt> 
<dd> Jeremy Hussell </dd> 
<dt> wiki: </dt> 
<dd> Jeremy Hussell </dd> 
<dt> wildcard: </dt> 
<dd> Jeremy Hussell </dd> 
<dt> working copy: </dt> 
<dd></dd> </dl> 
<h2>X</h2> 
<dl> </dl> 
<h2>Y</h2> 
<dl> </dl> 
<h2>Z</h2> 
<dl> </dl> prev top next <br>
<br>

<h1>Online Resources</h1> prev  Draft Version 534 next <br>
<br>

<dl> 
<dt> Andrew Kuchling's Python Regular Expression HOWTO: </dt> 
<dd> A short tutorial on the basics of regular expressions aimed at <code>
Python</code> programmers. (Viewed 2005-09-01.) </dd> 
<dt> Apache Web Server: </dt> 
<dd> The main site for the most widely-used web server in the world. (Viewed 
2005-07-26.)</dd> 
<dt> ArgoUML: </dt> 
<dd> The most advanced open source UML tool available. (Viewed 2005-08-08.) 
</dd> 
<dt> Bitten: </dt> 
<dd> A tool for running builds continuously in the background across multiple 
machines. (Viewed 2005-09-01.)</dd> 
<dt> CruiseControl: </dt> 
<dd> A framework for managing continuous builds. Each time you update 
something in your version control repository, CruiseControl recompiles your 
code, re-runs your tests, and lets you (and your teammates) know if you've 
broken anything. (Viewed 2005-07-26.)</dd> 
<dt> Cygwin: </dt> 
<dd> A Linux-like environment for Windows, which brings with it a lot of other 
tools (like SSH and GNU Make). (Viewed 2005-07-26.)</dd> 
<dt> Daily Python URL: </dt> 
<dd> Daily (more or less) news about <code>Python</code> modules, new releases 
of the interpreter, meetings, etc. (Viewed 2005-07-26.)</dd> 
<dt> Dive Into Python: </dt> 
<dd> The complete text of [ Pilgrim 2004] available on-line. (Viewed 
2005-09-06.)</dd> 
<dt> Doctor Dobb's Journal Python-URL: </dt> 
<dd> Bi-weekly news from the world of <code>Python</code>. (Viewed 2005-09-01.)
</dd> 
<dt> Dept. of Computer Science, University of Toronto: </dt> 
<dd> The principal author's home department, which helped make this course 
happen. (Viewed 2005-07-26.)</dd> 
<dt> Eclipse: </dt> 
<dd> Originally developed by IBM for Java development, Eclipse is the biggest 
open source development environment around these days. There are literally 
hundreds of plugins for it, and hundreds of thousands of users. It's not for 
the faint of heart (and it definitely won't be happy on a four-year-old 
hand-me-down machine), but it's one of the real power tools of modern 
programming. (Viewed 2005-08-10.)</dd> 
<dt> Emacs: </dt> 
<dd> It doesn't actually stand for &ldquo;eighteen megabytes and constantly 
swapping&rdquo;, and it isn't actually a Lisp-based operating system, but 
there's a grain of truth in each claim. Many programmers swear by it; others 
massage their aching wrists and swear<em>at</em> it instead, but there's no 
denying that it's a very powerful tool. (Viewed 2005-08-10.)</dd> 
<dt> Firefox: </dt> 
<dd> The best web browser around, where &ldquo;best&rdquo; means &ldquo;nicest 
interface&rdquo;, &ldquo;most extensible&rdquo;, and &ldquo;least 
insecure&rdquo;. (Viewed 2005-07-26.)</dd> 
<dt> GIMP: </dt> 
<dd> The GNU Image Manipulation Program is a powerful tool for creating and 
manipulating images in a wide variety of formats. (Viewed 2005-07-26.)</dd> 
<dt> Internet Groupware for Scientific Collaboration: </dt> 
<dd> While it is now several years old, Udell's examination of what the web 
could be, and how it could help scientists collaborate more effectively, is 
still as thought-provoking as it was when it first appeared. (Viewed 
2005-07-26.)</dd> 
<dt> Komodo: </dt> 
<dd> A commercial IDE that supports Perl, PHP, Tcl, and XSLT as well as <code>
Python</code>. (Viewed 2005-07-29.) </dd> 
<dt> MySQL: </dt> 
<dd> The most popular open source database around (though many discerning 
users prefer<code>PostgreSQL</code>). (Viewed 2005-07-29.) </dd> 
<dt> Numeric: </dt> 
<dd> The standard numerical programming module for <code>Python</code>, with 
good support for multi-dimensional arrays. (Viewed 2005-08-16.)</dd> 
<dt> PEP-008: Python Style Guide: </dt> 
<dd> A semi-official guide to <code>Python</code> coding conventions. (Viewed 
2005-07-26.)</dd> 
<dt> PostgreSQL: </dt> 
<dd> The main site for an advanced open source relational database. It may not 
be as popular as its main competitor, MySQL, but most people who have used both 
have found PostgreSQL easier to work with. (Viewed 2005-07-26.)</dd> 
<dt> PyChecker: </dt> 
<dd> A code checking tool for <code>Python</code> that complements <code>PyLint
</code>. (Viewed 2005-09-06.) </dd> 
<dt> PyDev: </dt> 
<dd> PyDev is a plugin for <code>Eclipse</code>, an open source IDE backed by 
IBM that was originally targeted at Java, but which now has plugins to support 
several other languages. Like<code>Eclipse</code>, PyDev needs a lot of memory 
to run well. (Viewed 2005-08-10.)</dd> 
<dt> PyLint: </dt> 
<dd> A code checking tool for <code>Python</code> that complements <code>
PyChecker</code>. (Viewed 2005-09-06.) </dd> 
<dt> Python: </dt> 
<dd> The main site for all things Python. (Viewed 2005-07-26.) </dd> 
<dt> Python Imaging Library: </dt> 
<dd> A widely-used image processing library for <code>Python</code>, capable 
of working with every popular graphics format around. (Viewed 2005-07-28.)</dd> 
<dt> Python Cookbook: </dt> 
<dd> An ever-growing collection of <code>Python</code> tips and tricks. 
(Viewed 2005-07-29.)</dd> 
<dt> Python Software Foundation: </dt> 
<dd> A non-profit organization devoted to advancing open source technology 
related to<code>Python</code>, and the main financial sponsor of this course. 
(Viewed 2005-07-26.)</dd> 
<dt> RapidSVN: </dt> 
<dd> A cross-platform GUI for <code>Subversion</code>. (Viewed 2005-09-13.) 
</dd> 
<dt> SciPy: </dt> 
<dd> A set of extensions to the Numeric module for scientific programming. 
(Viewed 2005-08-16.)</dd> 
<dt> SCons: </dt> 
<dd> A powerful <code>Python</code>-based build management tool. (Viewed 
2005-07-28.)</dd> 
<dt> SmartSVN: </dt> 
<dd> A cross-platform GUI for <code>Subversion</code>. (Viewed 2005-07-14.) 
</dd> 
<dt> SPE: </dt> 
<dd> &ldquo;Stani's Python Editor&rdquo; has grown to be more than just an 
editor: it now supports several cool tools, including a regular expression 
debugger. (Viewed 2005-08-10.)</dd> 
<dt> SQLite: </dt> 
<dd> A small, simple, and very fast relational database that can be run on its 
own, or integrated into other applications. (Viewed 2005-07-26.)</dd> 
<dt> Subversion: </dt> 
<dd> The main site for Subversion is aimed more at Subversion's developers 
than at its users; if you're looking for a how-to, [Mason 2005] is a good place 
to start. (Viewed 2005-07-26.)</dd> 
<dt> The Absolute Minimum Every Software Developer Absolutely, Positively Must 
Know About Unicode and Character Sets (No Excuses!): </dt> 
<dd> Joel Spolsky's 15-minute guide to character set encodings, and what you 
have to do to deal with the fact that most of the world doesn't use the 
standard American alphabet. This article is reprinted in [Spolsky 2004] . 
(Viewed 2005-07-26.)</dd> 
<dt> Top 10 Accessible Web Authoring Practices: </dt> 
<dd> Ten simple, easy-to-follow rules that will make your web site more 
accessible to people with various disabilities. (Viewed 2005-07-26.)</dd> 
<dt> TortoiseSVN: </dt> 
<dd> A cross-platform GUI for <code>Subversion</code>. (Viewed 2005-09-13.) 
</dd> 
<dt> University of Toronto: </dt> 
<dd> Canada's biggest university, and the host institution for much of this 
work. (Viewed 2005-07-26.)</dd> 
<dt> Vim: </dt> 
<dd> &ldquo;Vi Improved&rdquo; is a modern version of the classic Unix text 
editor, and is supported by an active development community. (Viewed 
2005-08-10.)</dd> 
<dt> WingIDE: </dt> 
<dd> A commercial IDE targeted solely at <code>Python</code> developers. 
(Viewed 2005-07-29.)</dd> 
<dt> YesLogic: </dt> 
<dd> Makers of Prince, the document formatter and generator used to produce 
the PDF version of these notes. (Viewed 2005-10-05.)</dd> </dl> prev top next 
<br> <br>

<h1>List of Figures</h1> prev  Draft Version 327 next <br>
<br>

<ul> 
<li>Figure 3.1: Basic Use</li> 
<li>Figure 3.2: RapidSVN</li> 
<li>Figure 3.3: TortoiseSVN</li> 
<li>Figure 3.4: Merging Conflicts</li> 
<li>Figure 3.5: Undoing Changes</li> 
<li>Figure 3.6: Branching and Merging</li> 
<li>Figure 4.1: A Shell in Action</li> 
<li>Figure 4.2: Operating System and Shell</li> 
<li>Figure 4.3: A Directory Tree</li> 
<li>Figure 4.4: Parent Directories</li> 
<li>Figure 4.5: Running a Program</li> 
<li>Figure 5.1: The Shell Running a Program</li> 
<li>Figure 5.2: Redirecting Standard Input and Output</li> 
<li>Figure 5.3: Pipes</li> 
<li>Figure 6.1: Nimble vs. Sturdy Languages</li> 
<li>Figure 6.2: Sturdy vs. Nimble Execution</li> 
<li>Figure 6.3: Variables Refer to Values</li> 
<li>Figure 7.1: Visualizing Indices</li> 
<li>Figure 7.2: Visualizing Negative Indices</li> 
<li>Figure 7.3: Line Segment</li> 
<li>Figure 7.4: Aliasing In Action</li> 
<li>Figure 7.5: Slicing Copies Data</li> 
<li>Figure 8.1: Call Stack (a)</li> 
<li>Figure 8.2: Call Stack (b)</li> 
<li>Figure 8.3: Call Stack (c)</li> 
<li>Figure 8.4: Argument Passing (a)</li> 
<li>Figure 8.5: Argument Passing (b)</li> 
<li>Figure 8.6: Argument Passing (c)</li> 
<li>Figure 8.7: Argument Passing (d)</li> 
<li>Figure 8.8: Passing a Slice</li> 
<li>Figure 8.9: Functions As Objects</li> 
<li>Figure 9.1: Possible Overlap Tests</li> 
<li>Figure 10.1: Counting Frequency</li> 
<li>Figure 10.2: Tracing Execution of Dictionary Inversion</li> 
<li>Figure 10.3: Flow of Control in Try/Except</li> 
<li>Figure 10.4: Stacking Exception Handlers</li> 
<li>Figure 10.5: Running Another Program</li> 
<li>Figure 10.6: Deadlock</li> 
<li>Figure 11.1: A Debugger in Action</li> 
<li>Figure 11.2: Source Browser</li> 
<li>Figure 11.3: Code Assistant</li> 
<li>Figure 11.4: Microsoft Visual Studio in Action</li> 
<li>Figure 11.5: Inspecting Values</li> 
<li>Figure 11.6: Creating a Breakpoint</li> 
<li>Figure 12.1: Memory Model</li> 
<li>Figure 12.2: Method Lookup</li> 
<li>Figure 13.1: Object-Oriented Testing</li> 
<li>Figure 14.1: Structure of a Make Rule</li> 
<li>Figure 14.2: Visualizing Dependencies</li> 
<li>Figure 15.1: Chunking in Short-Term Memory</li> 
<li>Figure 15.2: Actual Chess Position</li> 
<li>Figure 15.3: Retention of Actual Chess Position</li> 
<li>Figure 15.4: Random Chess Position</li> 
<li>Figure 15.5: Retention of Random Chess Position</li> 
<li>Figure 15.6: Annotated Syntax Tree</li> 
<li>Figure 15.7: Data Display Debugger</li> 
<li>Figure 17.1: Matching</li> 
<li>Figure 17.2: Anchoring Matches</li> 
<li>Figure 17.3: Compiling Regular Expressions</li> 
<li>Figure 17.4: Word/Non-Word Breaks</li> 
<li>Figure 17.5: Regular Expressions as Finite State Machines</li> 
<li>Figure 18.1: Simple Page Rendered by Firefox</li> 
<li>Figure 18.2: Simple Page Rendered by Internet Explorer</li> 
<li>Figure 18.3: Lists and Tables</li> 
<li>Figure 18.4: Images in Pages</li> 
<li>Figure 18.5: Links in Pages</li> 
<li>Figure 18.6: A DOM Tree</li> 
<li>Figure 18.7: Modifying the DOM Tree</li> 
<li>Figure 20.1: Using Bits to Record Sets of Flags</li> 
<li>Figure 20.2: Floating Point Representation</li> 
<li>Figure 20.3: Uneven Spacing of Floating-Point Numbers</li> 
<li>Figure 20.4: Packing Data</li> 
<li>Figure 20.5: Unpacking Data</li> 
<li>Figure 20.6: Packing a Variable-Length Vector</li> 
<li>Figure 20.7: Structure of a Binary File With Metadata</li> 
<li>Figure 21.1: Database Tables</li> 
<li>Figure 21.2: A Combined Table</li> 
<li>Figure 21.3: Join In Action</li> 
<li>Figure 22.1: HTTP Request Cycle</li> 
<li>Figure 22.2: HTTP Request Format</li> 
<li>Figure 22.3: HTTP Response Format</li> 
<li>Figure 22.4: Remote Procedure Call Using HTTP</li> 
<li>Figure 23.1: A Simple Form</li> 
<li>Figure 23.2: Three Tier Architecture</li> 
<li>Figure 24.1: Secure Communication with Asymmetric Keys</li> 
<li>Figure 25.1: Trac Architecture</li> 
<li>Figure 25.2: Typical Trac Home Page</li> 
<li>Figure 25.3: Browsing Directories and Files</li> 
<li>Figure 25.4: Viewing an Old Version of a File</li> 
<li>Figure 25.5: Viewing File Changes</li> 
<li>Figure 25.6: The Timeline</li> 
<li>Figure 25.7: Filtering Events</li> 
<li>Figure 25.8: Creating a New Ticket</li> 
<li>Figure 25.9: Whitelisting an Email Address</li> 
<li>Figure 25.10: Editing a Wiki Page</li> 
<li>Figure 25.11: Dashboard Display</li> 
<li>Figure 25.12: How Blogs Work</li> 
<li>Figure 25.13: A Trac Timeline Blog</li> 
<li>Figure 26.1: The Cost of Change</li> 
<li>Figure 26.2: The Waterfall Model</li> 
<li>Figure 27.1: Flowcharts</li> 
<li>Figure 27.2: Entity-Relationship Diagrams</li> 
<li>Figure 27.3: Class Diagrams</li> 
<li>Figure 27.4: ICONIX: Start and End Points</li> 
<li>Figure 27.5: Domain Model Diagram</li> 
<li>Figure 27.6: Robustness Diagram</li> 
<li>Figure 27.7: Sequence Diagram</li> 
<li>Figure 28.1: Project Lifecycle</li> 
<li>Figure 28.2: Feature Rankings</li> 
<li>Figure 29.1: Original Image</li> 
<li>Figure 29.2: Processed Image</li> 
<li>Figure 29.3: How Python Represents Values</li> </ul> prev top next <br>

<br> 
<h1>List of Tables</h1> prev  Draft Version 327 next <br>
<br>

<ul> 
<li>Table 3.1: Common Subversion Commands</li> 
<li>Table 5.1: Important Environment Variables</li> 
<li>Table 5.2: Basic Command-Line Tools</li> 
<li>Table 5.3: Advanced Command-Line Tools</li> 
<li>Table 6.1: Numeric Operators in Python</li> 
<li>Table 6.2: Boolean Operators in Python</li> 
<li>Table 6.3: Comparison Operators in Python</li> 
<li>Table 6.4: Python String Comparisons</li> 
<li>Table 7.1: String Methods</li> 
<li>Table 7.2: List Methods</li> 
<li>Table 8.1: The Python Standard Math Library</li> 
<li>Table 8.2: The Python System Library</li> 
<li>Table 8.3: The Python Time Library</li> 
<li>Table 8.4: The Python File System Library</li> 
<li>Table 8.5: Python's Pathname Library</li> 
<li>Table 10.1: Dictionary Methods</li> 
<li>Table 10.2: Common Exception Types</li> 
<li>Table 14.1: Automatic Variables in Make</li> 
<li>Table 15.1: Typical Logging Levels</li> 
<li>Table 17.1: Basic Regular Expression Operators</li> 
<li>Table 17.2: Anchoring Regular Expressions</li> 
<li>Table 17.3: Regular Expression Escape Sequences</li> 
<li>Table 17.4: Regular Expression Object Methods</li> 
<li>Table 18.1: Common XML Escape Sequences</li> 
<li>Table 18.2: Common XHTML Tags</li> 
<li>Table 18.3: More XHTML Tags</li> 
<li>Table 20.1: Bitwise Operators in Python</li> 
<li>Table 20.2: Format Specifiers in Python</li> 
<li>Table 22.1: URL Encoding</li> 
<li>Table 23.1: CGI Environment Variables</li> 
<li>Table 23.2: Common MIME Types</li> </ul> prev top next <br>
<br>

<h1>Syllabus</h1> prev  Draft Version 327 <br>
<br>

<h2>Software Carpentry</h2> 
<ul> 
<li>course outline</li> 
<li>acknowledgments</li> </ul> 
<h2>Introduction</h2> 
<ul> 
<li>motivation for course</li> 
<li>need to improve quality as well as efficiency</li> 
<li>key idea</li> 
<li>target audience</li> 
<li>self-test</li> 
<li>course philosophy</li> 
<li>topics</li> 
<li>what you will need</li> 
<li>recommended reading</li> 
<li>typographic conventions</li> </ul> 
<h2>Version Control</h2> 
<ul> 
<li>motivation for this lecture</li> 
<li>version control systems</li> 
<li>CVS and Subversion</li> 
<li>basic operations</li> 
<li>command line and GUI clients</li> 
<li>merging conflicts</li> 
<li>versioning</li> 
<li>binary files</li> 
<li>rollback</li> 
<li>getting started</li> 
<li>Subversion command reference</li> 
<li>reading Subversion output</li> 
<li>branching and merging</li> </ul> 
<h2>Shell Basics</h2> 
<ul> 
<li>motivation for this lecture</li> 
<li>difference between shell and operating system</li> 
<li>the file system</li> 
<li>basic commands</li> 
<li>creating files and directories</li> 
<li>wildcards</li> </ul> 
<h2>More Shell</h2> 
<ul> 
<li>input, output, and redirection</li> 
<li>pipes</li> 
<li>environment variables</li> 
<li>the PATH variable</li> 
<li>basic tools</li> 
<li>Unix ownership and permission</li> 
<li>Windows ownership and permission</li> 
<li>some more advanced tools</li> </ul> 
<h2>Basic Scripting</h2> 
<ul> 
<li>introducing Python</li> 
<li>interactive use</li> 
<li>batch use</li> 
<li>variables</li> 
<li>printing and quoting</li> 
<li>numbers</li> 
<li>Booleans</li> 
<li>comparisons</li> 
<li>conditionals</li> 
<li>while, break, and continue</li> </ul> 
<h2>Strings, Lists, and Files</h2> 
<ul> 
<li>strings</li> 
<li>indexing</li> 
<li>string methods</li> 
<li>lists</li> 
<li>list methods</li> 
<li>for and range</li> 
<li>testing for membership</li> 
<li>aliasing</li> 
<li>tuples</li> 
<li>file I/O</li> </ul> 
<h2>Functions, Libraries, and the File System</h2> 
<ul> 
<li>defining functions</li> 
<li>variable scope</li> 
<li>aliasing</li> 
<li>default parameter values</li> 
<li>variable-length argument lists</li> 
<li>functions as objects</li> 
<li>creating modules</li> 
<li>math library</li> 
<li>system library</li> 
<li>representing and manipulating times</li> 
<li>file system programming</li> 
<li>The os.path Module</li> 
<li>The __main__ Keyword</li> 
<li>Python sources</li> </ul> 
<h2>Testing Basics</h2> 
<ul> 
<li>motivation</li> 
<li>terminology</li> 
<li>rules for tests</li> 
<li>testing frameworks</li> 
<li>choosing tests</li> </ul> 
<h2>Dictionaries and Error Handling</h2> 
<ul> 
<li>motivation</li> 
<li>string formatting</li> 
<li>dictionaries</li> 
<li>working with dictionaries</li> 
<li>dictionary methods</li> 
<li>counting and inverting</li> 
<li>dictionary string formatting</li> 
<li>try, except, and else</li> 
<li>exceptions</li> 
<li>exception handler stack</li> 
<li>raising exceptions</li> 
<li>assertions and defensive programming</li> 
<li>executing subprocesses</li> </ul> 
<h2>Debugging</h2> 
<ul> 
<li>what's wrong with print statements</li> 
<li>symbolic debuggers</li> 
<li>running in a debugger</li> 
<li>breakpoints, inspection, and single-stepping</li> 
<li>how debuggers work</li> 
<li>advanced operations</li> 
<li>rule 0</li> </ul> 
<h2>Object-Oriented Programming</h2> 
<ul> 
<li>motivation</li> 
<li>defining classes</li> 
<li>defining methods</li> 
<li>defining classes</li> 
<li>special methods</li> 
<li>inheritance</li> 
<li>polymorphism</li> 
<li>Liskov substitution principle</li> 
<li>class members</li> 
<li>operator overloading</li> </ul> 
<h2>Structured Unit Testing</h2> 
<ul> 
<li>mechanics</li> 
<li>example</li> 
<li>setup and teardown</li> 
<li>testing assertions</li> 
<li>testing I/O</li> 
<li>testing classes</li> 
<li>test-driven development</li> </ul> 
<h2>Automated Builds</h2> 
<ul> 
<li>motivation for this lecture</li> 
<li>overview of Make</li> 
<li>basic features</li> 
<li>handling multiple targets</li> 
<li>defining phony targets</li> 
<li>automatic variables</li> 
<li>pattern rules</li> 
<li>specifying dependencies</li> 
<li>defining variables</li> 
<li></li> </ul> 
<h2>Coding Style and Reading Code</h2> 
<ul> 
<li>why read code</li> 
<li>cognition</li> 
<li>determining functionality</li> 
<li>naming</li> 
<li>idioms</li> 
<li>style-checking tools</li> 
<li>role of documentation</li> 
<li>traceability</li> 
<li>defensive programming and other pseudo-documentation</li> 
<li>active reading</li> </ul> 
<h2>Watching Programs Run</h2> 
<ul> 
<li>Python's object model</li> 
<li>dynamic programming</li> 
<li>coverage</li> 
<li>profiling</li> </ul> 
<h2>Regular Expressions</h2> 
<ul> 
<li>basic patterns</li> 
<li>anchors</li> 
<li>escape sequences</li> 
<li>extracting matches</li> 
<li>compiled REs</li> 
<li>other languages</li> 
<li>other patterns</li> </ul> 
<h2>Basic XML and XHTML</h2> 
<ul> 
<li>formatting rules</li> 
<li>XHTML</li> 
<li>attributes</li> 
<li>images and links</li> 
<li>accessibility</li> 
<li>DOM</li> 
<li>basic features of DOM</li> 
<li>creating a DOM tree</li> 
<li>walking a DOM tree</li> 
<li>modifying a DOM tree</li> </ul> 
<h2>A Mini-Project</h2> 
<ul> 
<li>checking for tabs</li> 
<li>automation</li> 
<li>checking for printable characters</li> 
<li>checking glossary entries</li> 
<li>checking cross-references</li> </ul> 
<h2>Binary Data</h2> 
<ul> 
<li>motivation</li> 
<li>representing numbers</li> 
<li>bitwise operators</li> 
<li>shifting</li> 
<li>floating point numbers</li> 
<li>binary I/O</li> 
<li>packing data structures</li> 
<li>variable-length data</li> 
<li>metadata</li> </ul> 
<h2>Relational Databases</h2> 
<ul> 
<li>create, insert, and drop</li> 
<li>simple queries</li> 
<li>joins</li> 
<li>negation and nested queries</li> 
<li>aggregation</li> 
<li>application programming</li> 
<li>handling NULL</li> 
<li>concurrency</li> </ul> 
<h2>Client-Side Web Programming</h2> 
<ul> 
<li>underlying protocols</li> 
<li>HTTP</li> 
<li>HTTP request</li> 
<li>HTTP response</li> 
<li>urllib</li> 
<li>parameterizing requests</li> 
<li>encoding and decoding</li> 
<li>web services</li> </ul> 
<h2>CGI</h2> 
<ul> 
<li>overview</li> 
<li>MIME types</li> 
<li>example</li> 
<li>creating forms</li> 
<li>handling form data</li> 
<li>server-side state</li> 
<li>concurrency</li> 
<li>cookies</li> </ul> 
<h2>Security</h2> 
<ul> 
<li>goals</li> 
<li>limitations of technical solution</li> 
<li>terminology</li> 
<li>input is untrustworthy</li> 
<li>the evils of exec</li> 
<li>basic cryptography</li> 
<li>basic cryptography</li> 
<li>HTTPS</li> 
<li>ssh</li> 
<li>guidelines</li> </ul> 
<h2>Teamware</h2> 
<ul> 
<li>overview of Trac</li> 
<li>repository browser and timeline</li> 
<li>issue tracker</li> 
<li>writing useful tickets</li> 
<li>mailing lists</li> 
<li>wiki</li> 
<li>roadmap and milestones</li> 
<li>dashboard</li> 
<li>weblogs</li> 
<li>administration</li> </ul> 
<h2>Extreme Programming</h2> 
<ul> 
<li>Extreme Programming</li> 
<li>XP core practices</li> 
<li>planning game</li> 
<li>pair programming</li> 
<li>project velocity</li> 
<li>counter-arguments</li> </ul> 
<h2>The ICONIX Process</h2> 
<ul> 
<li>use cases</li> 
<li>domain model</li> 
<li>robustness diagrams</li> 
<li>class diagrams</li> 
<li>sequence diagrams</li> 
<li>order of operations</li> 
<li>UML tools</li> </ul> 
<h2>The Nevex Process</h2> 
<ul> 
<li>vision statement</li> 
<li>analysis &amp; estimation</li> 
<li>A&amp;E format</li> 
<li>design, implementation, and maintenance</li> 
<li>QA and documentation</li> 
<li>post mortem</li> </ul> 
<h2>Backward, Forward, and Sideways</h2> 
<ul> 
<li>intro</li> 
<li>the Numeric module</li> 
<li>Python Imaging Library</li> 
<li>SCons</li> 
<li>integrating C into Python</li> 
<li>SWIG, Fortran, and embedding Python in C</li> 
<li>design patterns</li> 
<li>refactoring</li> 
<li>non-technical reading</li> 
<li>rules of programming</li> </ul> prev top <br>
<br>
 Copyright &copy; 2005, 
Python Software Foundation. SeeLicense for details. <br>
<br>

</body>