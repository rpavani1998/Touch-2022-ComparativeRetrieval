englewood next we needed to distribute dots across geographies.
running on my macbook, this took about four days and produced about one gigabyte’s worth of json data files (not to mention over 3.7 gb of cached files from the ilga website.)
self.edit_post(blog, post_id) response = requests.get(url) self.assertmiss(response) this test creates a new post on a particular blog, then hits the blog homepage twice to ensure it is cached.
that being said, it also provides a pretty interesting example of using ec2 to solve problems that can really only be properly addressed with distributed computing.
commit messages should accurately summarize each task included in the commit, otherwisegit log is useless.
well this script is kinda boring without the template: {% for row in table.rows %}  {% if row['year featured']|trim %} {{ row['year featured'] }} {% endif %} {{ row['name'] }} {% if row['youtube'] %} {{ row['youtube']|safe }} {% endif %} written: {{ row['year written'] }} country of origin: {{ row['country of origin'] }} originally by: {{ row['original composer/lyricist'] }} {{ row['other composers/lyricists'] }} {% if row['keywords']|trim %} memorable lyrics {{ row['keywords'] }} {% endif %} {% if row['famous versions']|trim %} famous renditions {{ row['famous versions'] }} {% endif %} {% if row['noteable']|trim %} did you know?
this allowed me to produce an index to changes to the pension laws since the 93rd session of the illinois general assembly,in spreadsheet form.
and to prepare for this recent release, we even spent a week hacking near-complete prototype maps using data that the census had already released, kings county, new york.
in june we launched chicago breaking business, which is, at least in terms of traffic, our largest site so far.
use hyphens for ids and classes, no camelcase or underscores.
build normalized models and denormalize only when necessary for performance.
made in conjunction with news hackers from cnn, nyt, spokesman-review, university of nebraska and usa today.
it even has an interesting tool called scrapeshell which is appealing to me as someone who likes interactive code development.
bee 0 is joining the swarm.
if you look carefully, you can see me in the back corner of this room, hunched over my laptop.
make dots scale on zoom.
many of the tools needed to create the maps we wanted didn’t exist.
invar automates the generation of map tiles, and the deployment of tiles to s3.
it scatters points within each feature and then writes the points out to a table or new shapefile.
it does stuff that i always thought django templates should be able to do.
for those who want to cut to the chase, here is the pythonunittest script for testing our varnish cache layer.
bee 0 is out of ammo.
it makes big css scannable: a:link {color:#336699;} a:hover, a:active {color:#6d9fd2;} a:visited {color:#336699;} a:visited:hover {color:#6d9fd2;} don’t rely on (because of ie6): min-width, max-width, min-height, max-height
make your dots to stand out brightly.
it’ll make for a more interesting map.
as a foundation for open states, they’ve made a very robust library calledscrapelib, which can be used to manage caching and robots.txt compliance for any web scraper.
via crayonsman (cc by-sa 3.0) styling dots creating dot density maps created new challenges with regards to styling.
the spreadsheet was only 25 rows, but i was not about build all the html by hand.
low-cost, distributed load-testing using ec2.
perhaps the most important lesson i learned from triblocal’s development was that our cache layer was extremely fragile–it was prone to break when a new version of a site was deployed.
since 2003, the general assembly has filed nearly 60,000 pieces of legislation, but only a few of those became laws, and of course, most of those laws don’t impact the pension codes.
large, discrete units of work should be developed on their own feature branches, so that another developer can pick it up if you get hit by a truck.
some of the code i wrote, like that which extracts the list of statutes impacted by a bill, is probably of general use.
this was before the tribapps team was officially formed, but thanks to sunlight, i was in a good position to apply for a spot on the team when it was created.
it’s unfortunate that we lack a good “code coverage” metric for this sort of testing and of course these aren’t true “unit tests,” but using unit testing tools in this way goes a long way toward organizing the logic.
it scatters points within each feature and then writes the points out to a table or new shapefile.
the template will still get created, you’ll just have to edit the fabfile later if you plan on deploying the project to a staging or production server.
invar invar automates the generation of map tiles, and the deployment of tiles to s3.
i wrote python code to analyze the data produced by the scrape to identify only those bills which were actually passed and signed by the governor.
this is crucial to testing if the cache is being correctly invalidated.
the template contains a lot of personal preference but it’s been very useful for us and  handful of projects.
#1234syntax so that they are automatically associated in issue tracker.
if you look carefully, you can see me in the back corner of this room, hunched over my laptop.
we often need to take a spreadsheet of info and lay it out in html on deadline.
there are a lot of cool things you can do with tablefu that aren’t illustrated here, andjinja does a ton of stuff, their documentation is pretty extensive.
(photo by joshua ruihley) to do the analysis, we built upon the open states project framework developed by our friends atsunlight labs.
tribune reporter jason grotto has been leading a team of tribune and wgn-tv reporters ona series of investigations into the morass which is the illinois pension system.
it is the first and least glamorous of the tools we created, but crucially, it’s very, very fast.
in april, may, and june we contributed to a joint effort with an esteemed cadre of news nerds to developcensus.ire.org, a site intended to make it easier for journalists to report from census data.
tablesetter can be tweaked in a bunch of different ways to customize the generated table, but as with all specialized tools it has it’s limits.
you will work with a group of talented, passionate folks who enjoy making websites and software.
bees.py up:2 connecting to the hive.
the script knits together three unrelated technologies in order to allow us to test how changes to the site affect the cache: the unittest module provides a convenient framework for isolating tests from one another and python-requests dramatically simplifies the process of making various types of requests and testing the response headers.
this eliminates the possibility of version conflicts and makes setup as easy aspip install -r requirements.txt. 2.
both before and during that project i had been iterating toward a load-testing solution that would meet the challenge of the above quote and provide us with a reasonable certainty that sites of this size (and larger) would not collapse under sudden waves of traffic.
it’s okay to press enter and accept the defaults.
it provides methods to spin up an army of ec2 instances (the bees), assault a target server with a configurable amount of traffic, and then spin those instances back down.
the best thing about this cache testing rig is knowing that if we change something we can easily check if we have broken anything else (i.e. regression testing).
a few projects, most notablypinax, have their own ways to organize large projects.
target successfully fended off the swarm.
the first time we ever tried to create our own tileset, it took hours to render and twice as long to deploy.
using the bees i was able to verify that our new load-balanced and varnished servers could handle a sustained load significantly beyond our requirements.
most of the actual functionality has been abstracted into the testcachingbase base class so the individual tests are brief and readable.
we learned hard lessons about the scale and nuance of the census in the last few months, and along the way, further built out our toolkit for making maps.
if you’re working with csv files or other spreadsheets of data, try it out.
check outthe source code and the other great census resources provided by ire.
two years later, sunlight has continued to invest in open states, which means that the code i contributed then has gotten better without a bit of work from me—you can probably see why we get enthusiastic about open source development.
always request a logger with log = logging.getlogger("project.app.module").
paster create --template=newsapps_project example_project you’ll be asked for staging and production domains, a git repository location and a database password.
on a technical note, one of the nice features of the scrapelib library mentioned above, and the 3.7+ gb of cached web pages, was that as i refined my code to build the index, i was able to run it against the cached documents, which made things much faster.
the unittest module provides a convenient framework for isolating tests from one another and python-requests dramatically simplifies the process of making various types of requests and testing the response headers.
the shape of the data in the spreadsheet lent itself more to a top-ten-style list than a table, so tablesetter was not the best tool for the job.
html/css add a top level id to every kind of page (#race-page, #candidate-page)
it provides methods to spin up an army of ec2 instances (the bees), assault a target server with a configurable amount of traffic, and then spin those instances back down.
if you’re going to be there, please let me know so we can plan to connect early in the conference.
thanks to invar’s parallelizing these tasks, we can now produce a map in minutes and deploy it just as fast.
the newsapps boundary service, now with 100% more django the boundary service is a ready-to-deploy system for aggregating regional boundary data.
here are the things that we need that the default layout doesn’t provide a solution for: separate settings, apache configuration files and wsgi handlers for local development, a staging server and a production server.
if i find myself scraping any other web sites, i’ll definitely use sunlight’s library rather than build my own.
use it to render the custom map tile sets you’re working on in tilemill.
written by ryan mark december 7, 2010 at 5:07 pm posted in python, recipes with 20 comments the challenge you don’t get to start optimizing until you’ve made the servers fucking cry.
gareth’s project is really well organized and addresses all of these issues.
by that point, it appeared that the open states illinois work was not going anywhere, so i worked out the basics of scraping the site and contributed my work to the project.
newsapps_project example_project the template contains a lot of personal preference
in the event a release needs to be redeployed with fixes, increment the sub-version index, e.g. “v3.1” follow the principle of “merge early, merge often” to prevent conflicts.
census.ire.org a simple browser for census data, built with journalists in mind.
the shape of the data in the spreadsheet lent itself more to a top-ten-style list than a table, so tablesetter was not the best tool for the job.
using the fantastictilemill as our starting point, we began to build a toolkit.
check out hack tyler‘s instance for the hot demo boundaryservice.hacktyler.com/. panda panda is your new data research toolkit (to help you search and compare data) & newsroom data management system (‘cuz data stuck on your hard drive is sad data).special thanks for the knight foundation for funding the development!
use python’s built-in logging so that output can be structured for different use-cases.
if you decide to use the bees, please keep in mind the following important caveat: they are, more-or-less a distributed denial-of-service attack in a fancy package and, therefore, if you point them at any server you don’t own you will behavingunethically , have your amazon web services accountlocked-out, and be liable in a court of law for any downtime you cause.
it can be stressful at times, but it’s worth it.
in fact, we now deploy our maps to four separate s3 buckets so that we can take advantage ofleaflet‘s support for round-robining tile requests to multiple subdomains.
cloud commander scripts you can use to quickly build and launch servers in amazon’s cloud — you won’t forget how you built the server if you wrote a script to do it.
among other things, it allows us to keep some configuration (such as a bounding box) in a per-map yaml file.
somebody who has a passion for code and getting things done.
you will make things you will be proud to show mom.
i’ll write some more about the technical details below, but first, there’s a good story.
if you’re working with csv files or other spreadsheets of data, try it out.
bee 0 is firing his machine gun.
for example: render_to_response(‘template’, template_dict, context_instance=requestcontext(request)) put logic in view functions, not in templates.
one comfy aeron chair …all at a desk somewhere in the tribune newsroom, where you’ll be surrounded by reporters arguing with the cops, yelling about the ball game, telling crazy stories, and otherwise practicing their trade.
waiting for bees to load their machine guns... . . . .
(also it makes transition to py3k much easier.)
i usedchris amico’s python clone of propublica’s tablefu and the great templating library jinja.
the swarm has assembled 2 bees.
this test creates a new post on a particular blog, then hits the blog homepage twice to ensure it is cached.
all of them combine to provide us with explicit expectations for reading one another’s code and therefore a much easier time when are obligated to fix it at 10:30, on a sunday, for a monday morning paper.
being something of a documentation and organization junky i took it upon myself to begin to collate a best practices guide.
completed feature branches should be merged into master and deleted from the remote repository so that they are not mistaken for work-in-progress.
$ fab -f bees.py attack:http://your-domain.com/,1000,100 read 2 bees from the roster.
we learned hard lessons about the scale and nuance of the census in the last few months, and along the way, further built out our toolkit for making maps.
get_data dots_per = 1 dots = dotdensityplotter(source, source_layer, dest_driver, dest, dest_layer, get_data_callback, dots_per) dots.plot() a fast and stable process is useless if you can’t repeat it.
you will always be refining your tools and trying out bleeding edge web technologies.
perhaps most exciting, if you’re using the new tilemill 0.4 (available for osx or ubuntu) it can completely automate the production ofwax interactivity grids, such as we used to do the highlighting in our recent maps.
the vcl for the site attaches “x-cache” and “x-cache-hit” debug headers indicating whether the response was a cache hit or miss and if it was a hit how many hits there have been.
i’m also planning to organize an openspace for news developers and perhaps another for those working with government data, if someone doesn’t beat me to them.
just run your script, visit http://localhost:5000/ and see your handiwork.
englewood will divide this number by a "dots_per" value set below and create that many dots for that class within the geography.
$ fab -f bees.py down read 2 bees from the roster.
the second test logs the user in and then out and then, while maintaining the same cookie jar, hits the homepage twice to ensure that the user gets cached results after logging out.
get the code for our simple newsapps varnish plugin for wordpress.
env.get_template(template_file).render(table=table) # write the html string to our output_file o = open(output_file, 'w') o.write(html) o.close() jinja templates are very similar to django templates.
back in february we attacked the less-detailed (redistricting) data for print andthe web.
perhaps the most important lesson i learned from triblocal’s development was that our cache layer was extremely fragile–it was prone to break when a new version of a site was deployed.
bee i-dd450ab6 is ready for the attack.
in our fast-paced environment there is little justification for being confused when it could have been avoided by simply writing it down.
tribune reporter jason grotto has been leading a team of tribune and wgn-tv reporters ona series of investigations into the morass which is the illinois pension system.
and to prepare for this recent release, we even spent a week hacking near-complete prototype maps using data that the census had already released, kings county, new york.
running on my macbook, this took about four days and produced about one gigabyte’s worth of json data files (not to mention over 3.7 gb of cached files from the ilga website.)
use your best judgment, don’t go overboard with the nested rules, just enough to make sure your not going to style the wrong things.
since 2003 alone, the pension laws have been revised nearly 700 times, according to a tribune/wgn-tv analysis.
commit messages that close tickets should use the closes #1234 syntax to automatically tie the commit to the appropriate ticket.
we build good stuff fast and you will become a better programmer.
python follow pep 8 best practices, this means (among other things): four-space tabs are required.
the default django project layout makes it dead simple to learn the framework and get an application up and running.
the solution bees with machines guns is a fabric script that i put together to aggressively load-test our sites.
here are the things that we need that the default layout doesn’t provide a solution for: gareth’s project is really well organized and addresses all of these issues.
perhaps most exciting, if you’re using the new tilemill 0.4 (available for osx or ubuntu) it can completely automate the production ofwax interactivity grids, such as we used to do the highlighting in our recent maps.
i haven’t shared that back with the open states project yet because i want to do it in a way which they believe is extensible to other states.
i then wrote some custom code to analyze the full text of the public act (that is, the version of the bill which was signed into law) to find those which made changes to theillinois pension code.
/dev/null 2>&1 always include the requestcontext when rendering view templates.
i’ll write some more about the technical details below, but first, there’s a good story.
in april, may, and june we contributed to a joint effort with an esteemed cadre of news nerds to developcensus.ire.org, a site intended to make it easier for journalists to report from census data.
a few projects, most notablypinax, have their own ways to organize large projects.
for those who want to cut to the chase, here is the pythonunittest script for testing our varnish cache layer.
we’ve built out afabric configuration which allows us to make these maps in the quickest and most efficient way possible.
the biggest difference that i can discern is the much more powerful template syntax.
thanks to invar’s parallelizing these tasks, we can now produce a map in minutes and deploy it just as fast.
worse yet, minor changes to the vcl configuration frequently had unforeseen consequences that cascaded across the site.
what we needed was a solution that allowed us to use multiple, topographically-close clients to all simultaneously assault our servers with traffic.
back in february we attacked the less-detailed (redistricting) data for print andthe web.
(photo by joshua ruihley) to do the analysis, we built upon the open states project framework developed by our friends atsunlight labs.
fora recent report, i helped them analyze the laws passed by the illinois general assembly to tell the broad story of how we got into this situation.
dot maps let us represent multi-variate data more richly than choropleth maps–for example, illustrating variation in race and population density simultaneously.
in june we launched chicago breaking business, which is, at least in terms of traffic, our largest site so far.
with one comment at pycon 2011 i will be delivering a talk entitled best practices for impossible deadlines, which will go in depth on the incredible variety of ways we’ve found to shave precious hours off the software development process.
each of 2 bees will fire 500 rounds, 50 at a time.
the best thing about this cache testing rig is knowing that if we change something we can easily check if we have broken anything else (i.e. regression testing).
target failed to fully respond to 1 bees.
python setup.py install create a new project from the news apps paste template.
you’ll also be asked for a secret key which is used internally by django.
the first time we ever tried to create our own tileset, it took hours to render and twice as long to deploy.
this particular example is very well-suited to validating caching and scaling strategies.
sometimes this was because our intuitions about the right way to do things were different, other times it was a difference of priorities, but most often it was simply due to a lack of any explicit best practice.
the default django project layout makes it dead simple to learn the framework and get an application up and running.
as a foundation for open states, they’ve made a very robust library calledscrapelib, which can be used to manage caching and robots.txt compliance for any web scraper.
luckly it’s easy to create a rudementary tablesetter clone in python quite quickly.
if i find myself scraping any other web sites, i’ll definitely use sunlight’s library rather than build my own.
this allowed me to produce an index to changes to the pension laws since the 93rd session of the illinois general assembly,in spreadsheet form.
bee 1 is joining the swarm.
built because twitterfeed and other services weren’t fast enough for breaking news.
i haven’t shared that back with the open states project yet because i want to do it in a way which they believe is extensible to other states.
englewood (named after an ailing chicago neighborhood that the newspaper writes many sad stories about) uses the python bindings forgdal to load data from postgis or shapefile.
get the code for our simple newsapps varnish plugin for wordpress.
both before and during that project i had been iterating toward a load-testing solution that would meet the challenge of the above quote and provide us with a reasonable certainty that sites of this size (and larger) would not collapse under sudden waves of traffic.
my intention with chicagonow was to do a much better job of compartmentalizing the various elements of the configuration to ensure changes were idempotent, however, brian had an even better idea: unit tests.
each of 2 bees will fire 500 rounds, 50 at a time.
just run your script, visit http://localhost:5000/ and see your handiwork.
for the last few months my coworkers ryan mark and ryan nagle have been engaged in rebuilding the tribune’s blog-network,chicagonow.com (new version not yet launched).
englewood (named after an ailing chicago neighborhood that the newspaper writes many sad stories about) uses the python bindings forgdal to load data from postgis or shapefile.
then it edits the post that was created and hits the blog homepage once more to ensure that the cache was invalidated.
dot maps let us represent multi-variate data more richly than choropleth maps–for example, illustrating variation in race and population density simultaneously.
on the news apps team, you will help us research, design, and build online news products.
'build/xmas-carols.html' # set up jinja templates.
if you’ve found yourself unsatisfied with the default layout, or you’re using ourfabfile orec2 image, you might be interested in using our project layout.
but it’s been very useful for us and handful of projects.
on a technical note, one of the nice features of the scrapelib library mentioned above, and the 3.7+ gb of cached web pages, was that as i refined my code to build the index, i was able to run it against the cached documents, which made things much faster.
sometimes this was because our intuitions about the right way to do things were different, other times it was a difference of priorities, but most often it was simply due to a lack of any explicit best practice.
if you’re going to be there, please let me know so we can plan to connect early in the conference.
its got an impressive line-up oftalks and tutorials.
by that point, it appeared that the open states illinois work was not going anywhere, so i worked out the basics of scraping the site and contributed my work to the project.
my intention with chicagonow was to do a much better job of compartmentalizing the various elements of the configuration to ensure changes were idempotent, however, brian had an even better idea: unit tests.
it parses this file and handles passing the correct arguments to invar for rendering and deployment.
tablesetter which takes a google spreadsheet and generates an html table.
appengine-autotweeter a simple application for auto-tweeting an rss feed.
a small snippet of python is required to configure englewood.
the traditional load-testing tools we tried (ab, flood, jmeter, etc.), while often useful, suffered from a number of problems when trying to simulate this sort of event: testing clients may have an operating system imposed maximum number of out-bound connections.
we have short deadlines so we work iteratively and try to work closely with our users and stakeholders.
obviously this testing strategy doesn’t attempt to address all scenarios and it should be used in conjunction with traditional testing tools such as jmeter.
do use descriptive lower_case_with_underscores variable names (understanding is much more important than brevity).
the final component in the stack is the python-wordpress-xmlrpc library, which makes it nearly trivial to create posts and comments programmatically.
matters of interest, from the news applications team at the chicago tribune with one comment we are looking for an experienced web developer who can help us build sites for the chicago tribune and chicago tribune media group.
if it isn’t covered by pep 8, refer to idiomatic python, which is far more thorough.
play with transparency–you may want to take advantage of the effect of overlapping transparent dots.
all of them combine to provide us with explicit expectations for reading one another’s code and therefore a much easier time when are obligated to fix it at 10:30, on a sunday, for a monday morning paper.
bee 0 is joining the swarm.
i’m also planning to organize an openspace for news developers and perhaps another for those working with government data, if someone doesn’t beat me to them.
commit messages that reference tickets should use the #1234 syntax so that they are automatically associated in issue tracker.
organize imports in a logical manner: standard libraries first, then third-party libraries, then our own modules.
furthermore, in my first few weeks on the job, some of our reporters came to us interested in general assembly research.
closes #1234syntax to automatically tie the commit to the appropriate ticket.
the vcl for the site attaches “x-cache” and “x-cache-hit” debug headers indicating whether the response was a cache hit or miss and if it was a hit how many hits there have been.
we’ve built out afabric configuration which allows us to make these maps in the quickest and most efficient way possible.
written by joe germuska december 19, 2011 at 3:22 pm posted in craft, open source, python better web cartography with dot density maps and new tools with 16 comments between brian, joe, and myself there hasn’t been a time in the last six months where at least one of us wasn’t working with census data.
get_data dots_per = 1 dots = dotdensityplotter(source, source_layer, dest_driver, dest, dest_layer, get_data_callback, dots_per) dots.plot() deployment a fast and stable process is useless if you can’t repeat it.
check outthe source code and the other great census resources provided by ire.
it does stuff that i always thought django templates should be able to do.
most of the actual functionality has been abstracted into the testcachingbase base class so the individual tests are brief and readable.
this particular example is very well-suited to validating caching and scaling strategies.
the solution bees with machines guns is a fabric script that i put together to aggressively load-test our sites.
i then wrote some custom code to analyze the full text of the public act (that is, the version of the bill which was signed into law) to find those which made changes to theillinois pension code.
$ fab -f bees.py down read 2 bees from the roster.
fora recent report, i helped them analyze the laws passed by the illinois general assembly to tell the broad story of how we got into this situation.
(specifically, i looked for the text40 ilcs 5 which refers to that section of the illinois compiled statues.)
two years later, sunlight has continued to invest in open states, which means that the code i contributed then has gotten better without a bit of work from me—you can probably see why we get enthusiastic about open source development.
among other things, it allows us to keep some configuration (such as a bounding box) in a per-map yaml file.
use ids for elements that are unique to every page in the site.
some minor changes that were made to the illinois general assembly website had broken the scraper for past legislative sessions, but that turned out to be pretty easy to fix, so i was quickly up and running with the 2011 version of the code, and i was able to turn to gathering the data jason needed.
there are a lot of cool things you can do with tablefu that aren’t illustrated here, andjinja does a ton of stuff, their documentation is pretty extensive.
use your best judgment, don’t go overboard with the nested rules, just enough to make sure your not going to style the wrong things.
i usedchris amico’s python clone of propublica’s tablefu and the great templating library jinja.
this eliminates the possibility of version conflicts and makes setup as easy as pip install -r
the biggest difference that i can discern is the much more powerful template syntax.
the traditional load-testing tools we tried (ab, flood, jmeter, etc.), while often useful, suffered from a number of problems when trying to simulate this sort of event: what we needed was a solution that allowed us to use multiple, topographically-close clients to all simultaneously assault our servers with traffic.
worse yet, minor changes to the vcl configuration frequently had unforeseen consequences that cascaded across the site.
if you’ve found yourself unsatisfied with the default layout, or you’re using ourfabfile orec2 image, you might be interested in using our project layout.
as a result, you can see complete examples of both our backend and client-side mapping rigs in the following projects: we hope that we’ve pressed the envelope a bit with these new maps.
a template directory and media directory for the entire project.
testing a staging environment from a development workstation introduces network latency, firewalling, and traffic shaping as variables in the tests.
a separate place for the various primary source data files (csv, json, shape files) we typically have in a project.
the first test fetches the homepage of the site twice and assures that the second request was a hit and also that the max-age header is what we declared it to be in the vcl.
cloud commander scripts you can use to quickly build and launch servers in amazon’s cloud — you won’t forget how you built the server if you wrote a script to do it.
bee 1 lost sight of the target (connection timed out).
this week i got a spreadsheet of christmas carols with youtube embed codes to go along with a story about anorthern illinois university professor and carol expert who recently died.
take note of the logger naming structure so that output can be filtered.
bee i-df450ab4 is ready for the attack. .
but it can quickly get cumbersome as your application grows and you have to figure out how to handle deployment.
in fact, we now deploy our maps to four separate s3 buckets so that we can take advantage ofleaflet‘s support for round-robining tile requests to multiple subdomains.
next we needed to distribute dots across geographies.
a library directory to keep various reusable helper functions that are not django applications.
tablesetter can be tweaked in a bunch of different ways to customize the generated table, but as with all specialized tools it has it’s limits.
but it can quickly get cumbersome as your application grows and you have to figure out how to handle deployment.
testing from a single client will cause amazon’s elastic load balancer to route all connections to a single application server, no matter how many are available.
furthermore, in my first few weeks on the job, some of our reporters came to us interested in general assembly research.
in our fast-paced environment there is little justification for being confused when it could have been avoided by simply writing it down.
some minor changes that were made to the illinois general assembly website had broken the scraper for past legislative sessions, but that turned out to be pretty easy to fix, so i was quickly up and running with the 2011 version of the code, and i was able to turn to gathering the data jason needed.
luckly it’s easy to create a rudementary tablesetter clone in python quite quickly.
we tweaked his templates to match our use case.
stinging url so it will be cached for the attack.
made in conjunction with news hackers from cnn, nyt, spokesman-review, university of nebraska and usa today.
bee 1 is firing his machine gun.
if you decide to use the bees, please keep in mind the following important caveat: they are, more-or-less a distributed denial-of-service attack in a fancy package and, therefore, if you point them at any server you don’t own you will behavingunethically , have your amazon web services accountlocked-out, and be liable in a court of law for any downtime you cause.
} # example argument values passed into the dotdensityplotter # in this case features are read from a postgis table (under_5_by_race_blocks_shapes)...
tablesetter which takes a google spreadsheet and generates an html table.
try the fluorescent colors from the palette ofcrayola crayons.
being the “varnish guy” on the team, i was asked to implement a similar caching strategy to what we had developed fortriblocal.com last summer.
i will be delivering a talk entitled best practices for impossible deadlines, which will go in depth on the incredible variety of ways we’ve found to shave precious hours off the software development process.
$ fab -f bees.py attack:http://your-domain.com/,1000,100 read 2 bees from the roster.
it parses this file and handles passing the correct arguments to invar for rendering and deployment.
its about time that online maps were more than just shading boxes.
the second test logs the user in and then out and then, while maintaining the same cookie jar, hits the homepage twice to ensure that the user gets cached results after logging out.
the newsapps boundary service, now with 100% more django the boundary service is a ready-to-deploy system for aggregating regional boundary data.
javascript don’t use jquery in widgets that will end up on other sites.
using the bees i was able to verify that our new load-balanced and varnished servers could handle a sustained load significantly beyond our requirements.
these setting will be put in the fabfile and will be used for deployment.
(specifically, i looked for the text 40 ilcs 5 which refers to that section of the illinois compiled statues. )
put it another way, what we needed were bees with machine guns.
take note of the logger naming structure so that output can be filtered.
it is the first and least glamorous of the tools we created, but crucially, it’s very, very fast.
some of the code i wrote, like that which extracts the list of statutes impacted by a bill, is probably of general use.
this week i got a spreadsheet of christmas carols with youtube embed codes to go along with a story about anorthern illinois university professor and carol expert who recently died.
then it edits the post that was created and hits the blog homepage once more to ensure that the cache was invalidated.
the spreadsheet was only 25 rows, but i was not about build all the html by hand.
we often need to take a spreadsheet of info and lay it out in html on deadline.
i wrote python code to analyze the data produced by the scrape to identify only those bills which were actually passed and signed by the governor.
this was before the tribapps team was officially formed, but thanks to sunlight, i was in a good position to apply for a spot on the team when it was created.
the swarm has assembled 2 bees.
englewood will divide this number by a "dots_per" value set below and create that many dots for that class within the geography.
obviously this testing strategy doesn’t attempt to address all scenarios and it should be used in conjunction with traditional testing tools such as jmeter.
built because twitterfeed and other services weren’t fast enough for breaking news.
its about time that online maps were more than just shading boxes.
i exported the spreadsheet to a csv file, created a simple html template and wrote a simple script to mash the two together.
feature branches should merge from master as often as is feasible, to prevent merge headaches later on.
last week the census bureau released detailed (summary file) data for illinois, and we used our new tools to produce a couple of maps we’re pretty excited about: 2010 census: same-sex partners in chicagoland 2010 census: children less than five years old (shown above)
this is crucial to testing if the cache is being correctly invalidated.
for the last few months my coworkers ryan mark and ryan nagle have been engaged in rebuilding the tribune’s blog-network,chicagonow.com (new version not yet launched).
with 20 comments you don’t get to start optimizing until you’ve made the servers fucking cry.
since 2003 alone, the pension laws have been revised nearly 700 times, according to a tribune/wgn-tv analysis.
how jason and tribune reporter ray long described illinois’ system in the recent story: pension experts say healthy pension plans require stable, well-structured rules that are rarely altered.
i exported the spreadsheet to a csv file, created a simple html template and wrote a simple script to mash the two together.
being something of a documentation and organization junky i took it upon myself to begin to collate a best practices guide.
a place to put django apps that does not clutter up the root directory of the project.
bee i-df450ab4 is ready for the attack. .
well this script is kinda boring without the template: {% for row in table.rows %} {% if row['year featured']|trim %} {{ row['year featured'] }} {% endif %} {{ row['name'] }} {% if row['youtube'] %} {{ row['youtube']|safe }} {% endif %} written: {{ row['year written'] }} country of origin: {{ row['country of origin'] }} originally by: {{ row['original composer/lyricist'] }} {{ row['other composers/lyricists'] }} {% if row['keywords']|trim %} memorable lyrics {{ row['keywords'] }} {% endif %} {% if row['famous versions']|trim %} famous renditions {{ row['famous versions'] }} {% endif %} {% if row['noteable']|trim %} did you know?
it even has an interesting tool called scrapeshell which is appealing to me as someone who likes interactive code development.
if you don’t feel like dropping back to the shell to run the script to update your html with your new css or html changes, you may want to … sprinkle a little flask into the mix #!
last week the census bureau released detailed (summary file) data for illinois, and we used our new tools to produce a couple of maps we’re pretty excited about: these maps demonstrate a map style we haven’t attempted before: dot density mapping.
written by ryan mark march 8, 2010 at 2:30 pm posted in infrastructure, python with 27 comments at some point during the course of developing the elections center it became clear to me that each of us was spending too much development time trying to understand one another’s code.
check out hack tyler‘s instance for the hot demo boundaryservice.hacktyler.com/. panda panda is your new data research toolkit (to help you search and compare data) & newsroom data management system (‘cuz data stuck on your hard drive is sad data).special thanks for the knight foundation for funding the development!
it’s unfortunate that we lack a good “code coverage” metric for this sort of testing and of course these aren’t true “unit tests,” but using unit testing tools in this way goes a long way toward organizing the logic.
since 2003, the general assembly has filed nearly 60,000 pieces of legislation, but only a few of those became laws, and of course, most of those laws don’t impact the pension codes.
it will install the dependencies: pastescript, cheetah and fabric.
invar command line tools for generating map images from mapnik configuration.
the final component in the stack is the python-wordpress-xmlrpc library, which makes it nearly trivial to create posts and comments programmatically.
the first test fetches the homepage of the site twice and assures that the second request was a hit and also that the max-age header is what we declared it to be in the vcl.
feature branches should be prefixed with the owner’s initials to prevent confusion, e.g. “bb_polls”.
being the “varnish guy” on the team, i was asked to implement a similar caching strategy to what we had developed fortriblocal.com last summer.
env.get_template(template_file).render(table=table) # write the html string to our output_file o = open(output_file, 'w') o.write(html) o.close() jinja templates are very similar to django templates.
that being said, it also provides a pretty interesting example of using ec2 to solve problems that can really only be properly addressed with distributed computing.
use it to render the custom map tile sets you’re working on in tilemill.
